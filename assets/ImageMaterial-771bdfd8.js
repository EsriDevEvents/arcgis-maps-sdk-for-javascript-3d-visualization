import{h as i}from"./Matrix3PassUniform-df6e2166.js";import{n as h}from"./basicInterfaces-7449a8bf.js";import{A as f,l as _,f as P,i as g,k as T,m as A,z as O,S as E,E as n,B as y,h as S}from"./objectResourceUtils-3685cb27.js";import{E as v,u as $}from"./VisualVariablePassParameters-f892560d.js";import{a4 as w,a5 as N}from"./SceneView-7ac05f56.js";import{_ as R}from"./preload-helper-41c905a7.js";import{e as s}from"./jsonMap-ffa742d3.js";import"./ShaderBuilder-be7ca791.js";import{t as D,s as b,e as x,o as I,W as C,h as M,a as L,_ as F}from"./EvaluateSceneLighting.glsl-14c608ff.js";import{r as a}from"./ShaderTechniqueConfiguration-0fa0f78c.js";import{o as u}from"./TransparencyPassType-c3841b0a.js";import{s as U}from"./DefaultTechniqueConfiguration-b54ae0b1.js";import{w as W}from"./ImageMaterial.glsl-2e22ba6f.js";import{R as m}from"./enums-fc527c7c.js";class p extends x{initializeProgram(t){return new I(t.rctx,p.shader.get().build(this.configuration),v)}_setPipelineState(t,e){const o=this.configuration,c=t===u.NONE,d=t===u.FrontFace;return C({blending:o.output!==i.Color&&o.output!==i.Alpha||!o.transparent?null:c?G:f(t),culling:M(o.cullFace),depthTest:{func:_(t)},depthWrite:c?o.writeDepth?L:null:P(t),colorWrite:F,stencilWrite:o.hasOccludees?g:null,stencilTest:o.hasOccludees?e?T:A:null,polygonOffset:c||d?null:O(o.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,e){return e?this._occludeePipelineState:super.getPipelineState(t,e)}}p.shader=new D(W,()=>R(()=>import("./ImageMaterial.glsl-242635fe.js"),["./ImageMaterial.glsl-242635fe.js","./vec2f64-70cfd09e.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./Texture2DPassUniform-268e8d2d.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./TransparencyPassType-c3841b0a.js","./ImageMaterial.glsl-2e22ba6f.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./MultipassTerrainTest.glsl-8b279fcd.js","./ReadLinearDepth.glsl-0e6f5c47.js","./RgbaFloatEncoding.glsl-67199794.js","./AlphaCutoff-96178e0d.js","./FloatPassUniform-0426669b.js"],import.meta.url));const G=b(m.ONE,m.ONE_MINUS_SRC_ALPHA);class r extends U{constructor(){super(...arguments),this.output=i.Color,this.cullFace=h.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=u.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}s([a({count:i.COUNT})],r.prototype,"output",void 0),s([a({count:h.COUNT})],r.prototype,"cullFace",void 0),s([a()],r.prototype,"hasSlicePlane",void 0),s([a()],r.prototype,"transparent",void 0),s([a()],r.prototype,"enableOffset",void 0),s([a()],r.prototype,"writeDepth",void 0),s([a()],r.prototype,"hasOccludees",void 0),s([a({count:u.COUNT})],r.prototype,"transparencyPassType",void 0),s([a()],r.prototype,"hasMultipassTerrain",void 0),s([a()],r.prototype,"cullAboveGround",void 0);class st extends w{constructor(t){super(t,new H),this.supportsEdges=!0,this._configuration=new r}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<E,this._configuration.hasMultipassTerrain=e.multipassTerrain.enabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,e){return e===i.Color||e===i.Alpha||e===i.Highlight?t===n.DRAPED_MATERIAL?!0:e===i.Highlight?t===n.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?n.TRANSPARENT_MATERIAL:n.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:n.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new B(t)}createBufferWriter(){return new y(N)}}class B extends S{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(p,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output!==i.Color&&this._output!==i.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class H extends ${constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=h.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}export{st as c};
