import{_ as Y}from"./preload-helper-41c905a7.js";import{e as d,l as da,a as k,v as ge,y as p,u as y8,s as ss,t as mi,b as v8,c as v$,x as QA,A as Vf,d as b$,o as b8,n as hy,f as i2,g as tt,h as zo,r as w$,i as Ht,j as Bf,k as ox,m as w8,p as T0,q as x8,F as T8,w as ZA,z as C8}from"./jsonMap-ffa742d3.js";import{i as x$}from"./Clonable-7fa7ad97.js";import{s as r2,r as Nd,i as dy,o as E8}from"./Cyclical-47bda305.js";import{a as ie,l as ws,m as vt,g as lx,j as S8,A as R8,D as A8,b as ca,h as dt,v as zf,N as hc,F as cx,i as s2,c as uy}from"./mathUtils-ae09f98b.js";import{t as T,r as _,a as we,u as e0,s as KA,o as sa,e as Et,c as P8,i as T$,p as Us,l as Ze,w as sl,y as gr,h as Le,b as C$,g as hd,f as E$,d as S$,v as X1,z as O8,x as ts,n as Xp,F as M8,j as n2,k as I8,m as jC,q as D8,M as L8,A as R$}from"./typedArrayUtil-bf9f210a.js";import{r as V_,w as kt,o as XC,f as ci,O as qt,a as $8,N as tw,J as F8,K as N8,R as U8,b as a2,P as t0,s as i0,c as JA,d as YC,e as ms,$ as Yd,g as V8,E as o2,A as Y1,S as vg,M as l2,h as Q1,p as B8,L as z8,u as k8,T as A$,I as G8,i as H8,j as q8}from"./Extent-22afa84a.js";import{T as eP,b as iw,a as dd,t as C0,r as W8,n as fs,S as j8,e as Qo}from"./ArrayPool-b51874dd.js";import{n as X8}from"./geometry-7d866d3f.js";import{g as mc}from"./Graphic-5dcfa25e.js";import{v as QC,c as P$}from"./jsonUtils-36bf3d33.js";import{j as Oi,E as tP}from"./Collection-74ae958a.js";import{i as ZC,e as Zs,W as rn,n as U,v as Z1,h as iP,f as Kl,p as Y8,k as Q8,a as O$,t as Z8,w as K8,b as c2,r as rP,c as M$,o as sP}from"./widget-01c21b51.js";import{s as pe,a as ue,b as K1}from"./Error-5cdd6e0a.js";import{f as Ti,E as lh,y as I$,i as ku,g as B_,U as kf,j as za,b as J8,L as eB,A as D$,a as $s,v as Pd,p as Xo,C as r0,D as hp,t as h2,w as tB,d as iB,r as rB}from"./promiseUtils-5940888c.js";import{p as il,n as Gf,h as Vt}from"./string-53224faa.js";import{l as z,h as Je,a as Nr,f as ha,U as ii,j as py,w as er}from"./reactiveUtils-53e5756b.js";import{c as _o,i as Fi,x as _s,p as Hf,d as Xl,u as Rn,e as KC,s as L$}from"./screenUtils-410d12c0.js";import{c as sB}from"./workers-c8fc8d43.js";import{z as K,P as oe,_ as Xe,n as E,o as Z,s as xe,g as W,u as J,A as ns,e as ee,r as qe,t as Pn,a as X,x as Ni,H as Rp,F as po,O as Pe,v as Da,J as gs,Z as nP,X as $$,M as nB,G as dp,b as aB,p as nc,S as Jl,j as On,U as d2,c as so,f as Va,l as Cd,d as oB,q as aP,i as lB,Y as ko,E as cB,V as oP}from"./vec3-8818fe1c.js";import{l as hB,i as F$,a as JC}from"./GraphicsLayer-cbd6e467.js";import{v as s0}from"./HeightModelInfo-73f516f9.js";import{R as up,e as dB,A as u2,r as rw,t as uB,y as pB,g as xs,j as vs,d as Ud,x as In,Z as ch,p as mB,v as sw,a as N$,H as U$,P as fB,f as gB}from"./projection-4ac247db.js";import{u as Ot,f as V$,b as B$,H as _B,D as nl,z as J1,s as Yl,l as Vd,h as Od,E as nw,M as eE,a as my,m as p2,p as m2,o as z$,d as yB,K as vB,q as bB,c as k$,I as np,U as tE,R as lP,y as G$,w as wB,g as cP}from"./aaBoundingRect-2fb32e32.js";import{s as f2,c as We,b as xB,f as z_,n as Ed,E as TB,$ as CB,d as ea,p as al,z as aw,q as EB,h as SB,k as iE,Y as ow,O as g2,W as _2,r as RB,a as H$,e as AB,R as yo,F as PB,g as y2,C as OB,w as MB,i as q$,T as W$}from"./sphere-a48b65b1.js";import{h as aa,o as v2,p as ol,n as bs,e as n0,c as Sr,_ as IB,C as j$,k as b2,z as DB,x as fy,b as mo,r as pp,l as gy,m as w2,B as LB,R as $B,i as dc,H as FB,Q as NB,q as X$,s as Y$,f as Q$,O as UB}from"./mat4-f0dc8788.js";import{e as ve,t as Z$,o as Bd,r as VB}from"./mat4f64-abdda1bb.js";import{v as ag,A as hP,M as x2,b as ap,k as K$}from"./lineSegment-4eb8b6fa.js";import{p as sr,E as BB,A as J$,O as _y,F as zB,x as Ap,U as kB,w as GB,B as eF,J as HB,Y as Js,L as rE,_ as lw,V as ji,T as tF,P as sE,j as ec,b as qB,Q as dP}from"./plane-01584357.js";import{c as WB}from"./spatialReferenceEllipsoidUtils-88aa82c4.js";import{o as jB,r as XB}from"./scaleUtils-a3b834c2.js";import{v as iF,w as YB,d as QB,i as k_,s as qf,l as rF,o as uP,c as pP}from"./layerUtils-eef15b39.js";import{c as og,a as cw,d as T2}from"./HandleOwner-6217a02e.js";import{s as kl}from"./intl-87d72dbe.js";import{s as nE,t as ZB}from"./byteSizeEstimations-f0cab514.js";import{m as hw,L as eb,u as KB,S as sF}from"./number-036ac4ef.js";import{a as JB}from"./AttachmentInfo-23249301.js";import{c as mP}from"./AttachmentQuery-f1085685.js";import{x as e7,h as t7,i as i7}from"./fieldUtils-d430f46c.js";import{u as r7,i as s7,c as nF,a as n7,I as a7,b as aF,d as o7,e as l7,f as a0,g as c7,h as h7}from"./PopupTemplate-81dc9b83.js";import{i as C2,o as d7}from"./arcadeOnDemand-dd48afd7.js";import{a as aE,n as u7}from"./assets-94d592bf.js";import"./ColorStop-29c89bbb.js";import{j as Yp,F as p7,S as hx,J as m7,N as f7,d as g7}from"./utils-6a5cc1bf.js";import{l as li}from"./Color-7b46c33a.js";import{S as _7,p as y7,d as oF,c as lF,i as E2,j as v7,h as b7,e as w7,f as x7}from"./symbols-5f42cb0e.js";import{a as T7}from"./jsonUtils-9b4d797d.js";import{U as G_,o as C7,B as cF}from"./request-09e7d9b2.js";import{m as E7,x as dx}from"./Query-b0193ce7.js";import{s as ux}from"./executeQueryJSON-044ac84b.js";import{c as S7}from"./featureConversionUtils-aead6959.js";import{c as hF,u as dF,o as R7,v as S2,a as A7}from"./Polyline-82cb63bc.js";import{f as P7,i as O7,o as M7}from"./normalizeUtils-353ec0fc.js";import"./pbf-845dcafd.js";import"./FeatureSet-b4fbf079.js";import oE from"./RelationshipQuery-765b2184.js";import"./TopFeaturesQuery-d2b31d08.js";import{l as uF,s as I7}from"./locale-fe7cc1d0.js";import D7 from"./FeatureLayer-e767d294.js";import{s as pF}from"./Identifiable-e4f9b04c.js";import{n as Br}from"./Evented-686173eb.js";import{b as fP}from"./Layer-524734fa.js";import{i as L7,f as mF,e as fF,c as $7,a as gF,n as F7,r as N7}from"./callExpressionWithFeature-eb5719d8.js";import{b as U7}from"./Portal-8dfa7a94.js";import"./persistableUrlUtils-3635dccc.js";import"./PortalGroup-00fb77a4.js";import{e as gP}from"./Connection-3d9fb42e.js";import{t as V7,R as rr,D as tb,I as Mn,a as bi,P as ta,g as B7}from"./Scheduler-61737382.js";import{h as z7,t as k7}from"./ElevationSamplerData-3fc2a90f.js";import{j as i1,p as r1}from"./TileInfo-9973cd47.js";import{s as _P,x as lE}from"./Basemap-5a7c72ee.js";import{n as G7}from"./collectionUtils-423a192d.js";import{o as H7,n as ll}from"./compilerUtils-7bf6df9e.js";import{m as cE}from"./Loadable-40ecd3b9.js";import{l as q7}from"./loadAll-8ca49458.js";import{o as Pp}from"./enumeration-925aa0f6.js";import{r as W7,n as j7}from"./opacityUtils-d4a4b602.js";import{l as ib}from"./CollectionFlattener-80d223f1.js";import{l as X7,d as Y7,t as Q7}from"./TablesMixin-8f62a14c.js";import{T as Z7}from"./TimeExtent-64e16588.js";import{j as o0,b as yy,c as R2}from"./asyncUtils-24bd37b2.js";import{m as K7,_ as J7}from"./Promise-755e47e5.js";import{a as _F}from"./TimeReference-adaa7961.js";import{d as ez}from"./arcgisLayerUrl-1b8d6c52.js";import{l as Se,a as px,o as yP}from"./ViewingMode-5d7d590b.js";import{s as ia,t as tz,e as iz}from"./Ellipsoid-89682c5e.js";import{n as Xt,r as Ai,e as rz,t as dw,_ as Yo,l as Cf}from"./vec4f64-6d0e93be.js";import{r as pi,a as as,E as sz,k as nz,m as vy,l as La,s as Hl,A as bg,b as vP,o as yd,j as Or,g as yF,v as rb,H as az,_ as bP,q as oz,z as Qp}from"./vec2-848c6cf0.js";import{r as Vs,l as uw,E as lz,D as s1,a as Sd,b as wP,w as Jc,s as cz,G as vF,j as hz}from"./vec4-c7a19f0d.js";import{n as Ne,r as ti,f as uc,t as E0,e as dz}from"./vec2f64-70cfd09e.js";import{o as pw,d as zd,a as mw,m as uz,b as di,r as pz,s as by,e as A2,c as P2,v as bF,f as mz,t as fz,x as gz,h as wF,n as xF}from"./PhysicallyBasedRendering.glsl-edd81ba9.js";import{a as mp}from"./ReadLinearDepth.glsl-0e6f5c47.js";import{e as O2,v as _z,I as M2,c as yz,i as vz,E as $r,r as ql,a as Cn,R as I2,n as sb,b as bz,_ as wz,d as xz}from"./WaterSurface.glsl-e13d44e2.js";import{e as en,f as Bt,i as Na,u as TF,a as Ba,r as l0}from"./Texture2DPassUniform-268e8d2d.js";import{e as tn,a as Fs,v as Tz,d as xP,c as Cz,o as Ez,b as TP}from"./View.glsl-879c1eaf.js";import{e as ac}from"./Float4PassUniform-9354414b.js";import{o as yt}from"./FloatPassUniform-0426669b.js";import{o as Hi,a as R,n as ur,i as Op,b as D2}from"./ShaderBuilder-be7ca791.js";import{O as C}from"./VertexAttribute-15d1866a.js";import{e as Wt,o as Gt,W as it,l as os,_ as ut,t as jt,s as fc,L as mx,r as CF,n as Sz,i as EF,c as Rz,a as ka,P as SF,b as Az,h as L2,p as nb,d as Pz,f as Oz,u as RF,M as Mz}from"./EvaluateSceneLighting.glsl-14c608ff.js";import{E as Zt,f as Dn,A as c0,x as Ur,e as Ns,n as Qs,r as fh,a as Yt,i as AF,R as PF,b as OF,h as Mp,o as Iz,c as MF,d as CP,N as Dz,g as hr,j as IF,u as h0,v as DF,k as ab,l as Lz,p as LF,m as $z,y as $2,V as $F,q as FF,s as Fz,t as cl,w as NF,z as Kc,L as UF,B as Nz,C as VF,I as Uz,O as Vz,D as Bz,F as zz,G as kz,H as EP}from"./VisualVariablePassParameters-f892560d.js";import{R as he,I as Ts,E as bt,T as wy,Y as Wr,M as Qt,P as Ke,G as wt,D as Dt,L as Rt,F as ri,V as is,_ as Si,A as Ct,C as oa,U as Ef,B as Gz,N as Qu,S as BF,O as Sf,t as eh,H as Ho,X as fx,n as Eo,W as Hz,r as SP,f as qz}from"./enums-fc527c7c.js";import{r as L,t as Ln}from"./ShaderTechniqueConfiguration-0fa0f78c.js";import{t as Wz}from"./PiUtils.glsl-49462ceb.js";import{e as zF,o as It}from"./TransparencyPassType-c3841b0a.js";import{a as Ip}from"./RgbaFloatEncoding.glsl-67199794.js";import{a as hh,o as gh,g as jz,u as lg,s as kF,i as GF,r as HF,M as hE,h as qF,f as WF,p as Xz}from"./mat3-4fd89d48.js";import{r as oi,a as Yz,n as Zi,t as RP}from"./vec3f32-01c06d8d.js";import{e as Bs}from"./mat3f64-50f3b9f6.js";import{o as _h}from"./ScreenSpacePass.glsl-44cc0c5e.js";import{o as dE,a as Qz,t as AP,i as PP,d as jF,F as n1,c as Zz,W as Kz,b as OP}from"./ForwardLinearDepth.glsl-52bf5bdc.js";import{s as Jz,c as ek,p as kd,a as Tc}from"./HUD.glsl-73b068b4.js";import{o as tk,n as uE}from"./MultipassTerrainTest.glsl-8b279fcd.js";import{H as xy,u as ob,s as XF,l as yi,I as ik,L as rk,i as fw,P as sk,m as nk,p as YF,k as ak,V as Zo,U as Ki,v as ok}from"./Octree-813f29c9.js";import{E as ne,v as Vr,t as d0,u as lk,y as MP,j as vd,A as Qd,h as QF,o as ck,g as F2,b as ZF,O as KF,a as lb,p as IP,N as hk,r as pE,n as DP,c as LP,d as Dp,e as go,l as Lp,f as gw,i as dh,k as fp,m as $p,_ as N2,s as cb,q as JF,w as e5,P as t5,x as U2,z as V2,S as B2,B as u0,C as Ty,D as dk,F as wg,G as uk,H as pk,I as mk,J as $P,K as fk,L as gk,M as _k,Q as yk,V as vk,R as bk,T as wk}from"./objectResourceUtils-3685cb27.js";import{s as gc}from"./DefaultTechniqueConfiguration-b54ae0b1.js";import{r as i5}from"./Transform.glsl-052069d0.js";import{o as ul,m as xk,A as mE,a as r5,f as Tk,e as Ck,u as FP,T as Ek,d as Sk,w as Rk}from"./edgeProcessing-ac701714.js";import{T as Rr}from"./InterleavedLayout-07cc6753.js";import{s as Ae}from"./Attribute-f72d3f37.js";import{n as vo,l as _w,f as Wf,a as rl,g as Ak,c as Pk,t as Ok,e as gx}from"./MeshComponent-777de3ff.js";import{o as z2,n as _x}from"./Indices-f9b34f39.js";import{s as _t,u as NP,l as s5,a as Mk,c as Zp,f as S0,h as Ik}from"./Util-513876a8.js";import{E as ui,c as fE,a as Ch}from"./Texture-d2fa6cd8.js";import{a as Dk,q as UP,g as VP,O as Lk,v as $k,j as Fk,V as Nk,k as Uk}from"./projection-03824933.js";import{h as $,e as n5}from"./Matrix3PassUniform-df6e2166.js";import{S as Vk}from"./quat-77a0169c.js";import{e as Bk}from"./quatf64-f8f1c132.js";import{a as zs,S as Pi,E as Ko,B as k2,Z as G2,c as jf,f as Xf,l as a5,T as H2,N as o5,G as zk,O as kk,_ as l5,p as q2,P as W2,H as Gk,I as Hk,M as Ua,Y as Jo,h as qk,y as c5,F as R0,u as gE,v as Wk}from"./aaBoundingBox-fb003858.js";import{x as Gd,T as hb,i as Hd,u as h5,b as BP,l as Cy,h as jk,c as Ey,d as zP}from"./BufferView-b402c7a7.js";import{V as Xk,H as kP}from"./HUDMaterial.glsl-82200888.js";import{r as wi,o as Yk}from"./context-util-34d303b7.js";import{M as yh,v as Qk,z as Zk}from"./dehydratedFeatures-efdbcd90.js";import{createLabelFunction as Kk}from"./labelFormatUtils-f90ee62f.js";import{t as Yf,i as db,N as a1,n as Fr,D as j2,u as Oa,O as dr,a as H_,s as Sy}from"./basicInterfaces-7449a8bf.js";import{r as Jk,n as eG}from"./ElevationInfo-005ddd87.js";import{A as gt,a as tG,f as d5,e as iG,R as rG,O as GP,n as sG,b as nG}from"./orientedBoundingBox-6188c4d9.js";import{t as ud,n as aG}from"./vec2f32-eaf29605.js";import{u as oG}from"./LineCallout.glsl-76cd336e.js";import{r as Ry}from"./earcut-61f7b102.js";import{t as u5,r as ub,e as p5}from"./vec33-ca555933.js";import{t as lG,e as HP}from"./SnappingCandidate-970faec6.js";import{getVisualVariableValues as m5}from"./visualVariableUtils-61985981.js";import{d as cG,i as hG}from"./TextureOnly.glsl-469cc321.js";import{s as f5,a as dG,p as yx,f as uG}from"./MarkerSizing.glsl-950a18f6.js";import{A as pG,s as mG,r as Rf,j as fG}from"./RibbonLine.glsl-8fe4662b.js";import{v as gG,f as _G,i as yG,a as ho,e as vG,b as bG,c as Af,d as g5,t as wG,g as qP}from"./MixExternalColor.glsl-f5c601ed.js";import{i as xG,s as TG,h as CG,r as EG}from"./MemCache-b4d68123.js";import{u as _5}from"./LineStipple.glsl-4eef2aea.js";import{m as WP}from"./lengthUtils-3c9047c4.js";import{e as jP,o as SG,a as RG}from"./sdfPrimitives-3ceeab79.js";import{G as yw,t as gp}from"./Texture-ae652f15.js";import{d as AG}from"./CIMSymbol-8f55d4ab.js";import{M as PG}from"./LineMarker.glsl-2c017de2.js";import{t as vx}from"./resourceUtils-527631ac.js";import{n as OG,o as y5,r as pb}from"./symbolColorUtils-1c63720c.js";import{v as MG}from"./NativeLine.glsl-9893bc56.js";import{c as IG,t as bx}from"./symbolLayerUtils3D-5cf2dcce.js";import{a as X2,r as Y2}from"./common-d0b63c2d.js";import{i as na}from"./Normals.glsl-6a1bc6fb.js";import{_ as DG,p as LG}from"./Path.glsl-2eb74a31.js";import{f as $G}from"./ColorMaterial.glsl-1d45c81e.js";import{a as pd,T as FG}from"./Pattern.glsl-698f2083.js";import{m as NG,n as UG}from"./DefaultMaterial_COLOR_GAMMA-8ec4380b.js";import{n as VG}from"./RefreshableLayer-12bc7ba2.js";import{n as BG,e as zG,h as kG}from"./LercDecoder-f1486af7.js";import{e as Md,c as GG,r as HG}from"./DefaultMaterial.glsl-58ca0075.js";import{E as no}from"./enums-fb086c25.js";import{e as XP}from"./config-f7904f35.js";import{e as qG}from"./TileKey-4d1284e4.js";import{u as v5,p as WG}from"./Slice.glsl-cd30f0ea.js";import{o as _E}from"./OutputDepth.glsl-17bf0574.js";import{a as b5,i as jG}from"./OutputHighlight.glsl-ca02d1ee.js";import{r as XG}from"./NormalUtils.glsl-84d184a7.js";import{o as yE,r as w5}from"./floatRGBA-1f66d0a4.js";import{u as vw,o as x5,f as Q2}from"./Texture2DDrawUniform-e4341b84.js";import{e as T5}from"./VertexColor.glsl-2f905a78.js";import{t as YG,o as QG}from"./AlphaCutoff-96178e0d.js";import{n as Z2}from"./SSAO.glsl-2c6533cd.js";import{D as A0}from"./workerHelper-2d7b0d57.js";import{t as _p}from"./VertexElementDescriptor-2925c6af.js";import{l as ZG}from"./capabilities-caaa1278.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var vE;let o1=vE=class extends da{constructor(i){super(i),this.type="none"}clone(){return new vE({type:this.type})}};d([Pp({none:"none",stayAbove:"stay-above"})],o1.prototype,"type",void 0),o1=vE=d([k("esri.ground.NavigationConstraint")],o1);let qi=class extends ge{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};d([p()],qi.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([p()],qi.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([p()],qi.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([p()],qi.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([p()],qi.prototype,"LABELS_SHOW_BORDER",void 0),d([p()],qi.prototype,"TEXT_SHOW_BASELINE",void 0),d([p()],qi.prototype,"TEXT_SHOW_BORDER",void 0),d([p()],qi.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([p()],qi.prototype,"OVERLAY_SHOW_CENTER",void 0),d([p()],qi.prototype,"SHOW_POI",void 0),d([p()],qi.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([p()],qi.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([p()],qi.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([p()],qi.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([p()],qi.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([p()],qi.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([p()],qi.prototype,"I3S_TREE_SHOW_TILES",void 0),d([p()],qi.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([p()],qi.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([p()],qi.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([p()],qi.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([p()],qi.prototype,"LINE_WIREFRAMES",void 0),d([p()],qi.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),qi=d([k("esri.views.3d.support.DebugFlags")],qi);const zt=new qi;var bE;let Al=bE=class extends y8(cE){constructor(i){super(i),this.opacity=1,this.shading=!zt.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Oi;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&pe.getLogger(this.declaredClass).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},t=r=>{r.parent=null};this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>t(r.item))}initialize(){this.when().catch(i=>{pe.getLogger(this.declaredClass).error("#load()","Failed to load ground",i)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const i=this.layers.removeAll();for(const e of i)e.destroy();this.layers.destroy()}normalizeCtorArgs(i){return i&&"resourceInfo"in i&&(this._set("resourceInfo",i.resourceInfo),delete(i={...i}).resourceInfo),i}set layers(i){this._set("layers",G7(i,this._get("layers")))}writeLayers(i,e,t,r){const s=[];i&&(r={...r,layerContainerType:"ground"},i.forEach(n=>{if("write"in n){const a={};H7(n)().write(a,r)&&s.push(a)}else r&&r.messages&&r.messages.push(new ue("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(i){return this.addResolvingPromise(this._loadFromSource(i)),Promise.resolve(this)}loadAll(){return q7(this,i=>{i(this.layers)})}async queryElevation(i,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:t}=await Y(()=>import("./ElevationQuery-b9e13d42.js"),["./ElevationQuery-b9e13d42.js","./asyncUtils-24bd37b2.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./ElevationSamplerData-3fc2a90f.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./TileInfo-9973cd47.js"],import.meta.url);Ti(e);const r=new t,s=this.layers.filter(YP).toArray();return r.queryAll(s,i,e)}async createElevationSampler(i,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:t}=await Y(()=>import("./ElevationQuery-b9e13d42.js"),["./ElevationQuery-b9e13d42.js","./asyncUtils-24bd37b2.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./ElevationSamplerData-3fc2a90f.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./TileInfo-9973cd47.js"],import.meta.url);Ti(e);const r=new t,s=this.layers.filter(YP).toArray();return r.createSamplerAll(s,i,e)}clone(){const i={opacity:this.opacity,surfaceColor:il(this.surfaceColor),navigationConstraint:il(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(i.loadStatus="loaded"),new bE({resourceInfo:this.resourceInfo}).set(i)}read(i,e){this.resourceInfo||this._set("resourceInfo",{data:i,context:e}),super.read(i,e)}_loadFromSource(i){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,i):Promise.resolve()}_loadLayersFromJSON(i,e,t){const r=e&&e.origin||"web-scene",s=e&&e.portal||null,n=e&&e.url||null;return Y(()=>import("./layersCreator-b598658c.js"),["./layersCreator-b598658c.js","./Collection-74ae958a.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./lazyLayerLoader-bd5ce8c6.js","./preload-helper-41c905a7.js","./PortalItem-4d7e1038.js","./assets-94d592bf.js","./request-09e7d9b2.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Portal-8dfa7a94.js","./locale-fe7cc1d0.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./portalLayers-c0cd6234.js","./layerUtils-eef15b39.js","./layersLoader-df6c68a4.js","./Layer-524734fa.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Identifiable-e4f9b04c.js","./arcgisLayerUrl-1b8d6c52.js","./persistableUrlUtils-3635dccc.js","./fetchService-bf3bf196.js","./jsonContext-b61ab593.js","./portalItemUtils-0655aa33.js","./projection-4ac247db.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./mat4-f0dc8788.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./styleUtils-5c617777.js","./asyncUtils-24bd37b2.js"],import.meta.url).then(({populateOperationalLayers:a})=>{Ti(t);const o=[];if(i.layers&&Array.isArray(i.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};o.push(a(this.layers,i.layers,l))}return lh(o)}).then(()=>{})}};function KG(i){return i&&"createElevationSampler"in i}function YP(i){return i.type==="elevation"||KG(i)}d([p({json:{read:!1}})],Al.prototype,"layers",null),d([V_("layers")],Al.prototype,"writeLayers",null),d([p({readOnly:!0})],Al.prototype,"resourceInfo",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:eP,read:{reader:W7,source:"transparency"},write:{writer:(i,e)=>{e.transparency=j7(i)},target:"transparency"}}})],Al.prototype,"opacity",void 0),d([p({type:Boolean,nonNullable:!0,json:{read:!1}})],Al.prototype,"shading",void 0),d([p({type:li,json:{type:[eP],write:(i,e)=>{e.surfaceColor=i.toJSON().slice(0,3)}}})],Al.prototype,"surfaceColor",void 0),d([p({type:o1,json:{write:!0}})],Al.prototype,"navigationConstraint",void 0),Al=bE=d([k("esri.Ground")],Al);const mb=Al;function JG(i){var e,t;return!(!(i!=null&&i.loaded)||!((t=(e=iF(i))==null?void 0:e.operations)!=null&&t.supportsEditing)||"editingEnabled"in i&&!YB(i))}const QP=pe.getLogger("esri.support.basemapUtils");function eH(){return{}}function tH(i){for(const e in i){const t=i[e];(t==null?void 0:t.destroyed)===!1&&t.destroy(),delete i[e]}}function iH(i,e){let t;if(typeof i=="string"){if(!(i in _P)){const r=Object.entries(_P).filter(([s,n])=>K1.apiKey&&!n.classic||!K1.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return QP.warn(`Unable to find basemap definition for: ${i}. Try one of these: ${r}`),null}e&&(t=e[i]),t||(t=lE.fromId(i),e&&(e[i]=t))}else t=iw(lE,i);return t!=null&&t.destroyed&&(QP.warn("The provided basemap is already destroyed",{basemap:t}),t=null),t}const ZP={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function rH(i){let e=null;if(typeof i=="string")if(i in ZP){const t=ZP[i];e=new mb({resourceInfo:{data:{layers:[t]}}})}else pe.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${i}. Try "world-elevation"`);else e=iw(mb,i);return e}let Pl=class extends X7(Y7(Br.EventedMixin(ge))){constructor(e){super(e),this.allLayers=new ib({getCollections:()=>{var t,r,s;return[(t=this.basemap)==null?void 0:t.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=Q7(this),this.basemap=null,this.editableLayers=new ib({getCollections:()=>[this.allLayers],itemFilterFunction:JG}),this.ground=new mb,this._basemapCache=eH()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),tH(this._basemapCache),this._basemapCache=null}castBasemap(e){return iH(e,this._basemapCache)}castGround(e){const t=rH(e);return T(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};d([p({readOnly:!0,dependsOn:[]})],Pl.prototype,"allLayers",void 0),d([p({readOnly:!0})],Pl.prototype,"allTables",void 0),d([p({type:lE})],Pl.prototype,"basemap",void 0),d([ss("basemap")],Pl.prototype,"castBasemap",null),d([p({readOnly:!0})],Pl.prototype,"editableLayers",void 0),d([p({type:mb,nonNullable:!0})],Pl.prototype,"ground",void 0),d([ss("ground")],Pl.prototype,"castGround",null),Pl=d([k("esri.Map")],Pl);const sH=Pl;let Bc=class extends x$(da){constructor(...e){super(...e),this.position=new kt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return t!=null&&(n.heading=t),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,t,r,s){const n=e.clone();n.x=dd(e.x||0),n.y=dd(e.y||0),n.z=e.hasZ?dd(e.z||0):e.z,t[r]=n.write({},s)}readPosition(e,t){const r=new kt;return r.read(e,t),r.x=dd(r.x||0),r.y=dd(r.y||0),r.z=r.hasZ?dd(r.z||0):r.z,r}equals(e){return!T(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};d([p({type:kt,json:{write:{isRequired:!0}}})],Bc.prototype,"position",void 0),d([V_("position")],Bc.prototype,"writePosition",null),d([XC("position")],Bc.prototype,"readPosition",null),d([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ss(i=>r2.normalize(dd(i)))],Bc.prototype,"heading",void 0),d([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ss(i=>ie(dd(i),-180,180))],Bc.prototype,"tilt",void 0),d([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Bc.prototype,"fov",void 0),Bc=d([k("esri.Camera")],Bc);const bo=Bc;var wE;let Qh=wE=class extends da{constructor(i){super(i),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(i){return(i%=360)<0&&(i+=360),i}clone(){return new wE({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function wx(){return{enabled:!this.camera}}d([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:wx}}}}})],Qh.prototype,"rotation",void 0),d([ss("rotation")],Qh.prototype,"castRotation",null),d([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:wx}}}}})],Qh.prototype,"scale",void 0),d([p({types:X8,json:{read:QC,write:!0,origins:{"web-scene":{read:QC,write:{overridePolicy:wx}}}}})],Qh.prototype,"targetGeometry",void 0),d([p({type:bo,json:{write:!0}})],Qh.prototype,"camera",void 0),Qh=wE=d([k("esri.Viewpoint")],Qh);const hl=Qh;function yp(i){const e=i[0]*i[0]+i[4]*i[4]+i[8]*i[8],t=i[1]*i[1]+i[5]*i[5]+i[9]*i[9],r=i[2]*i[2]+i[6]*i[6]+i[10]*i[10];return Math.sqrt(Math.max(e,t,r))}function nH(i,e){const t=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return Z(i,t,r,s),i}function Lye(i,e,t){t=t||i;const r=oe(i,e);Z(t,i[0]-r*e[0],i[1]-r*e[1],i[2]-r*e[2]),K(t,t)}function $ye(i,e,t){Math.abs(i[0])>Math.abs(i[1])?Z(e,0,1,0):Z(e,1,0,0),Xe(t,i,e),K(e,e),Xe(e,t,i),K(t,t)}function P0(i,e,t,r,s,n){const a=i+(e-i)*s;return a+(t+(r-t)*s-a)*n}function aH(i,e,t,r=E()){const s=xe(i),n=xe(e),a=oe(i,e)/(s*n);if(a<.9999999999999999){const o=Math.acos(a),l=((1-t)*s+t*n)/Math.sin(o),c=l/s*Math.sin((1-t)*o),h=l/n*Math.sin(t*o);return W(Zu,i,c),W(Ku,e,h),J(r,Zu,Ku)}return ns(r,i,e,t)}function Fye(i,e,t,r=E(),s=E()){const n=xe(i),a=xe(e),o=oe(i,e)/(n*a);if(o<.9999999999999999){const l=Math.acos(o),c=Math.sin(l),h=Math.sin(t*l),u=Math.sin((1-t)*l),m=(1-t)*n+t*a;{const f=m/c,y=f/a*h;W(Zu,i,f/n*u),W(Ku,e,y),J(r,Zu,Ku)}{const f=1/n*(-Math.cos((1-t)*l)*l*m+u*(-n+a));W(Zu,i,f);const y=1/a*(Math.cos(t*l)*l*m+h*(-n+a));W(Ku,e,y),J(s,Zu,Ku),W(s,s,1/c)}return s}return ns(r,i,e,t),ee(s,e,i),K(s,s),s}function l1(i,e,t){i=K(Zu,i),e=K(Ku,e);const r=ws(oe(i,e));if(t){const s=Xe(oH,i,e);if(oe(s,t)<0)return-r}return r}function c1(i){const e=i.length;return t=>{if(t<=i[0][0])return i[0][1];if(t>=i[e-1][0])return i[e-1][1];let r=1;for(;t>i[r][0];)r++;const s=i[r-1][0],n=i[r][0],a=(n-t)/(n-s);return a*i[r-1][1]+(1-a)*i[r][1]}}function Nye(i,e,t,r){ee(KP,e,i),ee(JP,t,i),Xe(r,KP,JP),K(r,r),r[3]=-oe(i,r)}const KP=E(),JP=E(),oH=E(),Zu=E(),Ku=E(),xx=pe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let lH=class{constructor(){this.plane=sr(),this.origin=E(),this.basis1=E(),this.basis2=E()}};const C5=lH;function vh(i=$5){return{plane:sr(i.plane),origin:Pn(i.origin),basis1:Pn(i.basis1),basis2:Pn(i.basis2)}}function cH(i,e,t){const r=wH.get();return r.origin=i,r.basis1=e,r.basis2=t,r.plane=BB(0,0,0,0),bw(r),r}function Fp(i,e=vh()){return K2(i.origin,i.basis1,i.basis2,e)}function hH(i,e){X(e.origin,i.origin),X(e.basis1,i.basis1),X(e.basis2,i.basis2),J$(e.plane,i.plane)}function K2(i,e,t,r=vh()){return X(r.origin,i),X(r.basis1,e),X(r.basis2,t),bw(r),vH(r,"fromValues()"),r}function bw(i){_y(i.basis2,i.basis1,i.origin,i.plane)}function E5(i,e,t){i!==t&&Fp(i,t);const r=W(We.get(),uh(i),e);return J(t.origin,t.origin,r),t.plane[3]-=e,t}function dH(i,e,t){return S5(e,t),E5(t,iR(i,i.origin),t),t}function S5(i,e=vh()){const t=(i[2]-i[0])/2,r=(i[3]-i[1])/2;return Z(e.origin,i[0]+t,i[1]+r,0),Z(e.basis1,t,0,0),Z(e.basis2,0,r,0),zB(0,0,1,0,e.plane),e}function J2(i,e,t){return!!Ap(i.plane,e,t)&&D5(i,t)}function uH(i,e,t){if(J2(i,e,t))return t;const r=R5(i,e,We.get());return J(t,e.origin,W(We.get(),e.direction,Ni(e.origin,r)/xe(e.direction))),t}function R5(i,e,t){const r=fb.get();L5(i,e,r,fb.get());let s=Number.POSITIVE_INFINITY;for(const n of sR){const a=rR(i,n,ww.get()),o=We.get();if(kB(r,a,o)){const l=Rp(We.get(),e.origin,o),c=Math.abs(ws(oe(e.direction,l)));c<s&&(s=c,X(t,o))}}return s===Number.POSITIVE_INFINITY?A5(i,e,t):t}function A5(i,e,t){if(J2(i,e,t))return t;const r=fb.get(),s=fb.get();L5(i,e,r,s);let n=Number.POSITIVE_INFINITY;for(const a of sR){const o=rR(i,a,ww.get()),l=We.get();if(GB(r,o,l)){const c=xB(e,l);if(!eF(s,l))continue;c<n&&(n=c,X(t,l))}}return eR(i,e.origin)<n&&P5(i,e.origin,t),t}function P5(i,e,t){const r=HB(i.plane,e,We.get()),s=hP(eO(i,i.basis1),r,-1,1,We.get()),n=hP(eO(i,i.basis2),r,-1,1,We.get());return ee(t,J(We.get(),s,n),i.origin),t}function O5(i,e,t){const{origin:r,basis1:s,basis2:n}=i,a=ee(We.get(),e,r),o=z_(s,a),l=z_(n,a),c=z_(uh(i),a);return Z(t,o,l,c)}function eR(i,e){const t=O5(i,e,We.get()),{basis1:r,basis2:s}=i,n=xe(r),a=xe(s),o=Math.max(Math.abs(t[0])-n,0),l=Math.max(Math.abs(t[1])-a,0),c=t[2];return o*o+l*l+c*c}function pH(i,e){return Math.sqrt(eR(i,e))}function mH(i,e){let t=Number.NEGATIVE_INFINITY;for(const r of sR){const s=rR(i,r,ww.get()),n=x2(s,e);n>t&&(t=n)}return Math.sqrt(t)}function tR(i,e){return eF(i.plane,e)&&D5(i,e)}function fH(i,e,t,r){return yH(i,t,r)}function iR(i,e){const t=-i.plane[3];return z_(uh(i),e)-t}function gH(i,e,t,r){const s=iR(i,e),n=W(bH,uh(i),t-s);return J(r,e,n),r}function M5(i,e){return po(i.basis1,e.basis1)&&po(i.basis2,e.basis2)&&po(i.origin,e.origin)}function I5(i,e,t){return i!==t&&Fp(i,t),aa(Kp,e),v2(Kp,Kp),Pe(t.basis1,i.basis1,Kp),Pe(t.basis2,i.basis2,Kp),Pe(Js(t.plane),Js(i.plane),Kp),Pe(t.origin,i.origin,e),rE(t.plane,t.plane,t.origin),t}function _H(i,e,t,r){return i!==r&&Fp(i,r),ol(Tx,e,t),Pe(r.basis1,i.basis1,Tx),Pe(r.basis2,i.basis2,Tx),bw(r),r}function uh(i){return Js(i.plane)}function yH(i,e,t){switch(e){case Ed.X:X(t,i.basis1),K(t,t);break;case Ed.Y:X(t,i.basis2),K(t,t);break;case Ed.Z:X(t,uh(i))}return t}function D5(i,e){const t=ee(We.get(),e,i.origin),r=Da(i.basis1),s=Da(i.basis2),n=oe(i.basis1,t),a=oe(i.basis2,t);return-n-r<0&&n-r<0&&-a-s<0&&a-s<0}function eO(i,e){const t=ww.get();return X(t.origin,i.origin),X(t.vector,e),t}function rR(i,e,t){const{basis1:r,basis2:s,origin:n}=i,a=W(We.get(),r,e.origin[0]),o=W(We.get(),s,e.origin[1]);J(t.origin,a,o),J(t.origin,t.origin,n);const l=W(We.get(),r,e.direction[0]),c=W(We.get(),s,e.direction[1]);return W(t.vector,J(l,l,c),2),t}function vH(i,e){Math.abs(oe(i.basis1,i.basis2)/(xe(i.basis1)*xe(i.basis2)))>1e-6&&xx.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(oe(i.basis1,uh(i)))>1e-6&&xx.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-oe(uh(i),i.origin)-i.plane[3])>1e-6&&xx.warn(e,"Plane offset is not consistent with plane origin")}function L5(i,e,t,r){const s=uh(i);_y(s,e.direction,e.origin,t),_y(Js(t),s,e.origin,r)}const $5={plane:sr(),origin:qe(0,0,0),basis1:qe(1,0,0),basis2:qe(0,1,0)},fb=new f2(sr),ww=new f2(ag),bH=E(),wH=new f2(()=>vh()),sR=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Kp=ve(),Tx=ve(),xH=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:C5,UP:$5,altitudeAt:iR,axisAt:fH,closestPoint:A5,closestPointOnSilhouette:R5,copy:Fp,copyWithoutVerify:hH,create:vh,distance:pH,distance2:eR,distanceToSilhouette:mH,elevate:E5,equals:M5,extrusionContainsPoint:tR,fromAABoundingRect:S5,fromValues:K2,intersectRay:J2,intersectRayClosestSilhouette:uH,normal:uh,projectPoint:P5,projectPointLocal:O5,rotate:_H,setAltitudeAt:gH,setExtent:dH,transform:I5,updateUnboundedPlane:bw,wrap:cH},Symbol.toStringTag,{value:"Module"}));function TH(i){const{value:e,operations:t}=i;return{operations:t,value:t.create(e)}}function CH(i,e,t){return i.operations.setExtent(i.value,e,t.value),t}function EH(i){return{operations:i,value:i.create()}}function F5(i,e,t=EH(i)){return t.operations=i,i.copy(e,t.value),t}function SH(i){return F5(CB,TB(0,0,0,qt(i).radius))}const tO=2**50;function RH(){return F5(xH,K2([0,0,0],[tO,0,0],[0,tO,0]))}function AH(i,e,t){return i.operations.axisAt(i.value,e,Ed.Z,t)}function PH(i,e,t,r){return i.operations.axisAt(i.value,e,t,r)}function OH(i,e,t){return i.operations.intersectRay(i.value,e,t)}function MH(i,e,t){return i.operations.intersectRayClosestSilhouette(i.value,e,t)}function IH(i,e){return i.operations.altitudeAt(i.value,e)}function N5(i,e,t,r){return i.operations.setAltitudeAt(i.value,e,t,r)}function DH(i,e,t,r){return e!==r&&bs(r,e),Z(Jp,r[12],r[13],r[14]),N5(i,Jp,t,Jp),r[12]=Jp[0],r[13]=Jp[1],r[14]=Jp[2],r}function Cx(i,e,t){return i.operations.elevate(i.value,e,t.value)}const Jp=E();function iO(i,e,t,r,s){return s[0]=oe(i,e),s[1]=oe(i,t),s[2]=oe(i,r),s}function xE(i,e,t,r,s){X(t,i),X(O0,e),K(O0,O0),Xe(r,O0,t),Xe(s,r,t)}function U5(i,e){return i?WB(e):e.isGeographic?ci.PlateCarree:e}const O0=E(),V5="OBJECTID";let Qf=class extends hB{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{T(t.item)||t.item.parent===this.owner&&(pe.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Qf=d([k("esri.support.AnalysesCollection")],Qf);const h1={widthBreakpoint:{getValue(i){const e=i.viewSize[0],t=i.breakpoints,r=this.values;return e<=t.xsmall?r.xsmall:e<=t.small?r.small:e<=t.medium?r.medium:e<=t.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(i){const e=i.viewSize[1],t=i.breakpoints,r=this.values;return e<=t.xsmall?r.xsmall:e<=t.small?r.small:e<=t.medium?r.medium:e<=t.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(i){const e=i.viewSize,t=e[0],r=e[1],s=this.values;return r>=t?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Ex={xsmall:544,small:768,medium:992,large:1200};function LH(i){const e=i;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function Sx(i,e){return e?h1[i].valueToClassName[e].split(" "):[]}const $H=i=>{let e=class extends i{constructor(...t){super(...t),this._breakpointsHandles=new mi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Ex}initialize(){this._breakpointsHandles.add(z(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Je))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=we(this._breakpointsHandles))}set breakpoints(t){if(t===this._get("breakpoints"))return;const r=LH(t);if(!r){const s=JSON.stringify(Ex,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}t=r?t:Ex,this._set("breakpoints",{...t})}_updateClassNames(){if(!this.container)return;const t=C0.acquire(),r=C0.acquire();let s,n=!1;for(s in h1){const a=this[s],o=h1[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==o&&(n=!0,this[s]=o,Sx(s,a).forEach(l=>r.push(l)),Sx(s,o).forEach(l=>t.push(l)))}n&&(this._applyClassNameChanges(t,r),C0.release(t),C0.release(r))}_applyClassNameChanges(t,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),t.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const t=this.container;if(!t)return;let r;for(r in h1)Sx(r,this[r]).forEach(s=>t.classList.remove(s))}};return d([p()],e.prototype,"breakpoints",null),d([p()],e.prototype,"orientation",void 0),d([p()],e.prototype,"widthBreakpoint",void 0),d([p()],e.prototype,"heightBreakpoint",void 0),e=d([k("esri.views.BreakpointsOwner")],e),e};let Zh=class extends ge{constructor(){super(...arguments),this.items=new Oi,this._watchUpdatingTracking=new og,this._callbacks=new Map,this._projector=ZC(),this._hiddenProjector=ZC()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const r of t.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of t.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(t,n),r.renderNow();const a={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const o=s.domNode.getBoundingClientRect();a.left=o.left,a.top=o.top,a.right=o.right,a.bottom=o.bottom}for(r.detach(n);t.firstChild;)t.removeChild(t.firstChild);return a}overlaps(e,t){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(t);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const t=e.getContext("2d");t.save(),t.font=this._fontString(),this.items.forEach(r=>{t.save(),r.renderCanvas(t),t.restore()}),t.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([p({readOnly:!0})],Zh.prototype,"surface",void 0),d([p({readOnly:!0})],Zh.prototype,"items",void 0),d([p({readOnly:!0})],Zh.prototype,"needsRender",null),d([p({readOnly:!0})],Zh.prototype,"_watchUpdatingTracking",void 0),d([p({readOnly:!0})],Zh.prototype,"updating",null),Zh=d([k("esri.views.overlay.ViewOverlay")],Zh);const rO=Zh;function Pf(i,e,t,r){let s=null,n=1e3;typeof e=="number"?(n=e,r=t):(s=e??null,n=t);let a,o=0;const l=()=>{o=0,i.apply(r,a)},c=(...h)=>{s&&s.apply(r,h),a=h,n?o||(o=setTimeout(l,n)):l()};return c.remove=()=>{o&&(clearTimeout(o),o=0)},c.forceUpdate=()=>{o&&(clearTimeout(o),l())},c.hasPendingUpdates=()=>!!o,c}function FH(i,e,t){return i.units[e][t]}function xw(i,e,t,r=2,s="abbr"){return`${hw(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${FH(i,t,s)}`}function zye(i,e,t,r=2,s="abbr"){const n=$8(e,t);return xw(i,tw(e,t,n),n,r,s)}function kye(i,e,t,r=2,s="abbr"){const n=F8(e,t);return xw(i,tw(e,t,n),n,r,s)}function Gye(i,e,t,r=2,s="abbr"){const n=N8(e,t);return xw(i,tw(e,t,n),n,r,s)}function Hye(i,e,t,r=2,s="abbr"){const n=U8(e,t);return xw(i,tw(e,t,n),n,r,s)}const sO=["B","kB","MB","GB","TB"];function NH(i,e){let t=e===0?0:Math.floor(Math.log(e)/Math.log(nE.KILOBYTES));t=ie(t,0,sO.length-1);const r=hw(e/nE.KILOBYTES**t,{maximumFractionDigits:2});return Gf(i.units.bytes[sO[t]],{fileSize:r})}const UH="esri.widgets.Feature.support.featureUtils",nO=pe.getLogger(UH),VH=/href=(""|'')/gi,BH=/(\{([^\{\r\n]+)\})/g,zH=/\'/g,B5=/^\s*expression\//i,kH=/(\n)/gi,GH=/[\u00A0-\u9999<>\&]/gim,HH=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,qH=/^(?:mailto:|tel:)/,z5="relationships/",TE=sF("short-date-short-time");function k5(i){if(!T(i))return i.get("sourceLayer")||i.get("layer")}async function gb(i,e){return typeof i=="function"?i.call(null,e):i}function G5(i=""){if(i)return!qH.test(i.trim().toLowerCase())}function nR(i){return!!i&&B5.test(i)}function WH(i,e){if(!nR(e)||!i)return null;const t=e.replace(B5,"").toLowerCase();let r=null;return i.some(s=>s.name.toLowerCase()===t&&(r=s,!0)),r}function H5(i,e){const t=WH(e,i==null?void 0:i.fieldName);return t?t.title||null:i?i.label||i.fieldName:null}function jH(i,e){const t=e.get(i.toLowerCase());return`{${t&&t.fieldName||i}}`}function XH(i){return i.replace(VH,"")}function Ay(i,e){const t=aR(e,i);return t?t.name:i}function YH(i,e){return i&&i.map(t=>Ay(t,e))}function aR(i,e){return i&&typeof i.getField=="function"&&e?i.getField(e)??null:null}function q5(i){return`${i}`.trim()}function Ju({attributes:i,globalAttributes:e,layer:t,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?CE({formattedAttributes:e,template:JH(r,{...e,...s,...i},t),fieldInfoMap:n}):""}function CE({formattedAttributes:i,template:e,fieldInfoMap:t}){return q5(XH(Gf(Gf(e,r=>jH(r,t)),i)))}function QH(i,e,t=!1){const r=e[i];if(typeof r=="string"){const s="%27",n=(t?encodeURIComponent(r):r).replace(zH,s);e[i]=n}}function ZH(i,e=!1){const t={...i};return Object.keys(t).forEach(r=>QH(r,t,e)),t}function KH(i,e,t){const r=(e=q5(e))&&e[0]!=="{";return Gf(i,ZH(t,r||!1))}function EE(i,e){return i.replace(BH,(t,r,s)=>{const n=aR(e,s);return n?`{${n.name}}`:r})}function JH(i,e,t){const r=EE(i,t);return r&&r.replace(HH,(s,n,a)=>KH(s,n||a,e))}function eq(i,e){if(typeof i=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const t=Number(i);if(!isNaN(t))return t}return i}function tq(i){return(i==null?void 0:i.type)==="feature"}function aO(i){return!!(i!=null&&i.layer)}function iq(i){return(i==null?void 0:i.type)==="map-image"}function rq(i,e){var c;const t=e.fieldInfos,r=e.fieldName,s=(c=W5(t,r))==null?void 0:c.clone(),n=e.preventPlacesFormatting,a=e.layer,o=aR(a,r);if(s&&(o==null?void 0:o.type)==="date"){const h=s.format||new r7;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!aO(a)&&tq(a)&&a.datesInUnknownTimezone||aO(a)&&iq(a.layer)&&a.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof i=="string"&&t7(r)&&l?l.formatRasterPixelValue(i):typeof(i=eq(i,l))=="string"||i==null||l==null?p0(i):n?hw(i,{...KB(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(i)}function W5(i,e){if(!i||!i.length||!e)return;const t=e.toLowerCase();let r;return i.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==t)&&(r=s,!0)),r}function sq({fieldName:i,graphic:e,layer:t}){if(th(i)||!t||typeof t.getFeatureType!="function")return null;const{typeIdField:r}=t;if(!r||i!==r)return null;const s=t.getFeatureType(e);return s?s.name:null}function nq({fieldName:i,value:e,graphic:t,layer:r}){if(th(i)||!r||typeof r.getFieldDomain!="function")return null;const s=t&&r.getFieldDomain(i,{feature:t});return s&&s.type==="coded-value"?s.getName(e):null}function aq(i,e){const{creatorField:t,creationDateField:r,editorField:s,editDateField:n}=i;if(!e)return;const a=e[n];if(typeof a=="number"){const l=e[s];return{type:"edit",date:eb(a,TE),user:l}}const o=e[r];if(typeof o=="number"){const l=e[t];return{type:"create",date:eb(o,TE),user:l}}return null}function oq(i,e){const t=new Map;return i&&i.forEach(r=>{const s=Ay(r.fieldName,e);r.fieldName=s,t.set(s.toLowerCase(),r)}),t}function oO(i){const e=[];if(!i)return e;const{fieldInfos:t,content:r}=i;return t&&e.push(...t),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&e.push(...n)}}),e}function oR(i){return i.replace(GH,e=>`&#${e.charCodeAt(0)};`)}function p0(i){return typeof i=="string"?i.replace(kH,'<br class="esri-text-new-line" />'):i}function j5(i){const{value:e,fieldName:t,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:a}=i;if(e==null)return"";const o=nq({fieldName:t,value:e,graphic:a,layer:n});if(o)return o;const l=sq({fieldName:t,graphic:a,layer:n});if(l)return l;if(s.get(t.toLowerCase()))return rq(e,{fieldInfos:r||Array.from(s.values()),fieldName:t,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(t)?eb(e,TE):p0(e)}function Rx({fieldInfos:i,attributes:e,layer:t,graphic:r,fieldInfoMap:s,relatedInfos:n}){const a={};return n==null||n.forEach(o=>dq({attributes:a,relatedInfo:o,fieldInfoMap:s,fieldInfos:i,layer:t})),e&&Object.keys(e).forEach(o=>{const l=e[o];a[o]=j5({fieldName:o,fieldInfos:i,fieldInfoMap:s,layer:t,value:l,graphic:r})}),a}async function X5(i,e){var h,u;const{layer:t,graphic:r,outFields:s,objectIds:n,returnGeometry:a,spatialReference:o}=i,l=n[0];if(typeof l!="number"&&typeof l!="string"){const m="Could not query required fields for the specified feature. The feature's ID is invalid.",f={layer:t,graphic:r,objectId:l,requiredFields:s};return nO.warn(m,f),null}if(!((u=(h=iF(t))==null?void 0:h.operations)!=null&&u.supportsQuery)){const m="The specified layer cannot be queried. The following fields will not be available.",f={layer:t,graphic:r,requiredFields:s,returnGeometry:a};return nO.warn(m,f),null}const c=t.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[t.objectIdField],c.returnGeometry=!!a,c.returnZ=!!a,c.returnM=!!a,c.outSpatialReference=o,(await t.queryFeatures(c,e)).features[0]}async function lq(i){var r;if(!((r=i.expressionInfos)!=null&&r.length))return!1;const e=await C2(),{arcadeUtils:{hasGeometryFunctions:t}}=e;return t(i)}async function cq({graphic:i,popupTemplate:e,layer:t,spatialReference:r},s){if(!t||!e||(typeof t.load=="function"&&await t.load(s),!i.attributes))return;const n=i.attributes[t.objectIdField];if(n==null)return;const a=[n],o=await e.getRequiredFields(t.fieldsIndex),l=e7(o,i),c=l?[]:o,h=e.returnGeometry||await lq(e);if(l&&!h)return;const u=await X5({layer:t,graphic:i,outFields:c,objectIds:a,returnGeometry:h,spatialReference:r},s);u&&(u.geometry&&(i.geometry=u.geometry),u.attributes&&(i.attributes={...i.attributes,...u.attributes}))}function th(i=""){return!!i&&i.includes(z5)}function hq(i){return i?`${z5}${i.layerId}/${i.fieldName}`:""}function lO({attributes:i,graphic:e,relatedInfo:t,fieldInfos:r,fieldInfoMap:s,layer:n}){i&&e&&t&&Object.keys(e.attributes).forEach(a=>{const o=hq({layerId:t.relation.id.toString(),fieldName:a}),l=e.attributes[a];i[o]=j5({fieldName:o,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:e})})}function dq({attributes:i,relatedInfo:e,fieldInfoMap:t,fieldInfos:r,layer:s}){i&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach(n=>lO({attributes:i,graphic:n,relatedInfo:e,fieldInfoMap:t,fieldInfos:r,layer:s})),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach(n=>lO({attributes:i,graphic:n,relatedInfo:e,fieldInfoMap:t,fieldInfos:r,layer:s})))}const cO=i=>{if(!i)return!1;const e=i.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},Y5=({layer:i,method:e,query:t,definitionExpression:r})=>{var a,o;if(!((o=(a=i.capabilities)==null?void 0:a.query)!=null&&o.supportsCacheHint)||e==="attachments")return;const s=_(t.where)?t.where:null,n=_(t.geometry)?t.geometry:null;cO(r)||cO(s)||(n==null?void 0:n.type)==="extent"||t.resultType==="tile"||(t.cacheHint=!0)},uq=({query:i,layer:e,method:t})=>{Y5({layer:e,method:t,query:i,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})},pq=({queryPayload:i,layer:e,method:t})=>{Y5({layer:e,method:t,query:i,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})};function mq(i,e,t){return i&&e&&t?hO(i.allLayers,e,t)||hO(i.allTables,e,t):null}function hO(i,e,t){return i.find(r=>r!==e&&r.type==="feature"&&r.url===e.url&&r.layerId===t.relatedTableId)}const dO={editing:!1,operations:{add:!0,update:!0,delete:!0}},Q5=Oi.ofType(JB);let kn=class extends ge{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...dO},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new Q5,this.fileInfos=new Oi,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(z(()=>this.graphic,()=>this._graphicChanged(),Je))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...dO,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return(t==null?void 0:t.loaded)&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new ue("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),s=new mP({objectIds:[r],returnMetadata:!0}),n=[],a=e.queryAttachments(s).then(l=>l[r]||n).catch(()=>n);this._getAttachmentsPromise=a,this.notifyChange("state");const o=await a;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e,t=this.graphic){var l;const{_attachmentLayer:r,attachmentInfos:s,abilities:n}=this;if(!t)throw new ue("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new ue("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=n.operations)!=null&&l.add))throw new ue("invalid-abilities","addAttachment(): add abilities are required.");if(!r||typeof r.addAttachment!="function")throw new ue("invalid-layer","addAttachment(): A valid layer is required.");const a=r.addAttachment(t,e).then(c=>this._queryAttachment(c.objectId,t)),o=await a;return s.add(o),o}async deleteAttachment(e){var l;const{_attachmentLayer:t,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new ue("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=n.operations)!=null&&l.delete))throw new ue("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new ue("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new ue("invalid-graphic","deleteAttachment(): A graphic is required.");const a=t.deleteAttachments(s,[e.id]).then(()=>e),o=await a;return r.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){var h;const{_attachmentLayer:r,attachmentInfos:s,graphic:n,abilities:a}=this;if(!e)throw new ue("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new ue("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!((h=a.operations)!=null&&h.update))throw new ue("invalid-abilities","updateAttachment(): Update abilities are required.");const o=s.findIndex(u=>u===t);if(!r||typeof r.updateAttachment!="function")throw new ue("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new ue("invalid-graphic","updateAttachment(): A graphic is required.");const l=r.updateAttachment(n,t.id,e).then(u=>this._queryAttachment(u.objectId)),c=await l;return s.splice(o,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const r={file:e,form:t};return this.fileInfos.add(r),r}updateFile(e,t,r=this.activeFileInfo){if(!e||!t||!r)return null;const s=this.fileInfos.findIndex(n=>r===n);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:t}),this.fileInfos.items[s]}deleteFile(e){const t=this.fileInfos.find(r=>r.file===e);return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:r}=this;if(!e||!(r!=null&&r.queryAttachments))throw new ue("invalid-attachment-id","Could not query attachment.");const s=this._getObjectId(t),n=new mP({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(n).then(a=>a[s][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=k5(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};d([p()],kn.prototype,"abilities",void 0),d([ss("abilities")],kn.prototype,"castAbilities",null),d([p()],kn.prototype,"activeAttachmentInfo",void 0),d([p()],kn.prototype,"activeFileInfo",void 0),d([p({readOnly:!0,type:Q5})],kn.prototype,"attachmentInfos",void 0),d([p()],kn.prototype,"fileInfos",void 0),d([p({type:mc})],kn.prototype,"graphic",void 0),d([p()],kn.prototype,"mode",void 0),d([p({readOnly:!0})],kn.prototype,"state",null),d([p()],kn.prototype,"filesEnabled",void 0),d([p({readOnly:!0})],kn.prototype,"supportsResizeAttachments",null),kn=d([k("esri.widgets.Attachments.AttachmentsViewModel")],kn);const lR=kn;function uO(i){const e=i.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function fq(i){const e=aE("esri/themes/base/images/files/");return i?i==="text/plain"?`${e}text-32.svg`:i==="application/pdf"?`${e}pdf-32.svg`:i==="text/csv"?`${e}csv-32.svg`:i==="application/gpx+xml"?`${e}gpx-32.svg`:i==="application/x-dwf"?`${e}cad-32.svg`:i==="application/postscript"||i==="application/json"||i==="text/xml"||i==="model/vrml"?`${e}code-32.svg`:i==="application/x-zip-compressed"||i==="application/x-7z-compressed"||i==="application/x-gzip"||i==="application/x-tar"||i==="application/x-gtar"||i==="application/x-bzip2"||i==="application/gzip"||i==="application/x-compress"||i==="application/x-apple-diskimage"||i==="application/x-rar-compressed"||i==="application/zip"?`${e}zip-32.svg`:i.includes("image/")?`${e}image-32.svg`:i.includes("audio/")?`${e}sound-32.svg`:i.includes("video/")?`${e}video-32.svg`:i.includes("msexcel")||i.includes("ms-excel")||i.includes("spreadsheetml")?`${e}excel-32.svg`:i.includes("msword")||i.includes("ms-word")||i.includes("wordprocessingml")?`${e}word-32.svg`:i.includes("powerpoint")||i.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}const pO={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Jt="esri-attachments",Jd="esri-button",Ce={base:Jt,loaderContainer:`${Jt}__loader-container`,loader:`${Jt}__loader`,fadeIn:`${Jt}--fade-in`,container:`${Jt}__container`,containerList:`${Jt}__container--list`,containerPreview:`${Jt}__container--preview`,actions:`${Jt}__actions`,deleteButton:`${Jt}__delete-button`,addAttachmentButton:`${Jt}__add-attachment-button`,errorMessage:`${Jt}__error-message`,items:`${Jt}__items`,item:`${Jt}__item`,itemButton:`${Jt}__item-button`,itemMask:`${Jt}__item-mask`,itemMaskIcon:`${Jt}__item-mask--icon`,itemImage:`${Jt}__image`,itemImageResizable:`${Jt}__image--resizable`,itemLabel:`${Jt}__label`,itemFilename:`${Jt}__filename`,itemChevronIcon:`${Jt}__item-chevron-icon`,itemLink:`${Jt}__item-link`,itemLinkOverlay:`${Jt}__item-link-overlay`,itemLinkOverlayIcon:`${Jt}__item-link-overlay-icon`,itemEditIcon:`${Jt}__item-edit-icon`,itemAddIcon:`${Jt}__item-add-icon`,itemAddButton:`${Jt}__item-add-button`,formNode:`${Jt}__form-node`,fileFieldset:`${Jt}__file-fieldset`,fileLabel:`${Jt}__file-label`,fileName:`${Jt}__file-name`,fileInput:`${Jt}__file-input`,metadata:`${Jt}__metadata`,metadataFieldset:`${Jt}__metadata-fieldset`,progressBar:`${Jt}__progress-bar`,esriWidget:"esri-widget",esriButton:Jd,buttonDisabled:`${Jd}--disabled`,esriButtonSecondary:`${Jd}--secondary`,esriButtonTertiary:`${Jd}--tertiary`,esriButtonThird:`${Jd}--third`,esriButtonSmall:`${Jd}--small`,esriButtonHalf:`${Jd}--half`,empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},Ax=window.CSS;let qs=class extends rn{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...pO},this._supportsImageOrientation=Ax&&Ax.supports&&Ax.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.viewModel||(this.viewModel=new lR),this.addHandles([Nr(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Nr(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),z(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Je)])}loadDependencies(){return Promise.all([Y(()=>import("./calcite-icon-abf9d6bc.js"),["./calcite-icon-abf9d6bc.js","./icon-e2d88df4.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./observers-955fedd9.js"],import.meta.url)])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...pO,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new ue("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new ue("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new ue("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){var r;const t=this.viewModel.deleteFile(e||((r=this.viewModel.activeFileInfo)==null?void 0:r.file));return this.viewModel.mode="view",t}render(){const{submitting:e,viewModel:t}=this,{state:r}=t;return U("div",{class:this.classes(Ce.base,Ce.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?U("div",{key:"error-message",class:Ce.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:t,activeAttachmentInfo:r}=this.viewModel;return t==="add"?this.renderAddForm():t==="edit"?this.renderDetailsForm(r||e):this.renderAttachmentContainer()}renderLoading(){return U("div",{class:Ce.loaderContainer,key:"loader"},U("div",{class:Ce.loader}))}renderProgressBar(){return this.visibleElements.progressBar?U("div",{class:Ce.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,r=e||!t,s=this.visibleElements.cancelAddButton?U("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Ce.esriButton,Ce.esriButtonTertiary,Ce.esriButtonSmall,Ce.esriButtonHalf,e&&Ce.buttonDisabled)},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?U("button",{type:"submit",disabled:r,class:this.classes(Ce.esriButton,Ce.esriButtonSecondary,Ce.esriButtonSmall,Ce.esriButtonHalf,{[Ce.buttonDisabled]:r})},this.messages.add):null,a=t?U("span",{key:"file-name",class:Ce.fileName},t.name):null,o=U("form",{bind:this,afterCreate:Z1,afterRemoved:iP,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},U("fieldset",{class:Ce.fileFieldset},a,U("label",{class:this.classes(Ce.fileLabel,Ce.esriButton,Ce.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,U("input",{class:Ce.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,s);return U("div",{key:"add-form-container",class:Ce.formNode},o)}renderDetailsForm(e){var S,P,A;const{visibleElements:t,viewModel:r,selectedFile:s,submitting:n}=this,{abilities:a}=r,o=n||!s;let l,c,h,u;s?(l=s.type,c=s.name,h=s.size):e&&"file"in e?(l=e.file.type,c=e.file.name,h=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,h=e.size,u=e.url);const m=a.editing&&((S=a.operations)!=null&&S.delete)&&t.deleteButton?U("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:M=>this._submitDeleteAttachment(M,e),class:this.classes(Ce.esriButton,Ce.esriButtonSmall,Ce.esriButtonTertiary,Ce.deleteButton,{[Ce.buttonDisabled]:n})},this.messages.delete):void 0,f=a.editing&&((P=a.operations)!=null&&P.update)&&t.updateButton?U("button",{disabled:o,key:"update-button",type:"submit",class:this.classes(Ce.esriButton,Ce.esriButtonSmall,Ce.esriButtonThird,{[Ce.buttonDisabled]:o})},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?U("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Ce.esriButton,Ce.esriButtonSmall,Ce.esriButtonTertiary,Ce.esriButtonThird,{[Ce.buttonDisabled]:n})},this.messages.cancel):void 0,g=a.editing&&((A=a.operations)!=null&&A.update)?U("fieldset",{key:"file",class:Ce.fileFieldset},U("span",{key:"file-name",class:Ce.fileName},c),U("label",{class:this.classes(Ce.fileLabel,Ce.esriButton,Ce.esriButtonSecondary)},this.messages.changeFile,U("input",{class:Ce.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,v=U("fieldset",{key:"size",class:Ce.metadataFieldset},U("label",null,NH(this.messagesUnits,h??0))),b=U("fieldset",{key:"content-type",class:Ce.metadataFieldset},U("label",null,l)),x=_(u)?U("a",{class:Ce.itemLink,href:u,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),U("div",{class:Ce.itemLinkOverlay},U("span",{class:Ce.itemLinkOverlayIcon},U("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),w=U("form",{bind:this,afterCreate:Z1,afterRemoved:iP,"data-node-ref":"_updateAttachmentForm",onsubmit:M=>this._submitUpdateAttachment(M,e)},U("div",{class:Ce.metadata},v,b),g,U("div",{class:Ce.actions},m,y,f));return U("div",{key:"edit-form-container",class:Ce.formNode},x,w)}renderImageMask(e,t){return e?"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,t):null}renderGenericImageMask(e,t){const{supportsResizeAttachments:r}=this.viewModel,s=fq(t),n={[Ce.itemImageResizable]:r};return U("div",{class:this.classes(Ce.itemMaskIcon,Ce.itemMask)},U("img",{title:e,alt:e,src:s,class:this.classes(n,Ce.itemImage)}))}renderImageMaskForAttachment(e,t){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:s,name:n,url:a}=e;if(!r||!uO(s))return this.renderGenericImageMask(n,s);const o=this._getCSSTransform(e),l=o?{transform:o,"image-orientation":"none"}:{},c=`${a}${a!=null&&a.includes("?")?"&":"?"}w=${t}`,h={[Ce.itemImageResizable]:r};return U("div",{class:this.classes(Ce.itemMask)},U("img",{styles:l,alt:n,title:n,src:c,class:this.classes(h,Ce.itemImage)}))}renderFile(e){const{file:t}=e;return U("li",{class:Ce.item,key:t},U("button",{key:"details-button",bind:this,class:Ce.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),U("label",{class:Ce.itemLabel},U("span",{class:Ce.itemFilename},t.name||this.messages.noTitle),U("span",{"aria-hidden":"true",class:this.classes(Ce.itemChevronIcon,Kl(this.container)?Ce.iconLeft:Ce.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:r,effectiveDisplayType:s}=this,{abilities:n,supportsResizeAttachments:a}=r,{contentType:o,name:l,url:c}=e,h=this.renderImageMask(e,t==="list"?48:400),u=n.editing?U("span",{"aria-hidden":"true",class:this.classes(Ce.itemChevronIcon,Kl(this.container)?Ce.iconLeft:Ce.iconRight)}):null,m=[h,s==="preview"&&a&&uO(o)?null:U("label",{class:Ce.itemLabel},U("span",{class:Ce.itemFilename},l||this.messages.noTitle),u)],f=n.editing?U("button",{key:"details-button",bind:this,class:Ce.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},m):U("a",{key:"details-link",class:Ce.itemButton,href:c??void 0,target:"_blank"},m);return U("li",{class:Ce.item,key:e},f)}renderAttachmentContainer(){var y;const{effectiveDisplayType:e,viewModel:t,visibleElements:r}=this,{attachmentInfos:s,abilities:n,fileInfos:a}=t,o=!!(s!=null&&s.length),l=!!(a!=null&&a.length),c={[Ce.containerList]:e!=="preview",[Ce.containerPreview]:e==="preview"},h=n.editing&&((y=n.operations)!=null&&y.add)&&r.addButton?U("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Ce.esriButton,Ce.esriButtonTertiary,Ce.addAttachmentButton),type:"button"},U("span",{"aria-hidden":"true",class:this.classes(Ce.itemAddIcon,Ce.iconPlus)}),this.messages.add):void 0,u=o?U("ul",{key:"attachments-list",class:Ce.items},s.toArray().map(g=>this.renderAttachmentInfo({attachmentInfo:g,displayType:e}))):void 0,m=l?U("ul",{key:"file-list",class:Ce.items},a.toArray().map(g=>this.renderFile(g))):void 0,f=l||o?void 0:U("div",{class:Ce.empty},this.messages.noAttachments);return U("div",{key:"attachments-container",class:this.classes(Ce.container,c)},u,m,f,h)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,r=t&&t.files&&t.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){const{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};d([p()],qs.prototype,"abilities",null),d([p()],qs.prototype,"displayType",void 0),d([p({readOnly:!0})],qs.prototype,"effectiveDisplayType",null),d([p()],qs.prototype,"graphic",null),d([p()],qs.prototype,"label",null),d([p(),Zs("esri/widgets/Attachments/t9n/Attachments")],qs.prototype,"messages",void 0),d([p(),Zs("esri/core/t9n/Units")],qs.prototype,"messagesUnits",void 0),d([p({readOnly:!0})],qs.prototype,"selectedFile",void 0),d([p({readOnly:!0})],qs.prototype,"submitting",void 0),d([p({readOnly:!0})],qs.prototype,"error",void 0),d([p({type:lR})],qs.prototype,"viewModel",void 0),d([p()],qs.prototype,"visibleElements",void 0),d([ss("visibleElements")],qs.prototype,"castVisibleElements",null),qs=d([k("esri.widgets.Attachments")],qs);const gq=qs;let o_=class extends lR{constructor(e){super(e),this.description=null,this.title=null}};d([p()],o_.prototype,"description",void 0),d([p()],o_.prototype,"title",void 0),o_=d([k("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],o_);const cR=o_,_q={heading:"esri-widget__heading"};function hR({level:i,class:e,...t},r){const s=yq(i);return U(`h${s}`,{...t,class:Y8(_q.heading,e),role:"heading","aria-level":String(s)},r)}function yq(i){return ie(Math.ceil(i),1,6)}const Px="esri-feature-element-info",Ox={base:Px,title:`${Px}__title`,description:`${Px}__description`};let Gm=class extends rn{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return U("div",{class:Ox.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?U(hR,{level:this.headingLevel,class:Ox.title},e):null}renderDescription(){const{description:e}=this;return e?U("div",{key:"description",class:Ox.description},e):null}};d([p()],Gm.prototype,"description",void 0),d([p()],Gm.prototype,"headingLevel",void 0),d([p()],Gm.prototype,"title",void 0),Gm=d([k("esri.widgets.Feature.support.FeatureElementInfo")],Gm);const Tw=Gm,vq={base:"esri-feature-attachments"};let Ol=class extends rn{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new gq,this.headingLevel=2,this.viewModel=new cR}initialize(){this._featureElementInfo=new Tw,this.addHandles([z(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Je),z(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,Je)])}destroy(){var e;this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var t;const{attachmentsWidget:e}=this;return U("div",{class:vq.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var s;const{description:e,title:t,headingLevel:r}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:t,headingLevel:r})}};d([p({readOnly:!0})],Ol.prototype,"attachmentsWidget",void 0),d([p()],Ol.prototype,"description",null),d([p()],Ol.prototype,"displayType",null),d([p()],Ol.prototype,"graphic",null),d([p()],Ol.prototype,"headingLevel",void 0),d([p()],Ol.prototype,"title",null),d([p({type:cR})],Ol.prototype,"viewModel",void 0),Ol=d([k("esri.widgets.Feature.FeatureAttachments")],Ol);const bq=Ol;let Kh=class extends cw(ge){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(z(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},Je))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:r}=this;e&&t&&(gb(r,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const t=this.graphic;if(!t||!e)return;const r=gb(e,{graphic:t}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const s=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};d([p({readOnly:!0})],Kh.prototype,"created",void 0),d([p()],Kh.prototype,"creator",void 0),d([p()],Kh.prototype,"destroyer",void 0),d([p({type:mc})],Kh.prototype,"graphic",void 0),d([p({readOnly:!0})],Kh.prototype,"state",null),Kh=d([k("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Kh);const _b=Kh;function to(){return function(i,e){if(!i[e])throw new TypeError(`Cannot auto bind undefined function '${e}'`);return{value:xq(i[e])}}}function wq(i){const e=i==null?void 0:i.type;return i instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function xq(i){return function(e,...t){wq(e)?Q8(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):i.call(this,e,...t)}}function Tq(i){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const t=e._delegatedEventNames,r=Array.isArray(i)?i:Cq(i);t.push(...r)}}function Cq(i){return i.split(",").map(e=>e.trim())}const Z5="calcite-mode-";function Eq(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replace(/\s|'|"/g,"")}function yb(){return Eq().startsWith("dark")}function Sq(){return`${Z5}${yb()?"dark":"light"}`}function Rq(i){Aq(i),i.classList.add(Sq())}function Aq(i){Array.from(i.classList).forEach(e=>{e.startsWith(Z5)&&i.classList.remove(e)})}const Mx="esri-feature-content",Ix={base:Mx,loaderContainer:`${Mx}__loader-container`,loader:`${Mx}__loader`};let Hm=class extends rn{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(s=>{G5(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}renderLoading(){return U("div",{class:Ix.loaderContainer,key:"loader"},U("div",{class:Ix.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?U("div",{key:e,bind:e,afterCreate:this._attachToNode}):O$(e)?U("div",{key:e},!e.destroyed&&e.render()):U("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return U("div",{class:Ix.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};d([p()],Hm.prototype,"creator",null),d([p()],Hm.prototype,"graphic",null),d([p({type:_b})],Hm.prototype,"viewModel",void 0),Hm=d([k("esri.widgets.Feature.FeatureContent")],Hm);const d1=Hm;let zc=class extends ge{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,r=[];return t==null||t.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;const n=s.clone();n.label=H5(n,e),r.push(n)}),r}};d([p()],zc.prototype,"attributes",void 0),d([p({type:[s7]})],zc.prototype,"expressionInfos",void 0),d([p()],zc.prototype,"description",void 0),d([p({type:[nF]})],zc.prototype,"fieldInfos",void 0),d([p({readOnly:!0})],zc.prototype,"formattedFieldInfos",null),d([p()],zc.prototype,"title",void 0),zc=d([k("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],zc);const Cw=zc,Pq=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Oq(i){let e=null;return Pq.some(t=>(t.pattern.test(i)&&(e=t),!!e)),e}function Mq(i,e){if(typeof e!="string"||!e)return e;const t=Oq(e);if(!t)return e;const r=e.match(t.pattern),s=r&&r[2],n=Gf(Gf(t.label,{messages:i,hierPart:s}),{appName:t.appName}),a=t.target?` target="${t.target}"`:"",o=t.target==="_blank"?' rel="noreferrer"':"";return e.replace(t.pattern,`<a${a} href="$1"${o}>${n}</a>`)}const M0="esri-feature-fields",xg={base:M0,fieldHeader:`${M0}__field-header`,fieldData:`${M0}__field-data`,fieldDataDate:`${M0}__field-data--date`,esriTable:"esri-widget__table"};let Do=class extends rn{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new Cw,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Tw,this.addHandles(z(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Je))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,t){const{attributes:r}=this.viewModel,s=e.fieldName,n=e.label||s,a=r?r[s]==null?"":r[s]:"",o=!(!e.format||!e.format.dateFormat),l=typeof a=="number"&&!o?this._forceLTR(a):Mq(this.messagesURIUtils,a),c={[xg.fieldDataDate]:o};return U("tr",{key:`fields-element-info-row-${s}-${t}`},U("th",{key:`fields-element-info-row-header-${s}-${t}`,class:xg.fieldHeader,innerHTML:n}),U("td",{key:`fields-element-info-row-data-${s}-${t}`,class:this.classes(xg.fieldData,c),innerHTML:l}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?U("table",{class:xg.esriTable,summary:this.messages.fieldsSummary},U("tbody",null,e.map((t,r)=>this.renderFieldInfo(t,r)))):null}render(){var e;return U("div",{class:xg.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){var r;const{description:e,title:t}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};d([p()],Do.prototype,"attributes",null),d([p()],Do.prototype,"description",null),d([p()],Do.prototype,"expressionInfos",null),d([p()],Do.prototype,"fieldInfos",null),d([p()],Do.prototype,"title",null),d([p({type:Cw,nonNullable:!0})],Do.prototype,"viewModel",void 0),d([p(),Zs("esri/widgets/Feature/t9n/Feature")],Do.prototype,"messages",void 0),d([p(),Zs("esri/widgets/support/t9n/uriUtils")],Do.prototype,"messagesURIUtils",void 0),Do=d([k("esri.widgets.Feature.FeatureFields")],Do);const K5=Do,Iq={maximumFractionDigits:20};function Dq(i){return hw(i,Iq)}const Lq="<",$q=">",Fq=sF("short-date");function Nq(i,e,t,r){let s="";e===0?s=`${Lq} `:e===t&&(s=`${$q} `);let n=null;return n=r?eb(i,Fq):Dq(i),s+n}const Uq=new li([64,64,64]);function Vq(i,e){const t=[],r=i.length-1;return i.length===5?t.push(0,2,4):t.push(0,r),i.map((s,n)=>t.includes(n)?Nq(s,n,r,e):null)}async function Bq(i,e,t){let r=!1,s=[],n=[];if(i.stops){const c=i.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const a=s[0],o=s[s.length-1];if(a==null&&o==null)return null;const l=r?null:Vq(s,t??!1);return(await Promise.all(s.map(async(c,h)=>({value:c,color:i.type==="opacity"?await zq(c,i,e):(await Y(()=>import("./visualVariableUtils-61985981.js"),["./visualVariableUtils-61985981.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./typedArrayUtil-bf9f210a.js","./ArrayPool-b51874dd.js","./string-53224faa.js","./Error-5cdd6e0a.js","./Graphic-5dcfa25e.js","./jsonMap-ffa742d3.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./sizeVariableUtils-d4870b0d.js"],import.meta.url)).getColor(i,c),label:r?n[h]:(l==null?void 0:l[h])??""})))).reverse()}async function zq(i,e,t=Uq){const r=new li(t),s=(await Y(()=>import("./visualVariableUtils-61985981.js"),["./visualVariableUtils-61985981.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./typedArrayUtil-bf9f210a.js","./ArrayPool-b51874dd.js","./string-53224faa.js","./Error-5cdd6e0a.js","./Graphic-5dcfa25e.js","./jsonMap-ffa742d3.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./sizeVariableUtils-d4870b0d.js"],import.meta.url)).getOpacity(e,i);return s!=null&&(r.a=s),r}function kq(i){if(!i.colorStops)return[];const e=[...i.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let t=e.length-1;if(e&&e[0]){const r=e[t];r&&r.ratio!==1&&(e.push(new T7({ratio:1,color:r.color})),t++)}return e.map((r,s)=>{var a,o;let n="";return s===0?n=((a=i.legendOptions)==null?void 0:a.minLabel)||"low":s===t&&(n=((o=i.legendOptions)==null?void 0:o.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}pe.getLogger("esri.renderers.support.utils");async function pa(i,e,t){W8(i,e,()=>[]).push(...t)}async function Gq(i){var t,r;const e=new Map;if(!i)return e;if("visualVariables"in i&&i.visualVariables){const s=i.visualVariables.filter(n=>n.type==="color");for(const n of s){const a=(await Bq(n)??[]).map(o=>o.color);await pa(e,n.field||n.valueExpression,a)}}if(i.type==="heatmap"){const s=kq(i).map(n=>n.color);await pa(e,i.field||i.valueExpression,s)}else if(i.type==="pie-chart"){for(const s of i.attributes)await pa(e,s.field||s.valueExpression,[s.color]);await pa(e,"default",[(t=i==null?void 0:i.othersCategory)==null?void 0:t.color,Yp(i.backgroundFillSymbol,null)])}else if(i.type==="dot-density"){for(const s of i.attributes)await pa(e,s.field||s.valueExpression,[s.color]);await pa(e,"default",[i.backgroundColor])}else if(i.type==="unique-value")if(((r=i.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of i.uniqueValueInfos??[])await pa(e,s.value.toString(),[Yp(s.symbol,null)]);else{const s=(i.uniqueValueInfos??[]).map(c=>Yp(c.symbol,null)),{field:n,field2:a,field3:o,valueExpression:l}=i;(n||l)&&await pa(e,n||l,s),a&&await pa(e,a,s),o&&await pa(e,o,s)}else if(i.type==="class-breaks"){const s=i.classBreakInfos.map(o=>Yp(o.symbol,null)),{field:n,valueExpression:a}=i;await pa(e,n??a,s)}else i.type==="simple"&&await pa(e,"default",[Yp(i.symbol,null)]);return"defaultSymbol"in i&&i.defaultSymbol&&await pa(e,"default",[Yp(i.defaultSymbol,null)]),e.forEach((s,n)=>{const a=e0(s.filter(Boolean),(o,l)=>JSON.stringify(o)===JSON.stringify(l));e.set(n,a)}),e}const Hq="esri.widgets.Feature.support.relatedFeatureUtils",mO=pe.getLogger(Hq),fO=new Map;function u1(i){if(!th(i))return null;const[e,t]=i.split("/").slice(1);return{layerId:e,fieldName:t}}function qq(i,e){if(!e.relationships)return null;let t=null;const{relationships:r}=e;return r.some(s=>s.id===parseInt(i,10)&&(t=s,!0)),t}function Wq({originRelationship:i,relationships:e,layerId:t}){let r=null;return e&&e.some(s=>(`${s.relatedTableId}`===t&&s.id===(i==null?void 0:i.id)&&(r=s),!!r)),r}function jq(i,e){const t=e.toLowerCase();for(const r in i)if(r.toLowerCase()===t)return i[r];return null}function Xq(i,e){const t=qq(i,e);if(t)return{url:`${e.url}/${t.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:t,relatedFields:[],outStatistics:[]}}function Yq(i,e){if(!e||!i)return;const{features:t,statsFeatures:r}=i,s=t&&t.value;e.relatedFeatures=s?s.features:[];const n=r&&r.value;e.relatedStatsFeatures=n?n.features:[]}function Qq(i,e,t,r){var n;const s=new oE;return s.outFields=["*"],s.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),s.objectIds=[i.attributes[t.objectIdField]],((n=t.queryRelatedFeatures)==null?void 0:n.call(t,s,r))??Promise.resolve({})}function Zq(i,e,t){let r=0;const s=[];for(;r<e.length;)s.push(`${i} IN (${e.slice(r,t+r)})`),r+=t;return s.join(" OR ")}async function Kq(i,e,t,r){const s=t.layerId.toString(),{layerInfo:n,relation:a,relatedFields:o,outStatistics:l,url:c,sourceSpatialReference:h}=e;if(!n||!a)return null;const u=Wq({originRelationship:a,relationships:n.relationships,layerId:s});if(u!=null&&u.relationshipTableId&&u.keyFieldInRelationshipTable){const f=(await Qq(i,u,t,r))[i.attributes[t.objectIdField]];if(!f)return null;const y=f.features.map(g=>g.attributes[n.objectIdField]);if(l!=null&&l.length&&n.supportsStatistics){const g=new dx;g.where=Zq(n.objectIdField,y,1e3),g.outFields=o,g.outStatistics=l,g.sourceSpatialReference=h;const v={features:Promise.resolve(f),statsFeatures:ux(c,g)};return lh(v)}}const m=u==null?void 0:u.keyField;if(m){const f=i7(rW(n.fields,m)),y=jq(i.attributes,a.keyField),g=f?`${m}=${y}`:`${m}='${y}'`,v=ux(c,new dx({where:g,outFields:e.relatedFields,sourceSpatialReference:h}),r),b=e.outStatistics&&e.outStatistics.length>0&&n.supportsStatistics?ux(c,new dx({where:g,outFields:e.relatedFields,outStatistics:e.outStatistics,sourceSpatialReference:h}),r):null,x={features:v};return b&&(x.statsFeatures=b),lh(x)}return null}function Jq(i,e){return G_(i,{query:{f:"json"},signal:e&&e.signal})}function eW({relatedInfos:i,layer:e},t){const r={};return i.forEach((s,n)=>{const{relation:a}=s;if(!a){const u=new ue("relation-required","A relation is required on a layer to retrieve related records.");throw mO.error(u),u}const{relatedTableId:o}=a;if(typeof o!="number"){const u=new ue("A related table ID is required on a layer to retrieve related records.");throw mO.error(u),u}const l=`${e.url}/${o}`,c=fO.get(l),h=c||Jq(l);c||fO.set(l,h),r[n]=h}),I$(lh(r),t)}function tW({graphic:i,relatedInfos:e,layer:t},r){const s={};return e.forEach((n,a)=>{n.layerInfo&&(s[a]=Kq(i,n,t,r))}),lh(s)}function iW({relatedInfo:i,fieldName:e,fieldInfo:t}){var r,s;if((r=i.relatedFields)==null||r.push(e),t.statisticType){const n=new E7({statisticType:t.statisticType,onStatisticField:e,outStatisticFieldName:e});(s=i.outStatistics)==null||s.push(n)}}function rW(i,e){if(i!=null){e=e.toLowerCase();for(const t of i)if(t&&t.name.toLowerCase()===e)return t}return null}const gO={chartAnimation:!0};let zr=class extends ge{constructor(e){super(e),this.abilities={...gO},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...gO,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,r=(e+t)%t;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,r=t+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{mediaInfos:e,layer:t}=this,r=this.attributes??{},s=this.formattedAttributes??{},n=this.expressionAttributes??{},a=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(o=>{const l=o==null?void 0:o.clone();if(!l)return null;if(l.title=Ju({attributes:r,fieldInfoMap:a,globalAttributes:s,expressionAttributes:n,layer:t,text:l.title}),l.caption=Ju({attributes:r,fieldInfoMap:a,globalAttributes:s,expressionAttributes:n,layer:t,text:l.caption}),l.altText=Ju({attributes:r,fieldInfoMap:a,globalAttributes:s,expressionAttributes:n,layer:t,text:l.altText}),l.type==="image"){const{value:c}=l;return this._setImageValue({value:c,formattedAttributes:s,layer:t}),l.value.sourceURL?l:void 0}if(l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"){const{value:c}=l;return this._setChartValue({value:c,chartType:l.type,attributes:r,formattedAttributes:s,layer:t,expressionAttributes:n}),l}return null}).filter(_))??[]}_setImageValue(e){const t=this.fieldInfoMap??new Map,{value:r,formattedAttributes:s,layer:n}=e,{linkURL:a,sourceURL:o}=r;if(o){const l=EE(o,n);r.sourceURL=CE({formattedAttributes:s,template:l,fieldInfoMap:t})}if(a){const l=EE(a,n);r.linkURL=CE({formattedAttributes:s,template:l,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:r,formattedAttributes:s,chartType:n,layer:a,expressionAttributes:o}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:h,normalizeField:u}=t,m=a;if(t.fields=YH(h,m),u&&(t.normalizeField=Ay(u,m)),!h.some(y=>!!(s[y]!=null||th(y)&&(c!=null&&c.size))))return;const f=(l==null?void 0:l.fieldInfos)??[];h.forEach(y=>{if(th(y))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:y,formattedAttributes:s,chartType:n,value:t})]);const g=this._getChartOption({value:t,attributes:r,chartType:n,formattedAttributes:s,expressionAttributes:o,fieldName:y,fieldInfos:f});t.series.push(g)})}_getRelatedChartInfos(e){var f;const{fieldInfos:t,fieldName:r,formattedAttributes:s,chartType:n,value:a}=e,o=[],l=u1(r),c=l&&((f=this.relatedInfos)==null?void 0:f.get(l.layerId.toString()));if(!c)return o;const{relatedFeatures:h,relation:u}=c;if(!u||!h)return o;const{cardinality:m}=u;return h.forEach(y=>{const{attributes:g}=y;g&&Object.keys(g).forEach(v=>{v===l.fieldName&&o.push(this._getChartOption({value:a,attributes:g,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:v,hasMultipleRelatedFeatures:(h==null?void 0:h.length)>1,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var A;const{value:t,attributes:r,formattedAttributes:s,expressionAttributes:n,fieldName:a,relatedFieldName:o,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:h}=e,u=this.layer,m=this.fieldInfoMap??new Map,{normalizeField:f,tooltipField:y}=t,g=f?th(f)?r[u1(f).fieldName]:r[f]:null,v=nR(a)&&n&&n[a]!==void 0?n[a]:o&&r[o]!==void 0?r[o]:r[a]!==void 0?r[a]:s[a],b=new n7({fieldName:a,value:v===void 0?null:v&&g?v/g:v});if(th(a)){const M=m.get(a.toLowerCase()),O=y&&m.get(y.toLowerCase()),I=(M==null?void 0:M.fieldName)??a,N=h&&y?u1(y).fieldName:(O==null?void 0:O.fieldName)??y,F=h&&N?r[N]:s[N]??(M==null?void 0:M.label)??(M==null?void 0:M.fieldName)??o,V=h&&o?r[o]:s[I];return b.tooltip=this._getTooltip({label:F,value:V,chartType:c}),b}const x=W5(l,a),w=Ay(a,u),S=y&&s[y]!==void 0?s[y]:H5(x||new nF({fieldName:w}),(A=this.popupTemplate)==null?void 0:A.expressionInfos),P=s[w];return b.tooltip=this._getTooltip({label:S,value:P,chartType:c}),b}};d([p()],zr.prototype,"abilities",void 0),d([ss("abilities")],zr.prototype,"castAbilities",null),d([p()],zr.prototype,"activeMediaInfoIndex",void 0),d([p({readOnly:!0})],zr.prototype,"activeMediaInfo",null),d([p()],zr.prototype,"attributes",void 0),d([p()],zr.prototype,"description",void 0),d([p()],zr.prototype,"fieldInfoMap",void 0),d([p()],zr.prototype,"formattedAttributes",void 0),d([p()],zr.prototype,"expressionAttributes",void 0),d([p({readOnly:!0})],zr.prototype,"formattedMediaInfos",null),d([p()],zr.prototype,"isAggregate",void 0),d([p()],zr.prototype,"layer",void 0),d([p({readOnly:!0})],zr.prototype,"formattedMediaInfoCount",null),d([p()],zr.prototype,"mediaInfos",void 0),d([p()],zr.prototype,"popupTemplate",void 0),d([p()],zr.prototype,"relatedInfos",void 0),d([p()],zr.prototype,"title",void 0),zr=d([k("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],zr);const ep=zr;var _O=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],sW=[].concat(_O.slice(30,39),_O.slice(28,30).reverse()),nW=[{name:"default",colors:sW},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const yO="en-us",dR=new Map([["ar",()=>Y(()=>import("./ar-bb1fe5ab.js"),["./ar-bb1fe5ab.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.a)],["bg-bg",()=>Y(()=>import("./bg_BG-184a2bfa.js"),["./bg_BG-184a2bfa.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.b)],["bs-ba",()=>Y(()=>import("./bs_BA-f32cc344.js"),["./bs_BA-f32cc344.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.b)],["ca-es",()=>Y(()=>import("./ca_ES-d17ee95b.js"),["./ca_ES-d17ee95b.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.c)],["cs-cz",()=>Y(()=>import("./cs_CZ-bcd1e782.js"),["./cs_CZ-bcd1e782.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.c)],["da-dk",()=>Y(()=>import("./da_DK-27b1b06e.js"),["./da_DK-27b1b06e.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.d)],["de-de",()=>Y(()=>import("./de_DE-c0a1d8dd.js"),["./de_DE-c0a1d8dd.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.d)],["de-ch",()=>Y(()=>import("./de_CH-be7b4255.js"),["./de_CH-be7b4255.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.d)],["el-gr",()=>Y(()=>import("./el_GR-05fb9ec0.js"),["./el_GR-05fb9ec0.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.e)],["en-us",()=>Y(()=>import("./en_US-170979d8.js"),["./en_US-170979d8.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.e)],["en-ca",()=>Y(()=>import("./en_CA-170979d8.js"),["./en_CA-170979d8.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.e)],["es-es",()=>Y(()=>import("./es_ES-d0b66640.js"),["./es_ES-d0b66640.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.e)],["et-ee",()=>Y(()=>import("./et_EE-56dd74d3.js"),["./et_EE-56dd74d3.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.e)],["fi-fi",()=>Y(()=>import("./fi_FI-91d58cb9.js"),["./fi_FI-91d58cb9.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.f)],["fr-fr",()=>Y(()=>import("./fr_FR-a11503e0.js"),["./fr_FR-a11503e0.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.f)],["he-il",()=>Y(()=>import("./he_IL-90db98c4.js"),["./he_IL-90db98c4.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.h)],["hr-hr",()=>Y(()=>import("./hr_HR-fac8bb29.js"),["./hr_HR-fac8bb29.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.h)],["hu-hu",()=>Y(()=>import("./hu_HU-e8803856.js"),["./hu_HU-e8803856.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.h)],["id-id",()=>Y(()=>import("./id_ID-86e57d06.js"),["./id_ID-86e57d06.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.i)],["it-it",()=>Y(()=>import("./it_IT-2d4485ba.js"),["./it_IT-2d4485ba.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.i)],["ja-jp",()=>Y(()=>import("./ja_JP-77c6c16d.js"),["./ja_JP-77c6c16d.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.j)],["ko-kr",()=>Y(()=>import("./ko_KR-e155b9ab.js"),["./ko_KR-e155b9ab.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.k)],["lt-lt",()=>Y(()=>import("./lt_LT-fde47ae9.js"),["./lt_LT-fde47ae9.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.l)],["lv-lv",()=>Y(()=>import("./lv_LV-359be050.js"),["./lv_LV-359be050.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.l)],["nb-no",()=>Y(()=>import("./nb_NO-30d57c1a.js"),["./nb_NO-30d57c1a.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.n)],["nl-nl",()=>Y(()=>import("./nl_NL-cb904b48.js"),["./nl_NL-cb904b48.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.n)],["pl-pl",()=>Y(()=>import("./pl_PL-58c54c9f.js"),["./pl_PL-58c54c9f.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.p)],["pt-br",()=>Y(()=>import("./pt_BR-d2e10248.js"),["./pt_BR-d2e10248.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.p)],["pt-pt",()=>Y(()=>import("./pt_PT-65a41842.js"),["./pt_PT-65a41842.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.p)],["ro-ro",()=>Y(()=>import("./ro_RO-15e90e9f.js"),["./ro_RO-15e90e9f.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.r)],["ru-ru",()=>Y(()=>import("./ru_RU-a74d21e5.js"),["./ru_RU-a74d21e5.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.r)],["sk-sk",()=>Y(()=>import("./sk_SK-a928dbd1.js"),["./sk_SK-a928dbd1.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.s)],["sl-sl",()=>Y(()=>import("./sl_SL-1a3c3078.js"),["./sl_SL-1a3c3078.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.s)],["sr-rs",()=>Y(()=>import("./sr_RS-0b18b911.js"),["./sr_RS-0b18b911.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.s)],["sv-se",()=>Y(()=>import("./sv_SE-ce7e3f84.js"),["./sv_SE-ce7e3f84.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.s)],["th-th",()=>Y(()=>import("./th_TH-1448f333.js"),["./th_TH-1448f333.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.t)],["tr-tr",()=>Y(()=>import("./tr_TR-dd92f630.js"),["./tr_TR-dd92f630.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.t)],["uk-ua",()=>Y(()=>import("./uk_UA-fe4434ed.js"),["./uk_UA-fe4434ed.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.u)],["vi-vn",()=>Y(()=>import("./vi_VN-41938633.js"),["./vi_VN-41938633.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.v)],["zh-cn",()=>Y(()=>import("./zh_Hans-524a1291.js"),["./zh_Hans-524a1291.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.z)],["zh-hk",()=>Y(()=>import("./zh_Hant-0e1f08e5.js"),["./zh_Hant-0e1f08e5.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.z)],["zh-tw",()=>Y(()=>import("./zh_Hant-0e1f08e5.js"),["./zh_Hant-0e1f08e5.js","./_commonjsHelpers-2f3e7994.js","./_commonjs-dynamic-modules-42bbacb3.js"],import.meta.url).then(i=>i.z)]]);function aW(i){const e=i.split("-")[0].toLowerCase();let t=null;for(const r of dR.keys())if(r.startsWith(e)){t=r;break}return t}function oW(i){return i?dR.has(i.toLowerCase())?i.toLowerCase():aW(i)||yO:yO}let em=null,Tg=null;async function lW(i=uF()){if(i=oW(i),em&&i===Tg)return em;em=Y(()=>import("./index-a70dd312.js"),["./index-a70dd312.js","./_commonjsHelpers-2f3e7994.js"],import.meta.url).then(e=>e.i),Tg=i;try{const[e,t]=await Promise.all([em,dR.get(Tg)()]);Tg===i&&(e.am4core.options.defaultLocale=t.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return em=null,Tg=null,null}return em}function cW(i,e="default"){const t=nW.find(r=>r.name===e);return t?t.colors.map(r=>i.color(r)):null}const sn="esri-feature-media",mr={base:sn,mediaContainer:`${sn}__container`,mediaItemContainer:`${sn}__item-container`,mediaItem:`${sn}__item`,mediaItemTitle:`${sn}__item-title`,mediaItemCaption:`${sn}__item-caption`,mediaPrevious:`${sn}__previous`,mediaPreviousIconLTR:`${sn}__previous-icon`,mediaPreviousIconRTL:`${sn}__previous-icon--rtl`,mediaNext:`${sn}__next`,mediaNextIconLTR:`${sn}__next-icon`,mediaNextIconRTL:`${sn}__next-icon--rtl`,mediaChart:`${sn}__chart`,mediaButton:`${sn}__button`,mediaIcon:`${sn}__icon`,iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},Dx=.05,Lx=.95,$x=15,Cc="color",Eh="tooltip",Cg="value",vO="default-line-value";let Gn=class extends rn{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new ep,this.messages=null,this._getChartDependencies=async r=>{const s=await lW(),{destroyed:n,viewModel:a}=this;if(n||!a||!r)return;const{activeMediaInfo:o}=a,l=await this._getRendererColors(s);this._renderChart({chartDiv:r,mediaInfo:o,chartsModule:s,colorMap:l})}}initialize(){this._featureElementInfo=new Tw,this.addHandles([z(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Je),z(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Je)])}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return U("div",{bind:this,class:mr.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?U("div",{key:"media-element-container",class:mr.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:a,altText:o,title:l,type:c}=e,{sourceURL:h,linkURL:u}=n,m=G5(u??void 0)?"_blank":"_self",f=m==="_blank"?"noreferrer":"",y=a?t:null,g=y?y.timestamp:0,v=y?y.sourceURL:h,b=U("img",{alt:o||l,key:`media-${c}-${r}-${s}-${g}`,src:v??void 0});return(u?U("a",{title:l,href:u,rel:f,target:m},b):null)||b}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:r}=this.viewModel;return U("div",{key:`media-${e.type}-${t}-${r}`,bind:this,class:mr.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?U("div",{key:"media-title",class:mr.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?U("div",{key:"media-caption",class:mr.mediaItemCaption,innerHTML:e.caption}):null;return U("div",{key:"media-container",class:mr.mediaItemContainer},U("div",{key:"media-item-container",class:mr.mediaItem},this.renderMediaInfoType()),t,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",r=t?this.messages.previous:this.messages.next,s=t?this.classes(mr.mediaButton,mr.mediaPrevious):this.classes(mr.mediaButton,mr.mediaNext),n=t?this.classes(mr.mediaIcon,mr.mediaPreviousIconLTR,mr.iconLeftTriangleArrow):this.classes(mr.mediaIcon,mr.mediaNextIconLTR,mr.iconRightTriangleArrow),a=t?this.classes(mr.mediaIcon,mr.mediaPreviousIconRTL,mr.iconRightTriangleArrow):this.classes(mr.mediaIcon,mr.mediaNextIconRTL,mr.iconLeftTriangleArrow),o=t?"media-previous":"media-next",l=t?this._previous:this._next;return U("button",{type:"button",key:o,title:r,"aria-label":r,tabIndex:0,class:s,bind:this,onclick:l},U("span",{"aria-hidden":"true",class:n}),U("span",{"aria-hidden":"true",class:a}))}_setupFeatureElementInfo(){var r;const{description:e,title:t}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){const{isAggregate:e,layer:t}=this.viewModel;return e&&(t!=null&&t.featureReduction)&&"renderer"in t.featureReduction?t.featureReduction.renderer:t==null?void 0:t.renderer}async _getRendererColors(e){const{am4core:t}=e,r=new Map,s=this._getRenderer(),n="default";if(!s)return r;const a=await Gq(s);return a.delete(n),Array.from(a.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(vO,t.color({r:50,g:50,b:50,a:1})),Array.from(a.keys()).forEach(o=>{var l;o&&r.set(o,t.color((l=a.get(o))==null?void 0:l[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=ku(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:r,chartDiv:s,mediaInfo:n,colorMap:a}=e,{value:o,type:l}=n,{am4core:c}=r,h=cW(c);function u(y){y instanceof c.ColorSet&&h&&(y.list=h)}yb()&&c.useTheme(r.am4themes_dark);const m=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!m.matches?c.useTheme(r.am4themes_animated):c.unuseTheme(r.am4themes_animated),c.useTheme(u);const f=l==="pie-chart"?this._createPieChart(e):this._createXYChart(e);s.setAttribute("aria-label",n.altText||n.title),f.data=o.series.map(y=>({[Eh]:y.tooltip,[Cg]:y.value,[Cc]:a.get(y.fieldName)})).filter(y=>l!=="pie-chart"||y.value!=null&&y.value>0)}_customizeChartTooltip(e,t){e&&(e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7}))}_createPieChart(e){const{chartDiv:t,chartsModule:r}=e,{am4core:s,am4charts:n}=r,a=s.create(t,n.PieChart);a.rtl=Kl(this.container);const o=a.series.push(new n.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=Cg,o.dataFields.category=Eh,this._customizeChartTooltip(o.tooltip,s),o.slices.template.propertyFields.fill=Cc,o.slices.template.propertyFields.stroke=Cc,a}_getMinSeriesValue(e){let t=0;return e.forEach(r=>t=Math.min(r.value,t)),t}_createColumnChart(e,t){const{chartsModule:r,mediaInfo:s}=t,{value:n}=s,{am4core:a,am4charts:o}=r,l=e.xAxes.push(new o.CategoryAxis);l.dataFields.category=Eh,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,a),c.events.on("sizechanged",()=>{c.dy=-c.contentHeight});const h=e.yAxes.push(new o.ValueAxis),u=h.renderer.labels.template;h.renderer.minLabelPosition=Dx,h.renderer.maxLabelPosition=Lx,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,a),u.wrap=!0;const m=e.series.push(new o.ColumnSeries);m.dataFields.valueY=Cg,m.dataFields.categoryX=Eh,m.columns.template.propertyFields.fill=Cc,m.columns.template.propertyFields.stroke=Cc,e.cursor=new o.XYCursor,n.series.length>$x&&(e.scrollbarX=new a.Scrollbar)}_createBarChart(e,t){const{chartsModule:r,mediaInfo:s}=t,{value:n}=s,{am4core:a,am4charts:o}=r,l=e.yAxes.push(new o.CategoryAxis);l.dataFields.category=Eh,l.renderer.inversed=!0,l.renderer.labels.template.disabled=!0;const c=l.tooltip;this._customizeChartTooltip(c,a),c.events.on("sizechanged",()=>{c.dx=c.contentWidth});const h=e.xAxes.push(new o.ValueAxis),u=h.renderer.labels.template;h.renderer.minLabelPosition=Dx,h.renderer.maxLabelPosition=Lx,h.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(h.tooltip,a),u.wrap=!0;const m=e.series.push(new o.ColumnSeries);m.dataFields.valueX=Cg,m.dataFields.categoryY=Eh,m.columns.template.propertyFields.fill=Cc,m.columns.template.propertyFields.stroke=Cc,e.cursor=new o.XYCursor,n.series.length>$x&&(e.scrollbarY=new a.Scrollbar)}_createLineChart(e,t){const{chartsModule:r,mediaInfo:s,colorMap:n}=t,{value:a}=s,{am4core:o,am4charts:l}=r,c=e.xAxes.push(new l.CategoryAxis);c.dataFields.category=Eh,c.renderer.labels.template.disabled=!0;const h=c.tooltip;this._customizeChartTooltip(h,o),h.events.on("sizechanged",()=>{h.dy=-h.contentHeight});const u=e.yAxes.push(new l.ValueAxis),m=u.renderer.labels.template;u.renderer.minLabelPosition=Dx,u.renderer.maxLabelPosition=Lx,u.min=this._getMinSeriesValue(a.series),this._customizeChartTooltip(u.tooltip,o),m.wrap=!0;const f=e.series.push(new l.LineSeries);f.dataFields.categoryX=Eh,f.dataFields.valueY=Cg,f.strokeWidth=1;const y=n.get(vO);y&&(f.stroke=y);const g=f.bullets.push(new l.CircleBullet);g.propertyFields.fill=Cc,g.propertyFields.stroke=Cc,e.cursor=new l.XYCursor,a.series.length>$x&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:r,mediaInfo:s}=e,{type:n}=s,{am4core:a,am4charts:o}=r,l=a.create(t,o.XYChart);return l.rtl=Kl(this.container),n==="column-chart"&&this._createColumnChart(l,e),n==="bar-chart"&&this._createBarChart(l,e),n==="line-chart"&&this._createLineChart(l,e),l}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:r}=e;if(!t)return;const s=6e4*t;this._updateMediaInfoTimestamp(r.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},s);this._refreshTimer=n}_getImageSource(e,t){const r=e.includes("?")?"&":"?",[s,n=""]=e.split("#");return`${s}${r}timestamp=${t}${n?"#":""}${n}`}};d([p()],Gn.prototype,"attributes",null),d([p()],Gn.prototype,"activeMediaInfoIndex",null),d([p()],Gn.prototype,"description",null),d([p()],Gn.prototype,"fieldInfoMap",null),d([p()],Gn.prototype,"layer",null),d([p()],Gn.prototype,"mediaInfos",null),d([p()],Gn.prototype,"popupTemplate",null),d([p()],Gn.prototype,"relatedInfos",null),d([p()],Gn.prototype,"title",null),d([p({type:ep})],Gn.prototype,"viewModel",void 0),d([p(),Zs("esri/widgets/Feature/t9n/Feature")],Gn.prototype,"messages",void 0),Gn=d([k("esri.widgets.Feature.FeatureMedia")],Gn);const J5=Gn,hW=["$datastore","$map","$layer","$aggregatedfeatures"],dW="esri.widgets.Feature.support.arcadeFeatureUtils",uW=pe.getLogger(dW);function pW(i){return typeof i=="string"?p0(oR(i)):Array.isArray(i)?mW(i):(i==null?void 0:i.declaredClass)==="esri.arcade.Dictionary"?fW(i):i}function mW(i){return`<ul class="esri-widget__list">${i.map(e=>`<li>${typeof e=="string"?p0(oR(e)):e}</li>`).join("")}</ul>`}function fW(i){return`<table class="esri-widget__table">${i.keys().map(e=>{const t=i.field(e);return`<tr><th>${e}</th><td>${typeof t=="string"?p0(oR(t)):t}</td></tr>`}).join("")}</table>`}function gW({aggregatedFeatures:i,arcadeUtils:e,featureSetVars:t,context:r,viewInfo:s,map:n,graphic:a,interceptor:o}){t.forEach(l=>{const c=l.toLowerCase(),h=s.sr,u={map:n,spatialReference:h,interceptor:o};if(c==="$map"&&(r.vars[c]=e.convertMapToFeatureSetCollection(u)),c==="$layer"&&(r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:a.sourceLayer,spatialReference:h,interceptor:o})),c==="$datastore"&&(r.vars[c]=e.convertServiceUrlToWorkspace({url:a.sourceLayer.url,spatialReference:h,interceptor:o})),c==="$aggregatedfeatures"){const m=a.layer,{fields:f,objectIdField:y,geometryType:g,spatialReference:v,displayField:b}=m,x=new D7({fields:f,objectIdField:y,geometryType:g,spatialReference:v,displayField:b,...m.type==="feature"?{templates:m.templates,typeIdField:m.typeIdField,types:m.types}:null,source:i});r.vars[c]=e.convertFeatureLayerToFeatureSet({layer:x,spatialReference:v,interceptor:o})}})}function e4(){return Y(()=>import("./arcadeUtils-1329e1ca.js").then(i=>i.ax),["./arcadeUtils-1329e1ca.js","./geometry-7d866d3f.js","./ArrayPool-b51874dd.js","./string-53224faa.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./Extent-22afa84a.js","./jsonMap-ffa742d3.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./preload-helper-41c905a7.js","./ArcadeDate-9f8ea201.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./number-08a18d0d.js","./locale-fe7cc1d0.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./jsonUtils-36bf3d33.js","./featureConversionUtils-aead6959.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./request-09e7d9b2.js","./hash-0ddfbf4b.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./sizeVariableUtils-d4870b0d.js"],import.meta.url)}function _W(i){return"createQuery"in i&&"queryFeatures"in i}async function yW({graphic:i,view:e}){const{isAggregate:t,layer:r}=i;if(!t||!r||(e==null?void 0:e.type)!=="2d")return[];const s=await e.whenLayerView(r);if(!_W(s))return[];const n=s.createQuery(),a=i.getObjectId();n.aggregateIds=a!=null?[a]:[];const{features:o}=await s.queryFeatures(n);return o}async function t4({expressionInfo:i,arcadeUtils:e,interceptor:t,spatialReference:r,map:s,graphic:n,view:a}){if(!i||!i.expression)return null;const o=e.createSyntaxTree(i.expression),l=hW.filter(f=>e.hasVariable(o,f)),[c]=await Promise.all([yW({graphic:n,view:a}),e.loadScriptDependencies(o,!0,l)]),h=e.getViewInfo({spatialReference:r}),u=e.createExecContext(n,h);u.interceptor=t,u.useAsync=!0,gW({aggregatedFeatures:c,arcadeUtils:e,featureSetVars:l,context:u,viewInfo:h,map:s,graphic:n,interceptor:t});const m=e.createFunction(o,u);return e.executeAsyncFunction(m,u).catch(f=>uW.error("arcade-execution-error",{error:f,graphic:n,expressionInfo:i}))}async function vW({expressionInfos:i,spatialReference:e,graphic:t,interceptor:r,map:s,view:n}){if(!i||!i.length)return{};const a=await e4(),o={};for(const h of i)o[`expression/${h.name}`]=t4({expressionInfo:h,arcadeUtils:a,interceptor:r,spatialReference:e,map:s,graphic:t,view:n});const l=await lh(o),c={};for(const h in l)c[h]=pW(l[h].value);return c}const bW=1;let wa=class extends cw(ge){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var s,n;const t=(s=this.contentElement)==null?void 0:s.type;(n=this.contentElementViewModel)==null||n.destroy();const r=t==="fields"?new Cw:t==="media"?new ep:t==="text"?new _b:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=Pf(this._compile,bW,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:r,interceptor:s,spatialReference:n,map:a,view:o,_abortController:l}=this;if(!(t&&r&&n&&a))return void this._set("contentElement",null);const c=await e4();if(l!==this._abortController)return;const h=await t4({arcadeUtils:c,expressionInfo:t,graphic:r,interceptor:s,map:a,spatialReference:n,view:o});if(!h||h.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const u=await h.castAsJsonAsync(l==null?void 0:l.signal),m=u==null?void 0:u.type,f=m==="media"?a7.fromJSON(u):m==="text"?aF.fromJSON(u):m==="fields"?o7.fromJSON(u):null;this._set("contentElement",f)},this.handles.add([z(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Je),z(()=>[this.contentElement],()=>this._createVM(),Je)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:r}=this;return e?"loading":t||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};d([p()],wa.prototype,"_abortController",void 0),d([p({type:l7})],wa.prototype,"expressionInfo",void 0),d([p({type:mc})],wa.prototype,"graphic",void 0),d([p({readOnly:!0})],wa.prototype,"contentElement",void 0),d([p({readOnly:!0})],wa.prototype,"contentElementViewModel",void 0),d([p()],wa.prototype,"interceptor",void 0),d([p()],wa.prototype,"spatialReference",null),d([p({readOnly:!0})],wa.prototype,"state",null),d([p()],wa.prototype,"map",null),d([p()],wa.prototype,"view",void 0),wa=d([k("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],wa);const uR=wa,I0={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let p1=class extends rn{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new uR}initialize(){this.addHandles(z(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Je))}destroy(){this._destroyContentWidget()}renderLoading(){return U("div",{key:"loading-container",class:I0.loadingSpinnerContainer},U("span",{class:this.classes(I0.iconLoading,I0.spinner)}))}render(){var t;const{state:e}=this.viewModel;return U("div",{class:I0.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,r=t==null?void 0:t.type;this._destroyContentWidget();const s=e?r==="fields"?new K5({viewModel:e}):r==="media"?new J5({viewModel:e}):r==="text"?new d1({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};d([p({type:uR})],p1.prototype,"viewModel",void 0),p1=d([k("esri.widgets.Feature.FeatureExpression")],p1);const wW=p1,Fx=100;let Ci=class extends x$(pF(cw(ge))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const t=new AbortController;this._queryAbortController=t,await B_(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await B_(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const t=new AbortController;this._queryPageAbortController=t,await B_(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)},this._queryThrottled=Pf(this._queryController,Fx,this),this._queryFeatureCountThrottled=Pf(this._queryFeatureCountController,Fx,this),this._queryPageThrottled=Pf(this._queryPageController,Fx,this),this._query=async()=>{const{_queryAbortController:t,relatedFeatures:r}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.removeAll(),r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:t==null?void 0:t.signal})))},this.handles.add([z(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryThrottled(),Je),z(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),z(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:r}=this,s=1,n=Math.ceil(r/t)||1;this._set("featurePage",Math.min(Math.max(e,s),n))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&(t!=null&&t.loaded)?e.map(r=>{const s=r.clone(),n=Ay(r.field,t);return s.field=n,s}):e??[]}get supportsCacheHint(){var e,t,r;return!!((r=(t=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:t.queryRelated)!=null&&r.supportsCacheHint)}get canQuery(){var t,r;const e=(r=(t=this.layer)==null?void 0:t.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e,t;return((t=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:t.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,t;return(this.objectIdField&&((t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new Oi}get relatedLayer(){const{layer:e,map:t,relationship:r}=this;return e!=null&&e.loaded&&t&&r?mq(t,e,r)??null:null}get relationship(){var r;const{relationshipId:e,layer:t}=this;return typeof e=="number"?((r=t==null?void 0:t.relationships)==null?void 0:r.find(({id:s})=>s===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Oi}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,canQuery:s}=this;return t?"loading":e||r?"querying":s?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(t=>!t.destroyed&&t.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:t,relationshipId:r,objectId:s,_queryFeatureCountAbortController:n,canQuery:a,supportsCacheHint:o}=this;if(await(e==null?void 0:e.load()),await(t==null?void 0:t.load()),!a||!e||!t)return void this._set("featureCount",0);const l=t.createQuery(),c=new oE({cacheHint:o,relationshipId:r,returnGeometry:!1,objectIds:[s],where:KA(l.where,void 0)}),h=await e.queryRelatedFeaturesCount(c,{signal:n==null?void 0:n.signal});this._set("featureCount",h[s]||0)}_sliceFeatures(e){const{showAllEnabled:t,displayCount:r}=this;return t?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:r,_queryPageAbortController:s}=this;!r||t<2||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var A;const{orderByFieldsFixedCasing:t,showAllEnabled:r,featuresPerPage:s,displayCount:n,layer:a,relationshipId:o,featurePage:l,featureCount:c,relatedLayer:h,supportsCacheHint:u}=this,{canQuery:m,objectId:f}=this;if(!m||!a||!h)return[];const y=r?((l-1)*s+c)%c:0,g=r?s:n,v=h.objectIdField,b=[...t==null?void 0:t.map(M=>M.field),v].filter(_),x=t==null?void 0:t.map(M=>`${M.field} ${M.order}`),w=h.createQuery(),S=new oE({orderByFields:x,start:y,num:g,outFields:b,cacheHint:u,relationshipId:o,returnGeometry:!1,objectIds:[f],where:KA(w.where,void 0)}),P=((A=(await a.queryRelatedFeatures(S,{signal:e==null?void 0:e.signal}))[f])==null?void 0:A.features)||[];return P.forEach(M=>{M.sourceLayer=h,M.layer=h}),P}};d([p()],Ci.prototype,"_queryAbortController",void 0),d([p()],Ci.prototype,"_queryPageAbortController",void 0),d([p()],Ci.prototype,"_queryFeatureCountAbortController",void 0),d([p({value:1})],Ci.prototype,"featurePage",null),d([p()],Ci.prototype,"featuresPerPage",void 0),d([p({readOnly:!0})],Ci.prototype,"orderByFieldsFixedCasing",null),d([p({readOnly:!0})],Ci.prototype,"supportsCacheHint",null),d([p({readOnly:!0})],Ci.prototype,"canQuery",null),d([p()],Ci.prototype,"description",void 0),d([p({readOnly:!0})],Ci.prototype,"itemDescriptionFieldName",null),d([p({value:3})],Ci.prototype,"displayCount",null),d([p({type:mc})],Ci.prototype,"graphic",void 0),d([p()],Ci.prototype,"layer",void 0),d([p()],Ci.prototype,"map",void 0),d([p({readOnly:!0})],Ci.prototype,"objectId",null),d([p({readOnly:!0})],Ci.prototype,"objectIdField",null),d([p()],Ci.prototype,"orderByFields",void 0),d([p({readOnly:!0})],Ci.prototype,"relatedFeatures",null),d([p({readOnly:!0})],Ci.prototype,"relatedLayer",null),d([p({readOnly:!0})],Ci.prototype,"relationship",null),d([p()],Ci.prototype,"featureCount",void 0),d([p({readOnly:!0})],Ci.prototype,"relatedFeatureViewModels",null),d([p()],Ci.prototype,"relationshipId",void 0),d([p()],Ci.prototype,"showAllEnabled",void 0),d([p()],Ci.prototype,"state",null),d([p()],Ci.prototype,"title",void 0),Ci=d([k("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Ci);const pR=Ci,l_="esri-feature",Nx=`${l_}-relationship`,Ec={base:Nx,esriWidget:"esri-widget",listContainer:`${Nx}__list`,listContainerQuerying:`${Nx}__list--querying`,featureObserver:`${l_}__feature-observer`,stickySpinnerContainer:`${l_}__sticky-loading-container`,loadingSpinnerContainer:`${l_}__loading-container`,spinner:`${l_}__loading-spinner`,iconLoading:"esri-icon-loading-indicator esri-rotating"},bO={title:!0,description:!0};let pn=class extends rn{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new pR,this.messages=null,this.messagesCommon=null,this.visibleElements={...bO},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:s,relatedFeatures:n,featuresPerPage:a,featurePage:o}=this.viewModel;r==="ready"&&s&&n.length>=a*o&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Tw,this.addHandles([z(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),Je),z(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Nr(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([Y(()=>import("./calcite-list-d6777a37.js"),["./calcite-list-d6777a37.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./interactive-1de2e238.js","./observers-955fedd9.js","./utils3-7e94db45.js","./loadable-6afd516d.js","./debounce-d5abe404.js","./t9n-fc0d9eed.js","./key-dd674229.js","./icon-e2d88df4.js","./form-fe1dc9bd.js","./label2-f8b96630.js","./loader-de98eb51.js","./guid-51402ee7.js","./scrim-20a34a80.js"],import.meta.url),Y(()=>import("./calcite-list-item-db251f90.js"),["./calcite-list-item-db251f90.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./interactive-1de2e238.js","./utils3-7e94db45.js","./loadable-6afd516d.js","./icon-e2d88df4.js","./observers-955fedd9.js"],import.meta.url),Y(()=>import("./calcite-icon-abf9d6bc.js"),["./calcite-icon-abf9d6bc.js","./icon-e2d88df4.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./observers-955fedd9.js"],import.meta.url),Y(()=>import("./calcite-notice-8bb34977.js"),["./calcite-notice-8bb34977.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./observers-955fedd9.js","./loadable-6afd516d.js","./t9n-fc0d9eed.js","./key-dd674229.js","./icon-e2d88df4.js"],import.meta.url)])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=we(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:r}=this.viewModel;return!e&&!!t&&(t>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:t}=this.viewModel;return kl(t===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...bO,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?U("div",{key:"sticky-loader",class:Ec.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return U("span",{class:this.classes(Ec.iconLoading,Ec.spinner)})}renderLoading(){return U("div",{key:"loading-container",class:Ec.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return U("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=Kl(this.container)?"chevron-left":"chevron-right";return U("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var n,a;const{itemDescriptionFieldName:t}=this.viewModel,r=e.title;e.description=t&&((n=e.formattedAttributes)==null?void 0:n.global[t]);const s=e.state==="loading";return U("calcite-list-item",{key:e.uid,label:s?`${(a=this.messagesCommon)==null?void 0:a.loading}…`:r,description:s?"…":e.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?U("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return U("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},U("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return U("div",{key:"feature-observer",class:Ec.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return U("calcite-list",null,e.toArray().map(t=>this.renderRelatedFeature(t)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return U("div",{key:"list-container",class:this.classes(Ec.listContainer,{[Ec.listContainerQuerying]:t==="querying"})},e?this.renderList():t==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return U("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},U("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var t;const{state:e}=this.viewModel;return U("div",{class:this.classes(Ec.base,Ec.esriWidget)},(t=this._featureElementInfo)==null?void 0:t.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e==null||e.forEach(r=>{this.addHandles(z(()=>[r.title,r.state],()=>this.scheduleRender(),Je),t)}),this.scheduleRender()}_setupFeatureElementInfo(){var n;const{headingLevel:e,visibleElements:t}=this,r=t.description&&this.description,s=t.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:r,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await kf(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};d([p()],pn.prototype,"_relatedFeatureIntersectionObserverNode",void 0),d([p({readOnly:!0})],pn.prototype,"displayShowAllButton",null),d([p({readOnly:!0})],pn.prototype,"displayListItems",null),d([p()],pn.prototype,"description",null),d([p({readOnly:!0})],pn.prototype,"featureCountDescription",null),d([p()],pn.prototype,"headingLevel",void 0),d([p()],pn.prototype,"title",null),d([p({type:pR})],pn.prototype,"viewModel",void 0),d([p(),Zs("esri/widgets/Feature/t9n/Feature")],pn.prototype,"messages",void 0),d([p(),Zs("esri/t9n/common")],pn.prototype,"messagesCommon",void 0),d([p()],pn.prototype,"visibleElements",void 0),d([ss("visibleElements")],pn.prototype,"castVisibleElements",null),pn=d([k("esri.widgets.Feature.FeatureRelationship")],pn);const wO=pn;let xW=class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var c_;const TW=1,xO="content-view-models",TO="relationship-view-models",CO={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let Wi=c_=class extends pF(ge){constructor(i){super(i),this._handles=new mi,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=Pf(this._graphicChanged,TW,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...CO},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:t}=this;return e.type==="attachments"&&!!t.attachmentsContent||e.type==="custom"&&!!t.customContent||e.type==="fields"&&!!t.fieldsContent||e.type==="media"&&!!t.mediaContent||e.type==="text"&&!!t.textContent||e.type==="expression"&&!!t.expressionContent||e.type==="relationship"&&!!t.relationshipContent},this._handles.add(z(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),Je))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return oq(oO(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return k5(this.graphic)}castAbilities(i){return{...CO,...i}}get isTable(){var i;return((i=this._sourceLayer)==null?void 0:i.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(i){this._set("graphic",i?i.clone():null)}get spatialReference(){var i;return((i=this.view)==null?void 0:i.spatialReference)??null}set spatialReference(i){this._override("spatialReference",i)}get map(){var i;return((i=this.view)==null?void 0:i.map)||null}set map(i){this._override("map",i)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(i,e){const t=this.contentViewModels[i];t instanceof ep&&t.setActiveMedia(e)}nextMedia(i){const e=this.contentViewModels[i];e instanceof ep&&e.next()}previousMedia(i){const e=this.contentViewModels[i];e instanceof ep&&e.previous()}async updateGeometry(){var a,o;const{graphic:i,spatialReference:e,_sourceLayer:t}=this;await(t==null?void 0:t.load());const r=t==null?void 0:t.objectIdField;if(!r||!i||!t)return;const s=(a=i==null?void 0:i.attributes)==null?void 0:a[r];if(s==null)return;const n=[s];if(!i.geometry){const l=(o=await X5({layer:t,graphic:i,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}))==null?void 0:o.geometry;l&&(i.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:i}=this;if(!i)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(t){za(t)||(this._error=t,pe.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:t,graphic:i,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:i}=this;i&&i.abort(),this._featureAbortController=null}_compileContentElement(i,e){return i.type==="attachments"?this._compileAttachments(i,e):i.type==="custom"?this._compileCustom(i,e):i.type==="fields"?this._compileFields(i,e):i.type==="media"?this._compileMedia(i,e):i.type==="text"?this._compileText(i,e):i.type==="expression"?this._compileExpression(i,e):i.type==="relationship"?this._compileRelationship(i,e):void 0}_compileContent(i){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(i)?i.filter(this._isAllowedContentType).map((e,t)=>this._compileContentElement(e,t)).filter(_):typeof i=="string"?this._compileText(new aF({text:i}),0).text:i}_destroyContentViewModels(){var i,e;(i=this._handles)==null||i.remove(TO),(e=this._handles)==null||e.remove(xO),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_matchesFeature(i,e){var s;const t=(s=i==null?void 0:i.graphic)==null?void 0:s.getObjectId(),r=e==null?void 0:e.getObjectId();return _(t)&&_(r)&&t===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:i,relatedFeatures:e,map:t}){const{view:r,spatialReference:s}=this;e==null||e.filter(Boolean).forEach(n=>{i.find(a=>this._matchesFeature(a,n))||i.add(new c_({abilities:{relationshipContent:!1},map:t,view:r,spatialReference:s,graphic:n}))}),i.forEach(n=>{(e==null?void 0:e.find(o=>this._matchesFeature(n,o)))||i.remove(n)})}_setExpressionContentVM(i,e){const t=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=i,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:t}),s.set(this._createFieldsVMParams(r,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:t}),s.set(this._createMediaVMParams(r,e))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(i,e){const{displayCount:t,orderByFields:r,relationshipId:s,title:n,description:a}=i,{_sourceLayer:o,graphic:l,map:c}=this,h=new pR({displayCount:t,graphic:l,orderByFields:r,relationshipId:s,layer:o,map:c,...this._compileTitleAndDesc({title:n,description:a})});return this.contentViewModels[e]=h,this._handles.add(Nr(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),TO),i}_compileExpression(i,e){const{expressionInfo:t}=i,{graphic:r,map:s,spatialReference:n,view:a}=this,o=new uR({expressionInfo:t,graphic:r,interceptor:c_.interceptor,map:s,spatialReference:n,view:a});return this.contentViewModels[e]=o,this._handles.add(z(()=>o.contentElementViewModel,()=>this._setExpressionContentVM(o,e),Je),xO),i}_compileAttachments(i,e){const{graphic:t}=this,{description:r,title:s}=i;return this.contentViewModels[e]=new cR({graphic:t,...this._compileTitleAndDesc({title:s,description:r})}),i}_compileCustom(i,e){const{graphic:t}=this,{creator:r,destroyer:s}=i;return this.contentViewModels[e]=new _b({graphic:t,creator:r,destroyer:s}),i}_compileTitleAndDesc({title:i,description:e}){const{_fieldInfoMap:t,_sourceLayer:r,graphic:s,formattedAttributes:n}=this,a=s==null?void 0:s.attributes,o=this._expressionAttributes,l=n.global;return{title:Ju({attributes:a,fieldInfoMap:t,globalAttributes:l,expressionAttributes:o,layer:r,text:i}),description:Ju({attributes:a,fieldInfoMap:t,globalAttributes:l,expressionAttributes:o,layer:r,text:e})}}_createFieldsVMParams(i,e){var c;const t=this._effectivePopupTemplate,r=this.formattedAttributes,s={...r==null?void 0:r.global,...r==null?void 0:r.content[e]},n=(c=(i==null?void 0:i.fieldInfos)||(t==null?void 0:t.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>nR(h)||th(h)||s.hasOwnProperty(h)),a=t==null?void 0:t.expressionInfos,{description:o,title:l}=i;return{attributes:s,expressionInfos:a,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:o})}}_compileFields(i,e){const t=i.clone(),r=new Cw(this._createFieldsVMParams(i,e));return this.contentViewModels[e]=r,t.fieldInfos=r.formattedFieldInfos.slice(0),t}_createMediaVMParams(i,e){const{abilities:t,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:a,_sourceLayer:o,_expressionAttributes:l}=this,c=this.formattedAttributes,h=(r==null?void 0:r.attributes)??{},{description:u,mediaInfos:m,title:f}=i;return{abilities:{chartAnimation:t.chartAnimation},activeMediaInfoIndex:i.activeMediaInfoIndex||0,attributes:h,isAggregate:r==null?void 0:r.isAggregate,layer:o,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:m,popupTemplate:n,relatedInfos:a,...this._compileTitleAndDesc({title:f,description:u})}}_compileMedia(i,e){const t=i.clone(),r=new ep(this._createMediaVMParams(i,e));return t.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[e]=r,t}_createTextVMParams(i){var n;const{graphic:e,_fieldInfoMap:t,_sourceLayer:r,_expressionAttributes:s}=this;if(i&&i.text){const a=(e==null?void 0:e.attributes)??{},o=((n=this.formattedAttributes)==null?void 0:n.global)??{};i.text=Ju({attributes:a,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:r,text:i.text})}return{graphic:e,creator:i.text}}_compileText(i,e){const t=i.clone();return this.contentViewModels[e]=new _b(this._createTextVMParams(t)),t}_compileLastEditInfo(){const{_effectivePopupTemplate:i,_sourceLayer:e,graphic:t}=this;if(!i)return;const{lastEditInfoEnabled:r}=i,s=e==null?void 0:e.editFieldsInfo;return r&&s?aq(s,t==null?void 0:t.attributes):void 0}_compileTitle(i){var o;const{_fieldInfoMap:e,_sourceLayer:t,graphic:r,_expressionAttributes:s}=this,n=(r==null?void 0:r.attributes)??{},a=((o=this.formattedAttributes)==null?void 0:o.global)??{};return Ju({attributes:n,fieldInfoMap:e,globalAttributes:a,expressionAttributes:s,layer:t,text:i})}async _getTitle(){const{_effectivePopupTemplate:i,graphic:e}=this;if(!e)return null;const t=i==null?void 0:i.title;return gb(t,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:i,graphic:e}=this;if(!e)return null;const t=i==null?void 0:i.content;return gb(t,{graphic:e})}async _queryFeature(i){const{_featureAbortController:e,_sourceLayer:t,graphic:r,_effectivePopupTemplate:s}=this,n=this.map,a=this.view,o=this.spatialReference;if(e!==this._featureAbortController||!r)return;await cq({graphic:r,popupTemplate:s,layer:t,spatialReference:o},i);const{content:{value:l},title:{value:c}}=await lh({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=await lh({checkForRelatedFeatures:this._checkForRelatedFeatures(i),expressionAttributes:vW({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:o,graphic:r,map:n,interceptor:c_.interceptor,view:a})});e===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...r.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:t}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:a,_fieldInfoMap:o,_graphicExpressionAttributes:l}=this;t.content[e]=Rx({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:{...l,...i.attributes},layer:a,fieldInfoMap:o,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:i,contentElementIndex:e,formattedAttributes:t}){if(i.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:a,_graphicExpressionAttributes:o}=this;t.content[e]=Rx({fieldInfos:i.fieldInfos,graphic:r,attributes:{...o,...i.attributes},layer:n,fieldInfoMap:a,relatedInfos:s})}}_createFormattedAttributes(i){const{_effectivePopupTemplate:e,graphic:t,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:a}=this,o=e==null?void 0:e.fieldInfos,l={global:Rx({fieldInfos:o,graphic:t,attributes:a,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(i)&&i.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(i){const{graphic:e,_effectivePopupTemplate:t}=this;return this._queryRelatedInfos(e,oO(t),i)}async _queryRelatedInfos(i,e,t){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=_(s==null?void 0:s.associatedLayer)?await(s==null?void 0:s.associatedLayer.load(t)):s;if(!n||!i)return;const a=e.filter(c=>c&&th(c.fieldName));if(!a||!a.length)return;e.forEach(c=>this._configureRelatedInfo(c,n));const o=await eW({relatedInfos:r,layer:n},t);Object.keys(o).forEach(c=>{var m;const h=r.get(c.toString()),u=(m=o[c])==null?void 0:m.value;h&&u&&(h.layerInfo=u.data)});const l=await tW({graphic:i,relatedInfos:r,layer:n},t);Object.keys(l).forEach(c=>{var h;Yq((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(i,e){const{relatedInfos:t}=this,r=u1(i.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const a=t.get(s.toString())||Xq(s,e);a&&(iW({relatedInfo:a,fieldName:n,fieldInfo:i}),this.relatedInfos.set(s,a))}};Wi.interceptor=new xW(uq,pq),d([p()],Wi.prototype,"_error",void 0),d([p()],Wi.prototype,"_featureAbortController",void 0),d([p({readOnly:!0})],Wi.prototype,"_effectivePopupTemplate",null),d([p({readOnly:!0})],Wi.prototype,"_fieldInfoMap",null),d([p({readOnly:!0})],Wi.prototype,"_sourceLayer",null),d([p()],Wi.prototype,"abilities",void 0),d([ss("abilities")],Wi.prototype,"castAbilities",null),d([p({readOnly:!0})],Wi.prototype,"content",void 0),d([p({readOnly:!0})],Wi.prototype,"contentViewModels",void 0),d([p()],Wi.prototype,"description",void 0),d([p({type:Boolean})],Wi.prototype,"defaultPopupTemplateEnabled",void 0),d([p({readOnly:!0})],Wi.prototype,"isTable",null),d([p({readOnly:!0})],Wi.prototype,"state",null),d([p({readOnly:!0})],Wi.prototype,"formattedAttributes",void 0),d([p({type:mc,value:null})],Wi.prototype,"graphic",null),d([p({readOnly:!0})],Wi.prototype,"lastEditInfo",void 0),d([p({readOnly:!0})],Wi.prototype,"relatedInfos",void 0),d([p()],Wi.prototype,"spatialReference",null),d([p({readOnly:!0})],Wi.prototype,"title",void 0),d([p()],Wi.prototype,"map",null),d([p({readOnly:!0})],Wi.prototype,"waitingForContent",null),d([p()],Wi.prototype,"view",void 0),Wi=c_=d([k("esri.widgets.FeatureViewModel")],Wi);const mR=Wi,Es="esri-feature",lr={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:Es,container:`${Es}__size-container`,title:`${Es}__title`,main:`${Es}__main-container`,btn:`${Es}__button`,icon:`${Es}__icon`,content:`${Es}__content`,contentNode:`${Es}__content-node`,contentElement:`${Es}__content-element`,text:`${Es}__text`,lastEditedInfo:`${Es}__last-edited-info`,fields:`${Es}__fields`,fieldHeader:`${Es}__field-header`,fieldData:`${Es}__field-data`,fieldDataDate:`${Es}__field-data--date`,loadingSpinnerContainer:`${Es}__loading-container`,spinner:`${Es}__loading-spinner`},i4=i=>{let e=class extends i{constructor(){super(...arguments),this.renderNodeContent=t=>O$(t)&&!t.destroyed?U("div",{class:lr.contentNode,key:t},t.render()):t instanceof HTMLElement?U("div",{class:lr.contentNode,key:t,bind:t,afterCreate:this._attachToNode}):Z8(t)?U("div",{class:lr.contentNode,key:t,bind:t.domNode,afterCreate:this._attachToNode}):null}_attachToNode(t){const r=this;t.appendChild(r)}};return e=d([k("esri.widgets.Feature.ContentMixin")],e),e};var SE;const EO={title:!0,content:!0,lastEditedInfo:!0},SO="relationship-handles";let Qr=SE=class extends i4(rn){constructor(i,e){super(i,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...EO},this.viewModel=new mR}initialize(){this.addHandles(z(()=>{var i;return(i=this.viewModel)==null?void 0:i.contentViewModels},()=>this._setupContentWidgets(),Je))}loadDependencies(){return Y(()=>import("./calcite-notice-8bb34977.js"),["./calcite-notice-8bb34977.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./observers-955fedd9.js","./loadable-6afd516d.js","./t9n-fc0d9eed.js","./key-dd674229.js","./icon-e2d88df4.js"],import.meta.url)}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(i){this.viewModel.graphic=i}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(i){this.viewModel.defaultPopupTemplateEnabled=i}get isTable(){return this.viewModel.isTable}get label(){var i;return((i=this.messages)==null?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(i){this.viewModel.spatialReference=i}get title(){return this.viewModel.title}castVisibleElements(i){return{...EO,...i}}get map(){return this.viewModel.map}set map(i){this.viewModel.map=i}get view(){return this.viewModel.view}set view(i){this.viewModel.view=i}render(){const{state:i}=this.viewModel,e=U("div",{class:lr.container,key:"container"},this.renderTitle(),i==="error"?this.renderError():i==="loading"?this.renderLoading():this.renderContentContainer());return U("div",{class:this.classes(lr.base,lr.esriWidget)},e)}setActiveMedia(i,e){return this.viewModel.setActiveMedia(i,e)}nextMedia(i){return this.viewModel.nextMedia(i)}previousMedia(i){return this.viewModel.previousMedia(i)}renderError(){const{messagesCommon:i,messages:e,visibleElements:t}=this;return U("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},t.title?U("div",{key:"error-title",slot:"title"},i.errorMessage):null,U("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return U("div",{key:"loading-container",class:lr.loadingSpinnerContainer},U("span",{class:this.classes(lr.iconLoading,lr.spinner)}))}renderContentContainer(){const{visibleElements:i}=this;return i.content?U("div",{class:lr.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:i,title:e}=this;return i.title?U(hR,{level:this.headingLevel,class:lr.title,innerHTML:e}):null}renderContent(){const i=this.viewModel.content,e="content";if(!i)return null;if(Array.isArray(i))return i.length?U("div",{class:lr.contentNode,key:`${e}-content-elements`},i.map(this.renderContentElement,this)):null;if(typeof i=="string"){const t=this._contentWidgets[0];return!t||t.destroyed?null:U("div",{class:lr.contentNode,key:`${e}-content`},t.render())}return this.renderNodeContent(i)}renderContentElement(i,e){var r;const{visibleElements:t}=this;if(typeof t.content!="boolean"&&!((r=t.content)!=null&&r[i.type]))return null;switch(i.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(i,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(i,e);case"expression":return this.renderExpression(e);case"relationship":return this.renderRelationship(e);default:return null}}renderAttachments(i){const e=this._contentWidgets[i];if(!e||e.destroyed)return null;const{state:t,attachmentInfos:r}=e.viewModel;return t==="loading"||r.length>0?U("div",{key:this._buildKey("attachments-element",i),class:this.classes(lr.contentElement)},e.render()):null}renderRelationship(i){const e=this._contentWidgets[i];return e&&!e.destroyed&&this.flowItems?U("div",{key:this._buildKey("relationship-element",i),class:lr.contentElement},e.render()):null}renderExpression(i){const e=this._contentWidgets[i];return!e||e.destroyed?null:U("div",{key:this._buildKey("expression-element",i),class:lr.contentElement},e.render())}renderCustom(i,e){const{creator:t}=i,r=this._contentWidgets[e];return!r||r.destroyed?null:t?U("div",{key:this._buildKey("custom-element",e),class:lr.contentElement},r.render()):null}renderFields(i){const e=this._contentWidgets[i];return!e||e.destroyed?null:U("div",{key:this._buildKey("fields-element",i),class:lr.contentElement},e.render())}renderMedia(i){const e=this._contentWidgets[i];return!e||e.destroyed?null:U("div",{key:this._buildKey("media-element",i),class:lr.contentElement},e.render())}renderLastEditInfo(){const{visibleElements:i,messages:e}=this,{lastEditInfo:t}=this.viewModel;if(!t||!i.lastEditedInfo)return null;const{date:r,user:s}=t,n=t.type==="edit"?s?e.lastEditedByUser:e.lastEdited:s?e.lastCreatedByUser:e.lastCreated,a=kl(n,{date:r,user:s});return U("div",{key:"edit-info-element",class:this.classes(lr.lastEditedInfo,lr.contentElement)},a)}renderText(i,e){const t=i.text,r=this._contentWidgets[e];return!r||r.destroyed?null:t?U("div",{key:this._buildKey("text-element",e),class:this.classes(lr.contentElement,lr.text)},r.render()):null}_buildKey(i,...e){return`${i}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidget(i){i&&(i.viewModel=null,!i.destroyed&&i.destroy())}_destroyContentWidgets(){this.removeHandles(SO),this._contentWidgets.forEach(i=>this._destroyContentWidget(i)),this._contentWidgets=[]}_addFeatureRelationshipHandles(i){const{flowItems:e,visibleElements:t}=this;this.addHandles([Nr(()=>i,"select-record",({featureViewModel:r})=>{e&&(r.abilities={relationshipContent:!0},e.push(new SE({flowItems:e,viewModel:r,visibleElements:t})))}),Nr(()=>i,"show-all-records",()=>{if(!e)return;const{viewModel:r}=i;r.showAllEnabled=!0;const s=new wO({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(s),e.push(s)})],SO)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:i,visibleElements:e}=this,t=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(t))t.forEach((s,n)=>{if(s.type==="attachments"&&(this._contentWidgets[n]=new bq({displayType:s.displayType,headingLevel:e.title?i+1:i,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new K5({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new J5({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new d1({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new d1({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new wW({viewModel:r[n]})),s.type==="relationship"){const a=new wO({viewModel:r[n]});this._addFeatureRelationshipHandles(a),this._contentWidgets[n]=a}},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new d1({viewModel:s}))}this.scheduleRender()}};d([p()],Qr.prototype,"graphic",null),d([p()],Qr.prototype,"defaultPopupTemplateEnabled",null),d([p()],Qr.prototype,"flowItems",void 0),d([p()],Qr.prototype,"headingLevel",void 0),d([p({readOnly:!0})],Qr.prototype,"isTable",null),d([p()],Qr.prototype,"label",null),d([p(),Zs("esri/widgets/Feature/t9n/Feature")],Qr.prototype,"messages",void 0),d([p(),Zs("esri/t9n/common")],Qr.prototype,"messagesCommon",void 0),d([p(),Zs("esri/widgets/support/t9n/uriUtils")],Qr.prototype,"messagesURIUtils",void 0),d([p()],Qr.prototype,"spatialReference",null),d([p({readOnly:!0})],Qr.prototype,"title",null),d([p()],Qr.prototype,"visibleElements",void 0),d([ss("visibleElements")],Qr.prototype,"castVisibleElements",null),d([p()],Qr.prototype,"map",null),d([p()],Qr.prototype,"view",null),d([p({type:mR})],Qr.prototype,"viewModel",void 0),Qr=SE=d([k("esri.widgets.Feature")],Qr);const CW=Qr;var r4;const m1=Symbol("anchorHandles");let Ru=class extends Br.EventedAccessor{constructor(e){super(e),this[r4]=new mi,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[m1].add([ha(()=>sa(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),z(()=>this.screenLocation,(t,r)=>{_(t)&&_(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[m1]=we(this[m1])}get screenLocation(){var s;const{location:e,view:t,screenLocationEnabled:r}=this;return r&&_(e)&&_(t)&&t.ready?(s=t.toScreen)==null?void 0:s.call(t,e):null}};r4=m1,d([p()],Ru.prototype,"location",void 0),d([p()],Ru.prototype,"screenLocation",null),d([p()],Ru.prototype,"screenLocationEnabled",void 0),d([p()],Ru.prototype,"view",void 0),Ru=d([k("esri.widgets.support.AnchorElementViewModel")],Ru);const s4=Ru,EW="esri.widgets.CompassViewModel";let f1=class extends s4{constructor(e){super(e),this.visible=!1}};d([p()],f1.prototype,"visible",void 0),f1=d([k(EW)],f1);const n4=f1,Ux="esri-spinner",Vx={base:Ux,spinnerStart:`${Ux}--start`,spinnerFinish:`${Ux}--finish`};let Au=class extends rn{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new n4}initialize(){this.addHandles(z(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:r}=e??{};t&&(this.viewModel.location=t),this.visible=!0;const s=()=>this.hide();r&&r.catch(()=>{}).then(s)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,r=!!t,s=e&&r,n=!e&&r,a={[Vx.spinnerStart]:s,[Vx.spinnerFinish]:n},o=this._getPositionStyles();return U("div",{class:this.classes(Vx.base,a),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=kf(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(T(t)||T(e))return{};const{padding:r}=t;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};d([p()],Au.prototype,"location",null),d([p()],Au.prototype,"view",null),d([p({type:n4})],Au.prototype,"viewModel",void 0),d([p()],Au.prototype,"visible",null),Au=d([k("esri.widgets.Spinner")],Au);const SW=Au,Ew={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},tp=new a0({id:"zoom-to-feature",title:"{messages.zoom}",className:Ew.iconZoom}),RO=new a0({id:"remove-selected-feature",title:"{messages.remove}",className:Ew.iconTrash}),cf=new a0({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Ew.iconZoom}),hf=new a0({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Ew.iconBrowseClusteredFeatures}),RW="esri.widgets.Popup.PopupViewModel",vb=pe.getLogger(RW),AW=i=>{const{event:e,view:t}=i,{action:r}=e,s=t&&t.popup;if(!r)return Promise.reject(new ue("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new ue("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:a}=r;if(!a)return Promise.reject(new ue("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new ue("trigger-action:invalid-action","Action is disabled"));if(a===tp.id)return OW(s.viewModel).catch(J8);if(a===cf.id)return MW(s.viewModel);if(a===hf.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,a===RO.id){s.close();const{selectedFeature:o}=s;if(!o)return Promise.reject(new ue(`trigger-action:${RO.id}`,"selectedFeature is required",{selectedFeature:o}));const{sourceLayer:l}=o;return l?l.remove(o):t.graphics.remove(o),Promise.resolve()}return Promise.resolve()};function a4(i){const{selectedFeature:e,location:t,view:r}=i;return r?r.type==="3d"?e??t??null:i.get("selectedFeature.geometry")||t:null}function Gu(i){var e,t;return!!i&&i.isAggregate&&((t=(e=i.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:t.type)==="cluster"}async function PW(i,e){if((e==null?void 0:e.type)!=="3d"||!i||i.declaredClass!=="esri.Graphic")return!0;const t=e.getViewForGraphic(i);if(t&&"whenGraphicBounds"in t){let r;try{r=await t.whenGraphicBounds(i,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}async function OW(i){var h;const{location:e,selectedFeature:t,view:r,zoomFactor:s}=i,n=a4(i);if(!r||!n){const u=new ue("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw vb.error(u),u}const a=r.scale/s,o=(h=i.selectedFeature)==null?void 0:h.geometry,l=o??e,c=_(l)&&l.type==="point"&&await PW(t,r);tp.active=!0,tp.disabled=!0;try{await i.zoomTo({target:{target:n,scale:c?a:void 0}})}catch{const m=new ue("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:t});vb.error(m)}finally{tp.active=!1,tp.disabled=!1,i.zoomToLocation=null,c&&(i.location=l)}}async function MW(i){const{selectedFeature:e,view:t}=i;if((t==null?void 0:t.type)!=="2d"){const a=new ue("zoomToCluster:invalid-view","View must be 2d MapView.",{view:t});throw vb.error(a),a}if(!e||!Gu(e)){const a=new ue("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw vb.error(a),a}const[r,s]=await fR(t,e);cf.active=!0,cf.disabled=!0;const{extent:n}=await r.queryExtent(s);await i.zoomTo({target:n}),cf.active=!1,cf.disabled=!1}async function IW(i){const{view:e,selectedFeature:t}=i;if(!e||!t)return;const[r,s]=await fR(e,t),{extent:n}=await r.queryExtent(s);i.selectedClusterBoundaryFeature.geometry=n,e.graphics.add(i.selectedClusterBoundaryFeature)}async function DW(i){var a;const{selectedFeature:e,view:t}=i;if(!t||!e)return;const[r,s]=await fR(t,e);hf.active=!0,hf.disabled=!0;const{features:n}=await r.queryFeatures(s);hf.active=!1,hf.disabled=!1,(a=t.popup)==null||a.open({features:[e].concat(n),featureMenuOpen:!0})}async function fR(i,e){const t=await i.whenLayerView(e.sourceLayer),r=t.createQuery(),s=e.getObjectId();return r.aggregateIds=s!=null?[s]:[],[t,r]}function LW(i){const e=i.features.filter(t=>Gu(t));e.length&&(i.features=e)}function o4(i){var e;if(T(i))return null;switch(i.type){case"point":return i;case"extent":return i.center;case"polygon":return i.centroid;case"multipoint":case"polyline":return(e=i.extent)==null?void 0:e.center;default:return null}}const He="esri-popup",Eg=`${He}__header`,eu=`${He}--is-docked`,re={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:He,widget:"esri-widget",main:`${He}__main-container`,loadingContainer:`${He}__loading-container`,isCollapsible:`${He}--is-collapsible`,isCollapsed:`${He}--is-collapsed`,shadow:`${He}--shadow`,isDocked:eu,isDockedTopLeft:`${eu}-top-left`,isDockedTopCenter:`${eu}-top-center`,isDockedTopRight:`${eu}-top-right`,isDockedBottomLeft:`${eu}-bottom-left`,isDockedBottomCenter:`${eu}-bottom-center`,isDockedBottomRight:`${eu}-bottom-right`,alignTopCenter:`${He}--aligned-top-center`,alignBottomCenter:`${He}--aligned-bottom-center`,alignTopLeft:`${He}--aligned-top-left`,alignBottomLeft:`${He}--aligned-bottom-left`,alignTopRight:`${He}--aligned-top-right`,alignBottomRight:`${He}--aligned-bottom-right`,isFeatureMenuOpen:`${He}--feature-menu-open`,isActionsMenuOpen:`${He}--actions-menu-open`,hasFeatureUpdated:`${He}--feature-updated`,header:Eg,headerButtons:`${Eg}-buttons`,headerContainer:`${Eg}-container`,headerContainerButton:`${Eg}-container--button`,headerTitle:`${Eg}-title`,content:`${He}__content`,contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:`${He}__footer`,footerHasPagination:`${He}__footer--has-pagination`,footerHasActions:`${He}__footer--has-actions`,footerHasActionsMenu:`${He}__footer--has-actions-menu`,button:`${He}__button`,buttonDisabled:`${He}__button--disabled`,buttonDock:`${He}__button--dock`,icon:`${He}__icon`,iconDock:`${He}__icon--dock-icon`,inlineActionsContainer:`${He}__inline-actions-container`,actionsMenuButton:`${He}__actions-menu-button`,actions:`${He}__actions`,action:`${He}__action`,actionImage:`${He}__action-image`,actionText:`${He}__action-text`,actionToggle:`${He}__action-toggle`,actionToggleOn:`${He}__action-toggle--on`,actionExit:`${He}__action--exit`,actionSelectFeature:`${He}__action--select-feature`,pointer:`${He}__pointer`,pointerDirection:`${He}__pointer-direction`,navigation:`${He}__navigation`,paginationPrevious:`${He}__pagination-previous`,paginationNext:`${He}__pagination-next`,paginationPreviousIconLTR:`${He}__pagination-previous-icon`,paginationPreviousIconRTL:`${He}__pagination-previous-icon--rtl`,paginationNextIconLTR:`${He}__pagination-next-icon`,paginationNextIconRTL:`${He}__pagination-next-icon--rtl`,featureMenu:`${He}__feature-menu`,featureMenuList:`${He}__feature-menu-list`,featureMenuItem:`${He}__feature-menu-item`,featureMenuViewport:`${He}__feature-menu-viewport`,featureMenuHeader:`${He}__feature-menu-header`,featureMenuNote:`${He}__feature-menu-note`,featureMenuSelected:`${He}__feature-menu-item--selected`,featureMenuButton:`${He}__feature-menu-button`,featureMenuTitle:`${He}__feature-menu-title`,featureMenuObserver:`${He}__feature-menu-observer`,featureMenuLoader:`${He}__feature-menu-loader`,collapseButton:`${He}__collapse-button`,collapseIcon:`${He}__collapse-icon`};var vp;(function(i){i[i.size=22]="size",i[i.lineWidth=50]="lineWidth",i[i.maxSize=120]="maxSize",i[i.maxOutlineSize=80]="maxOutlineSize",i[i.tallSymbolWidth=20]="tallSymbolWidth"})(vp||(vp={}));const AO=Vt("android");Vt("chrome")||AO&&AO>=4;ZC();vp.size;vp.maxSize;vp.maxOutlineSize;vp.lineWidth;vp.tallSymbolWidth;function l4(i){return i&&"opacity"in i?i.opacity*l4(i.parent):1}async function $W(i,e){if(!i)return;const t=i.sourceLayer,r=(_(e)&&e.useSourceLayer?t:i.layer)??t,s=l4(r);if(_(i.symbol)&&(!_(e)||e.ignoreGraphicSymbol!==!0)){const v=i.symbol.type==="web-style"?await p7(i.symbol,{...e,cache:_(e)?e.webStyleCache:null}):i.symbol.clone();return hx(v,null,s),v}const n=(_(e)?e.renderer:null)??(r&&"renderer"in r?r.renderer:null);let a=n&&"getSymbolAsync"in n?await n.getSymbolAsync(i,e):null;if(!a)return;if(a=a.type==="web-style"?await a.fetchSymbol({...e,cache:_(e)?e.webStyleCache:null}):a.clone(),!(n&&"visualVariables"in n&&n.visualVariables&&n.visualVariables.length))return hx(a,null,s),a;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(T(e)||T(e.arcade))){const v={...Et(e)};v.arcade=await C2(),e=v}const o=await Y(()=>import("./visualVariableUtils-61985981.js"),["./visualVariableUtils-61985981.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./typedArrayUtil-bf9f210a.js","./ArrayPool-b51874dd.js","./string-53224faa.js","./Error-5cdd6e0a.js","./Graphic-5dcfa25e.js","./jsonMap-ffa742d3.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./sizeVariableUtils-d4870b0d.js"],import.meta.url),l=[],c=[],h=[],u=[];for(const v of n.visualVariables)switch(v.type){case"color":l.push(v);break;case"opacity":c.push(v);break;case"rotation":u.push(v);break;case"size":v.target||h.push(v)}const m=!!l.length&&l[l.length-1],f=m?o.getColor(m,i,e):null,y=!!c.length&&c[c.length-1];let g=y?o.getOpacity(y,i,e):null;if(s!=null&&(g=g!=null?g*s:s),hx(a,f,g),h.length){const v=o.getAllSizes(h,i,e);await m7(a,v)}for(const v of u)f7(a,o.getRotationAngle(v,i,e),v.axis);return a}let ph=class{constructor(e,t){this._owner=t,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new v8(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=v$(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const t=this._properties[e];for(const r of t.acquired)QA(r)||t.pool.release(r);t.pool.destroy(),t.pool=null,t.acquired=null}this._properties=null,this._owner=null}get(e){const t=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===t;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const t=this._properties[e];let r=0;for(const s of t.acquired)QA(s)?t.acquired[r++]=s:t.pool.release(s);t.acquired.length=r}}};const FW=Vt("mac")?"Meta":"Ctrl",Sw={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let i=48;i<58;i++)Sw[i]=String.fromCharCode(i);for(let i=1;i<25;i++)Sw[111+i]=`F${i}`;for(let i=65;i<91;i++)Sw[i]=[String.fromCharCode(i+32),String.fromCharCode(i)];function NW(i){if(i.key!==void 0)return ku(i);const e=Sw[i.keyCode];return Array.isArray(e)?i.shiftKey?e[1]:e[0]:e}function UW(i){switch(i){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let VW=class{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const t=e.modifiers;for(const r of this.keyModifiers)if(!t.has(r))return!1;return!0}};const PO=pe.getLogger("esri.views.input.InputHandler");let ls=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const r of t)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?PO.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(t=>this._handleEvent(t)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,t,r){let s;typeof t=="function"?(r=t,s=[]):s=t||[];const n=typeof e=="string"?new VW(e,s):e,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=h=>{const u=this._incoming[h.match.eventType];if(u){const m=u.indexOf(h);u.splice(m,1),a(),this._manager&&this._manager.updateDependencies()}},l=new BW(n,r,{onPause:o,onRemove:o,onResume:h=>{const u=this._incoming[h.match.eventType];u&&!u.includes(h)&&(u.push(h),a(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),a(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new zW(e,{onEmit:(r,s,n,a)=>{var o;(o=this._manager)==null||o.emit(r.eventType,s,n,a)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){var t;(t=this._manager)==null||t.setPointerCapture(e,!0)}stopCapturingPointer(e){var t;(t=this._manager)==null||t.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):PO.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var r;const t=this._incoming[e.type];if(t){for(const s of t)if(s.match.matches(e)&&((r=s.callback)==null||r.call(s,e),e.shouldStopPropagation()))break}}},BW=class{constructor(e,t,r){this.match=e,this._callback=t,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},zW=class{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,r){this._removed||this._handler.onEmit(this,e,t,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},kW=class extends ls{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",t=>{this._update(t.data)})}_update(e){const t=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;t===this._value&&this._x===r&&this._y===s||(this._value=t,this._x=r,this._y=s,this._onChange(t,r,s))}},GW=class extends ls{get multiTouchActive(){return this._multiTouchActive.get()}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new V7(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}},Ml=class extends ge{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=FW,this._latestPointerType="mouse",this._propertiesPool=new ph({latestPointerLocation:WW},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,t,r=Id.INTERNAL){if(this._nameToGroup[e])return void pe.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void pe.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const s={name:e,handlers:t.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const a=s.handlers[n];this._handlers.push(a),a.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,l,c,h,u)=>{this._emitInputEvent(a.priorityIndex+1,o,l,c,u,h)},setPointerCapture:(o,l)=>{this._setPointerCapture(s,a,o,l)},setEventCallback:o=>{a.eventCallback=o},setUninstallCallback:o=>{a.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):pe.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const a of s.handler.outgoingEventTypes)if(e.has(a)){n=!0;break}}if(n)for(const a of s.handler.incomingEventMatches){e.add(a.eventType);for(const o of a.keyModifiers)UW(o)||t.add(o)}s.active=n}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(T(s)||s.x!==t||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=t,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const n=t;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,t);const r=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,s=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,s)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const s=()=>{if(!r){const o=new Set;this._activeKeyModifiers.forEach(l=>{o.add(l)}),this._activeKeyModifiers=o,r=!0}},n=(o,l)=>{l&&!this._activeKeyModifiers.has(o)?(s(),this._activeKeyModifiers.add(o)):!l&&this._activeKeyModifiers.has(o)&&(s(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&n(o,e==="key-down")}const a=t.native;n("Alt",!(!a||!a.altKey)),n("Ctrl",!(!a||!a.ctrlKey)),n("Shift",!(!a||!a.shiftKey)),n("Meta",!(!a||!a.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new kW((e,t,r)=>this._setLatestPointer(e,t,r)),this._multiTouchHandler=new GW,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Id.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Id.INTERNAL)}_setPointerCapture(e,t,r,s){const n=e.name+"-"+t.priorityIndex,a=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,a),s?(a.add(n),a.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):a.has(n)&&(a.delete(n),a.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,r,s){this._emitInputEvent(0,e,t,r,s)}_emitInputEvent(e,t,r,s,n,a){const o=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new HW(t,r,o,a||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new gP,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var t,r;const e=P8(this._currentPropagation);for(;e.events.length>0;){const{event:s,priorityIndex:n}=e.events.pop(),a=s.data&&s.data.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[n];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((r=(t=e.currentHandler).eventCallback)==null||r.call(t,s)),s.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const t=new gP;t.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)t.push(r.events.pop());r.events=t,r.currentHandler=null}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of t.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(a=>s.keyModifiers.includes(a));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let s=0;for(;s<t.length&&this._compareHandlerPriority(r,t[s])>=0;)s++;t.splice(s,0,r)}return t}get debug(){const e=t=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=r};return{injectEvent:(t,r)=>{e(()=>{this._onEventReceived(t,r)})},disablePointerCapture:e}}};d([p({readOnly:!0})],Ml.prototype,"hasPendingInputs",null),d([p({constructOnly:!0})],Ml.prototype,"eventSource",void 0),d([p({constructOnly:!0})],Ml.prototype,"recognizers",void 0),d([p()],Ml.prototype,"_latestPointerType",void 0),d([p()],Ml.prototype,"latestPointerType",null),d([p()],Ml.prototype,"multiTouchActive",null),d([p({readOnly:!0})],Ml.prototype,"latestPointerLocation",void 0),Ml=d([k("esri.views.input.InputManager")],Ml);let HW=class{constructor(e,t,r,s,n){this.type=e,this.data=t,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=md.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=md.STOPPED}shouldStopPropagation(){return(this._propagationState&md.STOPPED)!=0}async(e){this._propagationState|=md.PAUSED;const t=(r,s)=>{this._propagationState&=~md.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>t(r,!1),r=>t(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&md.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var md;(function(i){i[i.NONE=0]="NONE",i[i.STOPPED=1]="STOPPED",i[i.PAUSED=2]="PAUSED"})(md||(md={}));const Id={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let qW=class{};const WW=qW;function OO(i){return i&&typeof i.highlight=="function"}function jW(i){return i&&typeof i.maskOccludee=="function"}function b0e(i,e,t){return T(i)||i>t&&(e===0||i<e)}function w0e(i,e){return _(i)&&i>0||_(e)&&e>0}function x0e(i){const e=i.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}const c4=i=>{let e=class extends i{constructor(...t){super(...t),this.goToOverride=null,this.view=null}callGoTo(t){const{view:r}=this;return T$(r),this.goToOverride?this.goToOverride(r,t):r.goTo(t.target,t.options)}};return d([p()],e.prototype,"goToOverride",void 0),d([p()],e.prototype,"view",void 0),e=d([k("esri.widgets.support.GoTo")],e),e},q_=Oi.ofType({key:"type",defaultKeyValue:"button",base:c7,typeMap:{button:a0,toggle:h7}}),XW=()=>[tp.clone()],YW=()=>[cf.clone(),hf.clone()];let Ut=class extends c4(s4){get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}constructor(e){super(e),this._handles=new mi,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new q_,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new mc({symbol:new _7({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this._handles.add([z(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),z(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),z(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),z(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),z(()=>this.location,e=>this._locationChange(e)),z(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),z(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),z(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),z(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>AW({event:e,view:this.view})),ha(()=>!this.waitingForResult,()=>this._waitingForResultChange(),ii),z(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),z(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),ha(()=>!this.visible,()=>this.browseClusterEnabled=!1),z(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new q_;e.removeAll();const{actions:t,defaultActions:r,defaultPopupTemplateEnabled:s,includeDefaultActions:n,selectedFeature:a}=this,o=n?r.concat(t):t,l=a&&(typeof a.getEffectivePopupTemplate=="function"&&a.getEffectivePopupTemplate(s)||a.popupTemplate),c=l&&l.actions,h=l&&l.overwriteActions?c:c?c.concat(o):o;return h&&h.filter(Boolean).forEach(u=>e.add(u)),e}get defaultActions(){const e=this._get("defaultActions")||new q_;return e.removeAll(),e.addMany(Gu(this.selectedFeature)?YW():XW()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:r,promiseCount:s,selectedFeatureIndex:n}=this,a=s&&t.length;a&&r&&n===-1?this.selectedFeatureIndex=0:a&&n!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){var s,n,a;let t=e;const r=(n=(s=this.view)==null?void 0:s.spatialReference)==null?void 0:n.isWebMercator;e&&((a=e==null?void 0:e.spatialReference)!=null&&a.isWGS84)&&r&&(t=a2(e)),this._set("location",t)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const r=n=>{this._pendingPromises.has(t)&&this._updateFeatures(n),this._updatePendingPromises(t)},s=()=>this._updatePendingPromises(t);t.then(r,s)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=a4(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new ue("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:r}=this;if(!r||!e)throw new ue("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return r.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=t;delete t.fetchFeatures,r&&this._setFetchFeaturesPromises(t.location);const s=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const n of s)delete t[n];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){LW(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?Gu(t)?(await IW(this),await DW(this)):pe.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):pe.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(tp.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),this._selectedClusterFeature&&e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Gu(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:r}=this;r&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:r,featuresPerPage:s,featureViewModels:n}=this;if(r===null)return;const a=((r-1)*s+t)%t,o=a+s;n.slice(a,o).forEach((l,c)=>{l&&!l.graphic&&(l.graphic=e[a+c])})}async _selectedFeatureChange(e){const{location:t,updateLocationEnabled:r,view:s}=this;if(e&&s){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(s.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Gu(e)?void 0:(e.symbol=await $W(e),this._selectedClusterFeature=e,void s.graphics.add(this._selectedClusterFeature));!r&&t||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{var a;const n=(a=s.center)==null?void 0:a.clone();n&&(this.location=n)}):this.location=Et(o4(e.geometry))}}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:r,promisesPerLayerView:s}=t,n=Promise.resolve(r),a=s.map(o=>o.promise);this.promises=[n,...a]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:r}=this;if(Gu(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const s=r.slice(0),n=[];t.forEach((a,o)=>{var c,h;if(!a)return;let l=null;if(s.some((u,m)=>(u&&u.graphic===a&&(l=u,s.splice(m,1)),!!l)),l)n[o]=l;else{const u=new mR({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(c=this.view)==null?void 0:c.spatialReference,graphic:a===e?a:null,map:(h=this.view)==null?void 0:h.map,view:this.view});n[o]=u}}),s.forEach(a=>a&&!a.destroyed&&a.destroy()),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:r}=this;if(t.remove(e),r&&this.view){const s=this.view.on("click",n=>{n.pointerType==="mouse"&&n.button!==0||this._fetchFeaturesAndOpen(n)},Id.WIDGET);t.add(s,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const r=new AbortController,{signal:s}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const n=this.fetchFeatures(e,{signal:s,event:t});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),n}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:r}=e,{view:s}=this;this._fetchFeaturesWithController(t,e).then(n=>{var h;const{clientOnlyGraphics:a,promisesPerLayerView:o,location:l}=n,c=[Promise.resolve(a),...o.map(u=>u.promise)];return(h=s==null?void 0:s.popup)==null||h.open({location:l||r,promises:c}),n})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:r}=e;return r&&"layer"in r&&r.layer?r.layer:(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:t}_getHighlightTarget(e,t){const r=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||V5:null,s=e.attributes;return s&&r&&s[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:r,activeFeature:s,visible:n}=this;if(!(s&&r&&t&&n))return;const a=this._getHighlightLayer(s);if(!(a&&a instanceof fP))return;const o=this._getLayerView(r,a);this._highlightActiveFeaturePromise=o;const l=await o;if(!(l&&OO(l)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const c=l.highlight(this._getHighlightTarget(s,a));this._handles.add(c,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:r,view:s,visible:n}=this;if(!(t&&s&&r&&n))return;const a=this._getHighlightLayer(t);if(!(a&&a instanceof fP))return;const o=this._getLayerView(s,a);this._highlightSelectedFeaturePromise=o;const l=await o;if(!(l&&OO(l)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=l.highlight(this._getHighlightTarget(t,a));this._handles.add(c,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const r=e.filter(s=>!t.includes(s));this.features=t.concat(r)}};d([p()],Ut.prototype,"featurePage",void 0),d([p()],Ut.prototype,"isLoadingFeature",null),d([p({type:q_})],Ut.prototype,"actions",void 0),d([p({readOnly:!0})],Ut.prototype,"active",null),d([p()],Ut.prototype,"activeFeature",void 0),d([p({readOnly:!0})],Ut.prototype,"allActions",null),d([p({type:Boolean})],Ut.prototype,"defaultPopupTemplateEnabled",void 0),d([p()],Ut.prototype,"autoCloseEnabled",void 0),d([p()],Ut.prototype,"autoOpenEnabled",void 0),d([p()],Ut.prototype,"browseClusterEnabled",void 0),d([p()],Ut.prototype,"content",void 0),d([p({type:q_,readOnly:!0})],Ut.prototype,"defaultActions",null),d([p({readOnly:!0})],Ut.prototype,"featureCount",null),d([p()],Ut.prototype,"features",null),d([p()],Ut.prototype,"featuresPerPage",void 0),d([p()],Ut.prototype,"featureViewModelAbilities",void 0),d([p({readOnly:!0})],Ut.prototype,"featureViewModels",void 0),d([p()],Ut.prototype,"highlightEnabled",void 0),d([p()],Ut.prototype,"includeDefaultActions",void 0),d([p({type:kt})],Ut.prototype,"location",null),d([p({readOnly:!0})],Ut.prototype,"pendingPromisesCount",null),d([p({readOnly:!0})],Ut.prototype,"selectedClusterBoundaryFeature",void 0),d([p({readOnly:!0})],Ut.prototype,"waitingForResult",null),d([p({readOnly:!0})],Ut.prototype,"promiseCount",null),d([p()],Ut.prototype,"promises",null),d([p({value:null,readOnly:!0})],Ut.prototype,"selectedFeature",null),d([p({value:-1})],Ut.prototype,"selectedFeatureIndex",null),d([p({readOnly:!0})],Ut.prototype,"selectedFeatureViewModel",null),d([p({readOnly:!0})],Ut.prototype,"state",null),d([p()],Ut.prototype,"title",void 0),d([p()],Ut.prototype,"updateLocationEnabled",void 0),d([p()],Ut.prototype,"view",void 0),d([p()],Ut.prototype,"visible",void 0),d([p()],Ut.prototype,"zoomFactor",void 0),d([p()],Ut.prototype,"zoomToLocation",void 0),d([p()],Ut.prototype,"centerAtLocation",null),Ut=d([k("esri.widgets.Popup.PopupViewModel")],Ut);const h4=Ut,MO="selected-index",QW=0,IO="popup-spinner",DO={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},LO="esri-popup";function Sc(i,e){return e===void 0?`${LO}__${i}`:`${LO}__${i}-${e}`}const $O={closeButton:!0,featureNavigation:!0};let Ge=class extends i4(rn){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new mi,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverNode=null,this._featureMenuViewportNode=null,this._rootFlowItemNode=null,this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=Pf(()=>this._displaySpinner(),QW),this._exitRelatedRecordsActions=new WeakMap,this._featureSelectionActions=new WeakMap,this._flowItems=new Oi,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new h4,this.visibleElements={...$O},this._handleOpenRelatedFeature=r=>{this._openRelatedFeature(r)},this._addSelectedFeatureIndexHandle(),this.addHandles([z(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),z(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),z(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,s)=>{!!r!=!!s&&this.reposition()}),z(()=>{var r,s,n,a,o,l;return[(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.padding,(a=(n=this.viewModel)==null?void 0:n.view)==null?void 0:a.size,(o=this.viewModel)==null?void 0:o.active,(l=this.viewModel)==null?void 0:l.location,this.alignment]},()=>this.reposition()),z(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),z(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.size},(r,s)=>this._updateDockEnabledForViewSize(r,s)),z(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,s)=>this._viewChange(r,s)),z(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.ready},(r,s)=>this._viewReadyChange(r??!1,s??!1)),z(()=>{var r,s;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(s=this.viewModel)==null?void 0:s.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),z(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),z(()=>{var r,s,n,a;return[(s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:s.title,(a=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:a.state]},()=>this._setTitleFromFeatureWidget()),z(()=>{var r,s,n,a;return[(s=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:s.content,(a=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:a.state]},()=>this._setContentFromFeatureWidget()),ha(()=>!this.collapsed,()=>{var r,s;((s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Nr(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),z(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),Je),z(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),Nr(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),z(()=>{var r,s,n,a;return[(s=(r=this._activeFlowItemWidget)==null?void 0:r.viewModel)==null?void 0:s.state,(a=(n=this._activeFlowItemWidget)==null?void 0:n.viewModel)==null?void 0:a.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([Y(()=>import("./calcite-flow-351eb4cf.js"),["./calcite-flow-351eb4cf.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./observers-955fedd9.js"],import.meta.url),Y(()=>import("./calcite-flow-item-b5d41481.js"),["./calcite-flow-item-b5d41481.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./interactive-1de2e238.js","./loadable-6afd516d.js","./t9n-fc0d9eed.js","./key-dd674229.js","./observers-955fedd9.js","./guid-51402ee7.js","./action-1d167c92.js","./icon-e2d88df4.js","./loader-de98eb51.js","./tooltip-496b8e9a.js","./debounce-d5abe404.js","./scrim-20a34a80.js"],import.meta.url),Y(()=>import("./calcite-action-da4df145.js"),["./calcite-action-da4df145.js","./action-1d167c92.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./guid-51402ee7.js","./interactive-1de2e238.js","./loadable-6afd516d.js","./t9n-fc0d9eed.js","./key-dd674229.js","./observers-955fedd9.js","./icon-e2d88df4.js","./loader-de98eb51.js"],import.meta.url),Y(()=>import("./calcite-tooltip-02836dd9.js"),["./calcite-tooltip-02836dd9.js","./tooltip-496b8e9a.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./debounce-d5abe404.js","./guid-51402ee7.js"],import.meta.url),Y(()=>import("./calcite-icon-abf9d6bc.js"),["./calcite-icon-abf9d6bc.js","./icon-e2d88df4.js","./widget-01c21b51.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./assets-94d592bf.js","./Evented-686173eb.js","./Promise-755e47e5.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./observers-955fedd9.js"],import.meta.url)])}destroy(){var e,t;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect()}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:t}=this;if(!e)return!!(t!=null&&t.content);const r=e.viewModel;if(r!=null&&r.waitingForContent||(r==null?void 0:r.state)==="error")return!0;const s=r==null?void 0:r.content;return Array.isArray(s)?!!s.length:!!s}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation!=null}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||DO}set dockOptions(e){var l,c;const t={...DO},r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.breakpoints,s={};r&&(s.width=r.xsmall,s.height=r.xsmall);const n={...t,...e},a={...t.breakpoint,...s},{breakpoint:o}=n;typeof o=="object"?n.breakpoint={...a,...o}:o&&(n.breakpoint=a),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:r,_flowItems:s}=this,{selectedFeatureViewModel:n}=this.viewModel,a={...t,title:!1};return n?(e?(e.viewModel=n,e.visibleElements=a):this._feature=new CW({flowItems:s,headingLevel:r+1,viewModel:n,visibleElements:a}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...$O,...e}}blur(){const{active:e}=this.viewModel;e||pe.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||pe.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var n,a;this._handles.remove(MO);const t=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,s={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:t};((a=(n=this.viewModel)==null?void 0:n.view)==null?void 0:a.widthBreakpoint)==="xsmall"&&(s.collapsed=!0),this.set(s),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var g,v,b,x;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:r,dividedActions:s,currentAlignment:n,currentDockPosition:a}=this,{active:o}=this.viewModel,{menuActions:l}=s,c=o&&l.length>1&&e,h=o&&t,u=o&&!t,m=(v=(g=this.selectedFeature)==null?void 0:g.layer)==null?void 0:v.title,f=(x=(b=this.selectedFeature)==null?void 0:b.layer)==null?void 0:x.id,y={[re.alignTopCenter]:n==="top-center",[re.alignBottomCenter]:n==="bottom-center",[re.alignTopLeft]:n==="top-left",[re.alignBottomLeft]:n==="bottom-left",[re.alignTopRight]:n==="top-right",[re.alignBottomRight]:n==="bottom-right",[re.isDocked]:h,[re.shadow]:u,[re.isDockedTopLeft]:a==="top-left",[re.isDockedTopCenter]:a==="top-center",[re.isDockedTopRight]:a==="top-right",[re.isDockedBottomLeft]:a==="bottom-left",[re.isDockedBottomCenter]:a==="bottom-center",[re.isDockedBottomRight]:a==="bottom-right",[re.isFeatureMenuOpen]:r,[re.isActionsMenuOpen]:c};return U("div",{class:this.classes(re.base,y),role:"presentation","data-layer-title":m,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return U("span",{"aria-hidden":"true",class:this.classes(re.icon,re.iconLoading,re.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?U("div",{key:Sc("loading-container"),role:"presentation",class:re.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Kl(this.container),t={[re.iconRightTriangleArrow]:e,[re.paginationPreviousIconRTL]:e,[re.iconLeftTriangleArrow]:!e,[re.paginationPreviousIconLTR]:!e};return U("span",{"aria-hidden":"true",class:this.classes(re.icon,t)})}renderPreviousButton(){const{messages:e}=this;return U("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(re.button,re.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Kl(this.container),t={[re.iconLeftTriangleArrow]:e,[re.paginationNextIconRTL]:e,[re.iconRightTriangleArrow]:!e,[re.paginationNextIconLTR]:!e};return U("span",{"aria-hidden":"true",class:this.classes(re.icon,t)})}renderNextButton(){const{messages:e}=this;return U("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(re.button,re.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:r}=this,{featureCount:s,selectedFeatureIndex:n}=this.viewModel;return U("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(re.button,re.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(s,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),r={[re.iconUndock]:e,[re.iconDock]:!e,[re.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[re.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[re.iconDockToTop]:!e&&t==="top-center",[re.iconDockToBottom]:!e&&t==="bottom-center"};return U("span",{"aria-hidden":"true",class:this.classes(r,re.icon)})}renderDockButton(){var n,a,o;const{dockEnabled:e,messages:t}=this,r=(a=(n=this.viewModel)==null?void 0:n.view)==null?void 0:a.widthBreakpoint,s=e?t.undock:t.dock;return r!=="xsmall"&&((o=this.dockOptions)!=null&&o.buttonEnabled)?U("div",{role:"button","aria-label":s,title:s,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(re.button,re.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:r,contentCollapsed:s,messagesCommon:n}=this,a={[re.headerContainerButton]:r},o=U(hR,{level:this.headingLevel,class:re.headerTitle,innerHTML:e??""}),l=r?U("button",{key:`${e}--collapsible`,id:t,title:s?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(re.headerContainer,a),"aria-expanded":s?"false":"true",onclick:this._toggleCollapsed,type:"button"},o,U("calcite-icon",{class:re.collapseIcon,key:"collapse-icon",icon:s?"chevron-down":"chevron-up",scale:"m"})):U("div",{key:e??"title",id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(re.headerContainer,a)},o);return e?l:null}renderCloseIcon(){return U("span",{"aria-hidden":"true",class:this.classes(re.icon,re.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?U("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:re.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return U("header",{class:re.header},this.renderTitle(),U("div",{class:re.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:r,_flowItems:s}=this,{content:n}=this.viewModel,a=s.toArray(),o={[re.contentHasFlows]:!!a.length};return t&&!r?U("div",{key:n??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(re.content,o)},U("calcite-flow",{bind:this},U("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:Z1,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),a.map(l=>this.renderFlowItem(l))),a.map(l=>this.renderFlowItemTooltips(l))):null}renderFlowItem(e){const{messages:t}=this,r=yb(),s="graphic"in e&&!e.isTable;return U("calcite-flow-item",{bind:this,class:this.classes({[re.calciteThemeDark]:!r,[re.calciteThemeLight]:r}),heading:e.title??"",description:this._getFlowItemDescription(e),onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${e.viewModel.uid}`},U("calcite-action",{class:re.actionExit,icon:"move-up",label:t==null?void 0:t.exitRelatedRecords,text:t==null?void 0:t.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:n=>this._storeExitRelatedRecordsAction(e,n),onclick:this._destroyFlowItemWidgets}),s?U("calcite-action",{class:re.actionSelectFeature,icon:"zoom-to-object",label:t==null?void 0:t.selectFeature,text:t==null?void 0:t.selectFeature,slot:"header-actions-end",bind:this,afterCreate:n=>this._storeFeatureSelectionAction(e,n),onclick:()=>this._handleOpenRelatedFeature(e)}):null,U("div",{class:this.classes(re.contentFlowItem,{[re.calciteThemeDark]:r,[re.calciteThemeLight]:!r})},e.render()))}renderFlowItemTooltips(e){const{messages:t,_exitRelatedRecordsActions:r,_featureSelectionActions:s}=this,n=yb(),a=s.get(e);return[U("calcite-tooltip",{class:this.classes({[re.calciteThemeDark]:!n,[re.calciteThemeLight]:n}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:t==null?void 0:t.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:r.get(e),placement:"top"},t==null?void 0:t.exitRelatedRecords),a?U("calcite-tooltip",{class:this.classes({[re.calciteThemeDark]:!n,[re.calciteThemeLight]:n}),key:`select-related-record-tooltip-${e.viewModel.uid}`,label:t==null?void 0:t.selectFeature,overlayPositioning:"fixed",referenceElement:a,placement:"top"},t==null?void 0:t.selectFeature):null]}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:s,messagesCommon:n}=this,a=r?n.close:n.open,{menuActions:o}=s;return o.length?U("div",{key:Sc("actions-menu-button"),class:this.classes(re.button,re.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":a,title:a},U("span",{"aria-hidden":"true",class:re.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:s}=this,{menuActions:n}=s;return n.length&&r?U("ul",{id:e,role:"menu","aria-labelledby":t,key:Sc("actions"),class:re.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(a=>this.renderAction({action:a,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return e.length?e.toArray().map(t=>this.renderAction({action:t,type:"inline"})):[]}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,r=!!e.length,s=!!t.length;return r||s?U("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":s.toString(),class:re.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?U("section",{key:Sc("navigation"),class:this.classes(re.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:r,menuActions:s}=t,n=!!r.length,a=!!s.length,o={[re.footerHasPagination]:e,[re.footerHasActions]:n,[re.footerHasActionsMenu]:a};return e||n?U("div",{key:Sc("feature-buttons"),class:this.classes(re.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:r}=this.viewModel,s=kl(e.selectedFeatures,{total:t.length});return U("section",{key:Sc("menu"),class:re.featureMenu},U("strong",{class:re.featureMenuHeader},s),U("nav",{bind:this,class:re.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:Z1},this.renderFeatureMenu(),U("div",{class:re.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?U("div",{class:re.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:U("div",{key:Sc("pointer"),class:re.pointer,role:"presentation"},U("div",{class:this.classes(re.pointerDirection,re.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:r,titleId:s,contentId:n,collapsible:a,hasContent:o,contentCollapsed:l,visibleElements:c}=this,{title:h}=this.viewModel,u=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",m=t==="top-left"||t==="top-center"||t==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",f={[re.shadow]:e,[re.isCollapsible]:a,[re.isCollapsed]:l};return U("div",{class:this.classes(re.main,re.widget,f),tabIndex:c.closeButton?void 0:-1,role:"dialog","aria-labelledby":h?s:"","aria-describedby":o&&!l?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),m?this.renderFooter():null,m?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?U("div",{class:lr.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return U("span",{key:"text",class:re.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),r=this._getActionImage(e),s={[re.iconLoading]:e.active,[re.rotating]:e.active,[re.icon]:!!t,[re.actionImage]:!e.active&&!!r};return t&&(s[t]=!e.active),U("span",{key:"icon","aria-hidden":"true",class:this.classes(re.icon,s),styles:this._getIconStyles(r)})}renderAction(e){const{action:t,type:r}=e,s=this._getActionTitle(t),n={[re.action]:t.type!=="toggle",[re.actionToggle]:t.type==="toggle",[re.actionToggleOn]:t.type==="toggle"&&t.value,[re.buttonDisabled]:t.disabled},a=[this.renderActionIcon(t),this.renderActionText(s)],o=r==="menu-item"?U("li",{key:t.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(re.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},a):U("div",{key:t.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(re.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},a);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:r,messagesCommon:s}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:a}=this.viewModel,o=e===a,l={[re.featureMenuSelected]:o},c=o?U("span",{key:Sc(`feature-menu-selected-feature-${n}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:re.iconCheckMark}):null,h=U("span",{innerHTML:e.title||s.untitled});return U("li",{role:"menuitem",tabIndex:-1,key:Sc(`feature-menu-feature-${n}`),class:this.classes(l,re.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},U("span",{class:re.featureMenuTitle},h,c))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?U("ol",{class:re.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(r=>!!r.graphic).map((r,s)=>this.renderFeatureMenuItem(r,s))):null}_storeFeatureSelectionAction(e,t){this._featureSelectionActions.set(e,t),this.scheduleRender()}_storeExitRelatedRecordsAction(e,t){this._exitRelatedRecordsActions.set(e,t),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const t=e.graphic,r=t==null?void 0:t.geometry;if(T(r)||T(t))return;this._destroyFlowItemWidgets(),await this.viewModel.zoomTo({target:r});const s=o4(r);this.open({features:[t],location:_(s)?s:void 0})}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();e&&(this._exitRelatedRecordsActions.delete(e),this._featureSelectionActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_getActionTitle(e){const{messages:t,selectedFeature:r,messagesCommon:s}=this,{id:n}=e,a=r==null?void 0:r.attributes,o=e.title??"",l=n==="zoom-to-feature"?kl(o,{messages:t}):n==="remove-selected-feature"?kl(o,{messages:s}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?kl(o,{messages:t}):e.title;return l&&a?kl(l,a):l??""}_getActionClass(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{className:s,image:n}=e,a=n||s?s:re.iconDefaultAction;return a&&r?kl(a,r):a??""}_getActionImage(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{image:s}=e;return s&&r?kl(s,r):s??""}_createFeatureUpdatedAnimation(){return K8("enter",re.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(t?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(r=>{this._handles.add(z(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(a=>a.visible),r=this._getInlineActionCount(),s=r===null,n=r===0;return{inlineActions:s?t.slice(0):n?new Oi:t.slice(0,r),menuActions:s?new Oi:n?t.slice(0):t.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,s;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?t.errorMessage:((s=e.viewModel)==null?void 0:s.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){ku(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){ku(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,r=e.currentTarget["data-feature-index"];t.activeFeature=t.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=ku(e),{_featureMenuNode:r}=this,s=e.currentTarget["data-feature-index"];if(!r)return;const n=r.querySelectorAll("li"),a=n.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(s+1+a)%a].focus()):(e.stopPropagation(),n[(s-1+a)%a].focus())}_handleActionMenuItemKeyup(e){const t=ku(e),{_actionsMenuNode:r}=this,s=e.currentTarget.dataset.actionUid,{menuActions:n}=this.dividedActions,a=n.findIndex(c=>c.uid===s);if(!r)return;const o=r.querySelectorAll("li"),l=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(a+1+l)%l].focus()):(e.stopPropagation(),o[(a-1+l)%l].focus())}_handleMainKeyup(e){const t=ku(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:r}=this.viewModel;r&&t?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e!=null&&e.shouldFocus&&(await py(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=z(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,r)=>this._selectedFeatureIndexUpdated(t,r));this._handles.add(e,MO)}_selectedFeatureIndexUpdated(e,t){const{featureCount:r}=this;r&&e!==t&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:r,screenLocation:s,side:n,view:a}=e;if(isNaN(r)||isNaN(t)||!a||!s)return!1;const o=a.padding;return n==="right"&&s.x+r/2>a.width-o.right||n==="left"&&s.x-r/2<o.left||n==="top"&&s.y-t<o.top||n==="bottom"&&s.y+t>a.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:r,_mainContainerNode:s,viewModel:n}=this,{screenLocation:a,view:o}=n;if(T(a)||!o||!r)return"top-center";if(!this._isScreenLocationWithinView(a,o))return this._get("currentAlignment")||"top-center";function l(S){return parseInt(S.replace(/[^-\d\.]/g,""),10)}const c=s?window.getComputedStyle(s,null):null,h=c?l(c.getPropertyValue("max-height")):0,u=c?l(c.getPropertyValue("height")):0,{height:m,width:f}=r.getBoundingClientRect(),y=f+t,g=Math.max(m,h,u)+t,v=this._isOutsideView({popupHeight:g,popupWidth:y,screenLocation:a,side:"right",view:o}),b=this._isOutsideView({popupHeight:g,popupWidth:y,screenLocation:a,side:"left",view:o}),x=this._isOutsideView({popupHeight:g,popupWidth:y,screenLocation:a,side:"top",view:o}),w=this._isOutsideView({popupHeight:g,popupWidth:y,screenLocation:a,side:"bottom",view:o});return b?x?"bottom-right":"top-right":v?x?"bottom-left":"top-left":x?w?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Kl(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,r=Kl(this.container)?"top-left":"top-right";if(!t)return r;const s=t.padding||{left:0,right:0,top:0,bottom:0},n=t.width-s.left-s.right,{breakpoints:a}=t;return a&&n<=a.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;const{screenLocation:t}=this.viewModel,{width:r}=this._containerNode.getBoundingClientRect(),s=this._calculatePositionStyle(t,r);s&&Object.assign(this._containerNode.style,s)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:r}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,t,r,s){const{currentAlignment:n,_pointerOffsetInPx:a}=this;if(!r)return;const{padding:o}=r,l=s/2,c=r.height-t,h=r.width-e;return n==="bottom-center"?{top:t+a-o.top,left:e-l-o.left}:n==="top-left"?{bottom:c+a-o.bottom,right:h+a-o.right}:n==="bottom-left"?{top:t+a-o.top,right:h+a-o.right}:n==="top-right"?{bottom:c+a-o.bottom,left:e+a-o.left}:n==="bottom-right"?{top:t+a-o.top,left:e+a-o.left}:n==="top-center"?{bottom:c+a-o.bottom,left:e-l-o.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:r,view:s}=this;if(!s)return;if(r)return{left:"",top:"",right:"",bottom:""};if(T(e)||!t)return;const n=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,s,n);return a?{top:a.top!==void 0?`${a.top}px`:"auto",left:a.left!==void 0?`${a.left}px`:"auto",bottom:a.bottom!==void 0?`${a.bottom}px`:"auto",right:a.right!==void 0?`${a.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,r){const[s,n]=e,[a,o]=t,{width:l=0,height:c=0}=r??{};return s<=l&&a>l||s>l&&a<=l||n<=c&&o>c||n>c&&o<=c}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},s=r.left+r.right,n=r.top+r.bottom,a=[],o=[];a[0]=e[0]-s,a[1]=e[1]-n,o[0]=t[0]-s,o[1]=t[1]-n;const{dockOptions:l}=this,c=l.breakpoint;this._dockingThresholdCrossed(a,o,c)&&this._setDockEnabledForViewSize(l),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const r=t.active&&!e;t.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var l,c;const t=e.breakpoint,r=(c=(l=this.viewModel)==null?void 0:l.view)==null?void 0:c.ui;if(!r)return!1;const{width:s,height:n}=r;if(isNaN(s)||isNaN(n)||!t)return!1;const a=t.hasOwnProperty("width")&&s<=(t.width??0),o=t.hasOwnProperty("height")&&n<=(t.height??0);return a||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?kl(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(e,IO),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new SW({view:e}),e.ui.add(this._spinner,{key:IO,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,s=r.findIndex(a=>a.uid===t),n=r.getItemAt(s);n&&n.type==="toggle"&&(n.value=!n.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(s)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};d([p({readOnly:!0})],Ge.prototype,"actionsMenuId",null),d([p({readOnly:!0})],Ge.prototype,"actionsMenuButtonId",null),d([p({readOnly:!0})],Ge.prototype,"featureMenuId",null),d([p({readOnly:!0})],Ge.prototype,"titleId",null),d([p({readOnly:!0})],Ge.prototype,"contentId",null),d([p({readOnly:!0})],Ge.prototype,"hasContent",null),d([p({readOnly:!0})],Ge.prototype,"featureNavigationVisible",null),d([p({readOnly:!0})],Ge.prototype,"collapsible",null),d([p({readOnly:!0})],Ge.prototype,"featureMenuVisible",null),d([p({readOnly:!0})],Ge.prototype,"contentCollapsed",null),d([p({readOnly:!0})],Ge.prototype,"dividedActions",null),d([p({readOnly:!0,dependsOn:["_flowItems.length"]})],Ge.prototype,"_activeFlowItemWidget",null),d([p()],Ge.prototype,"actions",null),d([p()],Ge.prototype,"actionsMenuOpen",null),d([p()],Ge.prototype,"alignment",void 0),d([p()],Ge.prototype,"autoCloseEnabled",null),d([p()],Ge.prototype,"autoOpenEnabled",null),d([p()],Ge.prototype,"defaultPopupTemplateEnabled",null),d([p()],Ge.prototype,"content",null),d([p()],Ge.prototype,"collapsed",void 0),d([p()],Ge.prototype,"collapseEnabled",void 0),d([p({readOnly:!0})],Ge.prototype,"currentAlignment",null),d([p({readOnly:!0})],Ge.prototype,"currentDockPosition",null),d([p()],Ge.prototype,"dockOptions",null),d([p()],Ge.prototype,"dockEnabled",void 0),d([p({readOnly:!0})],Ge.prototype,"featureCount",null),d([p()],Ge.prototype,"featureMenuOpen",void 0),d([p()],Ge.prototype,"features",null),d([p()],Ge.prototype,"goToOverride",null),d([p()],Ge.prototype,"headingLevel",void 0),d([p()],Ge.prototype,"highlightEnabled",null),d([p()],Ge.prototype,"location",null),d([p()],Ge.prototype,"label",null),d([p()],Ge.prototype,"maxInlineActions",void 0),d([p(),Zs("esri/widgets/Popup/t9n/Popup")],Ge.prototype,"messages",void 0),d([p(),Zs("esri/t9n/common")],Ge.prototype,"messagesCommon",void 0),d([p()],Ge.prototype,"promises",null),d([p({readOnly:!0})],Ge.prototype,"selectedFeature",null),d([p()],Ge.prototype,"selectedFeatureIndex",null),d([p({readOnly:!0})],Ge.prototype,"selectedFeatureWidget",null),d([p()],Ge.prototype,"spinnerEnabled",void 0),d([p()],Ge.prototype,"title",null),d([p()],Ge.prototype,"updateLocationEnabled",null),d([p()],Ge.prototype,"view",null),d([p({type:h4}),Tq(["triggerAction","trigger-action"])],Ge.prototype,"viewModel",void 0),d([p()],Ge.prototype,"visible",null),d([p()],Ge.prototype,"visibleElements",void 0),d([ss("visibleElements")],Ge.prototype,"castVisibleElements",null),d([to()],Ge.prototype,"_close",null),d([to()],Ge.prototype,"_toggleDockEnabled",null),d([to()],Ge.prototype,"_toggleFeatureMenu",null),d([to()],Ge.prototype,"_toggleActionsMenu",null),d([to()],Ge.prototype,"_triggerAction",null),d([to()],Ge.prototype,"_selectFeature",null),d([to()],Ge.prototype,"_next",null),d([to()],Ge.prototype,"_previous",null),Ge=d([k("esri.widgets.Popup")],Ge);const FO=Ge,Bx=[0,0];function ZW(i){const e=(i.ownerDocument||window.document).defaultView,t=i.getBoundingClientRect();return Bx[0]=t.left+((e==null?void 0:e.pageXOffset)??0),Bx[1]=t.top+((e==null?void 0:e.pageYOffset)??0),Bx}function NO(i){i&&(M$(i),i.parentNode&&i.parentNode.removeChild(i))}function KW(i){const e=document.createElement("div");return i.appendChild(e),e}const Sg=16,D0=750,JW=512,ej=2,tj=i=>{let e=class extends i{constructor(...t){var r;super(...t),this._freqInfo={freq:Sg,time:D0},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,t.length!==0&&((r=t[0])==null?void 0:r.popup)!==void 0||(this.popup=new FO({view:this})),this.handles.add([z(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),z(()=>this.interacting,s=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",s.toString())})])}initialize(){this.handles.add(z(()=>this.ui,(t,r)=>this._handleUIChange(t,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=we(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(t){const r=this._get("container"),s=c2(t);if(s||typeof t!="string"||pe.getLogger(this.declaredClass).error("#container",`element with id '${t}' not found`),r===s)return;const n="dom-size";if(this.handles.remove(n),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(NO(this.root),this._set("root",null)),this.userContent&&(rP(this.userContent,r),NO(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const a=document.createElement("div");a.className="esri-view-user-storage",rP(s,a),s.appendChild(a),this._set("userContent",a);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,o.appendChild(l),this._set("surface",l);const c=new rO;o.appendChild(c.surface),this._set("overlay",c),z(()=>c.needsRender,h=>{h&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Vf({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=Us(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(z(()=>this.size,h=>{const[u,m]=h,f="esri-view-surface--inset-outline";u>=document.body.clientWidth||m>=document.body.clientHeight?l.classList.add(f):l.classList.remove(f)},Je),n),this._set("container",s),this._startMeasuring()}get focused(){const t=document.activeElement===this.surface;return document.hasFocus()&&t}set popup(t){const r=this._get("popup");r&&r!==t&&r.destroy(),this._set("popup",t)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(t,r,s){const n=this.position;return t-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=t,s[1]=r):s=[t,r],s}containerToPage(t,r,s){const n=this.position;return t+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=t,s[1]=r):s=[t,r],s}_handleUIChange(t,r){r&&(this.handles.remove("ui"),r.destroy()),t&&this._wireUI(t),this._set("ui",t)}_wireUI(t){this.handles.remove("ui"),t&&(t.view=this,this.handles.add([z(()=>this.root,r=>{t.container=r?KW(r):null},Je),z(()=>this.popup,(r,s)=>{const n="popup",a="manual";s&&t.remove(s,n),r&&(r.view=t.view,t.add(r,{key:n,position:a}))},Je)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const t=this._freqInfo;t.freq=Sg,t.time=D0,this.handles.add([(()=>{const r=()=>{t.freq=Sg,t.time=D0};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),Vf({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=Sg,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const a=this._position();n.freq=a||s?Sg:Math.min(D0,n.freq*ej),!s&&n.freq>=JW&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const t=this.container,r=t?t.clientWidth:0,s=t?t.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,a=this.height;return r===n&&s===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:a,width:r,height:s}),!0)}_position(){const t=this.container,r=this.position,s=t&&ZW(t);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return d([p()],e.prototype,"container",null),d([p({readOnly:!0})],e.prototype,"focused",null),d([p({readOnly:!0})],e.prototype,"height",void 0),d([p({type:FO})],e.prototype,"popup",null),d([p({type:rO})],e.prototype,"overlay",void 0),d([p({readOnly:!0})],e.prototype,"position",void 0),d([p({readOnly:!0})],e.prototype,"resizing",void 0),d([p({readOnly:!0})],e.prototype,"root",void 0),d([p({value:null,readOnly:!0})],e.prototype,"size",null),d([p({readOnly:!0})],e.prototype,"surface",void 0),d([p({readOnly:!0})],e.prototype,"suspended",void 0),d([p()],e.prototype,"ui",void 0),d([p({readOnly:!0})],e.prototype,"userContent",void 0),d([p({readOnly:!0})],e.prototype,"width",void 0),d([p()],e.prototype,"widthBreakpoint",void 0),e=d([k("esri.views.DOMContainer")],e),e},ij=12;let Jn=class mn{constructor(e){const t=mn.checkUnsupported(e);if(_(t))throw t;const r=Et(e);this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=up(this.spatialReference)||t0(this.spatialReference)||i0(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,u)=>(h.level<c.min&&(c.min=h.level,c.minIndex=u),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],a=2**n.level;let o=n.resolution*a,l=n.scale*a;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:o,scale:l,tileSize:[o*r.size[0],o*r.size[1]]},o/=2,l/=2}clone(){return new mn(this.toTileInfo())}toTileInfo(){return new i1({dpi:this.dpi,origin:new kt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,t)=>new r1({level:t,scale:e.scale,resolution:e.resolution}))})}getExtent(e,t,r,s){const n=this.levels[e],a=n.tileSize[0],o=n.tileSize[1];s[0]=this.origin[0]+r*a,s[2]=this.origin[0]+(r+1)*a,s[3]=this.origin[1]-t*o,s[1]=this.origin[1]-(t+1)*o}convertExtentToRadians(e,t){this._isWebMercator?(t[0]=JA(e[0]),t[1]=YC(e[1]),t[2]=JA(e[2]),t[3]=YC(e[3])):this._isGCS&&(t[0]=vt(e[0]),t[1]=vt(e[1]),t[2]=vt(e[2]),t[3]=vt(e[3]))}getExtentGeometry(e,t,r,s=new ms){return this.getExtent(e,t,r,gl),s.spatialReference=this.spatialReference,s.xmin=gl[0],s.ymin=gl[1],s.xmax=gl[2],s.ymax=gl[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let t=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),t=!0}return t}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof mn)){if(mn.checkUnsupported(e))return!1;e=new mn(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[t].resolution;let s=.5*r;return!lx(e.origin[0],this.origin[0],s)||!lx(e.origin[1],this.origin[1],s)?!1:(s=.5*r/2**t/this.pixelSize*ij,lx(r,e.levels[t].resolution,s))}rootTilesInExtent(e,t=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(T(e)||n[0]===0||n[1]===0)return s;mn.computeRowColExtent(e,n,this.origin,gl);let a=gl[1],o=gl[3],l=gl[0],c=gl[2];const h=c-l,u=o-a;if(h*u>r){const m=Math.floor(Math.sqrt(r));u>m&&(a=a+Math.floor(.5*u)-Math.floor(.5*m),o=a+m),h>m&&(l=l+Math.floor(.5*h)-Math.floor(.5*m),c=l+m)}for(let m=a;m<o;m++)for(let f=l;f<c;f++)s.push([0,m,f]);return _(t)&&(t[0]=this.origin[0]+l*n[0],t[1]=this.origin[1]-o*n[1],t[2]=this.origin[0]+c*n[0],t[3]=this.origin[1]-a*n[1]),s}static computeRowColExtent(e,t,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/t[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/t[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/t[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/t[1]))}static isPowerOfTwo(e){const t=e.lods,r=t[0].resolution*2**t[0].level;return!t.some(s=>!S8(s.resolution,r/2**s.level))}static hasGapInLevels(e){const t=e.lods.map(r=>r.level);t.sort((r,s)=>r-s);for(let r=1;r<t.length;r++)if(t[r]!==t[0]+r)return!0;return!1}static tileSizeSupported(e){const t=e.size[1];return t===e.size[0]&&(t&t-1)==0&&t>=128&&t<=512}static hasOriginPerLODs(e){const t=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==t.x||r.origin[1]!==t.y))}static getMissingTileInfoError(){return new ue("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return T(e)?gR():e.lods.length<1?new ue("tilingscheme:generic","Tiling scheme must have at least one level"):mn.isPowerOfTwo(e)?mn.hasGapInLevels(e)?new ue("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):mn.tileSizeSupported(e)?mn.hasOriginPerLODs(e)?new ue("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new ue("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new ue("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,t){const r=e[2]-e[0],s=e[3]-e[1],n=Yd(t),a=1.2*Math.max(r,s),o=256,l=96,c=.0254,h=new mn(new i1({size:[o,o],origin:new kt({x:e[0]-.5*(a-r),y:e[3]+.5*(a-s)}),lods:[new r1({level:0,resolution:a/o,scale:1/(o/l*c/(a*n))})],spatialReference:t}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(e){const t=new mn(mn.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(e),t}static makeGCSWithTileSize(e,t=256,r=16){const s=256/t,n=new mn(new i1({size:[t,t],origin:new kt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new r1({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function gR(){return new ue("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Jn.WebMercatorAuxiliarySphereTileInfo=new i1({size:[256,256],origin:new kt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:ci.WebMercator}),spatialReference:ci.WebMercator,lods:[new r1({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Jn.WebMercatorAuxiliarySphere=Jn.makeWebMercatorAuxiliarySphere(19);const gl=Ot(),df=64,h_=512,rj=2.5,Py=R8(A8/10),d4=2,u4=Ot();Jn.WebMercatorAuxiliarySphere.getExtent(0,0,0,u4);const sj=Ot([-180,-90,180,90]),nj="Cannot extend surface to encompass all layers because it would result in too many root tiles.",aj="Surface extent is too large for tile resolution at level 0.",oj=3;let lj=oj;function RE(i){return i<4?3:lj}let Jh=class extends Br.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=Py}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||T(e.extent)||T(e.spatialReference))return null;const t=V$(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){var e;return Ze((e=this.view.basemapTerrain)==null?void 0:e.spatialReference,ci.WGS84)}elevationAt(e,t){var r;if(T(this.extent)||!V8(this.extent,e,t)){const s=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return pe.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${s})`),this.noDataValue}return Ze((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return z7(e.clone(),this)}};d([p({readOnly:!0})],Jh.prototype,"demResolution",void 0),d([p({readOnly:!0})],Jh.prototype,"extent",null),d([p({readOnly:!0})],Jh.prototype,"noDataValue",void 0),d([p()],Jh.prototype,"spatialReference",null),d([p({constructOnly:!0})],Jh.prototype,"view",void 0),Jh=d([k("esri.views.support.GroundViewElevationSampler")],Jh);const cj=Jh;let ed=class extends ge{constructor(e){super(e),this._handles=new mi,this.view=null,this.layerViews=new Oi}initialize(){this._handles.add(ha(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new cj({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>z(()=>e.updating,()=>this._updateUpdating(),ii)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([p({readOnly:!0})],ed.prototype,"elevationSampler",null),d([p({type:Boolean,readOnly:!0})],ed.prototype,"updating",null),d([p({constructOnly:!0})],ed.prototype,"view",void 0),d([p({type:Oi,readOnly:!0})],ed.prototype,"layerViews",void 0),d([p({readOnly:!0})],ed.prototype,"suspended",null),ed=d([k("esri.views.GroundView")],ed);const hj=ed,dj=i=>{let e=class extends i{async fetchPopupFeatures(t,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:a,clientOnlyGraphics:o}=await this._prepareFetchPopupFeatures(t,r),l=Promise.resolve(o),c=this._queryLayerPopupFeatures(n,a,r),h=c.map(u=>u.promise);return{location:s,clientOnlyGraphics:o,allGraphicsPromise:eB([l,...h]).then(u=>Array.from(new Set(u.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(t,r,s){return r.map(({layerView:n,graphics:a})=>{const o={clientGraphics:a,event:_(s)?s.event:void 0,signal:_(s)?s.signal:void 0,defaultPopupTemplateEnabled:!!_(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(t,o);return{layerView:n,promise:l}})}_isValidPopupGraphic(t,r){return t&&!!t.getEffectivePopupTemplate(_(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(t,r){const{clientGraphics:s,queryArea:n,location:a}=await this._popupHitTestGraphics(t,r),o=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,o);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:a}}async _popupHitTestGraphics(t,r){const s=await this.popupHitTest(t),n=s.results,a=s.mapPoint,o=n.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(c=>c.graphic),queryArea:a,location:a||l}}_getFetchPopupLayerViews(){const t=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&t.push(r)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()}_isValidPopupLayerView(t){return _(t)&&(!("layer"in t)||!t.suspended)&&"fetchPopupFeatures"in t}_graphicsPerFetchPopupLayerView(t,r){const s=[],n=new Map,a=r.map(o=>{const l=[];return"layer"in o?n.set(o.layer,l):n.set(o.graphics,l),{layerView:o,graphics:l}});for(const o of t){const l=n.get(o.layer)||n.get(o.sourceLayer)||null;l?l.push(o):s.push(o)}return{layerViewsAndGraphics:a,clientOnlyGraphics:s}}};return e=d([k("esri.views.PopupView")],e),e};let td=class extends ge{constructor(e){super(e),this.view=null,this.baseLayerViews=new Oi,this.referenceLayerViews=new Oi,this._loadingHandle=z(()=>{var t,r;return(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap},t=>{t&&t.load().catch(()=>{})},Je)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,r;if(this.view&&this.view.suspended)return!1;const e=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};d([p({constructOnly:!0})],td.prototype,"view",void 0),d([p({readOnly:!0})],td.prototype,"baseLayerViews",void 0),d([p({readOnly:!0})],td.prototype,"referenceLayerViews",void 0),d([p({readOnly:!0})],td.prototype,"suspended",null),d([p({type:Boolean,readOnly:!0})],td.prototype,"updating",null),td=d([k("esri.views.BasemapView")],td);function uj(i){return"tryRecycleWith"in i}let pj=class{constructor(e,t,r){this.layer=e,this.view=t,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=D$(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Pd(this._controller.signal,()=>{const s=new ue("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!uj(this.layerView))return null;const t=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==t)continue;const a=this.layerView.tryRecycleWith(n,{signal:r});if(a){e.splice(s,1),this.layer=n;const o=this.layerView,l=o.view;return this.promise=Promise.race([a.then(()=>(Ti(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:o}),l.emit("layerview-destroy",{view:l,layerView:o}),n.emit("layerview-create",{view:l,layerView:o}),l.emit("layerview-create",{view:l,layerView:o}),o)),new Promise((c,h)=>Pd(this._controller.signal,()=>h($s())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:r}=this;t.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n,a;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:r}=this;this._map=r.map;try{let o,l;if(await t.load({signal:e}),"prefetchResources"in t&&await((s=t.prefetchResources)==null?void 0:s.call(t,{signal:e})),fj(t))o=await t.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new ue("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(t);Ti(e),o="default"in u?new u.default({layer:t,view:r}):new u({layer:t,view:r})}const c=()=>{l=Us(l),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};l=Pd(e,c),Ti(e);try{await o.when()}catch(u){throw c(),u}if(!((a=(n=this._map)==null?void 0:n.allLayers)==null?void 0:a.includes(t)))return c(),void this._deferred.reject(new ue("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=o,t.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:t,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){t.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:t,error:o}),this.done=!0,this._deferred.reject(new ue("layerview:create-error","layerview creation failed",{layer:t,error:o}))}}},Xa=class extends ge{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new og,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const t=(r=this.view.map)==null?void 0:r.allLayers;if(t)for(const s of t)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>(T(this._workPromise)&&(this._workPromise=D$(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(b$(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,h;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),T(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,a=u=>{if(!T(u)){for(const m of u)if(m){r.add(m);const f=this._layerLayerViewInfoMap.get(m);f&&n?f.start():f||this._recyclingInfoMap.has(m)||s.push(m),"layers"in m&&m.layers&&a(m.layers)}}};for(const u of this._rootCollectionNames)a(this.get(u));for(const[u,m]of this._layerLayerViewInfoMap)if(!r.has(u)){this._layerLayerViewInfoMap.delete(m.layer);const f=m.tryRecycle(s);f?(this._recyclingInfoMap.set(m.layer,m),f.then(()=>{this._recyclingInfoMap.delete(m.layer),this._layerLayerViewInfoMap.set(m.layer,m),this._reschedule()}).catch(()=>{this._recyclingInfoMap.delete(m.layer),m.destroy(),this._reschedule()})):m.destroy()}for(const[u,m]of this._recyclingInfoMap)r.has(u)||(this._recyclingInfoMap.delete(m.layer),m.destroy());for(const u of s)this._createLayerView(u);this._refreshCollections();const o=[(l=t==null?void 0:t.ground)==null?void 0:l.layers,(c=t==null?void 0:t.basemap)==null?void 0:c.baseLayers,(h=t==null?void 0:t.basemap)==null?void 0:h.referenceLayers,t==null?void 0:t.layers].filter(u=>!!u);r.forEach(u=>"layers"in u&&o.push(u.layers)),this.addHandles(o.map(u=>this._watchUpdatingTracking.addOnCollectionChange(()=>u,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Nr(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),z(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),er)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,_(this._workPromise)&&(this._workPromise.reject($s()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||fs(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new ue("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let s=0;for(const n of e){const a=this._layerLayerViewInfoMap.get(n);if(!a||!a.layerView)continue;const o=a.layerView;o.layer=n,o.parent=r,t.getItemAt(s)!==o&&t.splice(s,0,o),n.layers&&this._populateLayerViewsOwners(n.layers,o.layerViews,o),s+=1}s<t.length&&t.splice(s,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new pj(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),r=>{r&&(za(r)||r.name==="cancelled:layerview-create")||pe.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([p()],Xa.prototype,"_workPromise",void 0),d([p({readOnly:!0})],Xa.prototype,"_watchUpdatingTracking",void 0),d([p({readOnly:!0})],Xa.prototype,"_layersToLayerViews",null),d([p({readOnly:!0})],Xa.prototype,"_rootCollectionNames",null),d([p()],Xa.prototype,"layerViewImporter",void 0),d([p()],Xa.prototype,"supportsGround",void 0),d([p({readOnly:!0})],Xa.prototype,"updating",null),d([p({readOnly:!0})],Xa.prototype,"updatingRemaining",null),d([p({constructOnly:!0})],Xa.prototype,"view",void 0),Xa=d([k("esri.views.LayerViewManager")],Xa);const mj=Xa;function fj(i){return"createLayerView"in i&&i.createLayerView!=null}let xa=class extends ge{constructor(e){super(e),this.factor=1.5,this.offset=_o(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([p({type:Number})],xa.prototype,"factor",void 0),d([p({nonNullable:!0})],xa.prototype,"offset",void 0),d([p()],xa.prototype,"position",void 0),d([p({type:Number,range:{min:0}})],xa.prototype,"size",void 0),d([p()],xa.prototype,"maskUrl",void 0),d([p()],xa.prototype,"maskEnabled",void 0),d([p()],xa.prototype,"overlayUrl",void 0),d([p()],xa.prototype,"overlayEnabled",void 0),d([p({readOnly:!0})],xa.prototype,"version",null),d([p({type:Boolean})],xa.prototype,"visible",void 0),xa=d([k("esri.views.Magnifier")],xa);const p4=xa;let uf=class extends ge{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(t==null?void 0:t.registerTask(rr.TEXTURE_UNLOAD))??tb}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,r){const s=this.makeUid(e);let n=this._textureRequests.get(s);if(!n){const a=t();n={referenceCount:0,texture:a,textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(a),this._stage.loadImmediate(a)),this._textureRequests.set(s,n)}return n.referenceCount++,{uid:s,texture:n.texture,release:()=>this._release(s)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};d([p()],uf.prototype,"_frameTask",void 0),d([p()],uf.prototype,"updating",null),uf=d([k("esri.views.3d.support.TextureCollection")],uf);var UO;(function(i){i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right"})(UO||(UO={}));const m4=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],f4={};function g4(i){return!!f4[i]}function gj(i){for(const e of i)if(!g4(e))return!1;return!0}m4.forEach(i=>{f4[i]=!0});let _j=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:t,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[t],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,t)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(t)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,t,r,s){const n=Array.isArray(e)?e:e.split(",");if(!gj(n))return n.some(g4)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,o;Array.isArray(t)?o=t:(a=t,o=[]),typeof r=="function"?a=r:s=r,s=s??Id.DEFAULT;const l=this._createUniqueGroupName(),c=new yj(this.view,n,o,a);this._handlers.set(l,{handler:c,priority:s});for(const h of n){const u=this._handlerCounts.get(h)||0;this._handlerCounts.set(h,u+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,t){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of t){const s=this._handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},yj=class extends ls{constructor(e,t,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of t)switch(n){case"click":this.registerIncoming("click",r,a=>s(this._wrapClick(a)));break;case"double-click":this.registerIncoming("double-click",r,a=>s(this._wrapDoubleClick(a)));break;case"immediate-click":this.registerIncoming("immediate-click",r,a=>s(this._wrapImmediateClick(a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,a=>s(this._wrapImmediateDoubleClick(a)));break;case"hold":this.registerIncoming("hold",r,a=>s(this._wrapHold(a)));break;case"drag":this.registerIncoming("drag",r,a=>{const o=this._wrapDrag(a);o&&s(o)});break;case"key-down":this.registerIncoming("key-down",r,a=>s(this._wrapKeyDown(a)));break;case"key-up":this.registerIncoming("key-up",r,a=>s(this._wrapKeyUp(a)));break;case"pointer-down":this.registerIncoming("pointer-down",r,a=>s(this._wrapPointer(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,a=>s(this._wrapPointer(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,a=>s(this._wrapPointer(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,a=>s(this._wrapPointerDrag(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,a=>s(this._wrapMouseWheel(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,a=>s(this._wrapPointer(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,a=>s(this._wrapPointer(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,a=>{s(this._wrapGamepad(a))});break;case"focus":this.registerIncoming("focus",r,a=>{s(this._wrapFocus(a))});break;case"blur":this.registerIncoming("blur",r,a=>{s(this._wrapBlur(a))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:t,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"click",pointerType:t,button:r,buttons:s,x:n,y:a,native:o,timestamp:h,screenPoint:_o(n,a),mapPoint:this._getMapPoint(n,a),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:t,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,{cancelable:c,timestamp:h}=e;return{type:"double-click",pointerType:t,button:r,buttons:s,x:n,y:a,native:o,timestamp:h,mapPoint:this._getMapPoint(n,a),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:t,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,c=o.pointerId,{cancelable:h,timestamp:u}=e;return{type:"immediate-click",pointerId:c,pointerType:t,button:r,buttons:s,x:n,y:a,native:o,timestamp:u,mapPoint:this._getMapPoint(n,a),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:t,button:r,buttons:s,x:n,y:a,native:o,eventId:l}=e.data,c=o.pointerId,{cancelable:h,timestamp:u}=e;return{type:"immediate-double-click",pointerId:c,pointerType:t,button:r,buttons:s,x:n,y:a,native:o,timestamp:u,mapPoint:this._getMapPoint(n,a),eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:t,button:r,buttons:s,x:n,y:a,native:o}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:t,button:r,buttons:s,x:n,y:a,native:o,timestamp:c,mapPoint:this._getMapPoint(n,a),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,t){return this.view.toMap(_o(e,t),{exclude:[]})}_wrapDrag(e){const t=e.data,{x:r,y:s}=t.center,{action:n,pointerType:a,button:o}=t;if(n==="start"&&(this._latestDragStart=t),!this._latestDragStart)return;const l=t.pointer.native,c=t.buttons,{cancelable:h,timestamp:u}=e,m={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:m,pointerType:a,button:o,buttons:c,radius:t.radius,angle:ca(t.angle),native:l,timestamp:u,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:t,repeat:r,native:s}=e.data,{cancelable:n,timestamp:a}=e;return{type:"key-down",key:t,repeat:r,native:s,timestamp:a,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:t,native:r}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-up",key:t,native:r,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,t){const{x:r,y:s,button:n,buttons:a,native:o,eventId:l}=e.data,c=o.pointerId,h=o.pointerType,{cancelable:u,timestamp:m}=e;return{type:t,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:a,native:o,timestamp:m,eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:t,y:r,buttons:s,native:n,eventId:a}=e.data.currentEvent,{button:o}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,h=e.data.action,u={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:m,timestamp:f}=e;return{type:"pointer-drag",x:t,y:r,pointerId:l,pointerType:c,button:o,buttons:s,action:h,origin:u,native:n,timestamp:f,eventId:a,cancelable:m,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:t,data:r,timestamp:s}=e,{x:n,y:a,deltaY:o,native:l}=r;return{type:"mouse-wheel",x:n,y:a,deltaY:o,native:l,timestamp:s,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:t,state:r,device:s}=e.data,{cancelable:n,timestamp:a}=e,{buttons:o,axes:l}=r;return{type:"gamepad",device:s,timestamp:a,action:t,buttons:o,axes:l,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var Oy,VO,BO;(function(i){i[i.USER=0]="USER",i[i.MANAGER=1]="MANAGER"})(Oy||(Oy={})),function(i){i[i.None=0]="None",i[i.Unfocused=1]="Unfocused",i[i.Focused=2]="Focused",i[i.Unselected=4]="Unselected",i[i.Selected=8]="Selected",i[i.All=15]="All"}(VO||(VO={})),function(i){i[i.None=0]="None",i[i.Custom1=16]="Custom1",i[i.Custom2=32]="Custom2",i[i.Custom3=64]="Custom3",i[i.Custom4=128]="Custom4",i[i.Custom5=256]="Custom5",i[i.Custom6=512]="Custom6",i[i.Custom7=1024]="Custom7",i[i.Custom8=2048]="Custom8",i[i.Custom9=4096]="Custom9",i[i.Custom10=8192]="Custom10",i[i.Custom11=16384]="Custom11",i[i.Custom12=32768]="Custom12",i[i.All=65520]="All"}(BO||(BO={}));function vj(i){return[i.on("before-add",e=>{const t=e.item;if(t==null||i.includes(t))return pe.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();t.onAdd()}),i.on("after-remove",e=>{const t=e.item;t.active&&(t.view.activeTool=null),t.destroy()})]}function AE(i){return i.visible&&i.getEditableFlag!=null&&i.getEditableFlag(Oy.USER)&&i.getEditableFlag(Oy.MANAGER)}function Il(i){return _o(i.x,i.y)}function L0e(i){return Fi(i.x,i.y)}function _4(i,e){var r;const t=(r=i instanceof HTMLElement?i:i.surface)==null?void 0:r.getBoundingClientRect();return t?_o(e.clientX-t.left,e.clientY-t.top):_o(0,0)}function zO(i,e){return e instanceof Event?_4(i,e):Il(e)}function kO(i){if(i instanceof Event)return!0;if(typeof i=="object"&&"type"in i)switch(i.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let bj=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":GO(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!HO(e))break;const s=Il(e),n=this._intersect(s,e.pointerType,t.forEachTool);if(T(n))break;const a=n.manipulator,o=n.tool;!(_(a)&&_(o)&&a.interactive)||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,e,t),_(a)&&_(o)&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:a,tool:o,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&T(t.activeTool)&&(this._revertToNullActiveTool=!0,t.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!HO(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=sa(s,({manipulator:h})=>h),a=sa(s,({tool:h})=>h);if(T(n)||T(a))break;const o=Il(e);o.x=ie(o.x,0,t.view.width),o.y=ie(o.y,0,t.view.height);const l=Et(s).start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:o}):n.events.emit("drag",{action:"start",start:l,screenPoint:o,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:a,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:o}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}r();break}case"immediate-click":{const s=Il(e),n=this._intersect(s,e.pointerType,t.forEachTool);if(wj(e)||t.forEachTool(c=>{if((!_(n)||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let h=!1;c.manipulators.forEach(({manipulator:u})=>{u.selected&&(u.selected=!1,h=!0)}),h&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),T(n))break;const{manipulator:a,tool:o}=n;if(!a.interactive)break;a.selectable&&o.automaticManipulatorSelection&&(a.selected=!a.selected,o.onManipulatorSelectionChanged&&o.onManipulatorSelectionChanged());const l=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r});break}case"click":{const s=Il(e),n=this._intersect(s,e.pointerType,t.forEachTool),a=_(n)?n.manipulator:null;if(T(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o}),r();break}case"double-click":{const s=Il(e),n=this._intersect(s,e.pointerType,t.forEachTool),a=_(n)?n.manipulator:null;if(T(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r});break}case"immediate-double-click":{const s=Il(e),n=this._intersect(s,e.pointerType,t.forEachTool),a=_(n)?n.manipulator:null;if(T(a)||!a.interactive)break;const o=e.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:r});break}}this._onFocusChange(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Il(t)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,t){const r=sa(this._grabbedManipulators.get(e.pointerId),({manipulator:s})=>s);T(r)||r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Il(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(t.setActiveTool))}_cursorFromMap(e){let t=null;return fs(e,({manipulator:r})=>!(T(r)||!r.interactive)&&(r.grabbing&&r.grabCursor?(t=r.grabCursor,!0):!!r.cursor&&(t=r.cursor,!0))),t}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{t.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=t.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),a=b8(n,({tool:o})=>o===s);s.firstGrabbedManipulator=_(a)?a.manipulator:null})}clearPointers(e,{forEachTool:t,setActiveTool:r},s=!0,n){const a=(o,l)=>o===e&&(T(n)||n===l);this._grabbedManipulators.forEach(({tool:o,manipulator:l,pointerType:c},h)=>{a(o,l)&&(this._grabbedManipulators.delete(h),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:o,manipulator:l},c)=>{a(o,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:o,manipulator:l},c)=>{a(o,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(t)}_intersect(e,t,r){let s=null;return r(n=>{if(n.manipulators==null||!AE(n))return!1;const a=n.manipulators.intersect(e,t);return!T(a)&&(s={tool:n,manipulator:a},!0)}),s}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((t,r)=>{this._updateHoveredStateForPointerAtScreenPosition(_o(t.x,t.y),r,t.pointerType,e)})}handleHoverEvent(e,t){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!GO(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Il(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,r,s){let n=this._intersect(e,r,s);const a=sa(this._hoveredManipulators.get(t),({manipulator:o})=>o);_(n)&&!n.manipulator.interactive&&(n=null),_(n)&&a===n.manipulator||(_(a)&&(a.hovering=!1),_(n)?(n.manipulator.hovering=!0,this._hoveredManipulators.set(t,n)):this._hoveredManipulators.delete(t),this._onFocusChange(s))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function GO(i){return i==="mouse"}function HO(i){return i.pointerType!=="mouse"||i.button===0}function wj(i){return!!i.native.shiftKey}const qO="attached",zx="tools";let kc=class extends T2{constructor(e){super(e),this._manipulatorState=new bj,this.tools=new Oi,this.cursor=null,this._forEachTool=t=>{for(const r of this.tools.items)if(t(r))return}}initialize(){this.handles.add([this.view.on(m4,e=>{this._handleInputEvent(e)},Id.TOOL),...vj(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(_(e)&&!this.view.ready)return void pe.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=AE(r);!T(this.activeTool)&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(t=>t.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}attach(){var e;this.view.type==="3d"?(this._set("textures",new uf(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([z(()=>{const{state:t}=this.view;return"camera"in t&&t.camera},()=>this._forEachManipulator(t=>t.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",t=>this._forEachManipulator(r=>r.onElevationChange(t))),hy(()=>this._set("textures",we(this.textures)))],qO)):this.handles.add(z(()=>this.view.extent,()=>this._forEachManipulator(t=>t.onViewChange())))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(qO)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:r})=>e(r,t))})}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!t&&s.visible&&s.handleInputEvent(r)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(zx),this._forEachTool(e=>{if(e instanceof ge){const t=z(()=>[e.cursor,e.visible,e.editable],()=>{AE(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(t,zx)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],zx)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var t;(t=e.setEditableFlag)==null||t.call(e,Oy.MANAGER,T(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;T(e)&&this._forEachTool(t=>!(!_(t.cursor)||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(T(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};d([p({constructOnly:!0,nonNullable:!0})],kc.prototype,"view",void 0),d([p({readOnly:!0,nonNullable:!0})],kc.prototype,"textures",void 0),d([p({value:null})],kc.prototype,"activeTool",null),d([p({readOnly:!0,type:Oi})],kc.prototype,"tools",void 0),d([p({readOnly:!0})],kc.prototype,"cursor",void 0),d([p({readOnly:!0})],kc.prototype,"updating",null),kc=d([k("esri.views.ToolViewManager")],kc);const xj=kc;let qm=class extends ge{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Tj.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Cj[this.deviceType]}};d([p({nonNullable:!0,readOnly:!0})],qm.prototype,"nativeIndex",void 0),d([p({type:String,readOnly:!0})],qm.prototype,"deviceType",null),d([p({type:Number,readOnly:!0})],qm.prototype,"axisThreshold",null),qm=d([k("esri.views.input.gamepad.GamepadInputDevice")],qm);const Tj=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Cj={standard:.15,spacemouse:.025,unknown:0},_R=qm;let d_=class extends ge{constructor(...e){super(...e),this.devices=new Oi,this.enabledFocusMode="document"}};d([p({type:Oi.ofType(_R),readOnly:!0})],d_.prototype,"devices",void 0),d([p({type:["document","view","none"]})],d_.prototype,"enabledFocusMode",void 0),d_=d([k("esri.views.input.gamepad.GamepadSettings")],d_);const Ej=d_;let g1=class extends ge{constructor(){super(...arguments),this.gamepad=new Ej}};d([p({readOnly:!0})],g1.prototype,"gamepad",void 0),g1=d([k("esri.views.input.Input")],g1);const Sj=g1;let id=class extends ge{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([p({type:Boolean,nonNullable:!0})],id.prototype,"enabled",void 0),d([p({type:_R})],id.prototype,"device",void 0),d([p({type:["pan","zoom"],nonNullable:!0})],id.prototype,"mode",void 0),d([p({type:["forward-down","forward-up"],nonNullable:!0})],id.prototype,"tiltDirection",void 0),d([p({type:Number,nonNullable:!0})],id.prototype,"velocityFactor",void 0),id=d([k("esri.views.navigation.gamepad.GamepadSettings")],id);const y4=id;let Pu=class extends ge{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new y4,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};d([p({type:Boolean})],Pu.prototype,"browserTouchPanEnabled",void 0),d([p({type:y4,nonNullable:!0})],Pu.prototype,"gamepad",void 0),d([p({type:Boolean})],Pu.prototype,"momentumEnabled",void 0),d([p({type:Boolean})],Pu.prototype,"mouseWheelZoomEnabled",void 0),Pu=d([k("esri.views.navigation.Navigation")],Pu);const v4=Pu;function k0e(i,e,t){const r=b4(i),s=e,n=Rj(r,s,t);if(r){const a=s0.deriveUnitFromSR(r,i.spatialReference).heightUnit;if(!t&&a!==r.heightUnit){const o=new ue("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a});return new ue("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:o})}}if(!Aj(i)||n===Qn.Unsupported)return new ue("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Qn.Units:{const a=(r==null?void 0:r.heightUnit)||"unknown",o=(s==null?void 0:s.heightUnit)||"unknown",l=new ue("layerview:incompatible-height-unit",`The vertical units of the layer (${a}) must match the vertical units of the scene (${o})`,{layerUnit:a,sceneUnit:o});return new ue("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Qn.HeightModel:{const a=(r==null?void 0:r.heightModel)||"unknown",o=(s==null?void 0:s.heightModel)||"unknown",l=new ue("layerview:incompatible-height-model",`The height model of the layer (${a}) must match the height model of the scene (${o})`,{layerHeightModel:a,sceneHeightModel:o});return new ue("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Qn.CRS:{const a=(r==null?void 0:r.vertCRS)||"unknown",o=(s==null?void 0:s.vertCRS)||"unknown",l=new ue("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${a}) must match the vertical datum of the scene (${o})`,{layerDatum:a,sceneDatum:o});return new ue("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function Rj(i,e,t){if(!WO(i)||!WO(e))return Qn.Unsupported;if(i==null||e==null)return Qn.Ok;if(!t&&i.heightUnit!==e.heightUnit)return Qn.Units;if(i.heightModel!==e.heightModel)return Qn.HeightModel;switch(i.heightModel){case"gravity-related-height":return Qn.Ok;case"ellipsoidal":return i.vertCRS===e.vertCRS?Qn.Ok:Qn.CRS;default:return Qn.Unsupported}}var Qn;function WO(i){return i==null||i.heightModel!=null&&i.heightUnit!=null}function Aj(i){return"heightModelInfo"in i&&i.heightModelInfo!=null||i.spatialReference!=null||!T4(i)}function b4(i){var r;const e=i.url?ez(i.url):void 0;return!(((r=i.spatialReference)==null?void 0:r.vcsWkid)==null&&_(e)&&e.serverType==="ImageServer")&&w4(i)&&i.heightModelInfo?i.heightModelInfo:T4(i)?s0.deriveUnitFromSR(Oj,i.spatialReference):null}function w4(i){return"heightModelInfo"in i}function x4(i){if(i.type==="unknown"||!("capabilities"in i))return!1;switch(i.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function T4(i){return x4(i)?!!(i.capabilities&&i.capabilities.data&&i.capabilities.data.supportsZ):C4(i)}function Pj(i){return i.layers!=null||C4(i)||x4(i)||w4(i)}function C4(i){switch(i.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(i){i[i.Ok=0]="Ok",i[i.Units=1]="Units",i[i.HeightModel=2]="HeightModel",i[i.CRS=3]="CRS",i[i.Unsupported=4]="Unsupported"})(Qn||(Qn={}));const Oj=new s0({heightModel:"gravity-related-height"});let PE,kx=null;async function Mj(i){kx||(kx=Y(()=>Promise.resolve().then(()=>xae),void 0,import.meta.url).then(e=>PE=e)),await kx,Ti(i)}async function E4(i,e,t,r){if(!i)return null;const s=i.spatialReference;return dB()||u2(s,e)?rw(i,e):PE?PE.projectGeometry(i,e,t,r):(await Promise.race([Mj(r),uB(r)]),E4(i,e,t,r))}let Ei=class extends ge{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=sl(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:Et(this._spatialReferenceTask.spatialReference)}get extent(){return Et(this._extentTask.extent)}get heightModelInfo(){return Et(this._heightModelInfoTask.heightModelInfo)}get vcsWkid(){return Et(this._heightModelInfoTask.vcsWkid)}get latestVcsWkid(){return Et(this._heightModelInfoTask.latestVcsWkid)}get viewingMode(){return T(this.userSpatialReference)||this.userSpatialReference.equals(Et(this._spatialReferenceTask.spatialReference))?Et(this._spatialReferenceTask.viewingMode):null}get tileInfo(){return Et(this._tileInfoTask.tileInfo)}get mapCollections(){var r,s,n,a;const e=(r=this.map)==null?void 0:r.call(this),t=[];return _(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let r=null;for(const n of e){const a=this._getSupportedSpatialReferences(n);if(a.length>0){const o=this._narrowDownSpatialReferenceCandidates(r,a);_(o)&&(r=o)}if(_(r)&&r.length===1)break}if(t&&(T(r)||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:_(s)?s.spatialReference:null,viewingMode:_(s)?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,s,n,a,o,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(o=(a=(n=this.map)==null?void 0:n.call(this))==null?void 0:a.basemap)==null?void 0:o.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var r,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const a of e)if(Pj(a)){const o=b4(a);if(o)return{heightModelInfo:o,vcsWkid:(s=a.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=a.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(_(s.fullExtent)?[s.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:n[0],o=n.find(l=>l.spatialReference.equals(this.spatialReference))??a;if(o)return{candidates:[{extent:o,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(T(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=sl(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:o0(async n=>{try{const a=await E4(r.extent,s,r.layer.portalItem,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:a}}catch{if(Xo(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(T(e))return t;const r=[],s=(n,a)=>_(n)?_(a)?n===a&&n:n:a;for(const n of e)for(const a of t){if(!n.spatialReference.equals(a.spatialReference))continue;const o=s(n.viewingMode,a.viewingMode);if(o!==!1){r.push({spatialReference:n.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return T(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(t))&&(e=e.filter(({spatialReference:r})=>r.equals(t))),e.length>1&&e.some(({viewingMode:r})=>r!==Se.Local)&&(e=e.filter(({viewingMode:r})=>r!==Se.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const r=[];for(const s of t){const n=this.getSpatialReferenceSupport({spatialReference:s,layer:e});if(_(n)){const a=_(n.constraints)?n.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:o,viewingMode:l}of a)(!this.requiresExtentInSpatialReference||T(this.userSpatialReference)||o.equals(this.userSpatialReference))&&r.push({spatialReference:o,viewingMode:l})}}return r}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:r})=>t.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const s of e)if(this._collectCollection(s,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};d([p()],Ei.prototype,"required",void 0),d([p({constructOnly:!0})],Ei.prototype,"map",void 0),d([p({constructOnly:!0})],Ei.prototype,"getSpatialReferenceSupport",void 0),d([p()],Ei.prototype,"defaultSpatialReference",void 0),d([p()],Ei.prototype,"userSpatialReference",void 0),d([p()],Ei.prototype,"sourcePreloadCount",void 0),d([p()],Ei.prototype,"priorityCollection",void 0),d([p()],Ei.prototype,"requiresExtentInSpatialReference",void 0),d([p()],Ei.prototype,"suspended",void 0),d([p({readOnly:!0})],Ei.prototype,"ready",null),d([p({readOnly:!0})],Ei.prototype,"heightModelInfoReady",null),d([p({readOnly:!0})],Ei.prototype,"spatialReference",null),d([p({readOnly:!0})],Ei.prototype,"extent",null),d([p({readOnly:!0})],Ei.prototype,"heightModelInfo",null),d([p({readOnly:!0})],Ei.prototype,"vcsWkid",null),d([p({readOnly:!0})],Ei.prototype,"latestVcsWkid",null),d([p({readOnly:!0})],Ei.prototype,"viewingMode",null),d([p({readOnly:!0})],Ei.prototype,"tileInfo",null),d([p({readOnly:!0})],Ei.prototype,"mapCollections",null),d([p({readOnly:!0})],Ei.prototype,"_allLayers",null),d([p({readOnly:!0})],Ei.prototype,"_spatialReferenceTask",null),d([p({readOnly:!0})],Ei.prototype,"_tileInfoTask",null),d([p({readOnly:!0})],Ei.prototype,"_heightModelInfoTask",null),d([p({readOnly:!0})],Ei.prototype,"_extentCandidatesTask",null),d([p()],Ei.prototype,"_extentTask",null),d([p()],Ei.prototype,"_projectExtentTask",void 0),Ei=d([k("esri.views.support.DefaultsFromMap")],Ei);var _1;let je=_1=class extends cw(Br.EventedMixin(K7(ge))){constructor(i){super(i),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new ib({getCollections:()=>{var e,t,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(t=this.groundView)==null?void 0:t.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new F$,this.analyses=new Qf,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Oi,this.magnifier=new p4,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new _F,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Sj,this.navigation=new v4,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new _j(this),this.persistableViewModels=new Oi,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(z(()=>this.preconditionsReady,e=>{var t,r;e?(this._currentSpatialReference=this.spatialReference,_1.views.add(this)):(this._currentSpatialReference=null,_1.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((t=this.toolViewManager)==null||t.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),(r=this.layerViewManager)==null||r.clear(),this._teardown()):e&&!this.ready&&(this._startup(),_(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},ii))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,py(()=>this.ready)))),this.basemapView=new td({view:this}),this.layerViewManager=new mj({view:this,layerViewImporter:{importLayerView:i=>this.importLayerView(i),hasLayerViewModule:i=>this.hasLayerViewModule(i)},supportsGround:this.supportsGround}),this.toolViewManager=new xj({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([z(()=>this.initialExtentRequired,i=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:i},{sync:!0,initial:!0}),z(()=>this.ready,i=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=i,this.defaultsFromMap.userSpatialReference=i?this.spatialReference:this._userSpatialReference)},{sync:!0}),z(()=>this._userSpatialReference,i=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=i)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let i=null;this.handles.add([z(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const t=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&t){if(_(i))return;const s=hy(()=>i=sl(i));i=o0(async n=>{try{await kf(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{i=null}pe.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=we(this.graphics),this.analyses=we(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),we(this.analysisViewManager),this.toolViewManager=we(this.toolViewManager),this.layerViewManager=we(this.layerViewManager),this.basemapView=we(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const i=this.map;this.map=null,i==null||i.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return pe.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var i;return(i=this.toolViewManager)==null?void 0:i.activeTool}set activeTool(i){this.toolViewManager&&(this.toolViewManager.activeTool=i)}get animation(){return this._get("animation")}set animation(i){this._set("animation",i)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ei({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:i=>this.getSpatialReferenceSupport(i),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(i){this._set("extent",i)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var i;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||cE.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((i=this.defaultsFromMap)!=null&&i.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(i){i!==this._get("map")&&(i!=null&&i.destroyed&&(pe.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:i}),i=null),cE.isLoadable(i)&&i.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",i))}get spatialReference(){var e,t;let i=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return i&&((t=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&t.heightModelInfo)&&(i=i.clone(),i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),i}set spatialReference(i){const e=!o2(i,this._get("spatialReference"));this._set("_userSpatialReference",i),e&&(this._set("spatialReference",i),this._spatialReferenceChanged(i))}_spatialReferenceChanged(i){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var i;return(i=this.toolViewManager)==null?void 0:i.tools}get initialExtent(){var i;return(i=this.defaultsFromMap)==null?void 0:i.extent}get cursor(){const i=this.toolViewManager?this.toolViewManager.cursor:null;return _(i)?i:this._cursor||"default"}set cursor(i){this._cursor=i,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(i){return this.layerViewManager.whenLayerView(i)}getDefaultSpatialReference(){var i;return(i=this.defaultsFromMap)==null?void 0:i.spatialReference}getDefaultHeightModelInfo(){var i;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((i=this.defaultsFromMap)==null?void 0:i.heightModelInfo)??null}importLayerView(i){throw new ue("importLayerView() not implemented")}hasLayerViewModule(i){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(i){return _(this.getSpatialReferenceSupport({spatialReference:i}))}when(i,e){return this.isResolved()&&!this.ready&&pe.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(i,e)}forceReadyCycle(){this.ready&&(ha(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(i){this.toolViewManager.tools.add(i),this.activeTool=i}tryFatalErrorRecovery(){this.fatalError=null}};je.views=new Oi,d([p()],je.prototype,"_userSpatialReference",void 0),d([p()],je.prototype,"activeTool",null),d([p({readOnly:!0})],je.prototype,"allLayerViews",void 0),d([p()],je.prototype,"groundView",void 0),d([p()],je.prototype,"animation",null),d([p()],je.prototype,"basemapView",void 0),d([p()],je.prototype,"center",null),d([p({readOnly:!0})],je.prototype,"_defaultsFromMapSettings",null),d([p()],je.prototype,"defaultsFromMap",null),d([p()],je.prototype,"fatalError",void 0),d([p({type:ms})],je.prototype,"extent",null),d([p(JC(F$,"graphics"))],je.prototype,"graphics",void 0),d([p(JC(Qf,"analyses"))],je.prototype,"analyses",void 0),d([p({readOnly:!0,type:s0})],je.prototype,"heightModelInfo",null),d([p({readOnly:!0})],je.prototype,"interacting",null),d([p({readOnly:!0})],je.prototype,"navigating",null),d([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],je.prototype,"preconditionsReady",null),d([p({readOnly:!0})],je.prototype,"typeSpecificPreconditionsReady",void 0),d([p({type:Oi,readOnly:!0})],je.prototype,"layerViews",void 0),d([p()],je.prototype,"resolution",null),d([p({type:p4})],je.prototype,"magnifier",void 0),d([p({value:null,type:sH})],je.prototype,"map",null),d([p()],je.prototype,"padding",void 0),d([p({readOnly:!0})],je.prototype,"ready",void 0),d([p({type:ci})],je.prototype,"spatialReference",null),d([p()],je.prototype,"spatialReferenceWarningDelay",void 0),d([p()],je.prototype,"stationary",null),d([p({readOnly:!0})],je.prototype,"supportsGround",void 0),d([p({type:Z7})],je.prototype,"timeExtent",void 0),d([p({type:_F,nonNullable:!0})],je.prototype,"timeReference",void 0),d([p()],je.prototype,"tools",null),d([p()],je.prototype,"toolViewManager",void 0),d([p({readOnly:!0})],je.prototype,"type",void 0),d([p({type:Number})],je.prototype,"scale",void 0),d([p({readOnly:!0})],je.prototype,"updating",void 0),d([p({readOnly:!0})],je.prototype,"initialExtentRequired",void 0),d([p({readOnly:!0})],je.prototype,"initialExtent",null),d([p()],je.prototype,"cursor",null),d([p({readOnly:!0})],je.prototype,"input",void 0),d([p({type:v4,nonNullable:!0})],je.prototype,"navigation",void 0),d([p()],je.prototype,"layerViewManager",void 0),d([p()],je.prototype,"analysisViewManager",void 0),d([p()],je.prototype,"width",void 0),d([p()],je.prototype,"height",void 0),d([p({readOnly:!0})],je.prototype,"resizing",void 0),d([p({value:null,readOnly:!0})],je.prototype,"size",null),d([p({readOnly:!0})],je.prototype,"suspended",void 0),d([p({readOnly:!0})],je.prototype,"viewEvents",void 0),d([p({readOnly:!0})],je.prototype,"persistableViewModels",void 0),d([p()],je.prototype,"_isValid",void 0),d([p()],je.prototype,"_readyCycleForced",void 0),d([p()],je.prototype,"_currentSpatialReference",void 0),je=_1=d([k("esri.views.View")],je);const Ij=je;let rd=class extends J7{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new ue("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,t){t||(t=r0(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};d([p({readOnly:!0})],rd.prototype,"done",null),d([p({readOnly:!0,type:String})],rd.prototype,"state",void 0),d([p()],rd.prototype,"target",void 0),rd=d([k("esri.views.ViewAnimation")],rd),function(i){i.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(rd||(rd={}));const Zf=rd,Rg=()=>Y(()=>import("./TileLayerView3D-6f8e2bea.js"),["./TileLayerView3D-6f8e2bea.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./LayerView3D-e2b7aff2.js","./reactiveUtils-53e5756b.js","./TiledLayerView3D-f92aa007.js","./LayerView-92e98881.js","./Evented-686173eb.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./RefreshableLayerView-e8f476db.js","./MapServiceLayerViewHelper-f7e8c688.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./scaleUtils-a3b834c2.js","./floorFilterUtils-080a7cd2.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./sublayerUtils-225416ed.js","./TimeExtent-64e16588.js","./popupUtils-55b97964.js","./drapedUtils-839f6fe4.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),jO=()=>Y(()=>import("./ElevationLayerView3D-e1a80cef.js"),["./ElevationLayerView3D-e1a80cef.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./LayerView3D-e2b7aff2.js","./reactiveUtils-53e5756b.js","./TiledLayerView3D-f92aa007.js","./LayerView-92e98881.js","./Evented-686173eb.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./preload-helper-41c905a7.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),XO={"base-dynamic":()=>Y(()=>import("./BaseDynamicLayerView3D-948f1f36.js"),["./BaseDynamicLayerView3D-948f1f36.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./DynamicLayerView3D-1f6f13ed.js","./asyncUtils-24bd37b2.js","./reactiveUtils-53e5756b.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./LayerView3D-e2b7aff2.js","./Attribute-f72d3f37.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./Polyline-82cb63bc.js","./deduplicate-a70aec6f.js","./Indices-f9b34f39.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./persistableUrlUtils-3635dccc.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./mat4-f0dc8788.js","./mat4f64-abdda1bb.js","./aaBoundingBox-fb003858.js","./BufferView-b402c7a7.js","./vec2-848c6cf0.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./enums-fc527c7c.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./byteSizeEstimations-f0cab514.js","./Texture-ae652f15.js","./Evented-686173eb.js","./TextureOnly.glsl-469cc321.js","./assets-94d592bf.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./projectExtentUtils-40135480.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./RefreshableLayerView-e8f476db.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),"base-elevation":jO,"base-tile":Rg,"bing-maps":Rg,"building-scene":()=>Y(()=>import("./BuildingSceneLayerView3D-86a5222b.js"),["./BuildingSceneLayerView3D-86a5222b.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./reactiveUtils-53e5756b.js","./BuildingGroupSublayer-24793e93.js","./loadAll-8ca49458.js","./asyncUtils-24bd37b2.js","./BuildingComponentSublayer-f2558dc9.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./jsonUtils-27937179.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./MemCache-b4d68123.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./Field-945b2973.js","./fieldType-24ac97df.js","./HeightModelInfo-73f516f9.js","./OperationalLayer-db187f46.js","./TimeExtent-64e16588.js","./ElevationInfo-005ddd87.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./AttachmentQuery-f1085685.js","./Query-b0193ce7.js","./RelationshipQuery-765b2184.js","./Layer-524734fa.js","./HandleOwner-6217a02e.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./assets-94d592bf.js","./intl-87d72dbe.js","./messages-1516d146.js","./editsZScale-9d0832b8.js","./queryZScale-f6e44ca7.js","./zscale-baa108ea.js","./FeatureSet-b4fbf079.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./projection-4ac247db.js","./RefreshableLayer-12bc7ba2.js","./ScaleRangeLayer-d1b04b80.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./TopFeaturesQuery-d2b31d08.js","./popupUtils-b8625101.js","./capabilities-a18453f6.js","./I3SIndexInfo-1765b03c.js","./I3SLayerDefinitions-7bfc1943.js","./I3SUtil-4be1431c.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./quatf32-51a323b8.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./I3SBinaryReader-1333d96d.js","./VertexAttribute-15d1866a.js","./orientedBoundingBox-6188c4d9.js","./vec3f32-01c06d8d.js","./plane-01584357.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./vec2f64-70cfd09e.js","./ViewingMode-5d7d590b.js","./Attribute-f72d3f37.js","./symbolColorUtils-1c63720c.js","./popupUtils-55b97964.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./I3SMeshView3D-6082276e.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./View.glsl-879c1eaf.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./I3SOverrides-754800bf.js","./dehydratedFeatures-efdbcd90.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./I3SNode-3d136092.js","./RenderTexture-b7e204b5.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Octree-813f29c9.js","./FeatureLayerView3D-c8f15273.js","./FeatureLayerViewBase3D-c2b95af2.js","./FeatureLikeLayerView3D-e43d70a7.js","./dehydratedFeatureComparison-e523fe14.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-93b8548c.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./vec2f32-eaf29605.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./LercDecoder-f1486af7.js","./EventedSet-acb3b163.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./AttachmentInfo-23249301.js","./executeQueryJSON-044ac84b.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js","./SceneModification-163046e6.js","./persistable-227af340.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-3dd2f93a.js","./SceneLayerWorker-6a8d059d.js","./I3SQueryFeatureStore-e335fdb8.js","./DefinitionExpressionSceneLayerView-3c2ce549.js"],import.meta.url),csv:()=>Y(()=>import("./CSVLayerView3D-2f473bda.js"),["./CSVLayerView3D-2f473bda.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./FeatureLayerViewBase3D-c2b95af2.js","./reactiveUtils-53e5756b.js","./FeatureLikeLayerView3D-e43d70a7.js","./asyncUtils-24bd37b2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./Promise-755e47e5.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./persistableUrlUtils-3635dccc.js","./layerUtils-eef15b39.js","./Query-b0193ce7.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./TimeExtent-64e16588.js","./enumeration-925aa0f6.js","./jsonUtils-36bf3d33.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Clonable-7fa7ad97.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./aaBoundingBox-fb003858.js","./quantizationUtils-16db4e0b.js","./ViewingMode-5d7d590b.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./compilerUtils-7bf6df9e.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./zscale-baa108ea.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./basicInterfaces-7449a8bf.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./Attribute-f72d3f37.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./EvaluateSceneLighting.glsl-14c608ff.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat4f64-abdda1bb.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),dimension:()=>Y(()=>import("./DimensionLayerView3D-bf94c332.js"),["./DimensionLayerView3D-bf94c332.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./asyncUtils-24bd37b2.js","./reactiveUtils-53e5756b.js","./LayerView3D-e2b7aff2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),elevation:jO,feature:()=>Y(()=>import("./FeatureLayerView3D-c8f15273.js"),["./FeatureLayerView3D-c8f15273.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./locale-fe7cc1d0.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./FeatureLayerViewBase3D-c2b95af2.js","./reactiveUtils-53e5756b.js","./FeatureLikeLayerView3D-e43d70a7.js","./asyncUtils-24bd37b2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./persistableUrlUtils-3635dccc.js","./Query-b0193ce7.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./TimeExtent-64e16588.js","./enumeration-925aa0f6.js","./jsonUtils-36bf3d33.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Clonable-7fa7ad97.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./aaBoundingBox-fb003858.js","./quantizationUtils-16db4e0b.js","./ViewingMode-5d7d590b.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./number-036ac4ef.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./compilerUtils-7bf6df9e.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./basicInterfaces-7449a8bf.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./Attribute-f72d3f37.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./EvaluateSceneLighting.glsl-14c608ff.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat4f64-abdda1bb.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),geojson:()=>Y(()=>import("./GeoJSONLayerView3D-ea2ab7e3.js"),["./GeoJSONLayerView3D-ea2ab7e3.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./FeatureLayerViewBase3D-c2b95af2.js","./reactiveUtils-53e5756b.js","./FeatureLikeLayerView3D-e43d70a7.js","./asyncUtils-24bd37b2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./Promise-755e47e5.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./persistableUrlUtils-3635dccc.js","./layerUtils-eef15b39.js","./Query-b0193ce7.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./TimeExtent-64e16588.js","./enumeration-925aa0f6.js","./jsonUtils-36bf3d33.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Clonable-7fa7ad97.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./aaBoundingBox-fb003858.js","./quantizationUtils-16db4e0b.js","./ViewingMode-5d7d590b.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./compilerUtils-7bf6df9e.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./zscale-baa108ea.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./basicInterfaces-7449a8bf.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./Attribute-f72d3f37.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./EvaluateSceneLighting.glsl-14c608ff.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat4f64-abdda1bb.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),graphics:()=>Y(()=>import("./GraphicsLayerView3D-1cc3fec8.js"),["./GraphicsLayerView3D-1cc3fec8.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./reactiveUtils-53e5756b.js","./LayerView3D-e2b7aff2.js","./queryForSymbologySnapping-0800c0e3.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./quantizationUtils-16db4e0b.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./lengthUtils-3c9047c4.js","./GraphicsProcessor-b6945ef7.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./HandleOwner-6217a02e.js","./diffUtils-1bae97a1.js","./Layer-524734fa.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Graphics3DObjectStates-93b8548c.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./MemCache-b4d68123.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./zscale-baa108ea.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./asyncUtils-24bd37b2.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./Scheduler-61737382.js","./basicInterfaces-7449a8bf.js","./projectExtentUtils-40135480.js","./LayerView-92e98881.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./sphere-a48b65b1.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),group:()=>Y(()=>import("./GroupLayerView-8876cfa9.js"),["./GroupLayerView-8876cfa9.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./collectionUtils-423a192d.js","./reactiveUtils-53e5756b.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js"],import.meta.url),imagery:()=>Y(()=>import("./ImageryLayerView3D-6a83e8a0.js"),["./ImageryLayerView3D-6a83e8a0.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./reactiveUtils-53e5756b.js","./DynamicLayerView3D-1f6f13ed.js","./asyncUtils-24bd37b2.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./LayerView3D-e2b7aff2.js","./Attribute-f72d3f37.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./Polyline-82cb63bc.js","./deduplicate-a70aec6f.js","./Indices-f9b34f39.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./persistableUrlUtils-3635dccc.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./mat4-f0dc8788.js","./mat4f64-abdda1bb.js","./aaBoundingBox-fb003858.js","./BufferView-b402c7a7.js","./vec2-848c6cf0.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./enums-fc527c7c.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./byteSizeEstimations-f0cab514.js","./Texture-ae652f15.js","./Evented-686173eb.js","./TextureOnly.glsl-469cc321.js","./assets-94d592bf.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./projectExtentUtils-40135480.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./RefreshableLayerView-e8f476db.js","./OperationalLayer-db187f46.js","./TimeExtent-64e16588.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./lengthUtils-3c9047c4.js","./opacityUtils-d4a4b602.js","./Query-b0193ce7.js","./enumeration-925aa0f6.js","./jsonUtils-36bf3d33.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Clonable-7fa7ad97.js","./popupUtils-55b97964.js","./Cyclical-47bda305.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./SimpleObservable-bd2c3ae8.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),"integrated-mesh":()=>Y(()=>import("./IntegratedMeshLayerView3D-2835afc1.js"),["./IntegratedMeshLayerView3D-2835afc1.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./reactiveUtils-53e5756b.js","./I3SMeshView3D-6082276e.js","./byteSizeEstimations-f0cab514.js","./mat3-4fd89d48.js","./DefaultMaterial.glsl-58ca0075.js","./mat4f64-abdda1bb.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4-f0dc8788.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./compilerUtils-7bf6df9e.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./quatf64-f8f1c132.js","./projection-4ac247db.js","./assets-94d592bf.js","./zscale-baa108ea.js","./I3SOverrides-754800bf.js","./dehydratedFeatures-efdbcd90.js","./quantizationUtils-16db4e0b.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Scheduler-61737382.js","./I3SNode-3d136092.js","./sphere-a48b65b1.js","./I3SUtil-4be1431c.js","./quat-77a0169c.js","./quatf32-51a323b8.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./I3SBinaryReader-1333d96d.js","./orientedBoundingBox-6188c4d9.js","./plane-01584357.js","./Attribute-f72d3f37.js","./asyncUtils-24bd37b2.js","./RenderTexture-b7e204b5.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Octree-813f29c9.js","./styleUtils-689841ac.js","./FeatureLayerView3D-c8f15273.js","./layerUtils-eef15b39.js","./FeatureLayerViewBase3D-c2b95af2.js","./FeatureLikeLayerView3D-e43d70a7.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./dehydratedFeatureComparison-e523fe14.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./vec2f32-eaf29605.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js","./SceneModification-163046e6.js","./persistable-227af340.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-3dd2f93a.js","./SceneLayerWorker-6a8d059d.js"],import.meta.url),"line-of-sight":()=>Y(()=>import("./LineOfSightLayerView3D-bc8f54fb.js"),["./LineOfSightLayerView3D-bc8f54fb.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./asyncUtils-24bd37b2.js","./reactiveUtils-53e5756b.js","./LayerView3D-e2b7aff2.js","./LayerView-92e98881.js","./Evented-686173eb.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),"map-image":()=>Y(()=>import("./MapImageLayerView3D-1b4f0a6a.js"),["./MapImageLayerView3D-1b4f0a6a.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./DynamicLayerView3D-1f6f13ed.js","./asyncUtils-24bd37b2.js","./reactiveUtils-53e5756b.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./LayerView3D-e2b7aff2.js","./Attribute-f72d3f37.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./Polyline-82cb63bc.js","./deduplicate-a70aec6f.js","./Indices-f9b34f39.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./persistableUrlUtils-3635dccc.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./mat4-f0dc8788.js","./mat4f64-abdda1bb.js","./aaBoundingBox-fb003858.js","./BufferView-b402c7a7.js","./vec2-848c6cf0.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./enums-fc527c7c.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./byteSizeEstimations-f0cab514.js","./Texture-ae652f15.js","./Evented-686173eb.js","./TextureOnly.glsl-469cc321.js","./assets-94d592bf.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./projectExtentUtils-40135480.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./RefreshableLayerView-e8f476db.js","./OperationalLayer-db187f46.js","./TimeExtent-64e16588.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./lengthUtils-3c9047c4.js","./opacityUtils-d4a4b602.js","./ExportImageParameters-db22156e.js","./serviceCapabilitiesUtils-22f436bd.js","./Collection-74ae958a.js","./SimpleObservable-bd2c3ae8.js","./arcgisLayerUrl-1b8d6c52.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-225416ed.js","./MapServiceLayerViewHelper-f7e8c688.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./scaleUtils-a3b834c2.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./popupUtils-55b97964.js","./drapedUtils-839f6fe4.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),media:()=>Y(()=>import("./MediaLayerView3D-0b8f01b5.js"),["./MediaLayerView3D-0b8f01b5.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./reactiveUtils-53e5756b.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./MediaElementView-05ce21e6.js","./Polyline-82cb63bc.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./request-09e7d9b2.js","./zscale-baa108ea.js","./normalizeUtilsSync-3bba9614.js","./jsonUtils-36bf3d33.js","./normalizeUtilsCommon-d8ea404e.js","./LayerView3D-e2b7aff2.js","./Attribute-f72d3f37.js","./basicInterfaces-7449a8bf.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./aaBoundingBox-fb003858.js","./BufferView-b402c7a7.js","./vec2-848c6cf0.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./asyncUtils-24bd37b2.js","./enums-fc527c7c.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./byteSizeEstimations-f0cab514.js","./Texture-ae652f15.js","./Evented-686173eb.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),"ogc-feature":()=>Y(()=>import("./OGCFeatureLayerView3D-f43d0798.js"),["./OGCFeatureLayerView3D-f43d0798.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./FeatureLayerViewBase3D-c2b95af2.js","./reactiveUtils-53e5756b.js","./FeatureLikeLayerView3D-e43d70a7.js","./asyncUtils-24bd37b2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./Promise-755e47e5.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./persistableUrlUtils-3635dccc.js","./layerUtils-eef15b39.js","./Query-b0193ce7.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./TimeExtent-64e16588.js","./enumeration-925aa0f6.js","./jsonUtils-36bf3d33.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Clonable-7fa7ad97.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./aaBoundingBox-fb003858.js","./quantizationUtils-16db4e0b.js","./ViewingMode-5d7d590b.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./compilerUtils-7bf6df9e.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./zscale-baa108ea.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./basicInterfaces-7449a8bf.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./Attribute-f72d3f37.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./EvaluateSceneLighting.glsl-14c608ff.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat4f64-abdda1bb.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),"open-street-map":Rg,"oriented-imagery":()=>Y(()=>import("./FeatureLayerView3D-c8f15273.js"),["./FeatureLayerView3D-c8f15273.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./locale-fe7cc1d0.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./FeatureLayerViewBase3D-c2b95af2.js","./reactiveUtils-53e5756b.js","./FeatureLikeLayerView3D-e43d70a7.js","./asyncUtils-24bd37b2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./persistableUrlUtils-3635dccc.js","./Query-b0193ce7.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./TimeExtent-64e16588.js","./enumeration-925aa0f6.js","./jsonUtils-36bf3d33.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Clonable-7fa7ad97.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./aaBoundingBox-fb003858.js","./quantizationUtils-16db4e0b.js","./ViewingMode-5d7d590b.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./number-036ac4ef.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./compilerUtils-7bf6df9e.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./basicInterfaces-7449a8bf.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./Attribute-f72d3f37.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./EvaluateSceneLighting.glsl-14c608ff.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat4f64-abdda1bb.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),"point-cloud":()=>Y(()=>import("./PointCloudLayerView3D-2ac12922.js").then(i=>i.P),["./PointCloudLayerView3D-2ac12922.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./asyncUtils-24bd37b2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./reactiveUtils-53e5756b.js","./screenUtils-410d12c0.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec3f32-01c06d8d.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./aaBoundingBox-fb003858.js","./plane-01584357.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./dehydratedFeatures-efdbcd90.js","./quantizationUtils-16db4e0b.js","./typeUtils-1714017f.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./geometry-7d866d3f.js","./Scheduler-61737382.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./LayerView3D-e2b7aff2.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./I3SUtil-4be1431c.js","./mat3-4fd89d48.js","./quat-77a0169c.js","./quatf32-51a323b8.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./jsonUtils-36bf3d33.js","./Clonable-7fa7ad97.js","./I3SBinaryReader-1333d96d.js","./VertexAttribute-15d1866a.js","./orientedBoundingBox-6188c4d9.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./ViewingMode-5d7d590b.js","./Attribute-f72d3f37.js","./symbolColorUtils-1c63720c.js","./PointCloudWorkerUtil-9740f803.js","./PointCloudUniqueValueRenderer-797177d9.js","./ColorStop-29c89bbb.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./basicInterfaces-7449a8bf.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec2-848c6cf0.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./enums-fc527c7c.js","./Version-621cc6b7.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./PopupSceneLayerView-0083d510.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js"],import.meta.url),voxel:()=>Y(()=>import("./VoxelLayerView3D-1ae20fb1.js"),["./VoxelLayerView3D-1ae20fb1.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./reactiveUtils-53e5756b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./aaBoundingBox-fb003858.js","./LayerView3D-e2b7aff2.js","./PopupSceneLayerView-0083d510.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./Evented-686173eb.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./context-util-34d303b7.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),route:()=>Y(()=>import("./RouteLayerView3D-8e7fc052.js"),["./RouteLayerView3D-8e7fc052.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./CollectionFlattener-80d223f1.js","./reactiveUtils-53e5756b.js","./Stop-44c81d5c.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./LayerView3D-e2b7aff2.js","./GraphicsProcessor-b6945ef7.js","./HandleOwner-6217a02e.js","./diffUtils-1bae97a1.js","./Layer-524734fa.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Graphics3DObjectStates-93b8548c.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./jsonUtils-27937179.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./MemCache-b4d68123.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./zscale-baa108ea.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./quantizationUtils-16db4e0b.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./asyncUtils-24bd37b2.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./ElevationInfo-005ddd87.js","./Scheduler-61737382.js","./basicInterfaces-7449a8bf.js","./projectExtentUtils-40135480.js","./EventedSet-acb3b163.js","./LayerView-92e98881.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./sphere-a48b65b1.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),scene:i=>i.profile==null||i.profile==="mesh-pyramids"?Y(()=>import("./SceneLayerView3D-5d71be3c.js"),["./SceneLayerView3D-5d71be3c.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./reactiveUtils-53e5756b.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./FeatureReductionLayer-5ef01ce2.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./TimeExtent-64e16588.js","./Query-b0193ce7.js","./Field-945b2973.js","./fieldType-24ac97df.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./jsonUtils-27937179.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./MemCache-b4d68123.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./OperationalLayer-db187f46.js","./ElevationInfo-005ddd87.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./floorFilterUtils-080a7cd2.js","./I3SMeshView3D-6082276e.js","./byteSizeEstimations-f0cab514.js","./mat3-4fd89d48.js","./DefaultMaterial.glsl-58ca0075.js","./mat4f64-abdda1bb.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./quatf64-f8f1c132.js","./projection-4ac247db.js","./assets-94d592bf.js","./zscale-baa108ea.js","./I3SOverrides-754800bf.js","./dehydratedFeatures-efdbcd90.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./I3SNode-3d136092.js","./sphere-a48b65b1.js","./I3SUtil-4be1431c.js","./quat-77a0169c.js","./quatf32-51a323b8.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./I3SBinaryReader-1333d96d.js","./orientedBoundingBox-6188c4d9.js","./plane-01584357.js","./Attribute-f72d3f37.js","./asyncUtils-24bd37b2.js","./RenderTexture-b7e204b5.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Octree-813f29c9.js","./FeatureLayerView3D-c8f15273.js","./FeatureLayerViewBase3D-c2b95af2.js","./FeatureLikeLayerView3D-e43d70a7.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./dehydratedFeatureComparison-e523fe14.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./hash-0ddfbf4b.js","./Graphics3DObjectStates-93b8548c.js","./Layer-524734fa.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./vec2f32-eaf29605.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js","./SceneModification-163046e6.js","./persistable-227af340.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-3dd2f93a.js","./SceneLayerWorker-6a8d059d.js","./SceneLayerView-fb308531.js","./DefinitionExpressionSceneLayerView-3c2ce549.js","./I3SQueryFeatureStore-e335fdb8.js","./PopupSceneLayerView-0083d510.js"],import.meta.url):Y(()=>import("./SceneLayerGraphicsView3D-1c73119d.js"),["./SceneLayerGraphicsView3D-1c73119d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./reactiveUtils-53e5756b.js","./projection-4ac247db.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./zscale-baa108ea.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./quantizationUtils-16db4e0b.js","./Field-945b2973.js","./fieldType-24ac97df.js","./I3SOverrides-754800bf.js","./Scheduler-61737382.js","./ViewingMode-5d7d590b.js","./vec4f64-6d0e93be.js","./I3SNode-3d136092.js","./sphere-a48b65b1.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./I3SUtil-4be1431c.js","./mat3-4fd89d48.js","./quat-77a0169c.js","./quatf32-51a323b8.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./I3SBinaryReader-1333d96d.js","./VertexAttribute-15d1866a.js","./orientedBoundingBox-6188c4d9.js","./vec3f32-01c06d8d.js","./plane-01584357.js","./Attribute-f72d3f37.js","./symbolColorUtils-1c63720c.js","./asyncUtils-24bd37b2.js","./RenderTexture-b7e204b5.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./compilerUtils-7bf6df9e.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./AlphaCutoff-96178e0d.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./ScreenSpacePass.glsl-44cc0c5e.js","./enums-fc527c7c.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Util-513876a8.js","./Octree-813f29c9.js","./styleUtils-689841ac.js","./FeatureLayerView3D-c8f15273.js","./layerUtils-eef15b39.js","./FeatureLayerViewBase3D-c2b95af2.js","./FeatureLikeLayerView3D-e43d70a7.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./dehydratedFeatureComparison-e523fe14.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js","./SceneLayerView-fb308531.js","./DefinitionExpressionSceneLayerView-3c2ce549.js","./PopupSceneLayerView-0083d510.js"],import.meta.url),stream:()=>Y(()=>import("./StreamLayerView3D-931e4eaf.js"),["./StreamLayerView3D-931e4eaf.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./reactiveUtils-53e5756b.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./HandleOwner-6217a02e.js","./StreamFeatureManager-28e50223.js","./createConnection-7407496c.js","./zscale-baa108ea.js","./query-b4dff312.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./EventedSet-acb3b163.js","./FeatureLikeLayerView3D-e43d70a7.js","./asyncUtils-24bd37b2.js","./arcgisLayerUrl-1b8d6c52.js","./layerUtils-eef15b39.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./quantizationUtils-16db4e0b.js","./ViewingMode-5d7d590b.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./compilerUtils-7bf6df9e.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./basicInterfaces-7449a8bf.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./featureConversionUtils-aead6959.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./Attribute-f72d3f37.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./EvaluateSceneLighting.glsl-14c608ff.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat4f64-abdda1bb.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./LayerView-92e98881.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),tile:Rg,"imagery-tile":()=>Y(()=>import("./ImageryTileLayerView3D-6d0e1cb4.js"),["./ImageryTileLayerView3D-6d0e1cb4.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./reactiveUtils-53e5756b.js","./LayerView3D-e2b7aff2.js","./TiledLayerView3D-f92aa007.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./OperationalLayer-db187f46.js","./TimeExtent-64e16588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./rasterProjectionHelper-61d493f4.js","./projection-4ac247db.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./zscale-baa108ea.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./RefreshableLayerView-e8f476db.js","./drapedUtils-839f6fe4.js","./capabilities-caaa1278.js","./context-util-34d303b7.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js"],import.meta.url),"vector-tile":()=>Y(()=>import("./VectorTileLayerView3D-5186fa4e.js"),["./VectorTileLayerView3D-5186fa4e.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./reactiveUtils-53e5756b.js","./MemCache-b4d68123.js","./DefaultMaterial.glsl-58ca0075.js","./mat4f64-abdda1bb.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4-f0dc8788.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./compilerUtils-7bf6df9e.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./aaBoundingBox-fb003858.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./preload-helper-41c905a7.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./request-09e7d9b2.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./assets-94d592bf.js","./intl-87d72dbe.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./messages-1516d146.js","./Rect-98da58d6.js","./pbf-845dcafd.js","./rasterizingUtils-2f530e4d.js","./floatRGBA-1f66d0a4.js","./TileKey-4d1284e4.js","./config-f7904f35.js","./StyleRepository-ba91c1e4.js","./enums-c655c737.js","./enums-fb086c25.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./colorUtils-c0f43caf.js","./TileClipper-ae6eca9e.js","./TileInfo-9973cd47.js","./TileInfoView-629d0576.js","./number-b10bd8f5.js","./vec2f32-eaf29605.js","./GeometryUtils-0258f920.js","./LayerView3D-e2b7aff2.js","./TiledLayerView3D-f92aa007.js","./LayerView-92e98881.js","./Evented-686173eb.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),wcs:()=>Y(()=>import("./ImageryTileLayerView3D-6d0e1cb4.js"),["./ImageryTileLayerView3D-6d0e1cb4.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./reactiveUtils-53e5756b.js","./LayerView3D-e2b7aff2.js","./TiledLayerView3D-f92aa007.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./OperationalLayer-db187f46.js","./TimeExtent-64e16588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./rasterProjectionHelper-61d493f4.js","./projection-4ac247db.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./zscale-baa108ea.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./RefreshableLayerView-e8f476db.js","./drapedUtils-839f6fe4.js","./capabilities-caaa1278.js","./context-util-34d303b7.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js"],import.meta.url),"web-tile":Rg,wfs:()=>Y(()=>import("./WFSLayerView3D-809335fb.js"),["./WFSLayerView3D-809335fb.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./FeatureLayerViewBase3D-c2b95af2.js","./reactiveUtils-53e5756b.js","./FeatureLikeLayerView3D-e43d70a7.js","./asyncUtils-24bd37b2.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./Promise-755e47e5.js","./HandleOwner-6217a02e.js","./arcgisLayerUrl-1b8d6c52.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./persistableUrlUtils-3635dccc.js","./layerUtils-eef15b39.js","./Query-b0193ce7.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./TimeExtent-64e16588.js","./enumeration-925aa0f6.js","./jsonUtils-36bf3d33.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Clonable-7fa7ad97.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./aaBoundingBox-fb003858.js","./quantizationUtils-16db4e0b.js","./ViewingMode-5d7d590b.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./utils-6a5cc1bf.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./queryForSymbologySnapping-0800c0e3.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./hash-0ddfbf4b.js","./compilerUtils-7bf6df9e.js","./diffUtils-1bae97a1.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./Graphics3DObjectStates-93b8548c.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./zscale-baa108ea.js","./Layer-524734fa.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./basicInterfaces-7449a8bf.js","./FeatureReductionLayer-5ef01ce2.js","./OperationalLayer-db187f46.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-b5607f4f.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeatureSet-1d1ac4b9.js","./QueryEngineResult-0c6179e0.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./QueryEngineCapabilities-42e44ded.js","./FieldsIndex-113320d3.js","./FeatureSet-b4fbf079.js","./scaleUtils-a3b834c2.js","./FeatureStore-4cc4d41d.js","./BoundsStore-d90f19c6.js","./Attribute-f72d3f37.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./EvaluateSceneLighting.glsl-14c608ff.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat4f64-abdda1bb.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Heatmap.glsl-934f4ed3.js","./HeatmapDensity.glsl-6ae51187.js","./projectExtentUtils-40135480.js","./LayerView3D-e2b7aff2.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./queryZScale-f6e44ca7.js","./LercDecoder-f1486af7.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./EventedSet-acb3b163.js","./popupUtils-55b97964.js","./LayerView-92e98881.js","./RefreshableLayerView-e8f476db.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./uuid-73213768.js","./GraphicsLayer-cbd6e467.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./executeQueryJSON-044ac84b.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),wms:()=>Y(()=>import("./WMSLayerView3D-f0362be9.js"),["./WMSLayerView3D-f0362be9.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./DynamicLayerView3D-1f6f13ed.js","./asyncUtils-24bd37b2.js","./reactiveUtils-53e5756b.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./LayerView3D-e2b7aff2.js","./Attribute-f72d3f37.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./Polyline-82cb63bc.js","./deduplicate-a70aec6f.js","./Indices-f9b34f39.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./persistableUrlUtils-3635dccc.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./mat3f64-50f3b9f6.js","./mat4-f0dc8788.js","./mat4f64-abdda1bb.js","./aaBoundingBox-fb003858.js","./BufferView-b402c7a7.js","./vec2-848c6cf0.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./enums-fc527c7c.js","./Version-621cc6b7.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2f64-70cfd09e.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./byteSizeEstimations-f0cab514.js","./Texture-ae652f15.js","./Evented-686173eb.js","./TextureOnly.glsl-469cc321.js","./assets-94d592bf.js","./sphere-a48b65b1.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./projectExtentUtils-40135480.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./RefreshableLayerView-e8f476db.js","./OperationalLayer-db187f46.js","./TimeExtent-64e16588.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./lengthUtils-3c9047c4.js","./opacityUtils-d4a4b602.js","./ExportWMSImageParameters-7e1cdaa0.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./SimpleObservable-bd2c3ae8.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),wmts:()=>Y(()=>import("./WMTSLayerView3D-d41cce96.js"),["./WMTSLayerView3D-d41cce96.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./reactiveUtils-53e5756b.js","./layerUtils-eef15b39.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./LayerView3D-e2b7aff2.js","./TiledLayerView3D-f92aa007.js","./LayerView-92e98881.js","./HandleOwner-6217a02e.js","./Identifiable-e4f9b04c.js","./Promise-755e47e5.js","./RefreshableLayerView-e8f476db.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function Dj(i){const e=i.declaredClass?i.declaredClass.slice(i.declaredClass.lastIndexOf(".")+1):"Unknown",t=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new ue(`${t}:view-not-supported`,`${e} is not supported in 3D`)}const YO={hasLayerViewModule:i=>_(XO[i.type]),importLayerView:i=>{const e=XO[i.type];if(T(e))throw Dj(i);return e(i)}},QO="analyses-owner-handles";var pf,Hu;(function(i){i[i.PENDING=0]="PENDING",i[i.CREATED=1]="CREATED"})(pf||(pf={})),function(i){i[i.ADDED=0]="ADDED",i[i.REMOVED=1]="REMOVED"}(Hu||(Hu={}));let Ou=class extends T2{constructor(e){super(e),this._allAnalysisViews=new Oi,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=ZO(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject($s("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject($s()),this._attachedToViewResolver=ZO()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(T(t)||t.state.list===Hu.REMOVED)throw new ue("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),QO)}_disconnectOwners(){this.handles.remove(QO),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const t=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return{remove:()=>{t.remove(),r.remove();for(const s of e)this._removeAnalysis(s)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const r={state:{view:pf.PENDING,list:Hu.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=o0(s=>this._createAnalysisViewPromise(r,s))}else t.state.list=Hu.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=Hu.REMOVED,this._scheduleUpdate()):pe.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=b$(()=>this._update()))}_update(){this._scheduledUpdateHandle=Us(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Hu.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case pf.PENDING:e.createAnalysisViewTask=sl(e.createAnalysisViewTask);break;case pf.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=we(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,T(n.module))try{n.module=await this._loadAnalysisModule(s)}catch(o){throw this._creatingViewCount-=1,o}if(Xo(t))throw this._creatingViewCount-=1,$s("AnalysisView creation aborted");const a=new n.module.default({analysis:r,view:this.view});try{await a.when()}catch(o){throw this._creatingViewCount-=1,o}if(Xo(t))throw this._creatingViewCount-=1,a.destroy(),$s("AnalysisView creation aborted");return e.view=a,e.state.view=pf.CREATED,this._allAnalysisViews.add(a),this._creatingViewCount-=1,a}_loadAnalysisModule(e){switch(e){case"area-measurement":return Y(()=>import("./AreaMeasurementAnalysisView3D-73398b95.js").then(t=>t.A),["./AreaMeasurementAnalysisView3D-73398b95.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./analysisThemeUtils-a5bfd117.js","./Segment-0dc6a9a8.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Portal-8dfa7a94.js","./preload-helper-41c905a7.js","./request-09e7d9b2.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./locale-fe7cc1d0.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./reactiveUtils-53e5756b.js","./screenUtils-410d12c0.js","./vec2-848c6cf0.js","./LineVisualElement-4382615e.js","./projection-4ac247db.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./mat4f64-abdda1bb.js","./vec4f64-6d0e93be.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./aaBoundingBox-fb003858.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./quantizationUtils-16db4e0b.js","./typeUtils-1714017f.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./geometry-7d866d3f.js","./lengthUtils-3c9047c4.js","./widget-01c21b51.js","./intl-87d72dbe.js","./number-036ac4ef.js","./messages-1516d146.js","./Evented-686173eb.js","./uuid-73213768.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./sphere-a48b65b1.js","./quatf64-f8f1c132.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./asyncUtils-24bd37b2.js","./Version-621cc6b7.js","./quat-77a0169c.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./vec3f32-01c06d8d.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./geometryEngine-ddae1820.js","./geometryEngineBase-e1a33b0a.js","./hydrated-013e69c7.js","./earcut-61f7b102.js","./plane-01584357.js","./EditGeometryOperations-0df36f69.js"],import.meta.url);case"dimension":return Y(()=>import("./DimensionAnalysisView3D-fb9d1281.js").then(t=>t.D),["./DimensionAnalysisView3D-fb9d1281.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./reactiveUtils-53e5756b.js","./LineVisualElement-4382615e.js","./Promise-755e47e5.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./mat4f64-abdda1bb.js","./vec4f64-6d0e93be.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./aaBoundingBox-fb003858.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./LengthDimension-0b9dbf47.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./Segment-0dc6a9a8.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./locale-fe7cc1d0.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./vec2-848c6cf0.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./quantizationUtils-16db4e0b.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./lengthUtils-3c9047c4.js","./widget-01c21b51.js","./intl-87d72dbe.js","./number-036ac4ef.js","./messages-1516d146.js","./uuid-73213768.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./sphere-a48b65b1.js","./quatf64-f8f1c132.js","./plane-01584357.js","./analysisViewUtils-61ca3438.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./jsonUtils-36bf3d33.js","./compilerUtils-7bf6df9e.js","./mat3-4fd89d48.js","./lineSegment-4eb8b6fa.js","./Attribute-f72d3f37.js","./basicInterfaces-7449a8bf.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./asyncUtils-24bd37b2.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./vec3f32-01c06d8d.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./Factory-3a66d8bc.js","./MarkerSizing.glsl-950a18f6.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./HandleOwner-6217a02e.js","./Octree-813f29c9.js","./RightAngleQuadVisualElement-c08b83c3.js","./VisualElementResources-b6496e82.js","./PointVisualElement-f510cbef.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./colorUtils-c0f43caf.js","./EditGeometryOperations-0df36f69.js","./QueryEngineResult-0c6179e0.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./WhereClause-0699a2ca.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./utils-95e81b90.js","./generateRendererUtils-e34cc2cf.js","./json-48e3ea08.js","./SnappingCandidate-970faec6.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./featureConversionUtils-aead6959.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./dehydratedFeatureComparison-e523fe14.js","./Scheduler-61737382.js","./RenderTexture-b7e204b5.js"],import.meta.url);case"direct-line-measurement":return Y(()=>import("./DirectLineMeasurementAnalysisView3D-27dd411d.js").then(t=>t.D),["./DirectLineMeasurementAnalysisView3D-27dd411d.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./analysisThemeUtils-a5bfd117.js","./Segment-0dc6a9a8.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Portal-8dfa7a94.js","./preload-helper-41c905a7.js","./request-09e7d9b2.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./locale-fe7cc1d0.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./reactiveUtils-53e5756b.js","./screenUtils-410d12c0.js","./vec2-848c6cf0.js","./LineVisualElement-4382615e.js","./projection-4ac247db.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./mat4f64-abdda1bb.js","./vec4f64-6d0e93be.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./aaBoundingBox-fb003858.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./quantizationUtils-16db4e0b.js","./typeUtils-1714017f.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./elevationInfoUtils-d3b9d588.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./geometry-7d866d3f.js","./lengthUtils-3c9047c4.js","./widget-01c21b51.js","./intl-87d72dbe.js","./number-036ac4ef.js","./messages-1516d146.js","./Evented-686173eb.js","./uuid-73213768.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./sphere-a48b65b1.js","./quatf64-f8f1c132.js","./geometryEngine-ddae1820.js","./geometryEngineBase-e1a33b0a.js","./hydrated-013e69c7.js","./InterleavedLayout-07cc6753.js","./BufferView-b402c7a7.js","./types-e1c0a5bf.js","./Matrix3PassUniform-df6e2166.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./asyncUtils-24bd37b2.js","./Version-621cc6b7.js","./quat-77a0169c.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./vec3f32-01c06d8d.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./lineSegment-4eb8b6fa.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./RightAngleQuadVisualElement-c08b83c3.js","./Identifiable-e4f9b04c.js","./VisualElementResources-b6496e82.js"],import.meta.url);case"line-of-sight":return Y(()=>import("./LineOfSightAnalysisView3D-78d727b2.js"),["./LineOfSightAnalysisView3D-78d727b2.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./LineVisualElement-4382615e.js","./Promise-755e47e5.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./mat4f64-abdda1bb.js","./vec4f64-6d0e93be.js","./reactiveUtils-53e5756b.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./aaBoundingBox-fb003858.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./LineOfSightAnalysisTarget-fe667195.js","./Clonable-7fa7ad97.js","./persistable-227af340.js","./multiOriginJSONSupportUtils-c978f4c3.js","./uuid-73213768.js","./resourceExtension-3dd2f93a.js","./persistableUrlUtils-3635dccc.js","./ElevationInfo-005ddd87.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./lengthUtils-3c9047c4.js","./asyncUtils-24bd37b2.js","./HandleOwner-6217a02e.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./quatf64-f8f1c132.js","./elevationInfoUtils-d3b9d588.js","./screenUtils-410d12c0.js","./dehydratedFeatures-efdbcd90.js","./quantizationUtils-16db4e0b.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./Scheduler-61737382.js","./lineSegment-4eb8b6fa.js","./analysisViewUtils-61ca3438.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./compilerUtils-7bf6df9e.js","./mat3-4fd89d48.js","./vec2-848c6cf0.js","./plane-01584357.js","./Attribute-f72d3f37.js","./basicInterfaces-7449a8bf.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./vec3f32-01c06d8d.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./PointVisualElement-f510cbef.js","./Octree-813f29c9.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./VisualElementResources-b6496e82.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url);case"slice":return Y(()=>import("./SliceAnalysisView3D-5dd61ad8.js").then(t=>t.S),["./SliceAnalysisView3D-5dd61ad8.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./LineVisualElement-4382615e.js","./Promise-755e47e5.js","./projection-4ac247db.js","./preload-helper-41c905a7.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./SimpleObservable-bd2c3ae8.js","./mat4-f0dc8788.js","./Polyline-82cb63bc.js","./assets-94d592bf.js","./request-09e7d9b2.js","./aaBoundingRect-2fb32e32.js","./zscale-baa108ea.js","./mat4f64-abdda1bb.js","./vec4f64-6d0e93be.js","./reactiveUtils-53e5756b.js","./VisualVariablePassParameters-f892560d.js","./VertexAttribute-15d1866a.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./ShaderBuilder-be7ca791.js","./mat3f64-50f3b9f6.js","./aaBoundingBox-fb003858.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./geometry-7d866d3f.js","./typeUtils-1714017f.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./persistable-227af340.js","./multiOriginJSONSupportUtils-c978f4c3.js","./uuid-73213768.js","./resourceExtension-3dd2f93a.js","./persistableUrlUtils-3635dccc.js","./Layer-524734fa.js","./Evented-686173eb.js","./Identifiable-e4f9b04c.js","./Loadable-40ecd3b9.js","./BuildingComponentSublayer-f2558dc9.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./jsonUtils-27937179.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./MemCache-b4d68123.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./Field-945b2973.js","./fieldType-24ac97df.js","./HeightModelInfo-73f516f9.js","./OperationalLayer-db187f46.js","./TimeExtent-64e16588.js","./ElevationInfo-005ddd87.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./AttachmentQuery-f1085685.js","./Query-b0193ce7.js","./RelationshipQuery-765b2184.js","./HandleOwner-6217a02e.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./intl-87d72dbe.js","./messages-1516d146.js","./editsZScale-9d0832b8.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./asyncUtils-24bd37b2.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./ScaleRangeLayer-d1b04b80.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./TopFeaturesQuery-d2b31d08.js","./popupUtils-b8625101.js","./capabilities-a18453f6.js","./I3SIndexInfo-1765b03c.js","./I3SLayerDefinitions-7bfc1943.js","./I3SUtil-4be1431c.js","./mat3-4fd89d48.js","./quat-77a0169c.js","./quatf64-f8f1c132.js","./quatf32-51a323b8.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./I3SBinaryReader-1333d96d.js","./orientedBoundingBox-6188c4d9.js","./vec3f32-01c06d8d.js","./plane-01584357.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./Attribute-f72d3f37.js","./symbolColorUtils-1c63720c.js","./popupUtils-55b97964.js","./analysisViewUtils-61ca3438.js","./vec2-848c6cf0.js","./lineSegment-4eb8b6fa.js","./basicInterfaces-7449a8bf.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./View.glsl-879c1eaf.js","./Texture2DPassUniform-268e8d2d.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./ImageMaterial-771bdfd8.js","./ImageMaterial.glsl-2e22ba6f.js","./Factory-3a66d8bc.js"],import.meta.url)}}};function ZO(){const i=hp();return i.promise.catch(()=>{}),i}d([p()],Ou.prototype,"updating",null),d([p({constructOnly:!0})],Ou.prototype,"view",void 0),d([p()],Ou.prototype,"_allAnalysisViews",void 0),d([p()],Ou.prototype,"_creatingViewCount",void 0),Ou=d([k("esri.views.3d.analysis.AnalysisViewManager3D")],Ou);const Lj=Ou;let Gc=class extends ge{constructor(e){super(e),this.collision=new u_,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Se.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Se.Local?this._set("altitude",e):pe.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ie(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return ie(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Se.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=Gx)=>(r.min=ps.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?c1([[4e3,ps.max],[1e4,vt(88)],[6e6,vt(88)]]):()=>ps.max;return(t,r=Gx)=>(r.min=ps.min,r.max=e(t),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?c1([[4e3,ps.max],[5e4,vt(88)],[6e6,vt(88)],[2e7,ps.min]]):c1([[3e5,ps.max],[3e6,vt(88)],[6e6,vt(88)],[2e7,ps.min]]);return(t,r=Gx)=>(r.min=ps.min,r.max=e(t),r)}};function $j(i){return{min:-2e5,max:4*i.radius}}d([p()],Gc.prototype,"altitude",null),d([p({readOnly:!0})],Gc.prototype,"collision",void 0),d([p()],Gc.prototype,"distance",void 0),d([p({readOnly:!0})],Gc.prototype,"minimumPoiDistance",void 0),d([p()],Gc.prototype,"tilt",void 0),d([p({constructOnly:!0})],Gc.prototype,"mode",void 0),Gc=d([k("esri.views.3d.state.Constraints")],Gc);const KO=$j(ia),ps={min:vt(.5),max:vt(179.5)},Gx={min:0,max:0};let u_=class extends ge{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([p({type:Boolean})],u_.prototype,"enabled",void 0),d([p({type:Number})],u_.prototype,"elevationMargin",void 0),u_=d([k("esri.views.3d.state.Constraints.CollisionConstraint")],u_);let mf=class extends ge{constructor(){super(...arguments),this.min=KO.min,this.max=KO.max}};d([p({type:Number})],mf.prototype,"min",void 0),d([p({type:Number})],mf.prototype,"max",void 0),mf=d([k("esri.views.3d.constraints.AltitudeConstraint")],mf);let Xc=class extends ge{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};d([p({type:Number,value:1e-8})],Xc.prototype,"near",null),d([ss("near")],Xc.prototype,"castNear",null),d([p({type:Number,value:1e-8})],Xc.prototype,"far",null),d([ss("far")],Xc.prototype,"castFar",null),d([p({type:["auto","manual"]})],Xc.prototype,"mode",void 0),Xc=d([k("esri.views.3d.constraints.ClipDistanceConstraint")],Xc);const OE={min:ca(ps.min),max:ca(ps.max)};let qu=class extends ge{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ie(e,OE.min,OE.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([p({type:["auto","manual"]})],qu.prototype,"mode",void 0),d([p({type:Number,value:OE.max})],qu.prototype,"max",null),d([ss("max")],qu.prototype,"castMax",null),qu=d([k("esri.views.3d.constraints.TiltConstraint")],qu);let Wu=class extends ge{constructor(){super(...arguments),this.tilt=new qu,this.altitude=new mf,this.clipDistance=new Xc}};d([p({type:qu})],Wu.prototype,"tilt",void 0),d([p({type:mf})],Wu.prototype,"altitude",void 0),d([p({type:Xc})],Wu.prototype,"clipDistance",void 0),Wu=d([k("esri.views.3d.constraints.Constraints")],Wu);var ME;let Ya=ME=class extends da{constructor(i){super(i),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(i,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(i,e,t){e[t]=i.getTime()}readDirectShadowsEnabled(i,e){return!!e.directShadows}writedirectShadowsEnabled(i,e,t){i&&(e[t]=i)}writeDisplayUTCOffset(i,e){i!=null&&(e.displayUTCOffset=i)}clone(){return new ME(this.cloneConstructProperties())}cloneConstructProperties(){const i={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(i.date=new Date(this.date.getTime())),i}};d([p({readOnly:!0,type:["sun"],json:{write:!0}})],Ya.prototype,"type",void 0),d([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],Ya.prototype,"date",void 0),d([XC("date",["datetime"])],Ya.prototype,"readDate",null),d([V_("date")],Ya.prototype,"writeDate",null),d([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Ya.prototype,"directShadowsEnabled",void 0),d([XC("directShadowsEnabled",["directShadows"])],Ya.prototype,"readDirectShadowsEnabled",null),d([V_("directShadowsEnabled")],Ya.prototype,"writedirectShadowsEnabled",null),d([p({type:Number,json:{write:!0}})],Ya.prototype,"displayUTCOffset",void 0),d([V_("displayUTCOffset")],Ya.prototype,"writeDisplayUTCOffset",null),Ya=ME=d([k("esri.webscene.SunLighting")],Ya);const My=Ya;var Wm;let Dl=Wm=class extends Br.EventedMixin(My){constructor(i){super(i),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),t=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",t),this._set("date",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(i){return new Wm(i.cloneConstructProperties())}set defaultDate(i){const e=this._get("date")===this._get("defaultDate");i=new Date(i.getTime()),this._set("defaultDate",i),e&&this._set("date",i)}set date(i){i!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(i.getTime())))}autoUpdate(i,e){const t=Wm.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;_(i)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(i.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(i.getTime()))));const s=Wm.calculateTimezoneOffset(this.positionTimezoneInfo);if(t!==s&&(Hx.target=this,Hx.timezoneOffset=s,this.emit("timezone-will-change",Hx)),_(i))return!!isNaN(i.getTime())||r!==i.getTime()}clone(){const i=this._get("date")===this._get("defaultDate"),e=new Wm({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return i&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(i){const e=this.clone();return i.date!=null&&(e.date=i.date),e.directShadowsEnabled=i.directShadowsEnabled,e.displayUTCOffset=i.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([p({type:Boolean})],Dl.prototype,"cameraTrackingEnabled",void 0),d([p({type:Boolean})],Dl.prototype,"ambientOcclusionEnabled",void 0),d([p({type:Boolean})],Dl.prototype,"waterReflectionEnabled",void 0),d([p({type:Date})],Dl.prototype,"defaultDate",null),d([p({type:Date})],Dl.prototype,"date",null),Dl=Wm=d([k("esri.views.3d.environment.SunLighting")],Dl),function(i){function e({hours:t,minutes:r,seconds:s}){return Math.round(t+r/60+s/3600)}i.calculateTimezoneOffset=e}(Dl||(Dl={}));const Hx={target:null,timezoneOffset:0},sd=Dl;var IE;let p_=IE=class extends da{constructor(i){super(i),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new IE(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([p({readOnly:!0,type:["virtual"],json:{write:!0}})],p_.prototype,"type",void 0),d([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],p_.prototype,"directShadowsEnabled",void 0),p_=IE=d([k("esri.webscene.VirtualLighting")],p_);const Rw=p_;var y1;let jm=y1=class extends Br.EventedMixin(Rw){constructor(i){super(i),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new y1({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(i){return new y1(i.cloneConstructProperties())}cloneWithWebsceneLighting(i){const e=this.clone();return e.directShadowsEnabled=i.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([p({type:Boolean})],jm.prototype,"ambientOcclusionEnabled",void 0),d([p({type:Boolean})],jm.prototype,"waterReflectionEnabled",void 0),d([p({type:Boolean})],jm.prototype,"cameraTrackingEnabled",void 0),jm=y1=d([k("esri.views.3d.environment.VirtualLighting")],jm);const m_=jm,Fj={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:sd,virtual:m_}};var DE;let W_=DE=class extends ge{set quality(i){["low","high"].includes(i)&&this._set("quality",i)}clone(){return new DE({quality:this.quality})}};d([p({type:["low","high"],value:"low"})],W_.prototype,"quality",null),W_=DE=d([k("esri.views.3d.environment.SceneViewAtmosphere")],W_);var LE;let f_=LE=class extends da{constructor(i){super(i),this.type="sunny",this.cloudCover=.5}clone(){return new LE({cloudCover:this.cloudCover})}};d([Pp({sunny:"sunny"})],f_.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f_.prototype,"cloudCover",void 0),f_=LE=d([k("esri.views.3d.environment.SunnyWeather")],f_);const $E=f_;var FE;let g_=FE=class extends da{constructor(i){super(i),this.type="cloudy",this.cloudCover=.5}clone(){return new FE({cloudCover:this.cloudCover})}};d([Pp({cloudy:"cloudy"})],g_.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],g_.prototype,"cloudCover",void 0),g_=FE=d([k("esri.views.3d.environment.CloudyWeather")],g_);const Nj=g_;var NE;let __=NE=class extends da{constructor(i){super(i),this.type="foggy",this.fogStrength=.5}clone(){return new NE({fogStrength:this.fogStrength})}};d([Pp({foggy:"foggy"})],__.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],__.prototype,"fogStrength",void 0),__=NE=d([k("esri.views.3d.environment.FoggyWeather")],__);const Uj=__;var UE;let Xm=UE=class extends da{constructor(i){super(i),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new UE({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Pp({rainy:"rainy"})],Xm.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Xm.prototype,"cloudCover",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Xm.prototype,"precipitation",void 0),Xm=UE=d([k("esri.views.3d.environment.RainyWeather")],Xm);const Vj=Xm;var VE;let Mu=VE=class extends da{constructor(i){super(i),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new VE({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Pp({snowy:"snowy"})],Mu.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Mu.prototype,"cloudCover",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Mu.prototype,"precipitation",void 0),d([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Mu.prototype,"snowCover",void 0),Mu=VE=d([k("esri.views.3d.environment.SnowyWeather")],Mu);const Bj=Mu,S4={key:"type",base:$E,typeMap:{sunny:$E,cloudy:Nj,rainy:Vj,snowy:Bj,foggy:Uj}},zj=Object.keys(S4.typeMap);function kj(i,e){return!!zj.includes(i)||(e.error(`"${i}" is not a valid weather type`),!1)}const ao=1e4,Gj={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:My,virtual:Rw}};let v1=class extends da{constructor(e){super(e)}clone(){}};d([p({readOnly:!0,json:{read:!1}})],v1.prototype,"type",void 0),v1=d([k("esri.webscene.background.Background")],v1);const R4=v1;var BE;const Hj={...y7,nonNullable:!0};let y_=BE=class extends R4{constructor(i){super(i),this.type="color",this.color=new li([0,0,0,1])}clone(){return new BE(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([Pp({color:"color"},{readOnly:!0})],y_.prototype,"type",void 0),d([p(Hj)],y_.prototype,"color",void 0),y_=BE=d([k("esri.webscene.background.ColorBackground")],y_);const A4=y_,JO={base:R4,key:"type",typeMap:{color:A4}};function qj(i){return(e,t,r)=>{if(!e)return e;for(const s in i.typeMap)if(e.type===s){const n=new i.typeMap[s];return n.read(e,r),n}}}const Wj={types:JO,json:{read:qj(JO),write:{overridePolicy:(i,e,t)=>({enabled:!t||!t.isPresentation})}}};var zE;const P4="esri.webscene.Environment",jj=pe.getLogger(P4),eM=(i,e,t)=>({enabled:!t||!t.isPresentation});let nd=zE=class extends da{constructor(i){super(i),this.lighting=new My,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(i){kj(i==null?void 0:i.type,jj)&&this._set("weather",i)}clone(){return new zE(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Rw.prototype.clone.call(this.lighting):My.prototype.clone.call(this.lighting),background:il(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([p({types:Gj,nonNullable:!0,json:{write:!0}})],nd.prototype,"lighting",void 0),d([p(Wj)],nd.prototype,"background",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:eM}}})],nd.prototype,"atmosphereEnabled",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:eM}}})],nd.prototype,"starsEnabled",void 0),d([p({types:S4,nonNullable:!0,json:{write:!0},value:new $E})],nd.prototype,"weather",null),nd=zE=d([k(P4)],nd);const O4=nd;var v_;let Ym=v_=class extends O4{constructor(i){super(i),this.atmosphere=new W_,this.lighting=new sd,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(i){const e=i.cloneConstructProperties();return new v_({...e,lighting:e.lighting?e.lighting.type==="virtual"?m_.fromWebsceneLighting(e.lighting):sd.fromWebsceneLighting(e.lighting):void 0})}castLighting(i){return this._convertLighting(i)}applyLighting(i){this.lighting=this._convertLighting(i)}_convertLighting(i){var e,t;return i?i instanceof sd||i instanceof m_?i:i instanceof My?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(i):new sd({...i.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):i instanceof Rw?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(i):new m_({...i.cloneConstructProperties(),...(t=this.lighting)==null?void 0:t.cloneNonPersistentConstructProperties()}):j8(Fj,i):new sd}clone(){return new v_({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:il(this.background)})}cloneWithWebsceneEnvironment(i){return new v_({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:il(this.background),...i.cloneConstructProperties(),lighting:this._getLighting(i)})}_getLighting(i){switch(i.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(i.lighting):sd.fromWebsceneLighting(i.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(i.lighting):m_.fromWebsceneLighting(i.lighting);default:return ll(i.lighting),sd.fromWebsceneLighting(i.lighting)}}};d([p({type:W_,json:{read:!1},nonNullable:!0})],Ym.prototype,"atmosphere",void 0),d([p({nonNullable:!0})],Ym.prototype,"lighting",void 0),d([ss("lighting")],Ym.prototype,"castLighting",null),Ym=v_=d([k("esri.views.3d.environment.SceneViewEnvironment")],Ym);const Qm=Ym;var Pr;(function(i){i[i.Simple=0]="Simple",i[i.Realistic=1]="Realistic",i[i.Panoramic=2]="Panoramic",i[i.None=3]="None"})(Pr||(Pr={}));function yR(i){return ie((i-1e5)/(1e6-1e5),0,1)}const kE=1e4,Xj=.085,Iy=1e5,j_=qe(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),qx=3,Wx=qe(qx*parseFloat(Number(65e-8).toFixed(6)),qx*parseFloat(Number(1881e-9).toFixed(6)),qx*parseFloat(Number(85e-9).toFixed(6))),Yj=3996e-9,Qj=qe(parseFloat(Number(j_[0]+Wx[0]).toFixed(6)),parseFloat(Number(j_[1]+Wx[1]).toFixed(6)),parseFloat(Number(j_[2]+Wx[2]).toFixed(6)));function Zj(i){const e=new Hi;e.attributes.add(C.POSITION,"vec2"),e.include(pw,{textureCoordinateType:zd.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add([new tn("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new tn("inverseViewMatrix",(s,n)=>n0(Kj,n.camera.viewMatrix))]),t.code.add(R`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new en("radii",s=>s.radii),new Fs("cameraPosition",(s,n)=>n.camera.eye),new ac("heightParameters",s=>s.heightParameters),new yt("innerFadeDistance",s=>s.innerFadeDistance),new yt("altitudeFade",s=>s.altitudeFade),new Bt("depthTex",s=>s.depthTex),new yt("hazeStrength",s=>s.hazeStrength)]),r.constants.add("betaRayleigh","vec3",j_),r.constants.add("betaCombined","vec3",Qj),r.constants.add("betaMie","float",Yj),r.constants.add("scaleHeight","float",Xj*Iy),mw(r),e.include(O2),i.haze&&(r.include(mp),r.uniforms.add(new en("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(R`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(R`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(R`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(R`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${i.haze?R`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${i.haze?R``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${i.haze?"":R`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${i.haze?R`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:R`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${i.haze?R`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:R`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${i.haze?R`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:R`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${i.haze?"":R`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),e}const Kj=ve(),Jj=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:j_,build:Zj},Symbol.toStringTag,{value:"Module"}));let eX=class extends ur{constructor(){super(...arguments),this.heightParameters=Xt(),this.radii=Ne(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}},GE=class M4 extends Wt{initializeProgram(e){return new Gt(e.rctx,M4.shader.get().build(this.configuration),Zt)}initializePipeline(){return this.configuration.haze?it({blending:os(he.ONE,he.ZERO,he.ONE_MINUS_SRC_COLOR,he.ONE),colorWrite:ut}):it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ts.LEQUAL},colorWrite:ut})}};GE.shader=new jt(Jj,()=>Y(()=>import("./ChapmanAtmosphere.glsl-28e3933b.js"),["./ChapmanAtmosphere.glsl-28e3933b.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./vec3f32-01c06d8d.js","./compilerUtils-7bf6df9e.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let I4=class extends Ln{constructor(){super(...arguments),this.haze=!1}};d([L()],I4.prototype,"haze",void 0);let jx=class{constructor(e,t){this._view=e,this.type=Pr.Realistic,this._handles=new mi,this._passParameters=new eX,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=ia.radius,this._fadeHaze=0,this._updateRadius(ia.radius);const r=t.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([z(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),z(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const s=new I4;s.haze=!1,this._atmosphereTechnique=t.techniqueRepository.acquire(GE,s),s.haze=!0,this._atmosphereHazeTechnique=t.techniqueRepository.acquire(GE,s),this._vao=Dn(r,c0)}destroy(){this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._vao.dispose(),this._handles.destroy()}render(e){this._render(e,this._atmosphereTechnique,e.offscreenRenderingHelper.depthTexture)}renderHaze(e,t){this._fadeHaze=t,this._render(e,this._atmosphereHazeTechnique,e.offscreenRenderingHelper.linearDepthTexture)}_render(e,t,r){if(T(r))return;this._update(e.bindParameters.camera),this._passParameters.depthTex=r;const s=e.rctx.bindTechnique(t,this._passParameters,e.bindParameters);e.offscreenRenderingHelper.renderDepthDetached(()=>this._renderCommon(s,e))}_renderCommon(e,t){T(this._vao)||(t.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),t.rctx.drawArrays(bt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=ia.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(ia.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,pi(this._passParameters.radii,e,e+Iy),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-kE)*kE)}_update(e){if(T(e))return;const t=Da(e.eye),r=Math.sqrt(t),s=t-this._passParameters.radii[1]*this._passParameters.radii[1],n=ie((r-this._passParameters.radii[0])/Iy,0,1);Vs(this._passParameters.heightParameters,r,t,s,n),this._passParameters.altitudeFade=yR(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=dt(dt(.6,1,zf(9500,10500,r-ia.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function tX(){const i=new Hi;i.attributes.add(C.POSITION,"vec2"),i.varyings.add("worldRay","vec3");const{vertex:e,fragment:t}=i;return e.uniforms.add([new tn("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new tn("inverseViewMatrix",(r,s)=>n0(iX,s.camera.viewMatrix))]),e.code.add(R`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),t.include(zF),t.include(Ip),i.include(uz,{pbrMode:di.Disabled,lightingSphericalHarmonicsOrder:2}),i.include(Wz),i.include(O2),i.include(pz,{useLegacyTerrainShading:!1}),i.include(_z,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),t.uniforms.add([new Fs("cameraPosition",(r,s)=>s.camera.eye)]),t.code.add(R`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),i}const iX=ve(),rX=Object.freeze(Object.defineProperty({__proto__:null,build:tX},Symbol.toStringTag,{value:"Module"}));let D4=class L4 extends Wt{constructor(e){super(e,new Ln,()=>this.destroy())}initializeProgram(e){return new Gt(e.rctx,L4.shader.get().build(),Zt)}initializePipeline(){return it({blending:fc(he.ONE,he.SRC_ALPHA),depthTest:{func:Ts.LEQUAL},colorWrite:ut})}};D4.shader=new jt(rX,()=>Y(()=>import("./CloudsComposition.glsl-84efc82f.js"),["./CloudsComposition.glsl-84efc82f.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./vec4-c7a19f0d.js","./vec4f64-6d0e93be.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./vec3f32-01c06d8d.js","./compilerUtils-7bf6df9e.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./mathUtils-ae09f98b.js","./Ellipsoid-89682c5e.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./mat3f64-50f3b9f6.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./ReadLinearDepth.glsl-0e6f5c47.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./Extent-22afa84a.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let Iu=class extends ge{constructor(e){super(e),this._technique=new D4(e),this._vao=Dn(e.rctx)}destroy(){this._technique=gr(this._technique),this._vao=Le(this._vao)}render(e){const t=e.bindParameters.cloudsFade;if(T(this._vao)||T(t.data))return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,sX,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(bt.TRIANGLE_STRIP,0,4)}};d([p({constructOnly:!0})],Iu.prototype,"rctx",void 0),d([p({constructOnly:!0})],Iu.prototype,"viewingMode",void 0),d([p({constructOnly:!0})],Iu.prototype,"planetRadius",void 0),d([p({constructOnly:!0})],Iu.prototype,"requestRender",void 0),Iu=d([k("esri.views.3d.environment.CloudsComposition")],Iu);const sX=new ur;var An;(function(i){i[i.SIXTEEN=0]="SIXTEEN",i[i.HUNDRED=1]="HUNDRED",i[i.TWOHUNDRED=2]="TWOHUNDRED",i[i.COUNT=3]="COUNT"})(An||(An={}));let b1=class extends Ln{constructor(){super(...arguments),this.steps=An.SIXTEEN,this.writeTextureChannels=M2.RG}};d([L({count:An.COUNT})],b1.prototype,"steps",void 0),d([L({constValue:Vt("esri-mobile")?1024:2048})],b1.prototype,"cubeMapSize",void 0),d([L()],b1.prototype,"writeTextureChannels",void 0);let b_=class{constructor(e,t,r,s,n,a,o,l,c=.5){this.coverage=e,this.density=t,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=a,this.cloudHeight=o,this.raymarchingSteps=l,this.median=c}};const tM=new b_([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],An.SIXTEEN),Os={sunny:tM,cloudy:new b_([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],An.TWOHUNDRED,.6),rainy:new b_([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],An.TWOHUNDRED,.4),snowy:new b_([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],An.HUNDRED,.65),foggy:new b_([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],An.SIXTEEN),default:tM},oo=Vt("esri-mobile")?64:128,nX=oo/128,Vo=Math.ceil(Math.sqrt(oo)),qo=(oo+2)*Vo,aX=1e5,Xx=128,oX=qo/1560;let $4=class extends ur{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Os.default.raymarchingSteps,this.weatherTile=Ne()}},F4=class extends ur{constructor(){super(...arguments),this.viewMatrix=Bs()}};function lX(i){const e=new Hi;e.include(_h,!1);const t=e.fragment;return t.uniforms.add([new yt("cloudRadius",r=>r.cloudRadius),new yt("power",r=>dt(35,120,r.absorption)),new yt("sigmaE",r=>1+r.absorption),new yt("density",r=>dt(0,.3,r.density)),new yt("cloudSize",r=>dt(0,.02,Math.max(.01,1-r.cloudSize))),new yt("detailSize",r=>dt(0,.2,Math.max(.01,1-r.detailSize))),new yt("smoothness",r=>dt(0,.5,1-r.smoothness)),new yt("cloudHeight",r=>dt(0,1500,r.cloudHeight)),new yt("coverage",r=>r.coverage),new dE("view",r=>r.viewMatrix),new Bt("cloudShapeTexture",r=>_(r.noiseTexture)?r.noiseTexture.textureAtlas:null),new en("cloudVariables",r=>pi(cX,r.coverage,r.absorption))]),t.constants.add("halfCubeMapSize","float",.5*i.cubeMapSize),t.code.add(R`
    const int STEPS = ${i.steps===An.SIXTEEN?R`16`:i.steps===An.HUNDRED?R`100`:R`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.code.add(R`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${R.float(qo)};
      const float dataWidth = ${R.float(qo)};
      const float tileRows = ${R.float(Vo)};
      const vec3 atlasDimensions = vec3(${R.float(oo)}, ${R.float(oo)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${R.float(nX)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${R.float(oX)} * p) / ${R.float(qo)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.code.add(R`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.code.add(R`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.code.add(R`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.code.add(R`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),t.code.add(R`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const cX=Ne(),hX=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:F4,CloudsPassParameters:$4,build:lX},Symbol.toStringTag,{value:"Module"}));let N4=class U4 extends Wt{constructor(e,t){super(e,t,()=>this.destroy())}initializeProgram(e){return new Gt(e.rctx,U4.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:fc(he.CONSTANT_COLOR,he.ONE_MINUS_CONSTANT_COLOR,wy.ADD,this.configuration.writeTextureChannels===M2.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Ts.LEQUAL},colorWrite:ut})}};N4.shader=new jt(hX,()=>Y(()=>import("./Clouds.glsl-a0ee06ea.js"),["./Clouds.glsl-a0ee06ea.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./mat3f64-50f3b9f6.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));var $a;(function(i){i[i.Full=0]="Full",i[i.WeatherMap=1]="WeatherMap",i[i.COUNT=2]="COUNT"})($a||($a={}));let HE=class extends Ln{constructor(){super(...arguments),this.mode=$a.Full}};d([L({count:$a.COUNT})],HE.prototype,"mode",void 0);let V4=class extends ur{constructor(){super(...arguments),this.weatherTile=ti(0,0)}};function dX(i){const e=new Hi;return e.include(_h,!1),e.fragment.code.add(R`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),i.mode===$a.Full&&e.fragment.code.add(R`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${R.float(Vo)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${R.float(8)});

      float worley0 = worley(p, ${R.float(2)} * 2.0);
      float worley1 = worley(p, ${R.float(2)} * 8.0);
      float worley2 = worley(p, ${R.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${R.float(2)});
      float worley1 = worley(p, ${R.float(2)} * 2.0);
      float worley2 = worley(p, ${R.float(2)} * 4.0);
      float worley3 = worley(p, ${R.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new en("weatherTile",t=>t.weatherTile)),e.fragment.code.add(R`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${R.float(Xx)});

      // Get global coordinates of p
      p += weatherTile * ${R.float(Xx)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${R.float(aX)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(R`void main() {`),i.mode===$a.Full&&e.fragment.code.add(R`
        float padWidth = 1.0;
        float paddedSize = ${R.float(oo)} + 2.0 * padWidth;
        float tileCount = ${R.float(Vo)} * ${R.float(Vo)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${R.float(oo)};
          }

          if (startPadY) {
            pixel.y += ${R.float(oo)};
          }

          if (endPadX) {
            pixel.x -= ${R.float(oo)};
          }

          if (endPadY) {
            pixel.y -= ${R.float(oo)};
          }

          uv = vec2(pixel.xy / ${R.float(oo)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${R.float(oo)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${R.float(Vo)} * ${R.float(Vo)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${R.float(Vo)} * ${R.float(Vo)});
        p = p_;
        p.z /= (${R.float(Vo)} * ${R.float(Vo)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(R`
      vec2 mapUV = ${R.float(Xx)} * (gl_FragCoord.xy / ${R.float(qo)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${i.mode===$a.Full?R`gl_FragColor.ba = vec2(0.0, map);`:R`gl_FragColor = vec4(map);`};
    }
  `),e}const uX=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:V4,build:dX},Symbol.toStringTag,{value:"Module"}));let qE=class B4 extends Wt{initializeProgram(e){return new Gt(e.rctx,B4.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:this.configuration.mode===$a.Full?fc(he.ONE,he.ZERO):os(he.ZERO,he.ONE,he.ONE,he.ZERO),depthTest:{func:Ts.ALWAYS},colorWrite:ut})}};qE.shader=new jt(uX,()=>Y(()=>import("./NoiseTextureAtlas.glsl-3ef40406.js"),["./NoiseTextureAtlas.glsl-3ef40406.js","./vec2f64-70cfd09e.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let w_=class extends ge{constructor(e){super(e),this._needsRender=!0,this._passParameters=new V4,this._frameBuffer=new Ur(e.context.renderContext.rctx,{colorTarget:Wr.TEXTURE,width:qo,height:qo},{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR,hasMipmap:!1,width:qo,height:qo}),this._vao=Dn(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return _(this._texture)?_(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render($a.WeatherMap)):_(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render($a.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(as(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=gr(this._fullTechniqueCached),this._weatherMapTechniqueCached=gr(this._weatherMapTechniqueCached),this._frameBuffer=Le(this._frameBuffer),this._vao=Le(this._vao)}get _fullTechnique(){if(T(this._fullTechniqueCached)){const e=new HE;e.mode=$a.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(qE,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(T(this._weatherMapTechniqueCached)){const e=new HE;e.mode=$a.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(qE,e)}return this._weatherMapTechniqueCached}_render(e){if(T(this._vao)||T(this._frameBuffer))return null;const t=e===$a.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,qo,qo),r.bindFramebuffer(this._frameBuffer);const n=r.bindTechnique(t,this._passParameters,null);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};d([p({constructOnly:!0})],w_.prototype,"context",void 0),d([p({readOnly:!0})],w_.prototype,"_techniqueRepository",null),w_=d([k("esri.views.3d.environment.NoiseTextureAtlas")],w_);function pX(i,e,t){return 2*Math.atan(Math.sqrt(e*e+t*t)*Math.tan(.5*i)/e)}function mX(i,e,t){return 2*Math.atan(Math.sqrt(e*e+t*t)*Math.tan(.5*i)/t)}function fX(i,e,t){return 2*Math.atan(e*Math.tan(.5*i)/Math.sqrt(e*e+t*t))}function gX(i,e,t){return 2*Math.atan(t*Math.tan(.5*i)/Math.sqrt(e*e+t*t))}var WE;let ze=WE=class extends ge{constructor(i={}){super(i),this._center=E(),this._up=E(),this._viewUp=E(),this._viewForward=E(),this._viewRight=E(),this._ray=ea(),this._viewport=Ai(0,0,1,1),this._padding=Ai(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ti(1,1e3),this._viewDirty=!0,this._viewMatrix=ve(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ve(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ve(),this._frustumDirty=!0,this._frustum=xy(),this._fullViewport=Xt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(i){this._pixelRatio=i>0?i:1}get eye(){return this._ray.origin}set eye(i){this._compareAndSetView(i,this._ray.origin)}get center(){return this._center}set center(i){this._compareAndSetView(i,this._center,"_center")}get ray(){return ee(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(i){this._compareAndSetView(i,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(i){bs(this._viewMatrix,i),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(i){this._nearFar[0]!==i&&(this._nearFar[0]=i,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(i){this._nearFar[1]!==i&&(this._nearFar[1]=i,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(i){this.x=i[0],this.y=i[1],this.width=i[2],this.height=i[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const i=uw(Xt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&lz(i,e)?e:i}get x(){return this._viewport[0]}set x(i){i+=this._padding[ht.LEFT],this._viewport[0]!==i&&(this._viewport[0]=i,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(i){i+=this._padding[ht.BOTTOM],this._viewport[1]!==i&&(this._viewport[1]=i,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(i){this._viewport[2]!==i&&(this._viewport[2]=i,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(i){this._viewport[3]!==i&&(this._viewport[3]=i,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[ht.RIGHT]+this._padding[ht.LEFT]}set fullWidth(i){this.width=i-(this._padding[ht.RIGHT]+this._padding[ht.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[ht.TOP]+this._padding[ht.BOTTOM]}set fullHeight(i){this.height=i-(this._padding[ht.TOP]+this._padding[ht.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[ht.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[ht.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(i){s1(this._padding,i)||(this._viewport[0]+=i[ht.LEFT]-this._padding[ht.LEFT],this._viewport[1]+=i[ht.BOTTOM]-this._padding[ht.BOTTOM],this._viewport[2]-=i[ht.RIGHT]+i[ht.LEFT]-(this._padding[ht.RIGHT]+this._padding[ht.LEFT]),this._viewport[3]-=i[ht.TOP]+i[ht.BOTTOM]-(this._padding[ht.TOP]+this._padding[ht.BOTTOM]),Sd(this._padding,i),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Sr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const i=this.width,e=this.height,t=this.near*Math.tan(this.fovY/2),r=t*this._aspect,s=IB(ve(),-r*(1+2*this._padding[ht.LEFT]/i),r*(1+2*this._padding[ht.RIGHT]/i),-t*(1+2*this._padding[ht.BOTTOM]/e),t*(1+2*this._padding[ht.TOP]/e),this.near,this.far),n=this._get("projectionMatrix");return n&&j$(n,s)?n:s}get inverseProjectionMatrix(){return aa(ve(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ve()}get fov(){return this._fov}set fov(i){this._fov=i,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return fX(this._fov,this.width,this.height)}set fovX(i){this._fov=pX(i,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return gX(this._fov,this.width,this.height)}set fovY(i){this._fov=mX(i,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Ni(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(aa(this._viewInverseTransposeMatrix,this.viewMatrix),v2(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(i){const e=2*i-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(i){X(this._ray.origin,i.eye),this.center=i.center,this.up=i.up,Sd(this._viewport,i.viewport),this.notifyChange("_viewport"),Sd(this._padding,i.padding),this.notifyChange("_padding"),as(this._nearFar,i.nearFar),this.notifyChange("_nearFar"),this._fov=i.fov,this.relativeElevation=i.relativeElevation;const e=i;return this._viewDirty=e._viewDirty,this._viewDirty||(bs(this._viewMatrix,i.viewMatrix),X(this._viewRight,i.viewRight),X(this._viewUp,i.viewUp),X(this._viewForward,i.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(ob(this._frustum,i.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(bs(this._viewInverseTransposeMatrix,i.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Sd(this._fullViewport,i.fullViewport),this.pixelRatio=i.pixelRatio,this}copyViewFrom(i){this.eye=i.eye,this.center=i.center,this.up=i.up}clone(){return new WE().copyFrom(this)}equals(i){return po(this.eye,i.eye)&&po(this.center,i.center)&&po(this.up,i.up)&&s1(this._viewport,i.viewport)&&s1(this._padding,i.padding)&&sz(this.nearFar,i.nearFar)&&this._fov===i.fov&&this.pixelRatio===i.pixelRatio&&this.relativeElevation===i.relativeElevation}almostEquals(i){if(Math.abs(i.fov-this._fov)>=.001||wP(i.padding,this._padding)>=.5||wP(this.screenViewport,i.screenViewport)>=.5)return!1;gs(Ss,i.eye,i.center),gs(Yx,this.eye,this.center);const e=oe(Ss,Yx),t=nP(Ss),r=nP(Yx),s=5e-4;return e*e>=(1-1e-10)*t*r&&$$(i.eye,this.eye)<Math.max(t,r)*s*s}computeRenderPixelSizeAt(i){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(i))}computeRenderPixelSizeAtDist(i){return i*this.perRenderPixelRatio}computeScreenPixelSizeAt(i){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(i))}_viewDirectionDistance(i){return Math.abs(z_(this.viewForward,ee(Ss,i,this.eye)))}computeScreenPixelSizeAtDist(i){return i*this.perScreenPixelRatio}computeDistanceFromRadius(i,e){return i/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(i=Fi()){return i[0]=(this.padding[ht.LEFT]+this.width/2)/this.pixelRatio,i[1]=(this.padding[ht.TOP]+this.height/2)/this.pixelRatio,i}getRenderCenter(i,e=.5,t=.5){return i[0]=this.padding[ht.LEFT]+this.width*e,i[1]=this.padding[ht.BOTTOM]+this.height*t,i[2]=.5,i}setGLViewport(i){const e=this.viewport,t=this.padding;i.setViewport(e[0]-t[3],e[1]-t[2],e[2]+t[1]+t[3],e[3]+t[0]+t[2])}applyProjection(i,e){i!==ct&&X(ct,i),ct[3]=1,Jc(ct,ct,this.projectionMatrix);const t=Math.abs(ct[3]);W(ct,ct,1/t);const r=this.fullViewport;e[0]=dt(0,r[0]+r[2],.5+.5*ct[0]),e[1]=dt(0,r[1]+r[3],.5+.5*ct[1]),e[2]=.5*(ct[2]+1),e[3]=t}unapplyProjection(i,e){const t=this.fullViewport;ct[0]=(i[0]/(t[0]+t[2])*2-1)*i[3],ct[1]=(i[1]/(t[1]+t[3])*2-1)*i[3],ct[2]=(2*i[2]-1)*i[3],ct[3]=i[3],this.inverseProjectionMatrix!=null&&(Jc(ct,ct,this.inverseProjectionMatrix),e[0]=ct[0],e[1]=ct[1],e[2]=ct[2])}projectToScreen(i,e){return this.projectToRenderScreen(i,Qx),this.renderToScreen(Qx,e),e}projectToRenderScreen(i,e){if(ct[0]=i[0],ct[1]=i[1],ct[2]=i[2],ct[3]=1,Jc(ct,ct,this.viewProjectionMatrix),ct[3]===0)return null;W(ct,ct,1/Math.abs(ct[3]));const t=this.fullViewport;return"x"in e?(e.x=dt(0,t[0]+t[2],.5+.5*ct[0]),e.y=dt(0,t[1]+t[3],.5+.5*ct[1])):(e[0]=dt(0,t[0]+t[2],.5+.5*ct[0]),e[1]=dt(0,t[1]+t[3],.5+.5*ct[1]),e.length>2&&(e[2]=.5*(ct[2]+1))),e}unprojectFromScreen(i,e){return this.unprojectFromRenderScreen(this.screenToRender(i,Qx),e)}unprojectFromRenderScreen(i,e){if(Sr(L0,this.projectionMatrix,this.viewMatrix),!aa(L0,L0))return null;const t=this.fullViewport;return ct[0]=2*(i[0]-t[0])/t[2]-1,ct[1]=2*(i[1]-t[1])/t[3]-1,ct[2]=2*i[2]-1,ct[3]=1,Jc(ct,ct,L0),ct[3]===0?null:(e[0]=ct[0]/ct[3],e[1]=ct[1]/ct[3],e[2]=ct[2]/ct[3],e)}constrainWindowSize(i,e,t,r){const s=i*this.pixelRatio,n=e*this.pixelRatio,a=Math.max(s-t/2,0),o=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-t/2,0),c=-Math.min(this.fullHeight-n-r/2,0);return[a,o,t-l- -Math.min(this.fullWidth-s-t/2,0),r-c- -Math.min(n-r/2,0)]}computeUp(i){i===Se.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(i,e){const t=i[0]*this.pixelRatio,r=this.fullHeight-i[1]*this.pixelRatio;return e[0]=t,e[1]=r,e}renderToScreen(i,e){const t=i[0]/this.pixelRatio,r=(this.fullHeight-i[1])/this.pixelRatio;e[0]=t,e[1]=r}_computeUpGlobal(){ee(Ss,this.center,this.eye);const i=xe(this.center);i<1?(Z(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(oe(Ss,this.center))>.9999*xe(Ss)*i||(Xe(this._up,Ss,this.center),Xe(this._up,this._up,Ss),K(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Rp(Ss,this.eye,this.center),Math.abs(Ss[2])<=.9999&&(W(Ss,Ss,Ss[2]),Z(this._up,-Ss[0],-Ss[1],1-Ss[2]),K(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(i,e,t=""){typeof i[0]=="number"&&isFinite(i[0])&&typeof i[1]=="number"&&isFinite(i[1])&&typeof i[2]=="number"&&isFinite(i[2])?po(i,e)||(X(e,i),this._markViewDirty(),t.length&&this.notifyChange(t)):pe.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(XF(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(b2(this._viewMatrix,this.eye,this.center,this.up),Z(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Z(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Z(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([p()],ze.prototype,"_center",void 0),d([p()],ze.prototype,"_up",void 0),d([p()],ze.prototype,"_viewport",void 0),d([p()],ze.prototype,"_padding",void 0),d([p()],ze.prototype,"_fov",void 0),d([p()],ze.prototype,"_nearFar",void 0),d([p()],ze.prototype,"_pixelRatio",void 0),d([p()],ze.prototype,"pixelRatio",null),d([p()],ze.prototype,"eye",null),d([p()],ze.prototype,"center",null),d([p()],ze.prototype,"up",null),d([p({readOnly:!0})],ze.prototype,"nearFar",null),d([p()],ze.prototype,"near",null),d([p()],ze.prototype,"far",null),d([p()],ze.prototype,"viewport",null),d([p({readOnly:!0})],ze.prototype,"screenViewport",null),d([p()],ze.prototype,"x",null),d([p()],ze.prototype,"y",null),d([p()],ze.prototype,"width",null),d([p()],ze.prototype,"height",null),d([p()],ze.prototype,"fullWidth",null),d([p()],ze.prototype,"fullHeight",null),d([p({readOnly:!0})],ze.prototype,"_aspect",null),d([p()],ze.prototype,"padding",null),d([p({readOnly:!0})],ze.prototype,"projectionMatrix",null),d([p({readOnly:!0})],ze.prototype,"inverseProjectionMatrix",null),d([p()],ze.prototype,"fov",null),d([p()],ze.prototype,"fovX",null),d([p()],ze.prototype,"fovY",null),ze=WE=d([k("esri.views.3d.webgl-engine.lib.Camera")],ze);const ct=Xt(),L0=ve(),Ss=E(),Yx=E(),Qx=_s();var ht;(function(i){i[i.TOP=0]="TOP",i[i.RIGHT=1]="RIGHT",i[i.BOTTOM=2]="BOTTOM",i[i.LEFT=3]="LEFT"})(ht||(ht={}));let Aw=class{constructor(e,t,r){this.shadowMap=e,this.ssaoHelper=t,this.slicePlane=r,this.slot=ne.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=It.NONE,this._camera=new ze,this._inverseViewport=Ne(),this.oldLighting=new mx,this.newLighting=new mx,this._fadedLighting=new mx,this._lighting=this.newLighting,this.ssr=new yz,this.multipassTerrain=new tk,this.multipassGeometry=new Jz,this.overlays=[],this.cloudsFade=new vz}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(t,r,e),this._lighting=this._fadedLighting)}},fn=class extends ge{constructor(e){super(e),this._handles=new mi,this._techniques=new Array,this._techniqueConfiguration=new b1,this._bindParameters=new Aw(null,null,null),this._passParameters=new $4,this._drawParameters=new F4,this._weatherTile=Ne(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=dt(Os.default.coverage[0],Os.default.coverage[1],.5),this.density=dt(Os.default.density[0],Os.default.density[1],.5),this.absorption=dt(Os.default.absorption[0],Os.default.absorption[1],.5),this.cloudSize=dt(Os.default.cloudSize[0],Os.default.cloudSize[1],.5),this.detailSize=dt(Os.default.detailSize[0],Os.default.detailSize[1],.5),this.smoothness=dt(Os.default.smoothness[0],Os.default.smoothness[1],.5),this.cloudHeight=dt(Os.default.cloudHeight[0],Os.default.cloudHeight[1],.5),this.raymarchingSteps=Os.default.raymarchingSteps,this._viewMatrix=ve(),this._dirty=!1,this.running=!1}_getTechnique(e){const t=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=t===M2.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=t,this._techniqueConfiguration.steps=e,this._techniques[r]=new N4({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;if(e==null||t==null)return;pi(this._weatherTile,(e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(_(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&_(this.view.environment.lighting.date)){const a=new Date(this.view.environment.lighting.date);a.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*a.getUTCMonth()+a.getUTCDate(),n=a.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),nz(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=Dn(this.context.renderContext.rctx);const e=qt(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(rr.CLOUDS_GENERATOR,this),z(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Je)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>gr(e)),this._frameBufferCube=Le(this._frameBufferCube),this._techniques.length=0,this._vao=Le(this._vao),this._passParameters.noiseTexture=we(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case An.SIXTEEN:return 1;case An.HUNDRED:return 4;case An.COUNT:case An.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(_(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new w_({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return _(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(T(this._frameBufferCube)){const t={target:Qt.TEXTURE_CUBE_MAP,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new Ur(this.context.renderContext.rctx,{colorTarget:Wr.CUBEMAP,width:e,height:e},t)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Le(this._frameBufferCube)}applyPreset(e,t){const r=e.median,s=n=>{const a=dt(n[0],n[1],r);return t<.5?dt(n[0],a,2*t):dt(a,n[1],2*(t-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(T(this._vao))return this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=$r.FINISHED_RENDERING,void e.madeProgress();this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),as(this._passParameters.weatherTile,this._weatherTile));const t=this._getTechnique(this._passParameters.raymarchingSteps);if(!t.compiled)return Mn.YIELD;if(!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Mn.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=$r.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,s=r.bindTechnique(t,this._passParameters,this._bindParameters);r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const n=r.getViewport(),a=t.configuration.cubeMapSize,o=a/this._tilesPerFace,l=this._tileIndex*o;r.setViewport(0,l,a,o);const c=this._ensureFrameBufferCube(a);r.bindFramebuffer(c);const h=_X[this._faceIndex],u=yX[this._faceIndex];DB(this._viewMatrix,vX,h,u),hh(this._drawParameters.viewMatrix,this._viewMatrix);const m=Qt.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(m),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(n.x,n.y,n.width,n.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=$r.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Mn.YIELD}};d([p({constructOnly:!0})],fn.prototype,"context",void 0),d([p({constructOnly:!0})],fn.prototype,"view",void 0),d([p({constructOnly:!0})],fn.prototype,"requestRender",void 0),d([p()],fn.prototype,"coverage",void 0),d([p()],fn.prototype,"density",void 0),d([p()],fn.prototype,"absorption",void 0),d([p()],fn.prototype,"cloudSize",void 0),d([p()],fn.prototype,"detailSize",void 0),d([p()],fn.prototype,"smoothness",void 0),d([p()],fn.prototype,"cloudHeight",void 0),d([p()],fn.prototype,"raymarchingSteps",void 0),d([p()],fn.prototype,"running",void 0),fn=d([k("esri.views.3d.environment.CloudsGenerator")],fn);const _X=[oi(1,0,0),oi(-1,0,0),oi(0,1,0),oi(0,-1,0),oi(0,0,1)],yX=[oi(0,1,0),oi(0,1,0),oi(0,0,-1),oi(0,0,1),oi(0,1,0)],vX=Yz();let vR=class extends ur{constructor(){super(...arguments),this.fogColor=E(),this.hazeColor=E(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1,this.fogAmount=0,this.hazeAmount=0}};function bX(i){const e=new Hi;e.attributes.add(C.POSITION,"vec2"),e.include(pw,{textureCoordinateType:zd.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add([new tn("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new tn("inverseViewMatrix",(s,n)=>n0(wX,n.camera.viewMatrix))]),t.code.add(R`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new yt("atmosphereC",s=>s.atmosphereC)),r.uniforms.add(new Fs("cameraPosition",(s,n)=>n.camera.eye)),r.uniforms.add(new en("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new Bt("depthTex",s=>s.depthTexture)),r.uniforms.add(new yt("fogStrength",s=>i.haze?s.hazeStrength:s.fogStrength)),r.uniforms.add(new yt("fogAmount",s=>i.haze?s.hazeAmount:s.fogAmount)),r.uniforms.add(new Fs("fogColor",s=>i.haze?s.hazeColor:s.fogColor)),e.include(O2),r.include(mp),r.code.add(R`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(R`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(R`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${i.haze?R`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),e}const wX=ve(),z4=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:vR,build:bX},Symbol.toStringTag,{value:"Module"}));let k4=class G4 extends Wt{initializeProgram(e){return new Gt(e.rctx,G4.shader.get().build(this.configuration),Zt)}initializePipeline(){return this.configuration.haze?it({blending:os(he.ONE,he.ZERO,he.ONE_MINUS_SRC_COLOR,he.ONE),colorWrite:ut}):it({blending:os(he.SRC_ALPHA,he.ZERO,he.ONE_MINUS_SRC_ALPHA,he.ONE),colorWrite:ut})}};k4.shader=new jt(z4,()=>Y(()=>import("./FogHaze.glsl-0f5a3ae3.js"),["./FogHaze.glsl-0f5a3ae3.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./FloatPassUniform-0426669b.js","./vec4-c7a19f0d.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./vec3f32-01c06d8d.js","./compilerUtils-7bf6df9e.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let bR=class extends Ln{constructor(){super(...arguments),this.haze=!1}};d([L()],bR.prototype,"haze",void 0);const xX=.95,TX=1;let x_=class extends ge{constructor(e){super(e),this._passParameters=new vR;const t=e.context.renderContext.rctx;this._vao=Dn(t,c0),this._technique=e.context.techniqueRepository.acquire(k4,new bR);const r=qt(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+Iy}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,t){if(this._update(e,t),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(n,e)})}_renderFog(e,t){const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(bt.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;K(iM,r.eye);const s=Math.max(0,oe(iM,e.bindParameters.lighting.mainLight.direction)),n=t.color;W(rM,n,.1),ns(this._passParameters.fogColor,rM,n,s);const a=xe(r.eye),o=a*a;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-zf(xX*ao,TX*ao,Math.abs(a-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};d([p({constructOnly:!0})],x_.prototype,"context",void 0),d([p({constructOnly:!0})],x_.prototype,"view",void 0),x_=d([k("esri.views.3d.environment.Fog")],x_);let CX=class{constructor(){this.color=E(),this.strength=0,this.amount=0}};const iM=E(),rM=E();var pc;(function(i){i[i.Cone=0]="Cone",i[i.Cylinder=1]="Cylinder",i[i.Underground=2]="Underground",i[i.COUNT=3]="COUNT"})(pc||(pc={}));let wR=class extends gc{constructor(){super(...arguments),this.geometry=pc.Cone}};d([L({count:pc.COUNT})],wR.prototype,"geometry",void 0);let xR=class extends ur{constructor(){super(...arguments),this.texV=Ne(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new H4}},H4=class{constructor(){this.center=E(),this.v1=E(),this.v2=E()}};function EX(i){const e=new Hi,{vertex:t,fragment:r}=e;if(mw(t),i.geometry===pc.Underground)e.attributes.add(C.POSITION,"vec2"),e.varyings.add("color","vec4"),t.uniforms.add([new Fs("cameraPosition",(s,n)=>n.camera.eye),new yt("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)]),t.code.add(R`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(R`void main() {
gl_FragColor = color;
}`);else{e.include(i5,i),e.attributes.add(C.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=i.geometry===pc.Cylinder;t.uniforms.add([new tn("proj",(o,l)=>l.camera.projectionMatrix),new tn("view",(o,l)=>l.camera.viewMatrix)]),s||(e.varyings.add("innerFactor","float"),t.uniforms.add(new Fs("silCircleCenter",o=>o.silhouette.center)),t.uniforms.add(new Fs("silCircleV1",o=>o.silhouette.v1)),t.uniforms.add(new Fs("silCircleV2",o=>o.silhouette.v2)),t.uniforms.add(new en("texV",o=>o.texV)),t.uniforms.add(new yt("innerScale",o=>o.innerScale)));const n=6.2831853,a=1/128;t.code.add(R`
		void main(void) {
      ${s?R`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:R`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${R.float(n*a)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${R.float(a)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new Bt("tex",o=>o.texture)),s||r.uniforms.add(new yt("altitudeFade",o=>o.altitudeFade)),r.code.add(R`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?R`gl_FragColor = atmosphereColor;`:R`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const SX=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:H4,SimpleAtmospherePassParameters:xR,build:EX},Symbol.toStringTag,{value:"Module"}));let bb=class q4 extends Wt{initializeProgram(e){return new Gt(e.rctx,q4.shader.get().build(this.configuration),Zt)}initializePipeline(){return this.configuration.geometry===pc.Cylinder?it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),culling:CF,depthTest:{func:Ts.LEQUAL},colorWrite:ut}):it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ts.LEQUAL},colorWrite:ut})}};bb.shader=new jt(SX,()=>Y(()=>import("./SimpleAtmosphere.glsl-f60d34f9.js"),["./SimpleAtmosphere.glsl-f60d34f9.js","./vec2f64-70cfd09e.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const W4=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);var jE;(function(i){function e(a,o){const l=a[o],c=a[o+1],h=a[o+2];return Math.sqrt(l*l+c*c+h*h)}function t(a,o){const l=a[o],c=a[o+1],h=a[o+2],u=1/Math.sqrt(l*l+c*c+h*h);a[o]*=u,a[o+1]*=u,a[o+2]*=u}function r(a,o,l){a[o]*=l,a[o+1]*=l,a[o+2]*=l}function s(a,o,l,c,h,u=o){(h=h||a)[u]=a[o]+l[c],h[u+1]=a[o+1]+l[c+1],h[u+2]=a[o+2]+l[c+2]}function n(a,o,l,c,h,u=o){(h=h||a)[u]=a[o]-l[c],h[u+1]=a[o+1]-l[c+1],h[u+2]=a[o+2]-l[c+2]}i.length=e,i.normalize=t,i.scale=r,i.add=s,i.subtract=n})(jE||(jE={}));function ir(i,e=!1){return i<=C$?e?new Array(i).fill(0):new Array(i):new Float32Array(i)}function sM(i){return length<=C$?Array.from(i):new Float32Array(i)}function nM(i,e,t){return Array.isArray(i)?i.slice(e,e+t):i.subarray(e,e+t)}const tm=jE,Zx=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],RX=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],AX=[0,0,1,0,1,1,0,1],PX=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],j4=new Array(36);for(let i=0;i<6;i++)for(let e=0;e<6;e++)j4[6*i+e]=i;const Du=new Array(36);for(let i=0;i<6;i++)Du[6*i+0]=0,Du[6*i+1]=1,Du[6*i+2]=2,Du[6*i+3]=2,Du[6*i+4]=3,Du[6*i+5]=0;function OX(i,e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=Zx[r][0]*e[0],t[3*r+1]=Zx[r][1]*e[1],t[3*r+2]=Zx[r][2]*e[2];return new Vr(i,[[C.POSITION,new Ae(t,3,!0)],[C.NORMAL,new Ae(RX,3)],[C.UV0,new Ae(AX,2)]],[[C.POSITION,PX],[C.NORMAL,j4],[C.UV0,Du]])}const Kx=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],MX=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],IX=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],DX=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function LX(i,e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=Kx[r][0]*e[0],t[3*r+1]=Kx[r][1]*e[1],t[3*r+2]=Kx[r][2]*e[2];return new Vr(i,[[C.POSITION,new Ae(t,3,!0)],[C.NORMAL,new Ae(MX,3)]],[[C.POSITION,IX],[C.NORMAL,DX]])}const w1=oi(-.5,0,-.5),x1=oi(.5,0,-.5),T1=oi(0,0,.5),C1=oi(0,.5,0),im=Zi(),rm=Zi(),Of=Zi(),Mf=Zi(),If=Zi();ee(im,w1,C1),ee(rm,w1,x1),Xe(Of,im,rm),K(Of,Of),ee(im,x1,C1),ee(rm,x1,T1),Xe(Mf,im,rm),K(Mf,Mf),ee(im,T1,C1),ee(rm,T1,w1),Xe(If,im,rm),K(If,If);const Jx=[w1,x1,T1,C1],$X=[0,-1,0,Of[0],Of[1],Of[2],Mf[0],Mf[1],Mf[2],If[0],If[1],If[2]],FX=[0,1,2,3,1,0,3,2,1,3,0,2],NX=[0,0,0,1,1,1,2,2,2,3,3,3];function UX(i,e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let r=0;r<4;r++)t[3*r]=Jx[r][0]*e[0],t[3*r+1]=Jx[r][1]*e[1],t[3*r+2]=Jx[r][2]*e[2];return new Vr(i,[[C.POSITION,new Ae(t,3,!0)],[C.NORMAL,new Ae($X,3)]],[[C.POSITION,FX],[C.NORMAL,NX]])}function vve(i,e,t,r,s={uv:!0}){const n=-Math.PI,a=2*Math.PI,o=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(t)),h=Math.max(2,Math.floor(r)),u=(c+1)*(h+1),m=ir(3*u),f=ir(3*u),y=ir(2*u),g=[];let v=0;for(let S=0;S<=h;S++){const P=[],A=S/h,M=o+A*l,O=Math.cos(M);for(let I=0;I<=c;I++){const N=I/c,F=n+N*a,V=Math.cos(F)*O,Q=Math.sin(M),ae=-Math.sin(F)*O;m[3*v]=V*e,m[3*v+1]=Q*e,m[3*v+2]=ae*e,f[3*v]=V,f[3*v+1]=Q,f[3*v+2]=ae,y[2*v]=N,y[2*v+1]=A,P.push(v),++v}g.push(P)}const b=new Array;for(let S=0;S<h;S++)for(let P=0;P<c;P++){const A=g[S][P],M=g[S][P+1],O=g[S+1][P+1],I=g[S+1][P];S===0?(b.push(A),b.push(O),b.push(I)):S===h-1?(b.push(A),b.push(M),b.push(O)):(b.push(A),b.push(M),b.push(O),b.push(O),b.push(I),b.push(A))}const x=[[C.POSITION,b],[C.NORMAL,b]],w=[[C.POSITION,new Ae(m,3,!0)],[C.NORMAL,new Ae(f,3,!0)]];return s.uv&&(w.push([C.UV0,new Ae(y,2,!0)]),x.push([C.UV0,b])),s.offset&&(x[0][0]=C.OFFSET,w[0][0]=C.OFFSET,x.push([C.POSITION,new Array(b.length).fill(0)]),w.push([C.POSITION,new Ae(Float64Array.from(s.offset),3,!0)])),new Vr(i,w,x)}function VX(i,e,t,r){const{vertexAttributes:s,indices:n}=X4(e,t,r);return new Vr(i,s,n)}function X4(i,e,t){const r=i;let s,n;if(t)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const h=r*(1+Math.sqrt(5))/2;s=[-r,h,0,r,h,0,-r,-h,0,r,-h,0,0,-r,h,0,r,h,0,-r,-h,0,r,-h,h,0,-r,h,0,r,-h,0,-r,-h,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let h=0;h<s.length;h+=3)tm.scale(s,h,i/tm.length(s,h));let a={};function o(h,u){h>u&&([h,u]=[u,h]);const m=h.toString()+"."+u.toString();if(a[m])return a[m];let f=s.length;return s.length+=3,tm.add(s,3*h,s,3*u,s,f),tm.scale(s,f,i/tm.length(s,f)),f/=3,a[m]=f,f}for(let h=0;h<e;h++){const u=n.length,m=new Array(4*u);for(let f=0;f<u;f+=3){const y=n[f],g=n[f+1],v=n[f+2],b=o(y,g),x=o(g,v),w=o(v,y),S=4*f;m[S]=y,m[S+1]=b,m[S+2]=w,m[S+3]=g,m[S+4]=x,m[S+5]=b,m[S+6]=v,m[S+7]=w,m[S+8]=x,m[S+9]=b,m[S+10]=x,m[S+11]=w}n=m,a={}}const l=sM(s);for(let h=0;h<l.length;h+=3)tm.normalize(l,h);const c=[[C.POSITION,n],[C.NORMAL,n]];return{vertexAttributes:[[C.POSITION,new Ae(sM(s),3,!0)],[C.NORMAL,new Ae(l,3,!0)]],indices:c}}function XE(i,e,t,r,s,n,a,o,l=null){const c=t?[t[0],t[1],t[2]]:[0,0,0],h=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];const u=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],m=_(s)&&s.length===2?s:[1,1],f=[[C.POSITION,new Ae(c,3,!0)],[C.NORMAL,new Ae(h,3,!0)],[C.UV0,new Ae(a,a.length)],[C.COLOR,new Ae(u,4,!0)],[C.SIZE,new Ae(m,2)]];if(n!=null){const y=[n[0],n[1],n[2],n[3]];f.push([C.AUXPOS1,new Ae(y,4)])}if(o!=null){const y=[o[0],o[1],o[2],o[3]];f.push([C.AUXPOS2,new Ae(y,4)])}return new Vr(i,f,null,null,Ns.Point,l)}const BX=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function bve(i,e=BX){const t=new Array(12);for(let h=0;h<4;h++)for(let u=0;u<3;u++)t[3*h+u]=e[h][u];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],a=[0,0,1,0,1,1,0,1],o=[255,255,255,255],l=[[C.POSITION,r],[C.NORMAL,n],[C.UV0,r],[C.COLOR,n]],c=[[C.POSITION,new Ae(t,3,!0)],[C.NORMAL,new Ae(s,3,!0)],[C.UV0,new Ae(a,2,!0)],[C.COLOR,new Ae(o,4,!0)]];return new Vr(i,c,l)}function aM(i,e,t,r,s,n=!0,a=!0){let o=0;const l=t,c=e;let h=oi(0,o,0),u=oi(0,o+c,0),m=oi(0,-1,0),f=oi(0,1,0);s&&(o=c,u=oi(0,0,0),h=oi(0,o,0),m=oi(0,1,0),f=oi(0,-1,0));const y=[u,h],g=[m,f],v=r+2,b=Math.sqrt(c*c+l*l);if(s)for(let O=r-1;O>=0;O--){const I=O*(2*Math.PI/r),N=oi(Math.cos(I)*l,o,Math.sin(I)*l);y.push(N);const F=oi(c*Math.cos(I)/b,-l/b,c*Math.sin(I)/b);g.push(F)}else for(let O=0;O<r;O++){const I=O*(2*Math.PI/r),N=oi(Math.cos(I)*l,o,Math.sin(I)*l);y.push(N);const F=oi(c*Math.cos(I)/b,l/b,c*Math.sin(I)/b);g.push(F)}const x=new Array,w=new Array;if(n){for(let O=3;O<y.length;O++)x.push(1),x.push(O-1),x.push(O),w.push(0),w.push(0),w.push(0);x.push(y.length-1),x.push(2),x.push(1),w.push(0),w.push(0),w.push(0)}if(a){for(let O=3;O<y.length;O++)x.push(O),x.push(O-1),x.push(0),w.push(O),w.push(O-1),w.push(1);x.push(0),x.push(2),x.push(y.length-1),w.push(1),w.push(2),w.push(g.length-1)}const S=ir(3*v);for(let O=0;O<v;O++)S[3*O]=y[O][0],S[3*O+1]=y[O][1],S[3*O+2]=y[O][2];const P=ir(3*v);for(let O=0;O<v;O++)P[3*O]=g[O][0],P[3*O+1]=g[O][1],P[3*O+2]=g[O][2];const A=[[C.POSITION,x],[C.NORMAL,w]],M=[[C.POSITION,new Ae(S,3,!0)],[C.NORMAL,new Ae(P,3,!0)]];return new Vr(i,M,A)}function zX(i,e,t,r,s,n,a){const o=s?RP(s):oi(1,0,0),l=n?RP(n):oi(0,0,0);a=a??!0;const c=Zi();K(c,o);const h=Zi();W(h,c,Math.abs(e));const u=Zi();W(u,h,-.5),J(u,u,l);const m=oi(0,1,0);Math.abs(1-oe(c,m))<.2&&Z(m,0,0,1);const f=Zi();Xe(f,c,m),K(f,f),Xe(m,f,c);const y=2*r+(a?2:0),g=r+(a?2:0),v=ir(3*y),b=ir(3*g),x=ir(2*y),w=new Array(3*r*(a?4:2)),S=new Array(3*r*(a?4:2));a&&(v[3*(y-2)+0]=u[0],v[3*(y-2)+1]=u[1],v[3*(y-2)+2]=u[2],x[2*(y-2)]=0,x[2*(y-2)+1]=0,v[3*(y-1)+0]=v[3*(y-2)+0]+h[0],v[3*(y-1)+1]=v[3*(y-2)+1]+h[1],v[3*(y-1)+2]=v[3*(y-2)+2]+h[2],x[2*(y-1)]=1,x[2*(y-1)+1]=1,b[3*(g-2)+0]=-c[0],b[3*(g-2)+1]=-c[1],b[3*(g-2)+2]=-c[2],b[3*(g-1)+0]=c[0],b[3*(g-1)+1]=c[1],b[3*(g-1)+2]=c[2]);const P=(F,V,Q)=>{w[F]=V,S[F]=Q};let A=0;const M=Zi(),O=Zi();for(let F=0;F<r;F++){const V=F*(2*Math.PI/r);W(M,m,Math.sin(V)),W(O,f,Math.cos(V)),J(M,M,O),b[3*F+0]=M[0],b[3*F+1]=M[1],b[3*F+2]=M[2],W(M,M,t),J(M,M,u),v[3*F+0]=M[0],v[3*F+1]=M[1],v[3*F+2]=M[2],x[2*F+0]=F/r,x[2*F+1]=0,v[3*(F+r)+0]=v[3*F+0]+h[0],v[3*(F+r)+1]=v[3*F+1]+h[1],v[3*(F+r)+2]=v[3*F+2]+h[2],x[2*(F+r)+0]=F/r,x[2*F+1]=1;const Q=(F+1)%r;P(A++,F,F),P(A++,F+r,F),P(A++,Q,Q),P(A++,Q,Q),P(A++,F+r,F),P(A++,Q+r,Q)}if(a){for(let F=0;F<r;F++){const V=(F+1)%r;P(A++,y-2,g-2),P(A++,F,g-2),P(A++,V,g-2)}for(let F=0;F<r;F++){const V=(F+1)%r;P(A++,F+r,g-1),P(A++,y-1,g-1),P(A++,V+r,g-1)}}const I=[[C.POSITION,w],[C.NORMAL,S],[C.UV0,w]],N=[[C.POSITION,new Ae(v,3,!0)],[C.NORMAL,new Ae(b,3,!0)],[C.UV0,new Ae(x,2,!0)]];return new Vr(i,N,I)}function wve(i,e,t,r,s,n,a=oi(0,0,0)){const o=e.length,l=ir(t.length*o*3+(6*r.length||0)),c=ir(t.length*o*3+(r?6:0)),h=new Array,u=new Array;let m=0,f=0;const y=Zi(),g=Zi(),v=Zi(),b=Zi(),x=Zi(),w=Zi(),S=Zi(),P=E(),A=Zi(),M=Zi(),O=Zi(),I=Zi(),N=Zi(),F=sr();Z(A,0,1,0),ee(g,t[1],t[0]),K(g,g),n?(J(P,t[0],a),K(v,P)):Z(v,0,0,1),wb(g,v,A,A,x,v,oM),X(b,v),X(I,x);for(let B=0;B<r.length;B++)W(w,x,r[B][0]),W(P,v,r[B][2]),J(w,w,P),J(w,w,t[0]),l[m++]=w[0],l[m++]=w[1],l[m++]=w[2];c[f++]=-g[0],c[f++]=-g[1],c[f++]=-g[2];for(let B=0;B<s.length;B++)h.push(s[B][0]>0?s[B][0]:-s[B][0]-1+r.length),h.push(s[B][1]>0?s[B][1]:-s[B][1]-1+r.length),h.push(s[B][2]>0?s[B][2]:-s[B][2]-1+r.length),u.push(0),u.push(0),u.push(0);let V=r.length;const Q=r.length-1;for(let B=0;B<t.length;B++){let le=!1;B>0&&(X(y,g),B<t.length-1?(ee(g,t[B+1],t[B]),K(g,g)):le=!0,J(M,y,g),K(M,M),J(O,t[B-1],b),lw(t[B],M,F),Ap(F,al(O,y),P)?(ee(P,P,t[B]),K(v,P),Xe(x,M,v),K(x,x)):wb(M,b,I,A,x,v,oM),X(b,v),X(I,x)),n&&(J(P,t[B],a),K(N,P));for(let ce=0;ce<o;ce++)if(W(w,x,e[ce][0]),W(P,v,e[ce][1]),J(w,w,P),K(S,w),c[f++]=S[0],c[f++]=S[1],c[f++]=S[2],J(w,w,t[B]),l[m++]=w[0],l[m++]=w[1],l[m++]=w[2],!le){const _e=(ce+1)%o;h.push(V+ce),h.push(V+o+ce),h.push(V+_e),h.push(V+_e),h.push(V+o+ce),h.push(V+o+_e);for(let j=0;j<6;j++){const de=h.length-6;u.push(h[de+j]-Q)}}V+=o}const ae=t[t.length-1];for(let B=0;B<r.length;B++)W(w,x,r[B][0]),W(P,v,r[B][1]),J(w,w,P),J(w,w,ae),l[m++]=w[0],l[m++]=w[1],l[m++]=w[2];const q=f/3;c[f++]=g[0],c[f++]=g[1],c[f++]=g[2];const D=V-o;for(let B=0;B<s.length;B++)h.push(s[B][0]>=0?V+s[B][0]:-s[B][0]-1+D),h.push(s[B][2]>=0?V+s[B][2]:-s[B][2]-1+D),h.push(s[B][1]>=0?V+s[B][1]:-s[B][1]-1+D),u.push(q),u.push(q),u.push(q);const H=[[C.POSITION,h],[C.NORMAL,u]],G=[[C.POSITION,new Ae(l,3,!0)],[C.NORMAL,new Ae(c,3,!0)]];return new Vr(i,G,H)}function xve(i,e,t,r){_t(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),_t(e[0].length===3,"createPolylineGeometry(): malformed vertex"),_t(t==null||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),_t(t==null||t[0].length===3,"createPolylineGeometry(): malformed normal");const s=vo(3*e.length),n=new Array(2*(e.length-1));let a=0,o=0;for(let h=0;h<e.length;h++){for(let u=0;u<3;u++)s[a++]=e[h][u];h>0&&(n[o++]=h-1,n[o++]=h)}const l=[],c=[];if(l.push([C.POSITION,n]),c.push([C.POSITION,new Ae(s,3,!0)]),t){const h=ir(3*t.length);let u=0;for(let m=0;m<e.length;m++)for(let f=0;f<3;f++)h[u++]=t[m][f];l.push([C.NORMAL,n]),c.push([C.NORMAL,new Ae(h,3,!0)])}return r&&(c.push([C.COLOR,new Ae(r,4)]),l.push([C.COLOR,z2(r.length/4)])),new Vr(i,c,l,null,Ns.Line)}function kX(i,e=i){const t=i.vertexAttributes,r=t.get(C.POSITION).data,s=t.get(C.NORMAL).data;if(s){const n=e.getMutableAttribute(C.NORMAL).data;for(let a=0;a<s.length;a+=3){const o=s[a+1];n[a+1]=-s[a+2],n[a+2]=o}}if(r){const n=e.getMutableAttribute(C.POSITION).data;for(let a=0;a<r.length;a+=3){const o=r[a+1];n[a+1]=-r[a+2],n[a+2]=o}}}function eT(i,e,t,r,s){return!(Math.abs(oe(e,i))>s)&&(Xe(t,i,e),K(t,t),Xe(r,t,i),K(r,r),!0)}function wb(i,e,t,r,s,n,a){return eT(i,e,s,n,a)||eT(i,t,s,n,a)||eT(i,r,s,n,a)}const oM=.99619469809;let GX=class{constructor(e,t){this.type=Pr.Panoramic,this._configuration=new wR,this._passParameters=new xR,this._configuration.geometry=pc.Cylinder,this._technique=t.techniqueRepository.acquire(bb,this._configuration);const r=t.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=Qs(this._vao,"geometry"),this._passParameters.texture=new ui(r,{pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR,flipped:!0,width:1,height:512},W4)}destroy(){this._passParameters.texture=Le(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const t=e.rctx,r=t.bindTechnique(this._technique,this._passParameters,e.bindParameters);HX(lM,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",lM),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(bt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const t=X4(1,2,!1),r=t.indices[0][1],s=t.vertexAttributes[0][1];for(let l=0;l<r.length;l+=3){const c=r[l];r[l]=r[l+2],r[l+2]=c}const n=s.data,a=cM.createBuffer(r.length),o=a.position;for(let l=0;l<r.length;++l){const c=3*r[l];o.set(l,0,n[c]),o.set(l,1,n[c+1]),o.set(l,2,n[c+2])}return new fh(e,Zt,{geometry:ul(cM)},{geometry:Yt.createVertex(e,ri.STATIC_DRAW,a.buffer)})}};function HX(i,e){bs(i,e),i[12]=0,i[13]=0,i[14]=0,i[15]=1}const lM=ve(),cM=Rr().vec3f(C.POSITION);var mh;(function(i){i[i.Rain=0]="Rain",i[i.Snow=1]="Snow",i[i.COUNT=2]="COUNT"})(mh||(mh={}));let YE=class extends Ln{constructor(){super(...arguments),this.type=mh.Rain}};d([L({count:mh.COUNT})],YE.prototype,"type",void 0);function qX(i){const e=new Hi;return e.attributes.add(C.POSITION,"vec3"),e.attributes.add(C.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Fs("cameraPosition",(t,r)=>r.camera.eye)),e.vertex.uniforms.add(new Fs("offset",(t,r)=>WX(t,r))),e.vertex.uniforms.add(new yt("width",t=>t.width)),e.vertex.uniforms.add(new tn("proj",(t,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new tn("view",(t,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new yt("time",t=>t.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(R`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${i.type===mh.Rain?R`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:R`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add([new yt("opacity",t=>t.opacity),new Fs("particleColor",(t,r)=>jX(r,i))]),e.fragment.code.add(R`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${i.type===mh.Rain?R`d = 0.35 * smoothstep(0.5, 0.0, d);`:R`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function WX(i,e){const t=e.camera.eye,r=.5*i.width,s=1/i.width,n=nB(QE,Z(QE,(t[0]+r)*s,(t[1]+r)*s,(t[2]+r)*s));return gs(n,t,W(n,n,i.width))}function jX(i,e){const t=e.type===mh.Rain?YX:XX,r=W(QE,t,QX),s=i.camera.eye;K(hM,s);const n=Math.max(0,oe(hM,i.lighting.mainLight.direction));return ns(r,r,t,n)}const QE=E(),hM=E(),XX=qe(1,1,1),YX=qe(.85,.85,.85),QX=.7,ZX=Object.freeze(Object.defineProperty({__proto__:null,build:qX},Symbol.toStringTag,{value:"Module"}));let KX=class extends ur{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},ZE=class Y4 extends Wt{initializeProgram(e){return new Gt(e.rctx,Y4.shader.get().build(this.configuration),E1)}initializePipeline(){return it({blending:os(he.ONE,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ts.LEQUAL},colorWrite:ut})}};ZE.shader=new jt(ZX,()=>Y(()=>import("./Precipitation.glsl-be6cdab8.js"),["./Precipitation.glsl-be6cdab8.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const E1=new Map([[C.POSITION,0],[C.INSTANCEFEATUREATTRIBUTE,1]]);let Lu=class extends ge{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new KX,this._animation=new AF,this._updatingTracking=new og,this._passParameters.time=0,this._passParameters.radius=qt(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=gr(this._snowTechniqueCached),this._rainTechniqueCached=gr(this._rainTechniqueCached),this._vao=Le(this._vao),this._instanceIdBuffer=Le(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(T(this._rainTechniqueCached)){const e=new YE;e.type=mh.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(ZE,e)}return this._rainTechniqueCached}get _snowTechnique(){if(T(this._snowTechniqueCached)){const e=new YE;e.type=mh.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(ZE,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,t,r){var l;const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),T(s)||T(this._vao)||T(this._instanceIdBuffer)||(_(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const a=.35;t=t<.5?dt(0,a,2*t):dt(a,1,2*(t-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*i2(this._animation.time)%1e5;const o=n.bindTechnique(s,this._passParameters,e.bindParameters);n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),PF(n,E1,this._instanceIdBuffer,dM,0),(l=n.capabilities.instancing)==null||l.drawArraysInstanced(bt.TRIANGLES,0,3,this._numParticles*t),OF(n,E1,this._instanceIdBuffer,dM)}_ensureResources(e){T(this._vao)&&(this._vao=this._createVertexArrayObject(e)),T(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return Yt.createVertex(e,ri.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new fh(e,E1,{geometry:ul(JX)},{geometry:Yt.createVertex(e,ri.STATIC_DRAW,t)})}};d([p({constructOnly:!0})],Lu.prototype,"context",void 0),d([p({constructOnly:!0})],Lu.prototype,"view",void 0),d([p({readOnly:!0})],Lu.prototype,"updating",null),d([p()],Lu.prototype,"_updatingTracking",void 0),Lu=d([k("esri.views.3d.environment.Precipitation")],Lu);const JX=Rr().vec3f(C.POSITION),dM=ul(Rr().f32(C.INSTANCEFEATUREATTRIBUTE),1),eY=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),$0=128,uM=-kE,pM=0,tT=50,tY=()=>1-511/512,iY=c1([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let rY=class{constructor(e,t){this.view=e,this.type=Pr.Simple,this._passParameters=new xR,this._vaoCount=0,this._texV1=1,this._isMars=t0(e.spatialReference);const r=qt(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+uM)/this._planetRadius,this._middleRimFactor=(this._planetRadius+pM)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=pM/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=t.techniqueRepository;const s=t.renderContext.rctx;this._cameraChangeHandle=z(()=>{var o;return(o=this.view.state)==null?void 0:o.camera},()=>t.requestRender(),er),this._vao=this._createRibbon(s),this._vaoCount=Qs(this._vao,"geometry"),this._fadeVao=Dn(s),this._fadeVaoCount=Qs(this._fadeVao,"geometry");const n=this._isMars?eY:W4;this._passParameters.texture=new ui(s,{pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR,flipped:!0,width:1,height:512},n);const a=new wR;a.geometry=pc.Cone,this._coneTechnique=this._techniqueRepository.acquire(bb,a),a.geometry=pc.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(bb,a)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Le(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const t=e.bindParameters.camera;this._update(t);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(bt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(bt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const t=E(),r=this._planetRadius,s=xe(e.eye),n=s-r;if(n<0){const f=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=f}else this._passParameters.undergroundFadeAlpha=0;const a=Math.max(tT,n),o=r+uM;this._passParameters.innerScale=sY(r+a,r,o)-1,this._passParameters.altitudeFade=yR(n),W(t,e.eye,(r+tT)/s),mM(t,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,t,e.up,this._passParameters.silhouette),c=tY(),h=iY(n);let u=this._texV0+c*this._texVScale,m=this._texV0+l*h*this._texVScale;if(n>tT){mM(e.eye,e.center,e.up,r,this._passParameters.silhouette);const f=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=ie((f-1.5)/(l-1.5),0,1);u=this._texV0+y*c*this._texVScale,m=this._texV0+dt(this._texV1,l*h,y)*this._texVScale}pi(this._passParameters.texV,u,m)}_createRibbon(e){const t=ir(3+3*$0*3),r=new Uint32Array(3*$0*5);t[0]=0,t[1]=0,t[2]=-1;for(let a=0;a<$0;a++){const o=9*a+3;t[o+0]=a,t[o+1]=this._innerRimFactor,t[o+2]=-1,t[o+3]=a,t[o+4]=this._middleRimFactor,t[o+5]=0,t[o+6]=a,t[o+7]=this._outerRimFactor,t[o+8]=1;const l=3*a+1,c=a===$0-1?1:l+3,h=15*a;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=fM.createBuffer(r.length),n=s.position;for(let a=0;a<r.length;++a){const o=3*r[a];n.set(a,0,t[o]),n.set(a,1,t[o+1]),n.set(a,2,t[o+2])}return new fh(e,Zt,{geometry:ul(fM)},{geometry:Yt.createVertex(e,ri.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,t,r,s){return J(sm,s.center,s.v2),W(F0,sm,this._outerRimFactor),b2(iT,t,sm,r),NP(sm,iT,e.projectionMatrix,e.viewport,sm),NP(F0,iT,e.projectionMatrix,e.viewport,F0),Ni(sm,F0)/e.height}};function mM(i,e,t,r,s){const n=xe(i),a=r*Math.sqrt(n*n-r*r)/n,o=Math.sqrt(r*r-a*a),l=s.v1,c=s.v2;return W(s.center,i,o/n),Xe(l,i,e),Da(l)<1&&Xe(l,i,t),W(l,l,a/xe(l)),Xe(c,l,i),W(c,c,a/xe(c)),a}const iT=ve(),sm=E(),F0=E();function sY(i,e,t){return i*i/(Math.sqrt(i*i-e*e)*Math.sqrt(i*i-t*t)+e*t)}const fM=Rr().vec3f(C.POSITION);let Q4=class Z4 extends Wt{initializeProgram(e){return new Gt(e.rctx,Z4.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:os(he.ONE,he.ZERO,he.ONE_MINUS_SRC_COLOR,he.ONE),colorWrite:ut})}};Q4.shader=new jt(z4,()=>Y(()=>import("./FogHaze.glsl-0f5a3ae3.js"),["./FogHaze.glsl-0f5a3ae3.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./FloatPassUniform-0426669b.js","./vec4-c7a19f0d.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./vec3f32-01c06d8d.js","./compilerUtils-7bf6df9e.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const nY=.7,aY=1;let T_=class extends ge{constructor(e){super(e),this._passParameters=new vR;const t=e.context.renderContext.rctx;this._vao=Dn(t,c0);const r=qt(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+Iy;const s=new bR;s.haze=!0,this._hazeTechnique=e.context.techniqueRepository.acquire(Q4,s)}destroy(){this._hazeTechnique.release(),this._vao.dispose()}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}render(e,t){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,t),this._passParameters.hazeAmount<=0))return;const r=this._hazeTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderSimpleHaze(n,e)})}_renderSimpleHaze(e,t){const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(bt.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;K(gM,r.eye);const s=Math.max(0,oe(gM,e.bindParameters.lighting.mainLight.direction)),n=lY;W(_M,n,0),ns(this._passParameters.hazeColor,_M,n,s);const a=xe(r.eye),o=a*a;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-zf(nY*ao,aY*ao,Math.abs(a-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};d([p({constructOnly:!0})],T_.prototype,"context",void 0),d([p({constructOnly:!0})],T_.prototype,"view",void 0),T_=d([k("esri.views.3d.environment.SimpleHaze")],T_);let oY=class{constructor(){this.strength=0,this.amount=0}};const lY=qe(.24,.44,.8),gM=E(),_M=E();function cY(){const i=new Hi;return i.attributes.add(C.POSITION,"vec3"),i.attributes.add(C.COLOR,"vec4"),i.attributes.add(C.SIZE,"float"),i.varyings.add("vcolor","vec4"),i.varyings.add("vsize","float"),i.vertex.uniforms.add([new tn("transform",(e,t)=>hY(e,t)),new ac("viewport",(e,t)=>t.camera.fullViewport),new yt("pixelRatio",(e,t)=>t.camera.pixelRatio)]),i.include(ek),i.vertex.code.add(R`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),i.fragment.code.add(R`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),i}function hY(i,e){return bs(Sh,e.camera.projectionMatrix),Sh[10]=24e-8-1,Sh[11]=-1,Sh[14]=(24e-8-2)*e.camera.near,Sr(Sh,Sh,e.camera.viewMatrix),Sr(Sh,Sh,i.modelMatrix)}const Sh=ve(),dY=Object.freeze(Object.defineProperty({__proto__:null,build:cY},Symbol.toStringTag,{value:"Module"}));let uY=class extends ur{constructor(){super(...arguments),this.modelMatrix=ve()}},K4=class J4 extends Wt{constructor(e){super(e,new Ln,()=>this.destroy())}initializeProgram(e){return new Gt(e.rctx,J4.shader.get().build(),Zt)}initializePipeline(){return it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ts.LEQUAL},colorWrite:ut})}};K4.shader=new jt(dY,()=>Y(()=>import("./Stars.glsl-bc18b82e.js"),["./Stars.glsl-bc18b82e.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let ad=class extends ge{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new uY,this._updatingTracking=new og}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=sl(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=gr(this._technique),this._vao=Le(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),T(this._technique)||T(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(bt.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||T(nm))return;this._technique=new K4({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=nm.byteLength/yM;const t=new Float32Array(nm,0,2*this._numPoints),r=new Uint8Array(nm,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),Je)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),s=bs(this._renderParameter.modelMatrix,fY);fy(s,s,-r*Math.PI),Sr(s,mY,s),fy(s,s,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,s){const n=vM.createBuffer(s),a=n.position,o=n.color,l=n.size;for(let c=0;c<s;c++){const h=t[2*c+0],u=t[2*c+1];a.set(c,0,-Math.cos(h)*Math.sin(u)),a.set(c,1,-Math.sin(h)*Math.sin(u)),a.set(c,2,-Math.cos(u));const m=this._unpackUint8Attributes(r[c]),f=this._hexToRGB(pY[m[1]]);o.set(c,0,255*f[0]),o.set(c,1,255*f[1]),o.set(c,2,255*f[2]),o.set(c,3,255),l.set(c,m[0])}return new fh(e,Zt,{geometry:ul(vM)},{geometry:Yt.createVertex(e,ri.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(_(nm))return null;const e=o0(async t=>{const{data:r}=await u7("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),nm=r});return e.promise.catch(t=>{za(t)||pe.getLogger(this.declaredClass).error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new ue("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/yM;if(t%1!=0||t>5e4||t<5e3)throw new ue("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};d([p({constructOnly:!0})],ad.prototype,"view",void 0),d([p({constructOnly:!0})],ad.prototype,"requestRender",void 0),d([p({readOnly:!0})],ad.prototype,"updating",null),d([p()],ad.prototype,"_loadDataTask",void 0),d([p()],ad.prototype,"_updatingTracking",void 0),ad=d([k("esri.views.3d.environment.Stars")],ad);const pY=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],mY=Z$(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),fY=Z$(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),yM=9,vM=Rr().vec3f(C.POSITION).vec4u8(C.COLOR).f32(C.SIZE);let nm=null;function gY(i,e,t){const r=i.parallax.anchorPointClouds;i.fadeIn.stage===ql.FINISHED&&(i.fadeIn.factor=0,X(r,Ql),i.fadeIn.stage=ql.CHANGE_ANCHOR,i.crossFade.enabled=!1,i.fadeInOut.stage=Cn.FINISHED),i.fadeIn.stage===ql.CHANGE_ANCHOR&&i.isCameraPositionFinal&&(I2(i.data)&&i.renderingStage!==$r.RENDERING||i.renderingStage===$r.FADING_TEXTURE_CHANNELS)&&(X(r,Ql),i.fadeIn.stage=ql.FADE_IN,i.startTime=e,i.renderingStage===$r.FADING_TEXTURE_CHANNELS&&(i.renderingStage=$r.SWITCH_CHANNELS)),i.fadeIn.factor<1&&i.fadeIn.stage===ql.FADE_IN?i.fadeIn.factor=t?ie((e-i.startTime)/(eN*t),0,1):1:i.fadeIn.factor>=1&&i.fadeIn.stage===ql.FADE_IN&&(i.fadeIn.stage=ql.FINISHED,i.fadeIn.factor=1)}function _Y(i,e,t){const{fadeInOut:r,crossFade:s}=i;r.stage===Cn.FINISHED&&(i.startTime=e,r.factor=1,r.stage=Cn.FADE_OUT),r.factor>0&&r.stage===Cn.FADE_OUT?r.factor=t?1-ie((e-i.startTime)/(xY*t),0,1):0:(r.factor<=0&&r.stage===Cn.FADE_OUT&&(r.factor=0,X(i.parallax.anchorPointClouds,Ql)),r.factor<=0&&r.stage===Cn.FADE_OUT&&i.isCameraPositionFinal&&(r.factor=0,r.stage=Cn.SWITCH,i.crossFade.enabled=!1,s.factor=1),r.stage===Cn.SWITCH&&(I2(i.data)&&i.renderingStage!==$r.RENDERING||i.renderingStage===$r.FADING_TEXTURE_CHANNELS)&&(i.startTime=e,r.factor=0,r.stage=Cn.FADE_IN,X(i.parallax.anchorPointClouds,Ql),i.crossFade.enabled=!1,s.factor=1,i.renderingStage===$r.FADING_TEXTURE_CHANNELS&&(i.renderingStage=$r.SWITCH_CHANNELS)),r.factor<1&&r.stage===Cn.FADE_IN?r.factor=t?ie((e-i.startTime)/(eN*t),0,1):1:r.factor>=1&&r.stage===Cn.FADE_IN&&(r.stage=Cn.FINISHED,r.factor=1))}function yY(i,e,t,r){const{crossFade:s}=i,n=i.parallax.anchorPointClouds;i.crossFade.enabled&&!r||(X(i.parallaxNew.anchorPointClouds,Ql),i.startTime=e,s.factor=0,i.crossFade.enabled=!0),s.factor<1&&i.crossFade.enabled?s.factor=t?ie((e-i.startTime)/(TY*t),0,1):1:s.factor>=1&&i.crossFade.enabled&&(i.crossFade.enabled=!1,s.factor=1,X(n,i.parallaxNew.anchorPointClouds),i.renderingStage===$r.FADING_TEXTURE_CHANNELS&&(i.renderingStage=$r.SWITCH_CHANNELS))}function bM(i,e,t,r){const s=i.fadeInOutHeight,n=s.stage===sb.FINISHED?t:i.startTimeHeightFade;if(r!==0){const a=(t-n)/(CY*r);s.factor+=e?-a:a}else s.factor=e?0:1;i.startTimeHeightFade=t,s.factor=ie(s.factor,0,1),s.stage=sb.HEIGHT_FADE}function vY(i,e,t,r,s){i.renderingStage===$r.FINISHED_RENDERING&&(i.renderingStage=$r.FADING_TEXTURE_CHANNELS);const n=xe(e.eye);i.fadeInOutHeight.factor<0&&(i.fadeInOutHeight.factor=n-ia.radius>ao?1:0),i.isCameraPositionFinal=dp(i.cameraPositionLastFrame,e.eye),K(Ql,e.eye),W(Ql,Ql,ia.radius);const a=i.parallax;a.anchorPointClouds[0]===0&&a.anchorPointClouds[1]===0&&a.anchorPointClouds[2]===0&&X(a.anchorPointClouds,Ql);const o=xe(ee(wY,a.anchorPointClouds,Ql));let l=!0;o>i.fadeIn.distanceThresholdFactor*a.cloudsHeight||i.fadeIn.stage!==ql.FINISHED?gY(i,r,s):o>i.fadeInOut.distanceThresholdFactor*a.cloudsHeight||i.fadeInOut.stage!==Cn.FINISHED?_Y(i,r,s):o>i.crossFade.distanceThresholdFactor*a.cloudsHeight||i.crossFade.enabled||i.renderingStage===$r.FADING_TEXTURE_CHANNELS?yY(i,r,s,(t!==bi.IDLE||!I2(i.data))&&i.renderingStage!==$r.FADING_TEXTURE_CHANNELS):l=!1;const c=n-ia.radius;if((c>1.7*ao||c<-ao)&&i.fadeInOutHeight.factor<1?i.fadeInOutHeight.factor=1:(c>ao||c<-.35*ao)&&i.fadeInOutHeight.factor<1?bM(i,!1,r,s):c<ao&&c>-.35*ao&&i.fadeInOutHeight.factor>0?bM(i,!0,r,s):i.fadeInOutHeight.stage=sb.FINISHED,i.renderingStage===$r.SWITCH_CHANNELS&&(i.readChannels=1-i.readChannels,i.renderingStage=$r.FINISHED),a.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-ia.radius*ia.radius,0))/n,UP(wM,a.anchorPointClouds,am),mo(a.transform,Bd,am[3],VP(am)),l){const{parallaxNew:h}=i;UP(wM,h.anchorPointClouds,am),mo(h.transform,Bd,am[3],VP(am))}X(i.cameraPositionLastFrame,e.eye)}function bY(i){return i.crossFade.enabled||i.fadeInOut.stage!==Cn.FINISHED||i.fadeIn.stage!==ql.FINISHED||i.fadeInOutHeight.stage!==sb.FINISHED||i.renderingStage!==$r.FINISHED}const wM=qe(0,0,1),am=Dk(),Ql=E(),wY=E(),eN=1,xY=.5,TY=1.3,CY=1;var Qi;function xM(i=Vt("enable-feature:high-quality-idle")){const e=new d0;return i&&(e.set(bi.INTERACTING,Qi.Antialiasing,!0),e.set(bi.IDLE,Qi.Antialiasing,!0),e.set(bi.INTERACTING,Qi.HighQualityTransparency,!0),e.set(bi.IDLE,Qi.HighQualityTransparency,!0),e.set(bi.INTERACTING,Qi.RealisticAtmosphere,!0),e.set(bi.IDLE,Qi.RealisticAtmosphere,!0),e.set(bi.IDLE,Qi.SSAO,!0),e.set(bi.IDLE,Qi.WaterReflection,!0),e.set(bi.IDLE,Qi.PhysicalPixelRendering,!0)),e.set(bi.ANIMATING,Qi.ShadowMapUpdate,!0),e.set(bi.INTERACTING,Qi.ShadowMapUpdate,!0),e.set(bi.IDLE,Qi.ShadowMapUpdate,!0),e.set(bi.IDLE,Qi.HighQualityVoxel,!0),e}(function(i){i[i.Antialiasing=0]="Antialiasing",i[i.HighQualityTransparency=1]="HighQualityTransparency",i[i.HighQualityVoxel=2]="HighQualityVoxel",i[i.RealisticAtmosphere=3]="RealisticAtmosphere",i[i.SSAO=4]="SSAO",i[i.WaterReflection=5]="WaterReflection",i[i.ShadowMapUpdate=6]="ShadowMapUpdate",i[i.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Qi||(Qi={}));var Df;(function(i){i[i.Immediate=0]="Immediate",i[i.Faded=1]="Faded"})(Df||(Df={}));var C_;const EY=[ne.POSTPROCESSING_ENVIRONMENT_OPAQUE,ne.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let kr=C_=class extends ge{constructor(i){super(i),this._context=null,this._atmosphere=null,this._hqAtmosphere=null,this._oldWeatherParameters=new rT,this._newWeatherParameters=new rT,this._fadedWeatherParameters=new rT,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(EY,this)}destroy(){var i;this.removeHandles(),((i=this.view)==null?void 0:i._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return _(this._hqAtmosphere)&&this.view._stage.renderer.isFeatureEnabled(Qi.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}get _atmosphereType(){return _(this.atmosphere)?this.atmosphere.type:Pr.None}get canRender(){var i;return!!((i=this.view.basemapTerrain)!=null&&i.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._atmosphereType===Pr.Realistic}updateAnimation(i){return!!_(this._precipitation)&&this._precipitation.update(i)}get updating(){return _(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return xe(this.view.state.camera.eye)-qt(this.view.spatialReference).radius<=ao}get _stars(){var r;const i=this.view,e=((r=i.environment)==null?void 0:r.starsEnabled)??!1,t=this._get("_stars");return!e||T(this._context)?(we(t),null):_(t)?t:new ad({view:i,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const i=this._get("_precipitation");if(!this._precipitationEnabled||T(this._context))return we(i),null;const e=this.view,t=this._context;return _(i)&&i.context===t?i:(we(i),new Lu({context:t,view:e}))}get _clouds(){const i=this._get("_clouds");if(!this.weatherEnabled||T(this._context))return we(i),null;if(_(i))return i;const e=this.view,t=this._context;return we(i),new fn({context:t,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const i=this._get("_cloudsComposition");if(!this.weatherEnabled||T(this._context))return we(i),null;const e=this.view.state.viewingMode,t=this._context.renderContext.rctx,r=qt(this.view.spatialReference).radius;return _(i)&&i.viewingMode===e&&i.planetRadius===r?i:(we(i),new Iu({rctx:t,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const i=this._get("_fog");if(!this.weatherEnabled||T(this._context))return we(i),null;if(_(i))return i;const e=this.view,t=this._context;return new x_({context:t,view:e})}get _simpleHaze(){const i=this._get("_simpleHaze");if(!this.weatherEnabled||T(this._context))return we(i),null;if(_(i))return i;const e=this.view,t=this._context;return new T_({context:t,view:e})}get weatherEnabled(){var i,e;return!!((e=(i=this.view)==null?void 0:i.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(i=null){this._context=i;const e=()=>this._setNeedsRender();this.addHandles([ha(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),er),z(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),t=>this._updateAtmosphere(t),er),z(()=>this._stars,e),z(()=>this._precipitation,e),z(()=>this._clouds,()=>this._updateWeather(),Je),z(()=>this._fog,()=>this._updateFogHaze(),Je),z(()=>this._simpleHaze,()=>this._updateFogHaze(),Je),z(()=>this.view.state.mode,()=>{this._setNeedsRender()},ii),z(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),er),z(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},er)])}uninitializeRenderContext(){this._context=null,this._atmosphere=we(this._atmosphere),this._hqAtmosphere=we(this._hqAtmosphere),this._set("_stars",we(this._stars)),this._set("_precipitation",we(this._precipitation)),this._set("_clouds",we(this._clouds)),this._set("_cloudsComposition",we(this._cloudsComposition)),this._set("_fog",we(this._fog)),this._set("_simpleHaze",we(this._simpleHaze))}prepareRender(i){i.bindParameters.cloudsFade.data=bz(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(vY(i.bindParameters.cloudsFade,i.bindParameters.camera,this.view.state.mode,i.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(i.bindParameters),i.bindParameters.cloudsFade.renderingStage===$r.FINISHED&&_(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),i.bindParameters.cloudsFade.data=null))}render(i){if(i.output===$.Color)switch(i.bindParameters.slot){case ne.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(i),_(this.atmosphere)&&(this.atmosphere.render(i),_(this._cloudsComposition)&&_(i.bindParameters.cloudsFade.data)&&(this.weatherVisible&&_(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(i)),bY(i.bindParameters.cloudsFade)&&_(this._context)&&this._context.requestRender());break;case ne.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this.atmosphere)&&(this.atmosphere.renderHaze(i,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._atmosphereType!==Pr.Realistic&&_(this._simpleHaze)&&this._simpleHaze.render(i,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&_(this._fog)&&this._fog.render(i,this._weatherParameters.fog),_(this._precipitation))){const e=this.view.environment.weather;e.type!=="rainy"&&e.type!=="snowy"||this._precipitation.render(i,e.precipitation,e.type)}}}updateLightSources(i,e,t,r){if(_(this._context)){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=t,s.bindParameters.newLighting.set(i),r===Df.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const i=this.weatherEnabled?this.view.environment.weather:null;return T(i)?null:i.type==="rainy"||i.type==="snowy"?{type:i.type,weatherAdjustment:i.cloudCover,effect:i.precipitation}:{type:i.type,weatherAdjustment:i.type==="foggy"?i.fogStrength:i.cloudCover}}_updateWeatherFading(i){if(!i.weatherFading)return;const e=i.cloudsFade;return e.fadeIn.stage===ql.FADE_IN?(i.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===Cn.FADE_IN?(i.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(i.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(i.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(i){const{_newWeatherParameters:e,_oldWeatherParameters:t}=this;i>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(t,e,i),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const i=this._weatherUpdateParameters;T(i)||T(this._clouds)||(this._clouds.applyPreset(Os[i.type],i.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFogHaze(){const i=this._weatherUpdateParameters;if(T(this._fog)||T(this._simpleHaze)||T(i)||T(this._context))return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),i.type){case"foggy":this._newWeatherParameters.fog.strength=dt(3e-5,.005,i.weatherAdjustment**3),X(this._newWeatherParameters.fog.color,TM),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Pr.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=dt(4e-6,2e-4,(i.effect??0)**3),X(this._newWeatherParameters.fog.color,SY),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=dt(4e-6,2e-4,(i.effect??0)**3),X(this._newWeatherParameters.fog.color,TM),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._atmosphereType===Pr.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(i){const e=this._selectAtmosphereType(i);if(_(this._atmosphere)?this._atmosphere.type===e:e===Pr.None)return;this._atmosphere=we(this._atmosphere),this._hqAtmosphere=we(this._hqAtmosphere);const t=this._getAtmosphereClass(e);t&&_(this._context)&&(this._atmosphere=new t(this.view,this._context),e===Pr.Simple&&(this._hqAtmosphere=new jx(this.view,this._context))),this._setNeedsRender(),this._updateBasemapTerrain()}_getAtmosphereClass(i){switch(i){case Pr.Realistic:return jx;case Pr.Panoramic:return GX;case Pr.Simple:return rY;default:case Pr.None:return null}}_selectAtmosphereType(i){const{enabled:e,quality:t,viewingMode:r}=i;return!e||i0(this.view.spatialReference)?Pr.None:r===Se.Local?Pr.Panoramic:_(this._context)&&t==="high"&&jx.isSupported(this._context)&&Y1(this.view.spatialReference)?Pr.Realistic:Pr.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===Pr.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:i=>{CM=C_.prototype._getAtmosphereClass,C_.prototype._getAtmosphereClass=i},restoreGetAtmosphereClass:()=>{C_.prototype._getAtmosphereClass=CM}}}};d([p({constructOnly:!0})],kr.prototype,"view",void 0),d([p({readOnly:!0})],kr.prototype,"atmosphere",null),d([p({readOnly:!0})],kr.prototype,"_atmosphereType",null),d([p({type:Boolean,readOnly:!0})],kr.prototype,"updating",null),d([p({readOnly:!0})],kr.prototype,"weatherVisible",null),d([p()],kr.prototype,"_context",void 0),d([p()],kr.prototype,"_atmosphere",void 0),d([p()],kr.prototype,"_hqAtmosphere",void 0),d([p({readOnly:!0})],kr.prototype,"_stars",null),d([p({readOnly:!0})],kr.prototype,"_precipitation",null),d([p({readOnly:!0})],kr.prototype,"_clouds",null),d([p({readOnly:!0})],kr.prototype,"_cloudsComposition",null),d([p({readOnly:!0})],kr.prototype,"_fog",null),d([p({readOnly:!0})],kr.prototype,"_simpleHaze",null),d([p({readOnly:!0})],kr.prototype,"weatherEnabled",null),d([p({readOnly:!0})],kr.prototype,"_precipitationEnabled",null),d([p({readOnly:!0})],kr.prototype,"_weatherUpdateParameters",null),kr=C_=d([k("esri.views.3d.environment.EnvironmentRenderer")],kr);let rT=class{constructor(){this.fog=new CX,this.haze=new oY}copyFrom(e){this.fog.amount=e.fog.amount,this.haze.amount=e.haze.amount,this.fog.strength=e.fog.strength,this.haze.strength=e.haze.strength,X(this.fog.color,e.fog.color)}lerp(e,t,r){this.fog.amount=dt(e.fog.amount,t.fog.amount,r),this.haze.amount=dt(e.haze.amount,t.haze.amount,r),this.fog.strength=dt(e.fog.strength,t.fog.strength,r),this.haze.strength=dt(e.haze.strength,t.haze.strength,r),ns(this.fog.color,e.fog.color,t.fog.color,r)}};const SY=qe(.5,.5,.5),TM=qe(1.5,1.5,1.5);let CM;function EM(i,e,t){if(T(e.longitude)||T(e.latitude)||T(t.longitude)||T(t.latitude))throw new Error("Invalid points: no lon/lat");return RY(i,e.longitude,e.latitude,t.longitude,t.latitude)}function RY(i,e,t,r,s){const n=vt(t),a=vt(s),o=n-a,l=vt(e)-vt(r),c=Math.sin(o/2),h=Math.sin(l/2),u=2*hc(Math.sqrt(c*c+Math.cos(n)*Math.cos(a)*h*h))*i;return Math.round(1e4*u)/1e4}function AY(i,e,t){const r=e.spatialReference,s=qt(r),n=new kt(e.x,i.y,r),a=new kt(t.x,i.y,r),o=new kt(i.x,e.y,r),l=new kt(i.x,t.y,r);return{lon:EM(s.radius,n,a),lat:EM(s.radius,o,l)}}function PY(i,e,t){const r=e/t,s=vt(i),n=Math.sin(r/2),a=Math.cos(s),o=2*hc(Math.sqrt(n*n/(a*a)));return ca(o)}function OY(i,e){let t=i/15;return e||(t=Math.round(t)),t}function SM(i,e){const t=i==null?void 0:i[0];if(t==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=OY(t,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}var RM,AM,PM,KE={},MY={get exports(){return KE},set exports(i){KE=i}};RM=MY,AM=function(){var i=Math.PI,e=Math.sin,t=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,a=Math.acos,o=i/180,l=864e5,c=2440588,h=2451545,u={dec:0,ra:0};function m(H){return H.valueOf()/l-.5+c}function f(H){return new Date((H+.5-c)*l)}function y(H){return m(H)-h}var g=23.4397*o;function v(H,G){return n(e(H)*t(g)-r(G)*e(g),t(H))}function b(H,G){return s(e(G)*t(g)+t(G)*e(g)*e(H))}function x(H,G,B){return n(e(H),t(H)*e(G)-r(B)*t(G))}function w(H,G,B){return s(e(G)*e(B)+t(G)*t(B)*t(H))}function S(H,G){return o*(280.16+360.9856235*H)-G}function P(H){return o*(357.5291+.98560028*H)}function A(H){return o*(1.9148*e(H)+.02*e(2*H)+3e-4*e(3*H))}function M(H,G){return H+G+102.9372*o+i}function O(H,G){var B=P(H),le=M(B,A(B));return G||(G={dec:0,ra:0}),G.dec=b(le,0),G.ra=v(le,0),G}var I={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(H,G,B,le){var ce=o*-B,_e=o*G,j=y(H),de=O(j,u),te=S(j,ce)-de.ra;return le||(le={azimuth:0,altitude:0}),le.azimuth=x(te,_e,de.dec),le.altitude=w(te,_e,de.dec),le}},N=[[-.83,"sunrise","sunset"]];I.addTime=function(H,G,B){N.push([H,G,B])};var F=9e-4;function V(H,G){return Math.round(H-F-G/(2*i))}function Q(H,G,B){return F+(H+G)/(2*i)+B}function ae(H,G,B){return h+H+.0053*e(G)-.0069*e(2*B)}function q(H,G,B){return a((e(H)-e(G)*e(B))/(t(G)*t(B)))}function D(H){var G=o*(134.963+13.064993*H),B=o*(93.272+13.22935*H),le=o*(218.316+13.176396*H)+6.289*o*e(G),ce=5.128*o*e(B),_e=385001-20905*t(G);return{ra:v(le,ce),dec:b(le,ce),dist:_e}}return I.getTimes=function(H,G,B){var le=o*-B,ce=o*G,_e=V(y(H),le),j=Q(0,le,_e),de=P(j),te=A(de),me=M(de,te),ye=b(me,0),Ue=ae(j,de,me);function De(lt){return ae(Q(q(lt,ce,ye),le,_e),de,me)}function Te(lt){var at=(e(lt)-e(ce)*e(ye))/(t(ce)*t(ye));return at<-1?I.PolarException.MIDNIGHT_SUN:at>1?I.PolarException.POLAR_NIGHT:I.PolarException.NORMAL}var et,be,Be,Re,Ye,nt={solarNoon:f(Ue),nadir:f(Ue-.5),polarException:I.PolarException.NORMAL};for(et=0,be=N.length;et<be;et+=1)Ye=Ue-((Re=De((Be=N[et])[0]*o))-Ue),nt[Be[1]]=f(Ye),nt[Be[2]]=f(Re);return nt.polarException=Te(N[0][0]*o),nt},I.getMoonPosition=function(H,G,B){var le=o*-B,ce=o*G,_e=y(H),j=D(_e),de=S(_e,le)-j.ra,te=w(de,ce,j.dec);return te+=.017*o/r(te+10.26*o/(te+5.1*o)),{azimuth:x(de,ce,j.dec),altitude:te,distance:j.dist}},I.getMoonFraction=function(H){var G=y(H),B=O(G),le=D(G),ce=149598e3,_e=a(e(B.dec)*e(le.dec)+t(B.dec)*t(le.dec)*t(B.ra-le.ra)),j=n(ce*e(_e),le.dist-ce*t(_e));return(1+t(j))/2},I},(PM=AM())!==void 0&&(RM.exports=PM);const bp=KE,Wl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function IY(i,e,t,r,s,n){Z(n.ambient.color,1,1,1),n.ambient.intensity=Wl.global.ambient,Z(n.direct.color,1,1,1),n.direct.intensity=Wl.global.direct;const a=e[2],o=ie((Math.abs(a)-Wl.local.altitude)/(Wl.global.altitude-Wl.local.altitude),0,1);let l;if(n.globalFactor=o,_(i)&&(l=bp.getTimes(i,e[1],e[0])),o<1){let c;if(_(i))c=VY(i,l,r);else{const h=rN(r);c={direct:{intensity:Wl.local.directAtNoon*h.direct,color:qe(1,1,1)},ambient:{intensity:Wl.local.ambientAtNoon*h.ambient,color:qe(1,1,1)},timeOfDay:"early afternoon"}}ns(n.ambient.color,c.ambient.color,n.ambient.color,o),n.ambient.intensity=dt(c.ambient.intensity,n.ambient.intensity,o),ns(n.direct.color,c.direct.color,n.direct.color,o),n.direct.intensity=dt(c.direct.intensity,n.direct.intensity,o),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=_(i)?UY(i,l):1,_(i)?DY(i,e,t,n.direct.directionToLightSource):tN(s,t,n.direct.directionToLightSource)}function tN(i,e,t){e===Se.Global?K(sT,i.eye):Z(sT,0,0,1),W(nT,i.viewForward,-1);const r=l1(nT,sT),s=Math.max(r-2*aT,0),n=.85*s/(s+1),a=Math.max(aT,r-aT-n);ol(MM,-a,i.viewRight),Pe(t,nT,MM),J(t,t,W(BY,i.viewRight,zY)),K(t,t)}function DY(i,e,t,r){const s=NY,n=pp(FY);if(t===Se.Global)bp.getPosition(i,0,0,s),Z(r,0,0,-1),gy(n,n,-s.azimuth),w2(n,n,-s.altitude),Pe(r,r,n);else{const a=Wl.planarDirection,o=a.globalAngles,l=e[2];let c=(Math.abs(l)-a.localAltitude)/(a.globalAltitude-a.localAltitude);c=ie(c,0,1),c<1?(bp.getPosition(i,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*o.azimuth,s.altitude=(1-c)*s.altitude+c*o.altitude):(s.azimuth=o.azimuth,s.altitude=o.altitude),Z(r,0,-1,0),fy(n,n,-s.azimuth),gy(n,n,-s.altitude),Pe(r,r,n)}}function LY(i,e){if(e===Se.Global)return!0;const t=Wl.planarDirection;return Math.abs(i)<t.localAltitude}const $Y=qe(.5773502691896258,-.5773502691896258,.5773502691896258);let iN=class{constructor(){this.ambient={color:qe(1,1,1),intensity:.55},this.direct={color:qe(1,1,1),intensity:.55,directionToLightSource:Pn($Y)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const FY=ve(),NY={azimuth:0,altitude:0};function UY(i,e){const t=i.valueOf();let r,s;e.polarException===bp.PolarException.MIDNIGHT_SUN?(r=t-60*(i.getHours()+48)*60*1e3-60*i.getMinutes()*1e3,s=r+432e6):e.polarException===bp.PolarException.POLAR_NIGHT?(r=t-2,s=t-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-ie(Math.abs(t-n)/432e5,0,1)}function rN(i){switch(i){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function OM(i,e){const t=(i[0]+i[1]+i[2])/3;for(let r=0;r<3;r++)i[r]=i[r]+(t-i[r])*e;return i}function VY(i,e,t){const r=i.valueOf();let s,n;e.polarException===bp.PolarException.MIDNIGHT_SUN?(s=r-60*(i.getHours()+48)*60*1e3-60*i.getMinutes()*1e3,n=s+432e6):e.polarException===bp.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const a=n-s,o=s+a/2,l=a/4,c=o-l,h=o+l,u=.06*a,m=s-u/2,f=s+u/2,y=n-u/2,g=n+u/2,v=Wl.local,b=[.01,v.ambientAtNight],x=[.8,.8,1],w=[.01,.01,.01],S=[v.directAtTwilight,v.ambientAtTwilight],P=[1,.6,.5],A=[.8,.8,1],M=[.9*v.directAtNoon,v.ambientAtNoon],O=[1,.98,.98],I=[.98,.98,1],N=[v.directAtNoon,v.ambientAtNoon],F=[1,1,1],V=[1,1,1],Q=M,ae=O,q=I,D=S,H=P,G=A;let B,le,ce=[0,0],_e=[0,0,0],j=[0,0,0];r<m||r>g?(ce=b,_e=w,j=x,le="night"):r<f?(B=f-m,ce=hs(r-m,B,b,S),_e=hs(r-m,B,w,P),j=hs(r-m,B,x,A),le="sun rising"):r<c?(B=c-f,ce=hs(r-f,B,S,M),_e=hs(r-f,B,P,O),j=hs(r-f,B,A,I),le="early morning"):r<o?(B=o-c,ce=hs(r-c,B,M,N),_e=hs(r-c,B,O,F),j=hs(r-c,B,I,V),le="late morning"):r<h?(B=h-o,ce=hs(r-o,B,N,Q),_e=hs(r-o,B,F,ae),j=hs(r-o,B,V,q),le="early afternoon"):r<y?(B=y-h,ce=hs(r-h,B,Q,D),_e=hs(r-h,B,ae,H),j=hs(r-h,B,q,G),le="late afternoon"):r<g&&(B=g-y,ce=hs(r-y,B,D,b),_e=hs(r-y,B,H,w),j=hs(r-y,B,G,x),le="sun setting");let de=0;switch(t){case"rainy":case"foggy":case"snowy":de=.5}de>0&&(_e=OM(_e,de),j=OM(j,de));const te=qe(_e[0],_e[1],_e[2]),me=qe(j[0],j[1],j[2]),ye=rN(t);return{direct:{intensity:ce[0]*ye.direct,color:te},ambient:{intensity:ce[1]*ye.ambient,color:me},timeOfDay:le}}function hs(i,e,t,r){const s=[];for(let n=0;n<t.length;n++)s[n]=(r[n]-t[n])*i/e+t[n];return s}const MM=ve(),sT=E(),nT=E(),BY=E(),aT=.25,zY=.2;let Lo=class extends Br.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new mi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new Sz,this._ambientLight=new EF,this._moonLight=new Rz,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(t=this._view)==null?void 0:t.state)==null?void 0:r.viewingMode)===Se.Global&&Y1(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new kr({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([z(()=>e.environment.lighting,s=>this._updateLightingHandler(s),ii),z(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),ii),z(()=>e.stationary,()=>this._interactingStationaryHandler()),z(()=>e.environment.lighting.directShadowsEnabled,t,ii),z(()=>e.environment.lighting.ambientOcclusionEnabled,t,ii),z(()=>e.environment.lighting.waterReflectionEnabled,t,ii),z(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,ii),z(()=>e.spatialReference,()=>this._resetReferencePosition(!0),ii),z(()=>e.environment.weather.type,()=>this._updateLighting(null,Df.Faded),ii),z(()=>this.weatherEnabled,()=>this._updateLighting(null,Df.Faded),ii),z(()=>e.viewingMode,()=>this._resetReferencePosition(!0),er),z(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),er),z(()=>e.state.camera,r,er),z(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=we(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!up(r)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const s=SM(this._referencePosWGS84Comparable,IM);_(s)&&(t.autoUpdate(null,s),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=Y1(this._view.spatialReference);if(r&&!up(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return T(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=E()),r?pB(s,this._referencePosWGS84Comparable):Z(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(t.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,t=Df.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePosWGS84Comparable,n=_(s)?kY:GY,a=this.weatherVisible?r.environment.weather.type:"disabled";_(s)?IY(e,s,r.state.viewingMode,a,r.state.camera,n):r.environment.lighting.type==="virtual"&&tN(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const o=this._mainLight,l=n.direct;W(o.intensity,l.color,l.intensity*Math.PI),X(o.direction,l.directionToLightSource),o.specularStrength=n.specularStrength,o.environmentStrength=n.environmentStrength;const c=this._ambientLight;W(c.intensity,n.ambient.color,n.ambient.intensity);const h=this._moonLight;ns(h.intensity,qY,WY,n.globalFactor);const u=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));W(h.intensity,h.intensity,u),X(h.direction,l.directionToLightSource),this._renderer.updateLightSources([o,c,h],n.noonFactor,n.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||T(e))return!1;const r=HY;r.setTime((t||this._view.environment.lighting.date).getTime());const s=SM(e,IM);if(T(s))return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const a=r.getUTCHours()-(s.hours-n.hours),o=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(a),r.setUTCMinutes(o),r.setUTCSeconds(l),!t&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=hd(this._referencePosWGS84Comparable,!0,n=>LY(n[2],this._view.state.viewingMode)),r=this._view.environment.background,s=r instanceof A4?{type:"color",color:rz(li.toUnitRGBA(r.color))}:{type:"color",color:Ai(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:s,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=kf(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=kf(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[t[0],t[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};d([p({type:Boolean,readOnly:!0})],Lo.prototype,"updating",null),d([p()],Lo.prototype,"disableQueries",void 0),d([p()],Lo.prototype,"_disableWeather",void 0),d([p()],Lo.prototype,"weatherEnabled",null),d([p()],Lo.prototype,"weatherVisible",null),d([p()],Lo.prototype,"referencePositionWGS84Comparable",null),d([p()],Lo.prototype,"_renderer",void 0),d([p()],Lo.prototype,"_referencePosWGS84Comparable",void 0),Lo=d([k("esri.views.3d.environment.SceneViewEnvironmentManager")],Lo);const kY=new iN,GY=new iN,HY=new Date,IM={hours:0,minutes:0,seconds:0},qY=qe(.22,.22,.33),WY=qe(.22,.22,.22);var hi;(function(i){i[i.NONE=0]="NONE",i[i.TILT=1]="TILT",i[i.ALTITUDE=2]="ALTITUDE",i[i.DISTANCE=4]="DISTANCE",i[i.COLLISION=8]="COLLISION",i[i.ALL=15]="ALL",i[i.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(hi||(hi={}));var ot;(function(i){i[i.NONE=0]="NONE",i[i.ZOOM=1]="ZOOM",i[i.TUMBLE=2]="TUMBLE",i[i.LOOK_AROUND=3]="LOOK_AROUND",i[i.PAN=4]="PAN",i[i.ASCEND=5]="ASCEND"})(ot||(ot={}));var jr;(function(i){i[i.TUMBLE=0]="TUMBLE",i[i.LOOK_AROUND=1]="LOOK_AROUND"})(jr||(jr={}));function Dy(i,e){return(i&e)!=0}function xb(i,e,t,r,s,n){i!==0&&(t?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const qd={selection:hi.NONE,interactionType:ot.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:jr.TUMBLE};function sN(i,e,t,r){return e=e||i.viewForward,X(r,e),W(r,r,Math.sign(oe(e,t))),r}function jY(i,e,t,r){return KY(i,e,t,QY(r,e,t,!0))}function XY(i,e,t,r){const s=oe(t,ee(i,r,e));return J(i,e,W(i,t,s))}const YY={dir:E(),len:0,clip:Ne()};function QY(i,e,t,r){const s=YY;return i?(t&&r&&(s.len=Ni(e,t)),X(s.dir,i)):r?(s.len=Ni(e,t),ee(s.dir,t,e),W(s.dir,s.dir,1/s.len)):(ee(s.dir,t,e),K(s.dir,s.dir)),s}function ZY(i,e,t){const r=oe(Js(i),t.dir),s=-ji(i,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<t.clip[1]&&(t.clip[1]=n):n>t.clip[0]&&(t.clip[0]=n),t.clip[0]<=t.clip[1]}function KY(i,e,t,r){r.clip[0]=0,r.clip[1]=t?r.len:Number.MAX_VALUE;for(let s=0;s<i.length;s++)if(!ZY(i[s],e,r))return!1;return!0}function JY(i,e,t=qd){const r=TR(i,e,t);if(r===0)return!1;const s=i.renderCoordsHelper,n=s.getAltitude(e.eye)+r,a=sN(e,t.interactionDirection,iQ(i,e,Math.sign(r),aQ),nQ),o=X(oQ,e.viewForward),l=s.intersectInfiniteManifold(al(e.eye,a),n,oT);return e.eye=_(l)?l:s.setAltitude(oT,n,e.eye),e.center=XY(oT,e.eye,o,e.center),!0}function TR(i,e,t=qd){if(!eQ(i,t)||!i.state.constraints.altitude)return 0;const r=rQ(i.state.constraints.altitude,sQ);tQ(i,t,r);const s=i.renderCoordsHelper.getAltitude(e.eye),n=ie(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function eQ(i,e){const t=i.state.constraints.altitude;return!(!i.state.isGlobal||!t)&&(e.interactionType!==ot.TUMBLE||!Dy(e.selection,hi.TILT))}function tQ(i,e,t){const r=e.interactionType;if(r===ot.NONE)return;const{min:s,max:n}=t,{interactionStartCamera:a,interactionFactor:o}=e;if(!a)return;const l=r===ot.TUMBLE||r===ot.ZOOM,c=TR(i,a),h=c===0?0:i.renderCoordsHelper.getAltitude(a.eye);t.min=s,t.max=n,xb(c,h,l,o,.05*h,t)}function iQ(i,e,t,r){return i.renderCoordsHelper.worldUpAtPosition(e.eye,r),W(r,r,t),r}function rQ(i,e){return e.min=i.min,e.max=i.max,e}const sQ={min:0,max:0},nQ=E(),aQ=E(),oQ=E(),oT=E();function CR(i,e,t=qd){if(!i.state.isLocal)return 0;const r=i.state.constraints.distance;if(!i.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;N0.min=0,N0.max=r,cQ(i,t,N0);const s=ER(i,e),n=N0.max-s;return n>=-1e-6?0:n}function lQ(i,e,t=qd){const r=CR(i,e,t);if(r===0)return!1;const s=i.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=ER(i,e)+r,a=X(dQ,e.eye),o=sN(e,t.interactionDirection,hQ(e,s.renderLocation,mQ),pQ);if(!aw(EB(s.renderLocation,n),al(e.eye,o),U0))return!1;e.eye=U0;const l=ee(uQ,e.eye,a);e.center=J(U0,e.center,l);const c=i.renderCoordsHelper.getAltitude(e.center),h=i.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,U0);return _(h)&&(e.center=h),!0}function cQ(i,e,t){const r=e.interactionType;if(r===ot.NONE)return;const{min:s,max:n}=t,{interactionStartCamera:a,interactionFactor:o}=e;if(!a)return;const l=r===ot.ZOOM||r===ot.PAN,c=CR(i,a),h=c===0?0:ER(i,a);t.min=s,t.max=n,xb(c,h,l,o,.05*h,t)}function ER(i,e){const t=i.pointsOfInterest.surfaceOrigin;return t.renderLocation?Ni(e.eye,t.renderLocation):0}function hQ(i,e,t){return Rp(t,i.eye,e)}const N0={min:0,max:0},dQ=E(),uQ=E(),pQ=E(),mQ=E(),U0=E();var Ri,rs;(function(i){i[i.OBJECT=0]="OBJECT",i[i.HUD=1]="HUD",i[i.TERRAIN=2]="TERRAIN",i[i.OVERLAY=3]="OVERLAY",i[i.I3S=4]="I3S",i[i.PCL=5]="PCL",i[i.LOD=6]="LOD",i[i.VOXEL=7]="VOXEL"})(Ri||(Ri={}));let fQ=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=rs.ALL}};(function(i){i[i.MIN=0]="MIN",i[i.MINMAX=1]="MINMAX",i[i.ALL=2]="ALL"})(rs||(rs={}));let gQ=class{constructor(e,t,r){this.object=e,this.geometryId=t,this.triangleNr=r}},_Q=class extends gQ{constructor(e,t,r,s){super(e,t,r),this.center=_(s)?Pn(s):null}},nN=class{constructor(e){this.layerUid=e}},Pw=class extends nN{constructor(e,t){super(e),this.graphicUid=t}};function pl(i){return _(i)&&_(i.dist)}function DM(i){return(e,t,r)=>(ns(LM,e,t,r),!tR(i,LM))}function Ow(i){return pl(i)&&i.intersector===Ri.OBJECT&&!!i.target}function Mw(i){return pl(i)&&i.intersector===Ri.HUD&&!!i.target&&"center"in i.target&&_(i.target.center)}const LM=E(),Kf=1e-5;let yQ=class{constructor(e){this.options=new fQ,this._results=new vQ,this.transform=new lk,this.tolerance=Kf,this.verticalOffset=null,this._ray=ea(),this._rayEnd=E(),this._rayBeginTransformed=E(),this._rayEndTransformed=E(),this.viewingMode=e??Se.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay(SB(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&iE(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Se.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,J(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,s,n){this.point=t,this.filterPredicate=s,this.tolerance=r??Kf;const a=MP(this.verticalOffset);if(_(e)&&e.length>0){const o=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(a)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,o,a):c.forEachAlongRay(this._ray.origin,this._ray.direction,o),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(o)):l.objects.forAll(h=>o(h))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.transformation,s=MP(this.verticalOffset);for(const n of t){if(!n.visible)continue;const{material:a,id:o}=n;this.transform.setAndInvalidateLazyTransforms(r,n.shaderTransformation),Pe(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Pe(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;_(s)&&(s.objectTransform=this.transform),a.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,h,u,m,f,y)=>{if(c>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const g=m?this._results.hud:this._results,v=m?b=>{const x=new _Q(e,o,u,y);b.set(Ri.HUD,x,c,h,Bd,f)}:b=>b.set(Ri.OBJECT,{object:e,geometryId:o,triangleNr:u},c,h,l,f);if((g.min.drapedLayerOrder==null||f>=g.min.drapedLayerOrder)&&(g.min.dist==null||c<g.min.dist)&&v(g.min),this.options.store!==rs.MIN&&(g.max.drapedLayerOrder==null||f<g.max.drapedLayerOrder)&&(g.max.dist==null||c>g.max.dist)&&v(g.max),this.options.store===rs.ALL)if(m){const b=new JE(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new Lf(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((t,r)=>t.dist!==r.dist?Ze(t.dist,0)-Ze(r.dist,0):t.drapedLayerOrder!==r.drapedLayerOrder?Ze(t.drapedLayerOrder,Number.MAX_VALUE)-Ze(r.drapedLayerOrder,Number.MAX_VALUE):Ze(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-Ze(t.drapedLayerGraphicOrder,Number.MIN_VALUE))}};function wo(i){return new yQ(i)}let vQ=class{constructor(){this.min=new Lf(ea()),this.max=new Lf(ea()),this.hud={min:new JE(ea()),max:new JE(ea()),all:new Array},this.ground=new Lf(ea()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},Lf=class{get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(W(V0,this.ray.direction,this.dist),xe(V0)):null}getIntersectionPoint(e){return!!pl(this)&&(W(V0,this.ray.direction,this.dist),J(e,this.ray.origin,V0),!0)}getTransformedNormal(e){return X(Ag,this.normal),Ag[3]=0,Jc(Ag,Ag,this.transformation),X(e,Ag),K(e,e)}constructor(e){this.intersector=Ri.OBJECT,this.normal=E(),this.transformation=ve(),this._ray=ea(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Ri.OBJECT,iE(e,this._ray)}set(e,t,r,s,n,a,o){this.intersector=e,this.dist=r,X(this.normal,Ze(s,aB)),bs(this.transformation,Ze(n,Bd)),this.target=t,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=o}copy(e){iE(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,X(this.normal,e.normal),bs(this.transformation,e.transformation)}},JE=class extends Lf{constructor(){super(...arguments),this.intersector=Ri.HUD}};function SR(i){return new Lf(i)}const V0=E(),Ag=Xt();function aN(i,e,t,r){return _(i.renderCoordsHelper.fromRenderCoords(e.eye,Tb,r))&&B$(t,Tb)}function Iw(i,e){return i.elevationProvider?Ze(i.elevationProvider.getElevation(e[0],e[1],e[2],i.renderCoordsHelper.spatialReference,"ground"),0):0}function Np(i,e,t,r){const s=i.state.camera.clone();e&&t&&r&&(s.eye=e,s.center=t,s.up=r),bQ(i,s.ray,Rh)||X(Rh,s.center);const n=i.state.constraints,a=n.minimumPoiDistance;if(nc(s.eye,Rh)<a){const o=n.collision.enabled;X(tu,s.viewForward),W(tu,tu,a),o?s.eye=ee(Tb,Rh,tu):J(Rh,s.eye,tu);const l=i.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;o&&c<h&&(ee(tu,Rh,s.eye),s.eye=l.setAltitude(Tb,h,s.eye),J(Rh,s.eye,tu))}return s.center=Rh,s}function $M(i,e,t){if(!i.state.isGlobal||!i.stateManager.constraintsManager)return!1;const r=Iw(i,e),s=i.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,t,i.renderDataExtent,r,xQ),a=n*n;return nc(e,t)>a}function bQ(i,e,t){let r=FM[i.viewingMode];r||(r=wo(i.state.viewingMode),r.options.backfacesTerrain=!i.state.isGlobal,r.options.invisibleTerrain=!0,FM[i.viewingMode]=r);const{isGlobal:s}=i.state;return!(!i.sceneIntersectionHelper.intersectRay(e,r,t)||$M(i,e.origin,t))||!(!i.renderCoordsHelper.intersectManifold(e,0,t)||$M(i,e.origin,t))||!!s&&wQ(e,t,qt(i.spatialReference).radius)}function wQ(i,e,t){const r=oe(i.origin,i.origin)-t*t,s=r>0?Math.sqrt(r)/3:1;return W(e,i.direction,s/xe(i.direction)),J(e,e,i.origin),!0}const FM={},Tb=E(),Rh=E(),tu=E(),xQ={near:0,far:0};function cg(i,e,t=fo.EYE){const r=i.state.constraints;if(!r.collision.enabled)return!1;const s=Iw(i,e.eye),n=i.renderCoordsHelper.getAltitude(e.eye),a=s+r.collision.elevationMargin;if(n>=a)return!1;const o=xe(e.eye);if(ee(B0,e.center,e.eye),e.eye=i.renderCoordsHelper.setAltitude(TQ,a,e.eye),t===fo.EYE_AND_CENTER)e.center=J(B0,e.eye,B0);else if(t===fo.EYE_AND_CENTER_SCALE){const l=(o-n+a)/o;e.center=W(B0,e.center,l)}return!0}var fo;(function(i){i[i.EYE=0]="EYE",i[i.EYE_AND_CENTER=1]="EYE_AND_CENTER",i[i.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(fo||(fo={}));const B0=E(),TQ=E();function Wd(i,e,t){i.worldUpAtPosition(e,NM),ee(lT,t,e);const r=xe(lT);return r===0?0:ws(oe(lT,NM)/r)}const NM=E(),lT=E();function oN(i,e,t=qd,r=!0){Pg.eyeCenterDistance=0,Pg.requiresTwoSteps=!1;const s=RR(i,e,t,void 0,Pg);if(s===0)return!1;switch(ol(z0,-s,e.viewRight),t.tiltMode){case jr.LOOK_AROUND:Pe(Ah,e.viewForward,z0),W(Ah,Ah,Pg.eyeCenterDistance),e.center=J(bd,e.eye,Ah);break;case jr.TUMBLE:ee(Ah,e.center,e.eye),Pe(Ah,Ah,z0),e.eye=ee(bd,e.center,Ah);break;default:ll(t.tiltMode)}return e.up=Pe(bd,e.up,z0),!Pg.requiresTwoSteps||!r||oN(i,e,t,!1)}function RR(i,e,t=qd,r=qd,s){if(!i.state.constraints.tilt)return 0;const n=e.distance,a=i.state.constraints.tilt(n,DQ);return IQ(i,t,a),r.interactionType===ot.TUMBLE&&Dy(r.selection,hi.ALTITUDE)&&lN(i,r.interactionStartCamera,a),t.tiltMode===jr.LOOK_AROUND||r.tiltMode===jr.LOOK_AROUND?EQ(i,e,a,s):CQ(i,e,a)}function CQ(i,e,t){const r=Wd(i.renderCoordsHelper,e.center,e.eye),s=r-ie(r,t.min,t.max);return Ly(s)?s:0}function EQ(i,e,t,r){switch(r&&(r.requiresTwoSteps=!1),i.viewingMode){case"global":return RQ(i,e,t,r);case"local":return SQ(i,e,t,r)}}function SQ(i,e,t,r){const s=Wd(i.renderCoordsHelper,e.center,e.eye),n=ie(s,t.min,t.max),a=s-n;if(!Ly(a))return 0;if(r){const o=i.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=i.renderCoordsHelper.getAltitude(e.eye)-o,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return a}function RQ(i,e,t,r){const s=AQ(i,e,LQ),n=ie(s.tiltAtCenter,t.min,t.max);if(!Ly(s.tiltAtCenter-n))return 0;let a,o;return s.centerIsOnSurface?(a=PQ(s),o=OQ(s,a)):(a=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&a<Math.PI/2&&(r.requiresTwoSteps=!0,a=Math.PI/2-1e-5),o=MQ(s,a)),r&&(r.eyeCenterDistance=eS(s,a)),o}function AQ(i,e,t){const r=i.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+qt(i.spatialReference).radius,n=i.renderCoordsHelper.intersectManifold(e.ray,r,bd);return t.eyeCenterDistance=e.distance,t.centerIsOnSurface=!1,_(n)?(t.eyeCenterDistance=Ni(e.eye,n),t.tiltAtCenter=Wd(i.renderCoordsHelper,n,e.eye),t.centerIsOnSurface=!0):i.state.isLocal?t.tiltAtCenter=Wd(i.renderCoordsHelper,e.center,e.eye):(ow(g2(_2,s),e.ray,bd),t.eyeCenterDistance=Ni(e.eye,bd),t.tiltAtCenter=ws(-oe(e.viewForward,K(bd,bd)))),t.radius=s,t.eyeRadius=xe(e.eye),t.constraints=i.state.constraints,t}function Ly(i){return Math.abs(i)>1e-9}function PQ(i){const{constraints:e,eyeCenterDistance:t,tiltAtCenter:r}=i;let s=r,n=e.clampTilt(t,r);const a=eS(i,n);if(e.clampTilt(a,r)===n)return n;let o=0;for(;o<10&&Ly(n-s);){const l=(s+n)/2,c=eS(i,l);Ly(e.clampTilt(c,l)-l)?s=l:n=l,o++}return n}function eS(i,e){if(!i.centerIsOnSurface)return i.eyeCenterDistance;const t=Math.PI-ie(e,0,Math.PI),r=hc(i.radius/i.eyeRadius*Math.sin(t)),s=Math.PI-t-r,n=Math.sin(s)/Math.sin(t);if(i.eyeRadius<i.radius&&n>1){const a=Math.PI-r,o=Math.PI-t-a;return Math.sin(o)/Math.sin(t)*i.eyeRadius}return n*i.eyeRadius}function OQ(i,e){const t=hc(i.radius/i.eyeRadius*Math.sin(i.tiltAtCenter)),r=hc(i.radius/i.eyeRadius*Math.sin(e));return i.eyeRadius>i.radius?t-r:r-t}function MQ(i,e){return i.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function IQ(i,e,t){if(e.interactionType===ot.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:a}=t,o=RR(i,r,qd,e),l=o===0?0:Wd(i.renderCoordsHelper,r.center,r.eye);t.min=n,t.max=a,e.interactionType===ot.TUMBLE?(Dy(e.selection,hi.ALTITUDE)&&lN(i,r,t),xb(o,l,!0,s,UM,t)):xb(o,l,!1,s,UM,t)}function lN(i,e,t){const r=i.state.constraints;if(i.state.isLocal||!r.altitude||!e)return;const s=Da(e.center),n=Math.sqrt(s),a=e.distance,o=qt(i.spatialReference).radius,l=r.altitude.min+o,c=r.altitude.max+o,h=(l*l-a*a-s)/(-2*n*a),u=(c*c-a*a-s)/(-2*n*a);t.min=Math.max(t.min,Math.min(Math.PI-ws(u),t.max)),t.max=Math.min(t.max,Math.PI-ws(h))}const Ah=E(),z0=ve(),bd=E(),UM=vt(5),DQ={min:0,max:0},LQ={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},Pg={eyeCenterDistance:0,requiresTwoSteps:!1};function $Q(i){return i}const Dw=i=>i*i,AR=i=>1-Dw(1-i),FQ=i=>i<.5?Dw(2*i)/2:(AR(2*(i-.5))+1)/2,PR=i=>i*i*i,cN=i=>1-PR(1-i),hN=i=>i<.5?PR(2*i)/2:(cN(2*(i-.5))+1)/2,OR=i=>i*i*i*i,dN=i=>1-OR(1-i),NQ=i=>i<.5?OR(2*i)/2:(dN(2*(i-.5))+1)/2,MR=i=>i*i*i*i*i,uN=i=>1-MR(1-i),UQ=i=>i<.5?MR(2*i)/2:(uN(2*(i-.5))+1)/2,IR=i=>1-Math.cos(i*Math.PI/2),pN=i=>1-IR(1-i),VQ=i=>i<.5?IR(2*i)/2:(pN(2*(i-.5))+1)/2,DR=i=>2**(10*(i-1)),m0=i=>1-DR(1-i),BQ=i=>i<.5?DR(2*i)/2:(m0(2*(i-.5))+1)/2,LR=i=>-(Math.sqrt(1-i*i)-1),mN=i=>1-LR(1-i),zQ=i=>i<.5?LR(2*i)/2:(mN(2*(i-.5))+1)/2;function To(i){const e=2*(i-Math.sqrt((i-1)*i)),t=e/2/i;return r=>r<t?i*r*r:e*r-e+1}function Co(i,e){return(t,r)=>t<e?e*i(t/e,r):1-i((1-t)/(1-e),r)*(1-e)}const kQ=Co(To(1),1),GQ=Co(To(1),0),fN=Co(To(1),.5),HQ=Co(To(2),1),qQ=Co(To(2),0),WQ=Co(To(2),.5),jQ=Co(To(3),1),XQ=Co(To(3),0),YQ=Co(To(3),.5),QQ=Co(To(4),1),ZQ=Co(To(4),0),KQ=Co(To(4),.5),JQ={linear:$Q,"in-quad":Dw,"out-quad":AR,"in-out-quad":FQ,"in-coast-quad":kQ,"out-coast-quad":GQ,"in-out-coast-quad":fN,"in-cubic":PR,"out-cubic":cN,"in-out-cubic":hN,"in-coast-cubic":HQ,"out-coast-cubic":qQ,"in-out-coast-cubic":WQ,"in-quart":OR,"out-quart":dN,"in-out-quart":NQ,"in-coast-quart":jQ,"out-coast-quart":XQ,"in-out-coast-quart":YQ,"in-quint":MR,"out-quint":uN,"in-out-quint":UQ,"in-coast-quint":QQ,"out-coast-quint":ZQ,"in-out-coast-quint":KQ,"in-sine":IR,"out-sine":pN,"in-out-sine":VQ,"in-expo":DR,"out-expo":m0,"in-out-expo":BQ,"in-circ":LR,"out-circ":mN,"in-out-circ":zQ};function tr(i,e,t=rZ,r=e){r!==e&&r.copyFrom(e),r.computeUp(i.state.viewingMode);let s=!1;for(let o=0;o<sZ;o++){let l=0;for(const c of iZ)if(Dy(t.selection,c.type)){const h=Math.abs(c.error(i,r,t));c.apply(i,r,t)&&(s=!0,l+=h)}if(l===0)break}const n=Dy(t.selection,hi.COLLISION),a=eZ(t.interactionType,i);return n&&cg(i,r,a)&&(s=!0),s&&r.computeUp(i.state.viewingMode),s}function eZ(i,e){switch(i){case ot.PAN:return fo.EYE_AND_CENTER;case ot.ASCEND:return e.state.isGlobal?fo.EYE_AND_CENTER_SCALE:fo.EYE_AND_CENTER;default:return fo.EYE}}function Wo(i){const e=Math.min(1,i/150);return hN(e)}function tZ(i,e,t){return RR(i,e,t)*e.distance}const iZ=[{type:hi.TILT,error:tZ,apply:oN},{type:hi.ALTITUDE,error:TR,apply:JY},{type:hi.DISTANCE,error:CR,apply:lQ}],rZ={selection:hi.ALL,interactionType:ot.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:jr.TUMBLE},sZ=5,ma=E(),Fn=E(),Ph=E(),Rs=E(),iu=E(),nZ=E(),fa={upward:qe(0,0,1),forward:qe(0,1,0),sideway:qe(1,0,0)},VM=Bs();let BM=class{constructor(e=Se.Global){this.viewingMode=e,this.center=E(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Pn(fa.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,t){if(t||(t={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Se.Global){const n=(xe(this.center)+xe(e.center))/2;t.pan=l1(this.center,e.center)*n}else t.pan=Ni(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e.pitch-this.pitch);return t.rotate=Math.max(r,s),t.sourceZoom=this.distance,t.targetZoom=e.distance,t}interpolate(e,t,r){this.viewingMode===Se.Global?aH(e.center,t.center,r.pan,this.center):ns(this.center,e.center,t.center,r.pan),this.distance=isFinite(t.distance)?dt(e.distance,t.distance,r.zoom):e.distance,this.pitch=dt(e.pitch,t.pitch,r.rotate);let s=e.yaw;const n=t.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=dt(s,n,r.rotate)}copyFrom(e){X(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,X(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const t=this._lookAtOrientation(e.center,VM);X(this.center,e.center),ee(Rs,e.center,e.eye),Jl(Rs,Rs,t),Jl(iu,e.up,t),this.distance=xe(Rs),this.distance!==0&&(Rs[0]/=this.distance,Rs[1]/=this.distance,Rs[2]/=this.distance),this.pitch=this._eyeUpToPitch(Rs),this.yaw=this._eyeUpToYaw(Rs,iu),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const t=this._lookAtOrientation(this.center,VM);gh(t,t),this._axisAngleVec3(fa.sideway,this.pitch-Math.PI/2,fa.forward,Rs),this._axisAngleVec3(fa.upward,this.yaw,Rs),this._axisAngleVec3(fa.sideway,this.pitch-Math.PI/2,fa.upward,iu),this._axisAngleVec3(fa.upward,this.yaw,iu),W(Rs,Rs,this.distance),Jl(Rs,Rs,t),Jl(iu,iu,t),e.center=this.center,e.eye=ee(Rs,this.center,Rs),e.up=iu}_axisAngleVec3(e,t,r,s=r){const n=Math.cos(t),a=Math.sin(t);return W(ma,r,n),Xe(Fn,e,r),W(Fn,Fn,a),W(Ph,e,(1-n)*oe(e,r)),J(s,J(s,ma,Fn),Ph)}_lookAtOrientation(e,t=Bs()){return this._upAtLookAt(e,Ph),Xe(ma,this.lookAtDirection,Ph),K(ma,ma),ma[0]===0&&ma[1]===0&&ma[2]===0&&X(ma,fa.sideway),Xe(Fn,Ph,ma),K(Fn,Fn),t[0]=ma[0],t[1]=Fn[0],t[2]=Ph[0],t[3]=ma[1],t[4]=Fn[1],t[5]=Ph[1],t[6]=ma[2],t[7]=Fn[2],t[8]=Ph[2],t}_upAtLookAt(e,t){return this.viewingMode===Se.Local?X(t,fa.upward):K(t,e)}_eyeUpToPitch(e){return Math.PI-l1(fa.upward,e)}_eyeUpToYaw(e,t){const r=nZ;return Math.abs(t[2])<.5?(X(r,t),e[2]>0&&W(r,r,-1)):X(r,e),Xe(Fn,r,fa.upward),K(Fn,Fn),l1(fa.sideway,Fn,fa.upward)}};const Cb={desiredScreenFlow:2,minDuration:tt(500),maxDuration:tt(8e3)};let aZ=class gN{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:Cb.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new gN(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,r){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:Cb.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},oZ=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,t)=>zo(e+t.time),zo(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition;for(let a=0;a<this.segments.length;a++){const o=this.segments[a],l=o.definition;if(e<=o.time||a===this.segments.length-1){if(t=this.segmentInterpolateComponentsAt(o,o.time===0?0:e/o.time,t),n.hasPan&&!isNaN(t.pan)&&isFinite(n.compared.pan)?t.pan=(r+l.compared.pan*t.pan)/n.compared.pan:t.pan=1,n.hasRotate&&!isNaN(t.rotate)&&isFinite(n.compared.rotate)?t.rotate=(s+l.compared.rotate*t.rotate)/n.compared.rotate:t.rotate=1,n.hasZoom&&!isNaN(t.zoom)&&isFinite(l.compared.targetZoom)){const c=t.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,u=this.segments[this.segments.length-1].definition.compared.targetZoom;t.zoom=(c-h)/(u-h)}else t.zoom=1;return t}e-=o.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,t,r){return e.interpolateComponentsAt(t,r)}},cT=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,r=t.sourceZoom,s=t.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=t.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let a=0,o=0;r&&(s&&(a=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(o=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=a+o+a*o;this._zoomPixelFlow=a*o/c*l,this._panPixelFlow=o/c*l,this._rotatePixelFlow=a/c*l}else if(r&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:zo(0)}get rotateTime(){return this.definition.hasRotate?zo(this._rotatePixels/this._rotatePixelFlow):zo(0)}get zoomTime(){return this.definition.hasZoom?zo(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):zo(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return zo(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return zo(this._panPixelsAtSource/this._panPixelFlow)}return zo(0)}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(t*(t/r)**-e-t)/(r-t)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),n=this._interpolateComponentsRotate(e);return t?(t.zoom=r,t.pan=s,t.rotate=n):t={zoom:r,pan:s,rotate:n},t}};function lZ(i,e,t){const r=e-i.compared.sourceZoom,s=i.halfWindowPanAtZoom(r);return-i.halfWindowSize*(t.ascensionFactor*Math.LN2*i.compared.pan+s)*Math.log(i.compared.sourceZoom/e)/(i.desiredPixelFlow*Math.LN2*s)}function cZ(i,e,t){const r=1/e,s=Math.log(i.compared.sourceZoom*r),n=1/i.desiredPixelFlow,a=1/Math.LN2,o=e-i.compared.sourceZoom,l=1/o,c=(t.ascensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(o))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*r*n*a*l*c-i.halfWindowSize*s*n*a*l+i.halfWindowSize*s*n*a*c/(o*o)}function hZ(i,e,t){const r=e-i.compared.sourceZoom,s=1/r,n=1/e,a=Math.log(i.compared.sourceZoom*n),o=(t.ascensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(r))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*s*(-2*s*n*o+2*s*a+2*n-2*a*o/(r*r)-o/(e*e))/(i.desiredPixelFlow*Math.LN2)}function dZ(i,e){return-i.halfWindowSize*Math.log(i.compared.sourceZoom/e)/(i.desiredPixelFlow*Math.LN2)}function uZ(i,e){return i.halfWindowSize/(e*i.desiredPixelFlow*Math.LN2)}function pZ(i,e){return-i.halfWindowSize/(e*e*i.desiredPixelFlow*Math.LN2)}function mZ(i,e,t){return-i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e))}function fZ(i,e,t){return i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e*e))}function gZ(i,e,t){return-2*i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e*e*e))}function _Z(i,e,t){return i.halfWindowSize*(-i.halfWindowPanAtZoom(e)-t.descensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(i.compared.targetZoom))*Math.log(e/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2*i.halfWindowPanAtZoom(-e+i.compared.targetZoom))}function yZ(i,e,t){const r=Math.log(e/i.compared.targetZoom),s=1/i.desiredPixelFlow,n=1/Math.LN2,a=-e+i.compared.targetZoom,o=1/a,l=(-i.halfWindowPanAtZoom(e)-t.descensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(i.compared.targetZoom))/i.halfWindowPanAtZoom(1);return-i.halfWindowSize*r*s*n*o+i.halfWindowSize*r*s*n*l/(a*a)+i.halfWindowSize*s*n*o*l/e}function vZ(i,e,t){const r=e-i.compared.targetZoom,s=1/r,n=1/e,a=Math.log(e/i.compared.targetZoom),o=(i.halfWindowPanAtZoom(e)+t.descensionFactor*Math.LN2*i.compared.pan-i.halfWindowPanAtZoom(i.compared.targetZoom))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*s*(-2*s*n*o-2*s*a+2*n+2*a*o/(r*r)-o/(e*e))/(i.desiredPixelFlow*Math.LN2)}function bZ(i,e){return i.halfWindowSize*Math.log(e/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2)}function wZ(i,e){return i.halfWindowSize/(e*i.desiredPixelFlow*Math.LN2)}function xZ(i,e){return-i.halfWindowSize/(e*e*i.desiredPixelFlow*Math.LN2)}function TZ(i){const e=Math.LN2*i.compared.pan,t=i.compared.sourceZoom-i.compared.targetZoom,r=i.halfWindowPanAtZoom(t),s=i.halfWindowSize*Math.log(i.compared.sourceZoom/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2*r);return i.compared.sourceZoom<=i.compared.targetZoom?s*(e-r):s*(e+r)}function CZ(i,e){let t=EZ(i,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,a=s?dZ:lZ,o=s?uZ:cZ,l=s?pZ:hZ,c=n?bZ:_Z,h=n?wZ:yZ,u=n?xZ:vZ,m=S=>a(i,S,r)+mZ(i,S,r)+c(i,S,r),f=S=>o(i,S,r)+fZ(i,S,r)+h(i,S,r),y=S=>l(i,S,r)+gZ(i,S,r)+u(i,S,r);let g=m(t);const v=TZ(i);let b;const x=e.maximumIterations||20,w=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<x;b++){const P=(f(t)+1e-6)/y(t);if(isNaN(P)||t>=w&&P<0){if(!isFinite(w))return null;t=w,g=m(t);break}if(t-=P,t<i.compared.sourceZoom||t<i.compared.targetZoom)return null;const A=m(t);if(Math.abs(A-g)/g<=.005)break;g=A}return g>v*(1-.3)||t<i.compared.sourceZoom||t<i.compared.targetZoom?null:t}function EZ(i,e){const t=Math.max(i.compared.sourceZoom,i.compared.targetZoom),r=i.source.zoomAtPixelsPerPan(i.desiredPixelFlow/i.compared.pan)/2;return r<t?e.maximumDistance!=null?t+(e.maximumDistance-t)/2:1.5*t:e.maximumDistance?Math.min(e.maximumDistance,r):r}let SZ=class extends oZ{constructor(e,t){super(),this._preallocSegments=[new cT,new cT,new cT],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;t&&t.apex&&(r=CZ(e,t.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,t==null?void 0:t.apex)}segmentInterpolateComponentsAt(e,t,r){return r=e.interpolateComponentsAt(t,r),e===this._ascensionSegment?r.zoom=AR(r.zoom):e===this._descensionSegment&&(r.zoom=Dw(r.zoom)),r}_updateWithApex(e,t){const[r,s,n]=this._preallocSegments,a=(t==null?void 0:t.ascensionFactor)??.5,o=Math.min(1-a,(t==null?void 0:t.ascensionFactor)!=null&&t.descensionFactor!=null?t.descensionFactor:.5),l=1-a-o;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*a,r.definition.compared.rotate=this.definition.compared.rotate*a,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*o,n.definition.compared.rotate=this.definition.compared.rotate*o,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const RZ={zoom:0,pan:0,rotate:0};let AZ=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=tt(0),this.definition=new aZ(e),this.path=new SZ}update(e,t,r){this.definition.update(e,t,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(w$(isFinite(this.path.time)?this.path.time:zo(0)),r),this._easing=r.easing?r.easing:this._time>=1e3?fN:m0}cameraAt(e,t){t=t||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,RZ);return t.interpolate(this.definition.source,this.definition.target,r),t}_normalizedEasing(e){const t=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(r-t)}_applyTimeSettings(e,t){const r=t.speedFactor!=null?t.speedFactor:1;t.duration!=null?e=t.duration:t.speedFactor!=null&&(e=tt(e/r));const s=t.minDuration!=null?t.minDuration:Cb.minDuration/r,n=t.maxDuration!=null?t.maxDuration:Cb.maxDuration/r;return tt(Math.min(Math.max(s,e),n))}};const PZ=E();let OZ=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=tt(0),this._animation=new AZ(()=>new BM(e)),this._current=new BM(e)}update(e,t,r){const s=this._animation.definition.source,n=this._animation.definition.target,a=ee(PZ,t.center,e.center),o=xe(a);o>=1e-5?(a[0]/=o,a[1]/=o,a[2]/=o):(a[0]=0,a[1]=1,a[0]=0),X(s.lookAtDirection,a),X(n.lookAtDirection,a),s.copyFromRenderCamera(e),n.copyFromRenderCamera(t),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=tt(0),e.almostEquals(t)&&(this.currentTime=this._animation.time)}cameraAt(e,t){return this._animation.cameraAt(e,this._current),t=t||new ze,this._current.copyToRenderCamera(t),t}step(e,t){return this.finished||(this.currentTime=tt(this.currentTime+w$(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)}};var $i;(function(i){i.Ready="ready",i.Rejected="rejected",i.Running="running",i.Stopped="stopped",i.Finished="finished"})($i||($i={}));let Zc=class extends ge{constructor(e){super(e),this.state=$i.Ready}get active(){return this.state===$i.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=$i.Stopped,!0)}finishController(){this.state=$i.Finished}get steppingFinished(){return!1}};d([p({constructOnly:!0})],Zc.prototype,"view",void 0),d([p({readOnly:!0})],Zc.prototype,"active",null),d([p()],Zc.prototype,"state",void 0),d([p({readOnly:!0})],Zc.prototype,"isInteractive",null),Zc=d([k("esri.views.3d.state.controllers.CameraController")],Zc);let $y=class extends Zc{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject($s()),this._asyncResult=null),this.state===$i.Finished||this.state===$i.Stopped?(T$(e),this.state===$i.Finished?e.resolve():e.reject($s())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=$i.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==$i.Ready&&this.state!==$i.Running||(this.viewAnimation.state===Zf.State.FINISHED?this.finish():this.viewAnimation.state===Zf.State.STOPPED&&(this.state=$i.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===$i.Finished?this.viewAnimation.finish():this.state===$i.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===$i.Finished?this._asyncResult.resolve():this._asyncResult.reject($s()))}finish(){this.finishController()}};$y=d([k("esri.views.3d.state.controllers.AnimationController")],$y);let ih=class extends $y{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new OZ(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new Zf}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;const r=this.animationSettings(t);k0.copyFrom(this.view.state.camera);const s=wo(this.view.state.viewingMode);this.intersectionHelper.intersectRay(k0.ray,s,zM)&&(k0.center=zM),this.animation.update(k0,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?JQ[e.easing]:e.easing}}};d([p({constructOnly:!0})],ih.prototype,"mode",void 0),d([p({readOnly:!0})],ih.prototype,"isInteractive",null),ih=d([k("esri.views.3d.state.controllers.PointToPointAnimationController")],ih);const k0=new ze,zM=E();function Lw(i=IZ){return[i[0],i[1],i[2],i[3]]}function Fy(i,e){return MZ(i[0],i[1],i[2],e,RB.get())}function MZ(i,e,t,r,s=Lw()){return s[0]=i,s[1]=e,s[2]=t,s[3]=r,s}function $R(i,e,t){return Xe(t,i,e),K(t,t),t[3]=H$(i,e),t}const IZ=[0,0,1,0];function _N(i,e,t){return DZ(i,i.screenToRender(e,Hf(We.get())),t)}function DZ(i,e,t){const r=Hf(as(We.get(),e));if(r[2]=0,!i.unprojectFromRenderScreen(r,t.origin))return null;const s=Hf(as(We.get(),e));s[2]=1;const n=i.unprojectFromRenderScreen(s,We.get());return T(n)?null:(ee(t.direction,n,t.origin),t)}function hg(i,e,t){return FR(i,i.screenToRender(e,Hf(We.get())),t)}function FR(i,e,t){X(t.origin,i.eye);const r=Z(We.get(),e[0],e[1],1),s=i.unprojectFromRenderScreen(r,We.get());return T(s)?null:(ee(t.direction,s,t.origin),t)}function NR(i,e,t,r){const s=hg(e,t,LZ);return aw(i,s,r)}const LZ=ea();var Jf;(function(i){i[i.Ellipsoid=0]="Ellipsoid",i[i.Silhouette=1]="Silhouette"})(Jf||(Jf={}));const yN=30,Eb=[1,3e8],$w=80,vN=8,bN=200,wN=1508e5,xN=5,TN=50,$Z=5,FZ=10,hT=90,Up={exclude:new Set([vd])};function op(i,e,t){return t[0]=e[0]/(i.fullWidth/i.pixelRatio),t[1]=e[1]/(i.fullHeight/i.pixelRatio),t}function tS(i){for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;return i}function jd(i,e,t){const r=ol(AB.get(),t[3],t);T(r)||LB(r,Bd)||(ee(ei,i.eye,e),Pe(ei,ei,r),i.eye=J(ei,ei,e),ee(ei,i.center,e),Pe(ei,ei,r),i.center=J(ei,ei,e),i.up=Pe(ei,i.up,r))}function NZ(i,e,t,r){return Ap(i,_N(e,t,BR),r)}function iS(i,e,t,r){return Ap(i,hg(e,t,BR),r)}function UR(i,e,t,r){const s=We.get();let n=1-t;ee(s,e,i.eye);const a=xe(s);let o=a*(1-n);n>=0&&o<r&&(o=r,n=-(o-a)/a),Math.abs(a-o)<1e-6||(W(s,s,n),i.eye=J(ei,i.eye,s),i.center=ns(ei,i.center,e,n))}function CN(i,e,t){e.getScreenCenter(kM),NR(i,e,kM,ei)&&(e.center=ei);const r=e.distance,s=r*t;if(Math.abs(r-s)<1e-6)return;const n=W(We.get(),e.viewForward,s);e.eye=ee(ei,e.center,n)}const kM=Fi();function dT(i,e){Z(e,0,0,0);for(const t of i)J(e,e,t);W(e,e,1/i.length)}function S1(i,e,t,r){return Math.sin(i/xe(e))*(t+r.radius)}function GM(i,e,t,r){return S1(Math.PI/2,e,t,r)+(i-Math.PI/2)}var qr;(function(i){i[i.Vertical=0]="Vertical",i[i.Horizontal=1]="Horizontal"})(qr||(qr={}));const HM={Elevation:3e4,Angle:vt(16)},G0={Pole:.95,Angle:vt(18),Tilt:45},EN=vt(80);function SN(i,e,t,r,s,n){const a=E(),o=yo();let l=!0,c=!0;return i.intersectScreen(t,a,n)?o[3]=xe(a):(c=!1,e.aboveGround&&s!==Jf.Ellipsoid?o[3]=Math.max(xe(e.center),.9*r.radius):o[3]=xe(e.eye)-e.relativeElevation,s===Jf.Silhouette?Ny(o,e,t,a):l=NR(o,e,t,a)),{sphere:o,scenePickPoint:l?a:null,hasGeometryIntersection:c}}function Fw(i,e,t){return xe(i.eye)-t.radius>HM.Elevation?qr.Horizontal:(hg(i,e,KM),-Math.sign(i.relativeElevation)*(.5*Math.PI+H$(i.eye,KM.direction))<HM.Angle?qr.Vertical:qr.Horizontal)}function RN(i,e,t){ee(uT,t,e),i.eye=ee(ei,i.eye,uT),i.center=ee(ei,i.center,uT)}const uT=E();function Ny(i,e,t,r){const s=hg(e,t,BR);return!T(s)&&(ow(i,s,H0),aw(i,s,r)?!(nc(H0,s.origin)<nc(r,s.origin))||(X(r,H0),!1):(ee(om,e.eye,e.center),K(om,om),tF(om,-oe(K(om,om),H0),qM),Ap(qM,s,r),!1))}const H0=E(),om=E(),qM=sr();function AN(i,e,t,r,s,n){let a=0;if(Xe(Ab,i,e),ee(X0,i,e),xe(i)<=s||!r.aboveGround){Xe(t,X0,r.eye);const o=oe(i,e)/(xe(i)*xe(e));if(o<.9999)a=ws(o);else{const c=xe(Xe(E(),i,e))/(xe(i)*xe(e));a=hc(c)}const l=Math.cos(ie(Nd.normalize(vt(n)),0,EN));a=-a-Math.max(0,xe(e)-s)/(l*s)}else ee(WM,r.eye,r.center),Xe(t,X0,WM),a=-xe(X0)/s;return K(t,t),W(t,t,xe(Ab)),a}const WM=E();function jM(i,e,t,r){let s,n;const a=Math.cos(ie(Nd.normalize(vt(r)),0,EN));return s=e>t?-(e-t)/(a*t):e<-t?Math.PI-(e+t)/(a*t):ws(e/t),n=i>t?-(i-t)/(a*t):i<-t?Math.PI-(i+t)/(a*t):ws(i/t),(n-s)*t}function UZ(i,e,t,r,s,n,a,o,l,c){const h=jM(i[2],e[2],n[3],o),u=l?jM(i[0],e[0],n[3],180):e[0]-i[0],m=Math.sin(a)*u-Math.cos(a)*h,f=Math.cos(a)*u+Math.sin(a)*h;K(ei,s);const y=l?m/Math.sqrt(Math.abs(n[3]**2-oe(t,ei)**2)):m/n[3],g=f/Math.sqrt(Math.abs(n[3]**2-oe(t,r)**2));pi(c,y,g)}function PN(i,e,t,r,s,n,a,o,l,c){Xe(Ab,i,e),xE(n.up,n.eye,q0,W0,j0),xE([0,0,1],n.eye,rh,Dd,DN),X(t,Dd),X(r,rh),K(t,t),W(t,t,xe(Ab)),iO(i,K(W0,W0),K(j0,j0),K(q0,q0),XM),iO(e,W0,j0,q0,YM),UZ(XM,YM,i,rh,Dd,a,o,l,c,s)}function VZ(i,e,t,r,s,n,a){ol(Sb,s,r),ol(Rb,a,n),Sr(ff,Sb,Rb),ee(e,i,t),Pe(e,e,ff),J(e,e,t)}function ON(i,e,t,r,s,n){ol(Sb,r,t),ol(Rb,n,s),Sr(ff,Sb,Rb),ee(ei,i.eye,e),Pe(ei,ei,ff),i.eye=J(ei,ei,e),ee(ei,i.center,e),Pe(ei,ei,ff),i.center=J(ei,ei,e),ee(ei,i.up,e),Pe(ei,ei,ff),i.up=J(ei,ei,e)}function VR(i,e,t,r,s,n){return(Math.abs(r)>Math.PI-G0.Angle||Math.abs(r)<G0.Angle)&&(Math.abs(i[2])<t*G0.Pole||Math.abs(e)>t)&&n.aboveGround&&s<G0.Tilt}function MN(i,e,t,r,s,n){if(n)$R(t,r,QM),jd(e,i,QM);else{const a=AN(t,r,ZM,e,i[3],s);jd(e,i,Fy(ZM,a))}}function IN(i,e,t,r,s,n,a){const o=a?20:1,l=1e-12;let c,h;X(ru,r),Y0.copyFrom(e);for(let u=0;u<o&&nc(t,ru)>l&&(c=nc(t,ru),PN(t,ru,Dd,rh,Og,Y0,i,s,n,a),ON(Y0,i,rh,Og[1],Dd,Og[0]),VZ(ru,ru,i,rh,Og[1],Dd,Og[0]),h=nc(t,ru),h<c||u===0);u++)e.copyFrom(Y0)}function BZ(i,e,t,r,s,n,a){VR(t,oe(e.up,t),i[3],-Nd.normalize(vt(s)),n,e)?IN(i,e,t,r,-Nd.normalize(vt(s)),n,a):MN(i,e,t,r,n,a)}function zZ(i,e,t,r,s,n){const{eye:a}=i;xE([0,0,1],a,rh,Dd,DN);const o=e.translation[0]*t.pan,l=s.mode==="zoom"?0:e.translation[1]*t.pan,c=Math.max(Math.sqrt(Math.abs(1-oe(i.center,rh)**2/xe(i.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*o)/c,u=-Math.cos(n)*l+Math.sin(n)*o;switch(mo(r.pan.matrix,r.pan.matrix,h,rh),r.pan.enabled=!0,s.mode){case"pan":mo(r.pan.matrix,r.pan.matrix,u,Dd),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*t.zoom}}function kZ(i,e,t,r,s){const{eye:n,viewRight:a}=i,o=Xe(We.get(),a,n),l=e.translation[0]*t.pan;switch(l!==0&&(mo(r.pan.matrix,r.pan.matrix,-l,o),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*t.pan;c!==0&&(mo(r.pan.matrix,r.pan.matrix,c,a),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*t.zoom}}function GZ(i,e,t,r,s,n,a,o,l){VR(i.center,oe(i.up,i.center),xe(i.center),-Nd.normalize(vt(n)),a,e)?zZ(e,t,r,o,l,-Nd.normalize(vt(s))):kZ(e,t,r,o,l)}const rh=E(),Dd=E(),DN=E(),q0=E(),W0=E(),j0=E(),XM=E(),YM=E(),Og=Ne(),QM=Lw(),Sb=ve(),Rb=ve(),ff=ve(),ru=E(),ei=E(),X0=E(),Y0=new ze,Ab=E(),ZM=E(),BR={origin:E(),direction:E()},KM={origin:E(),direction:E()},JM=.6,pT=4,HZ=60;let Pb=class extends ih{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new ze,this._tmpViewDir=E(),this._tmpRayDir={origin:E(),direction:E()},this._targetOnSphere=E(),this._tmpCenter=E(),this._constraintOptions={selection:hi.ALL_EXCEPT_COLLISION,interactionType:ot.ZOOM,interactionFactor:null,interactionStartCamera:new ze,interactionDirection:null,tiltMode:jr.TUMBLE},this._sphere=yo()}initialize(){this._intersector=wo(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s));let n=!1,a=!1;this.intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?Up:{})&&(n=e>0,a=!0),this._tmpCamera.copyFrom(r.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:X(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,t,a),this.begin(this._tmpCamera)}animationSettings(){return{duration:tt(600),easing:m0}}_updateCamera(e,t,r,s,n){const a=qt(this.view.spatialReference),o=Fw(e,s,a),l=Math.abs(this.view.camera.position.z);K(Z0,e.eye),W(Z0,Z0,-1),hg(e,s,this._tmpRayDir),K(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=ie(Math.min(vN,1/Math.abs(oe(Z0,this._tmpRayDir.direction)))*l,bN,wN);if(o===qr.Horizontal){let h=JM**t;this._sphere[3]=xe(r),ee(this._tmpViewDir,e.center,e.eye);const u=Math.min(xe(this._tmpViewDir),c);let m=u*h;if(h<=1&&m<pT&&(m=pT,h=m/u),Math.abs(u-m)<1e-6)return;const f=xe(e.center);if(this._sphere[3]!==f){const y=this._sphere[3]+h*(f-this._sphere[3]);e.center=W(Q0,e.center,y/f)}W(this._tmpViewDir,this._tmpViewDir,-h),e.eye=J(Q0,e.center,this._tmpViewDir),tr(this.view,e,this._constraintOptions),nc(r,e.center)>1e-12&&NR(this._sphere,e,s,this._targetOnSphere)&&BZ(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let h=JM**Math.abs(t);const u=t>0?1:-1;ee(this._tmpViewDir,r,e.eye);const m=xe(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,HZ);let y=_(f)?f:c;y=n&&t>0?Math.min(y,m):y,W(this._tmpRayDir.direction,this._tmpRayDir.direction,y),J(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=y*h;const v=Math.max(pT,1.01*e.nearFar[0]);if(t>0&&g<v&&(g=v,h=g/y),Math.abs(y-g)<1e-6)return;W(this._tmpRayDir.direction,this._tmpRayDir.direction,u*(1-h)),e.eye=J(Q0,e.eye,this._tmpRayDir.direction),e.center=J(Q0,e.center,this._tmpRayDir.direction)}cg(this.view,e)}};Pb=d([k("esri.views.3d.state.controllers.global.ZoomStepController")],Pb);const Q0=E(),Z0=E(),qZ=.6,WZ=4,jZ=60;let Ob=class extends ih{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new ze,this._tmpRayDir=E(),this._tmpCenter=E(),this._constraintOptions={selection:hi.ALL,interactionType:ot.ZOOM,interactionFactor:null,interactionStartCamera:new ze,interactionDirection:null,tiltMode:jr.TUMBLE}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(r.camera);const n=wo(this.view.state.viewingMode);let a=!1;e>0?(a=this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,this.view.map.ground.opacity===0?Up:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:X(this._zoomLocation,this._tmpCamera.center);const o=qZ**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,jZ);ee(K0,this._tmpCamera.eye,this._zoomLocation),K(K0,K0);const c=ie(Math.min(vN,1/Math.abs(oe(XZ,K0)))*Math.abs(this.view.camera.position.z),bN,wN);if(l=_(l)?l:c,l){const h=E();ee(h,this._zoomLocation,this._tmpCamera.eye),(l<xe(h)||!a)&&(K(h,h),J(this._zoomLocation,this._tmpCamera.eye,W(h,h,l)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:tt(600),easing:m0}}_updateCamera(e,t,r){ee(this._tmpRayDir,r,e.eye);const s=xe(this._tmpRayDir);let n=s*t;const a=t<=1,o=Math.max(WZ,1.01*e.nearFar[0]);n!==0&&(a&&n<o&&(n=o,t=n/s),Math.abs(s-n)<1e-6||(W(this._tmpRayDir,this._tmpRayDir,t),e.eye=ee(eI,r,this._tmpRayDir),e.center=ns(eI,e.center,r,1-t),tr(this.view,e,this._constraintOptions)))}};Ob=d([k("esri.views.3d.state.controllers.local.ZoomStepController")],Ob);const eI=E(),XZ=qe(0,0,1),K0=E();function YZ(i,e){switch(e){case"primary":return i.pointerType==="touch"||i.button===0;case"secondary":return i.pointerType!=="touch"&&i.button===2;case"tertiary":return i.pointerType!=="touch"&&i.button===1}}function zR(i,e){if(i.pointerType==="touch")return!1;switch(e){case"primary":return i.button===0;case"secondary":return i.button===2;case"tertiary":return i.button===1}}let QZ=class extends ls{constructor(e,t){super(!0),this._view=e,this.registerIncoming("double-click",t,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const t=e.data;if(YZ(t,"primary")){const r=this._view.state.isGlobal?new Pb({view:this._view,mode:"animation"}):new Ob({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Fi(t.x,t.y)),e.stopPropagation()}}};function ZZ(i,e,t){return i===Se.Global?new JZ(t):new KZ(e,t)}let KZ=class{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=qt(t),this._unitInMeters=Yd(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,r,s,n){var w;n||(n={near:0,far:0});let a=e[2]*this._unitInMeters;const o=a,l=a-s,c=(w=this._elevationProvider)==null?void 0:w.visibleElevationBounds;c&&(a=l>=0?o-this._unitInMeters*c.min:this._unitInMeters*c.max-o);const h={x:(r=_(r)?r:new ms({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},u=Math.max(h.x,h.y,h.z);ee(su,t,e),lm[0]=su[0]>0?r.xmax:r.xmin,lm[1]=su[1]>0?r.ymax:r.ymin,lm[2]=su[2]>0?u/2:-u/2,ee(lm,lm,e),K(su,su);const m=1.1*oe(lm,su)*this._unitInMeters,f=Math.sqrt(a*(a+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),g=y*iK*this._unitInMeters,v=y*rK*this._unitInMeters,b=ie((a-v)/(g-v),0,1)**3,x=Math.min(dt(f,m,b),f)*Math.max(Math.log(Math.abs(l)),1);return LN(Math.min(x,Math.max(34064e4,u))/this._unitInMeters,eK,this._unitInMeters,n)}},JZ=class{constructor(e){this._referenceEllipsoid=qt(e)}compute(e,t,r,s,n){n||(n={near:0,far:0});const a=xe(e),o=a-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(o-s),h=Math.max(c,Math.abs(o)),u=Math.sqrt(h*(h+2*l)),m=a+this._referenceEllipsoid.radius;return LN(1.2*dt(u,m,yR(h)),ie(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,n)}};function LN(i,e,t,r){const s=tK/t;return i/e>s?(r.far=i,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const eK=2e4,tK=2,iK=.001,rK=1e-4,lm=E(),su=E();let R1=class extends ge{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;_(e.spatialReference)&&aN(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>cg(this.view,e,fo.EYE_AND_CENTER))}};d([p({constructOnly:!0})],R1.prototype,"view",void 0),R1=d([k("esri.views.3d.state.ElevationCollisionConstraint")],R1);let E_=class extends ge{constructor(e){super(e),this.nearFarHeuristic=ZZ(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([z(()=>{var e,t,r,s;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),z(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),z(()=>this.view.renderDataExtent,()=>this._updateNearFar(),ii),z(()=>{var e,t,r,s;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),ii),z(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),ii),z(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),ii),z(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),ii),z(()=>{var e,t,r,s,n,a;return[(r=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:r.type,(a=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:a.enabled]},()=>this._updateCollision(),ii)]),this.view.state.isLocal&&this.addHandles(z(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Je)),this._updateNearFar(),this.view.state.viewingMode!==Se.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new R1({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,Iw(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var s,n,a;const e=(a=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:a.type,t=!e||e==="stay-above",r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(hi.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Se.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(vt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(ca(r))}}_updateLocalSurfaceDistance(e){if(T(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.zmax!=null&&e.zmin!=null&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,s=3*t/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=hi.ALL){this.view.state.updateCamera(t=>tr(this.view,t,{selection:e,interactionType:ot.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:jr.TUMBLE}))}};d([p({constructOnly:!0})],E_.prototype,"view",void 0),d([p({readOnly:!0})],E_.prototype,"surfaceCollisionConstraint",void 0),E_=d([k("esri.views.3d.state.ConstraintsManager")],E_);let wd=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=xy(),this._points=ik(),this.lines=new Array(12),this._origin=E(),this._direction=E(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:E(),endpoint:null}}update(e){XF(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),X(this._origin,e.eye),X(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)X(this._points[t],e[t]);rk(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return fw(this.frustum,e)}intersectsRay(e){return sk(this.frustum,e)}intersectsLineSegment(e,t){return nk(this.frustum,e,t)}intersectsPoint(e){return YF(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const r=t+4;mT(this.lines[t],e[t],e[r]),mT(this.lines[t+4],e[t],t===3?e[0]:e[t+1]),mT(this.lines[t+8],e[r],t===3?e[4]:e[r+1])}}};function mT(i,e,t){i.origin=e,i.endpoint=t,Rp(i.direction,e,t)}wd.planePointIndices=ak,wd.nearFarLineIndices=[[yi.NEAR_BOTTOM_LEFT,yi.FAR_BOTTOM_LEFT],[yi.NEAR_BOTTOM_RIGHT,yi.FAR_BOTTOM_RIGHT],[yi.NEAR_TOP_RIGHT,yi.FAR_TOP_RIGHT],[yi.NEAR_TOP_LEFT,yi.FAR_TOP_LEFT]];let X_=class extends Zc{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e),this._handles=new mi}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=$i.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){_(e.spatialReference)&&!aN(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),cg(this.view,e,fo.EYE_AND_CENTER)||this.constraintEnabled||(this.state=$i.Stopped)})}};d([p({constructOnly:!0})],X_.prototype,"desiredCamera",null),X_=d([k("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],X_);const sK=E(),J0=E();function kR(){return{direction:E(),up:E()}}function $N(i,e,t,r,s){let n=K(sK,i),a=oe(n,r);const o=a>0;a=Math.abs(a),a>.99&&(a=Math.abs(oe(e,r)),a<.99?(X(n,e),o&&W(n,n,-1)):n=null);let l=0;if(n){W(J0,r,oe(r,n)),ee(n,n,J0);const h=oe(n,s)/(xe(n)*xe(s));Xe(J0,n,s),l=(oe(J0,r)>0?1:-1)*ca(ws(h))}const c=ca(ws(-oe(r,i)/xe(i)));return t?(t.heading=l,t.tilt=c,t):{heading:l,tilt:c}}const FN=qe(0,1,0),NN=qe(0,0,1),Mg=ve(),Rc=E(),Ac=E();function UN(i,e,t,r=kR()){const{direction:s,up:n}=r;return $B(Mg,-vt(e)),gy(Mg,Mg,vt(t)),Pe(s,NN,Mg),W(s,s,-1),Pe(n,FN,Mg),r}function nK(i,e,t,r){return $N(e,t,r,NN,FN)}function aK(i,e,t,r){const s=UN(i,t,r),n=E();return W(n,s.direction,-e),J(n,n,i),{up:s.up,eye:n,heading:t,tilt:r}}function oK(i){return ca(i)}function lK(i){return vt(i)}function VN(i,e,t,r,s){const n=i.renderSpatialReference,a=i.map&&i.spatialReference||e.spatialReference;return xs(e,Rc,n),xs(e,Ac,n),Rc[0]-=t/2,Ac[0]+=t/2,Rc[1]-=r/2,Ac[1]+=r/2,vs(Rc,n,Rc,a),vs(Ac,n,Ac,a),s?(s.xmin=Rc[0],s.ymin=Rc[1],s.xmax=Ac[0],s.ymax=Ac[1],s.spatialReference=a):s=new ms(Rc[0],Rc[1],Ac[0],Ac[1],a),s}const cK=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:nK,eyeForCenterWithHeadingTilt:aK,eyeTiltToLookAtTilt:lK,headingTiltToDirectionUp:UN,lookAtTiltToEyeTilt:oK,toExtent:VN},Symbol.toStringTag,{value:"Module"})),BN=qe(0,0,1),zN=K(E(),qe(1,1,1)),hK=new dy(-180,180),Ig=ve(),fd=E(),cm=E();function kN(i,e,t,r=kR()){Xe(fd,i,BN),oe(fd,fd)===0&&Xe(fd,i,zN),ol(Ig,-vt(e),i),mo(Ig,Ig,-vt(t),fd);const{up:s,direction:n}=r;return Xe(s,fd,i),K(s,s),Pe(s,s,Ig),K(n,i),On(n,n),Pe(n,n,Ig),r}function dK(i,e,t,r){const s=fd,n=cm;return K(s,i),Xe(cm,s,BN),oe(cm,cm)===0&&Xe(cm,s,zN),Xe(n,cm,s),$N(e,t,r,s,n)}function uK(i,e,t,r){const s={eye:E(),up:null,tilt:r,heading:t},n=fd;n[0]=i[0],n[1]=i[2],n[2]=-i[1];const a=e,o=vt(t),l=vt(r),c=Math.sin(o),h=Math.cos(o),u=Math.sin(l),m=Math.cos(l),f=xe(n);let y;if(Math.abs(l)<1e-8)y=a+f;else{const D=f/u,H=hc(a/D),G=Math.PI-l-H;y=D*Math.sin(G)}const g=m*a,v=a*a*(u*u),b=h*h*v,x=y-g,w=x*x,S=b*(b+w-n[1]*n[1]);if(S<0)return W(s.eye,n,y/f),s.tilt=0,ev(s,i);const P=Math.sqrt(S),A=n[1]*x,M=b+w;let O;if(O=h>0?-P+A:P+A,Math.abs(M)<1e-8)return f<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=a):W(s.eye,n,y/f),s.tilt=0,fT(s.eye),ev(s,i);s.eye[1]=O/M;const I=c*c*v,N=u*a,F=h*N*s.eye[1],V=s.eye[1]*s.eye[1],Q=1-V,ae=Math.sqrt(Q),q=b*V+I-2*F*ae*x+Q*w;return Math.abs(q)<1e-8?(W(s.eye,n,y/f),s.tilt=0,fT(s.eye),ev(s,i)):(s.eye[0]=(Q*(y*n[0]-g*n[0])-N*ae*(n[0]*s.eye[1]*h+n[2]*c))/q,s.eye[2]=(Q*(y*n[2]-g*n[2])-N*ae*(n[2]*s.eye[1]*h-n[0]*c))/q,W(s.eye,s.eye,y),fT(s.eye),ev(s,i))}function fT(i){const e=i[1];i[1]=-i[2],i[2]=e}function ev(i,e){const t=kN(e,i.heading,i.tilt);return i.up=t.up,i}function pK(i,e,t){const r=xe(e),s=Math.sqrt(t*t+r*r-2*t*r*Math.cos(Math.PI-i)),n=hc(t/(s/Math.sin(i)));return ca(i-n)}function mK(i,e,t){const r=vt(i),s=xe(e);return hc(t/(s/Math.sin(r)))+r}function GN(i,e,t,r,s){let n,a,o,l;const c=e.latitude,h=qt(i.spatialReference).radius,u=e.longitude,m=PY(c,t,h)/2;n=u-m,a=u+m;const f=vt(c),y=(1+Math.sin(f))/(1-Math.sin(f)),g=(y+1)*Math.tan(r/h/2),v=g*g;function b(w){const S=Math.PI/2;return(w=E8.normalize(w,-S))>S&&(w=Math.PI-w),w}if(o=1.5*Math.PI-2*Math.atan(.5*(g+Math.sqrt(4*y+v))),l=o+r/h,o=b(o),l=b(l),l<o){const w=l;l=o,o=w}if(o=Math.max(ca(o),-90),l=Math.min(ca(l),90),a=hK.monotonic(n,a),a-n>180){const w=(a-n-180)/2;n+=w,a-=w}const x=i.spatialReference&&i.spatialReference.isGeographic?i.spatialReference:ci.WGS84;return s?(s.xmin=n,s.ymin=o,s.xmax=a,s.ymax=l,s.spatialReference=x):s=new ms(n,o,a,l,x),i.spatialReference&&i.spatialReference.isWebMercator&&a2(s,!1,s),s}const fK=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:dK,eyeForCenterWithHeadingTilt:uK,eyeTiltToLookAtTilt:mK,headingTiltToDirectionUp:kN,lookAtTiltToEyeTilt:pK,toExtent:GN},Symbol.toStringTag,{value:"Module"}));function Mb(i){return i.type==="point"}let HN=class{constructor(e,t=null,r=0){this.array=e,this.spatialReference=t,this.offset=r}};function qN(i){return"array"in i}function tc(i,e,t="ground"){if(Mb(e))return i.getElevation(e.x,e.y,e.z||0,e.spatialReference,t);if(qN(e)){let r=e.offset;return i.getElevation(e.array[r++],e.array[r++],e.array[r]||0,Ze(e.spatialReference,i.spatialReference),t)}return i.getElevation(e[0],e[1],e[2]||0,i.spatialReference,t)}function Ib(i,e){return i!=null&&(e==null||(e===Se.Local?!i.isGeographic||i.isWGS84||i.wkid===vg.CGCS2000:i.isWebMercator||i.isWGS84||i.wkid===vg.CGCS2000||i.wkid===vg.GCSMARS2000||i.wkid===vg.GCSMARS2000_SPHERE||i.wkid===vg.GCSMOON2000))}const WN=pe.getLogger("esri.views.3d.support.cameraUtils"),jN=39.37,XN=96,rS=1,gK=8,_K=5,YN=1,tI=E(),yK={heading:0,tilt:0},xd=new kt,vK=new dy(-20037508342788905e-9,20037508342788905e-9),bK=new dy(-180,180);var ys;function f0(i){return i.spatialReference||ci.WGS84}function dg(i){return i.viewingMode==="global"?fK:cK}function wK(i,e,t,r,s){return dg(i).headingTiltToDirectionUp(e,t,r,s)}function Yc(i,e){if(T(e))return null;const t=i.renderSpatialReference,r=dg(i).headingTiltToDirectionUp,s=E();if(!xs(e.position,s,t))return null;const n=r(s,e.heading,e.tilt);W(n.direction,n.direction,i.state.camera.distance),J(n.direction,n.direction,s);const a=Np(i,s,n.direction,n.up);return a.fov=vt(e.fov),a}(function(i){i[i.LOCKED=0]="LOCKED",i[i.ADJUST=1]="ADJUST"})(ys||(ys={}));const hm=E();function eg(i,e,t){const r=i.renderSpatialReference,s=Nw(i,e.eye,e.viewForward,e.up,yK);let n=f0(i);return vs(e.eye,r,hm,n)||(n=ci.WGS84,vs(e.eye,r,hm,n)),T(t)?new bo(new kt(hm,n),s.heading,s.tilt,ca(e.fov)):(t.position.x=hm[0],t.position.y=hm[1],t.position.z=hm[2],t.position.spatialReference=n,t.heading=s.heading,t.tilt=s.tilt,t.fov=ca(e.fov),t)}function GR(i,e,t){const r=i.state.camera,s=r.width/2/r.pixelRatio;return i.renderCoordsHelper.viewingMode===Se.Global&&t!=null&&(e*=Math.cos(vt(t))),e/=i.renderCoordsHelper.unitInMeters,s/(XN*jN/e)/Math.tan(r.fovX/2)}function wp(i,e,t){const r=i.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let a=XN*jN/(n/s);return i.renderCoordsHelper.viewingMode===Se.Global&&t!=null&&(a/=Math.cos(vt(t))),a*=i.renderCoordsHelper.unitInMeters,a}function QN(i,e,t,r,s,n){return ZN(i,e,GR(i,t,e.latitude),r,s,n)}function ZN(i,e,t,r,s,n){if(lp(n)){const o=new ug(n.signal);return Uy(i,r.heading,r.tilt,e,t,s,o),void o.resolver.promise.then(l=>{const c=Lb(i,l,r.fov);if(!T(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const a=Uy(i,r.heading,r.tilt,e,t,s);return Lb(i,a,r.fov,n)}function Nw(i,e,t,r,s){return dg(i).directionToHeadingTilt(e,t,r,s)}function xK(i,e){return!!(i.basemapTerrain&&i.renderCoordsHelper.fromRenderCoords(e,xd,i.spatialReference)&&i.elevationProvider&&Ze(tc(i.elevationProvider,xd),0)>(xd.z??0)-YN)}async function TK(i,e,t){if(!i.renderCoordsHelper.fromRenderCoords(e,xd,i.spatialReference)||!i.elevationProvider)return!1;const r=xd.z??0,s=await i.elevationProvider.queryElevation(xd.x,xd.y,r,xd.spatialReference,"ground",t);return Ze(s,0)>r-YN}async function CK(i,e,t){const r=E();if(e)if(e instanceof kt){if(xs(e,r,i.renderSpatialReference),e.z==null&&i.basemapTerrain!=null&&i.elevationProvider!=null){const s=await i.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",t);return _(s)&&i.renderCoordsHelper.setAltitude(r,s),r}}else X(r,e);else X(r,i.state.camera.center);return r}function EK(i,e){const t=E();if(e&&e instanceof kt){if(xs(e,t,i.renderSpatialReference),e.z==null&&i.basemapTerrain!=null&&i.elevationProvider!=null){const r=tc(i.elevationProvider,e);_(r)&&i.renderCoordsHelper.setAltitude(t,r)}}else X(t,e||i.state.camera.center);return t}function Uy(i,e,t,r,s,n,a){const o=r&&r instanceof kt?r:null;if(lp(a))return CK(i,r,a.signal).then(c=>{sS(i,e,t,o,c,s,n,a)},c=>a.resolver.reject(c)),null;const l=EK(i,r);return sS(i,e,t,o,l,s,n,a)}function sS(i,e,t,r,s,n,a,o){if(T(r)){const u=i.renderSpatialReference;if(r=Ud(s,u,f0(i)),T(r))return null}n=Math.max(n,i.state.constraints.minimumPoiDistance);const l=AK(i,e,t,s,n,a),c=(0,dg(i).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(a===ys.ADJUST&&i.viewingMode==="global"&&t>0){const u=()=>{const f=KN(i,s,n,OK(i,n,t,s));return a=t-f<1?ys.LOCKED:ys.ADJUST,sS(i,e,f,r,s,n,a,o)},m=i.map.ground.navigationConstraint;if(!m||m.type==="stay-above"){if(xK(i,c.eye))return u();if(lp(o))return TK(i,c.eye,o.signal).then(f=>f?u():(o.resolver.resolve({eye:c.eye,up:c.up,center:Pn(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!o||lp(o)?{center:E(),eye:E(),up:E(),tilt:0,heading:0}:o;return h.eye=c.eye,h.up=c.up,h.center=Pn(s),h.heading=c.heading,h.tilt=c.tilt,lp(o)&&o.resolver.resolve(h),h}function Y_(i,e,t,r,s,n=null){let a,o,l;if(i.state.isGlobal){if(!Ib(e.spatialReference,Se.Global))return lp(n)&&n.resolver.reject(),null;const v=new kt(e.xmin,e.ymin,e.spatialReference),b=new kt(e.xmax,e.ymax,e.spatialReference),x=e.spatialReference.isGeographic?bK:vK;a=new kt({x:x.center(v.x,b.x),y:(b.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const w=qt(e.spatialReference),S=AY(a,v,b);o=S.lon,l=S.lat,x.diff(v.x,b.x)>x.range/2&&(o+=w.halfCircumference),o=Math.min(o,w.halfCircumference),l=Math.min(l,w.halfCircumference)}else{const v=Ze(i.renderSpatialReference,e.spatialReference);v.equals(e.spatialReference)||(e=rw(e,v)),o=e.xmax-e.xmin,l=e.ymax-e.ymin;const b=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;a=new kt({x:e.xmin+.5*o,y:e.ymin+.5*l,z:b,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,h=i.state.camera,u=1/Math.tan(h.fovX/2),m=1/Math.tan(h.fovY/2),f=1/Math.tan(h.fov/2),y=Math.max(.5*o*u,.5*l*m,.5*c*f)/rS;if(lp(n)){const v=new ug(n.signal);return Uy(i,t,r,a,y,s,v),void v.resolver.promise.then(b=>{const x=Lb(i,b,i.camera.fov);if(!T(x))return n.resolver.resolve(x);n.resolver.reject()},b=>n.resolver.reject(b))}const g=Uy(i,t,r,a,y,s);return Lb(i,g,i.camera.fov,n)}function SK(i,e,t){const r=i.renderSpatialReference,s=Ud(t,r,f0(i));if(T(s))return null;const n=Math.tan(e.fovX/2),a=Math.tan(e.fovY/2),o=d2(e.eye,t),l=2*o*n*rS,c=2*o*a*rS;return i.viewingMode==="global"?GN(i,s,l,c):VN(i,s,l,c)}function RK(i,e,t){const r=i.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(t/r)/Math.LN2>gK)return!0;const s=i.renderSpatialReference,n=f0(i),a=Ud(e,s,n),o=Ud(i.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(T(a)||T(o))return!1;const l=Math.tan(.5*i.state.camera.fov)*r;return o.distance(a)/l>_K}function AK(i,e,t,r,s,n){let a=0;return n===ys.ADJUST&&RK(i,r,s)?(e=0,a=PK(i,s,t,r)):a=HR(i,r,s,t),a=i.state.constraints.clampTilt(s,a),{heading:e,tilt:t=KN(i,r,s,a)}}const Db=.7;function PK(i,e,t,r){const s=HR(i,r,e,t);if(!i.state.constraints.tilt)return s;const n=i.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const a=n.min*(1-Db)+n.max*Db;return Math.min(s,a)}function OK(i,e,t,r){let s=HR(i,r,e,t);if(!i.state.constraints.tilt)return s;const n=i.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-Db)+s*Db}function KN(i,e,t,r){return dg(i).lookAtTiltToEyeTilt(r,e,t)}function HR(i,e,t,r){return dg(i).eyeTiltToLookAtTilt(r,e,t)}function Lb(i,e,t,r){if(T(e))return null;const s=i.renderSpatialReference,n=Ud(e.eye,s,f0(i));return T(n)?null:_(r)?(r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=t,r):new bo(n,e.heading,e.tilt,t)}function MK(i,e){var r;const t=(r=i.basemapTerrain)==null?void 0:r.tilingScheme;if(t)return t.levelAtScale(e);WN.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function JN(i,e){var r;const t=(r=i.basemapTerrain)==null?void 0:r.tilingScheme;if(t)return t.scaleAtLevel(e);WN.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function e9(i,e){return vs(e.center,i.renderSpatialReference,tI,ci.WGS84),wp(i,e.distance,tI[1])}let ug=class{constructor(e){this.signal=e,this.resolver=hp()}};function lp(i){return i&&"resolver"in i}const IK=.66;function t9(i){return 360-r2.normalize(i)}function Uw(i){return r2.normalize(360-i)}function Dg(i){return _(i)&&i.resolver&&i.resolver.reject(),null}function DK(i,e){return _(i)&&i.resolver&&i.resolver.resolve(e),e}function i9(i,e,t,r=null){if(!e)return Dg(r);const s=i.spatialReference||ci.WGS84;if(_(e.camera)){const c=l2(e.camera.position,s);if(T(c))return Dg(r);const h=e.camera.clone();return h.position=c,DK(r,h)}if(T(e.targetGeometry))return Dg(r);const n=e.get("targetGeometry.spatialReference");if(n&&!Q1(n,s))return Dg(r);const a=eg(i,i.state.camera);let o=ys.ADJUST;if(e.rotation!=null&&(a.heading=t9(e.rotation),o=ys.LOCKED),t!=null&&(a.tilt=t),e.targetGeometry.type==="point"){const c=e.targetGeometry;let h;const u=e.targetGeometry.clone();return h=e.scale!=null?GR(i,e.scale,c.latitude):i.state.camera.distance,ZN(i,u,h,a,o,r)}const l=e.targetGeometry.extent;return l?Y_(i,l,a.heading,a.tilt,o,r):Dg(r)}function LK(i,e,t=null){return T(t)&&(t=new hl),jR(i,null,e.clone(),t)}async function $K(i,e,t){const r=qK(i,e);if(!r)throw new ue("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new bo({fov:i.camera.fov}),n=new hl({camera:s});if(r.target instanceof hl)return nu(await UK(i,r.target,r,t,n));if(r.target instanceof bo)return nu(s9(i,r.target,n));const a=r.scale!=null||r.zoom!=null;if(r.target instanceof ms){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return nu(a||c?await nS(i,r,r.target.center,s,t,n):await kK(i,r,r.target,s,t,n))}const o={boundingBox:Pi(),hasZ:!1,screenSpaceObjects:[]},l=a?FK(i,r):void 0;if(await r9(i,r.target,l,o),isFinite(o.boundingBox[0])){let c;if(Ko(o.boundingBox,Ji),Aa.x=Ji[0],Aa.y=Ji[1],Aa.z=Ji[2],Aa.spatialReference=i.spatialReference,isFinite(Aa.z)&&o.hasZ?c=k2(o.boundingBox):(Aa.z=void 0,c=_B(G2(o.boundingBox,jK))),a||c)return nu(await nS(i,r,Aa,s,t,n));const h=WK(i,o.screenSpaceObjects);return nu(await HK(i,r,Aa,o.boundingBox,h,s,t,n))}return r.position?nu(BK(i,r,s,n)):nu(await zK(i,r,s,t,n))}function qR(i,e){return e.scale==null&&e.zoom!=null?JN(i,e.zoom):e.scale}function FK(i,e){const t=qR(i,e);return t?jB(t):void 0}function WR(i,e){let t=!1;return e.heading!=null?(i.heading=e.heading,t=!0):e.rotation!=null&&(i.heading=t9(e.rotation),t=!0),e.tilt!=null&&(i.tilt=e.tilt,t=!0),e.fov!=null&&(i.fov=e.fov),t}function jR(i,e,t,r){const s=i.spatialReference||ci.WGS84;return e=_(e)?e:Yc(i,t),T(e)||(r.targetGeometry=Ud(e.center,i.renderSpatialReference,s),r.scale=e9(i,e),r.rotation=Uw(t.heading),r.camera=t),r}function $b(i,e,t){var o,l;const r=()=>new ue("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw r();if(!Q1(e.spatialReference,i.spatialReference))throw new ue("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(o=i.spatialReference)==null?void 0:o.wkid})`,{geometry:e});const s=[];if(!e.hasZ&&i.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&_(i.basemapTerrain.spatialReference)&&Q1(c,i.basemapTerrain.spatialReference)&&i.elevationProvider?Ji[2]=Ze(tc(i.elevationProvider,c),0):Ji[2]=0}(0,XK[e.type])(e,c=>{s.push(c[0],c[1],c[2])},Ji);const n=s.length/3;if(n===0)throw r();const a=new Array(s.length);if(In(s,e.spatialReference,0,a,i.spatialReference,0,n)){e.hasZ&&(t.hasZ=!0);for(let c=0;c<a.length;c+=3)e.hasZ?(Ji[0]=a[c+0],Ji[1]=a[c+1],Ji[2]=a[c+2]):(Ji[0]=a[c+0],Ji[1]=a[c+1]),jf(t.boundingBox,Ji)}}async function NK(i,e,t,r){const s=await yy(i.whenViewForGraphic(e));if(s.ok===!1||T(s.value)||!("whenGraphicBounds"in s.value))return void $b(i,e.geometry,r);const n=s.value,a=await yy(n.whenGraphicBounds(e,{minDemResolution:t}));if(a.ok===!1)return void $b(i,e.geometry,r);const{screenSpaceObjects:o,boundingBox:l}=a.value;Xf(r.boundingBox,l),o&&o.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function r9(i,e,t,r){var s;if(Array.isArray(e)&&e.length===2){const n=e[0],a=e[1];if(typeof n=="number"&&typeof a=="number")return Aa.x=n,Aa.y=a,Aa.z=void 0,Aa.spatialReference=(s=i.spatialReference)!=null&&s.isGeographic?i.spatialReference:ci.WGS84,void $b(i,Aa,r)}e&&typeof e.map=="function"?await lh(e.map(n=>r9(i,n,t,r))):e instanceof B8?$b(i,e,r):e instanceof mc&&await NK(i,e,t,r)}async function UK(i,e,t,r,s){if(_(e.camera))return s9(i,e.camera,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=_(e.targetGeometry)?e.targetGeometry.clone():null,s.camera=null,t.heading!=null?s.rotation=Uw(t.heading):t.rotation!=null&&(s.rotation=t.rotation);const n=qR(i,t);n!=null&&(s.scale=n);const a=new ug(r);return i9(i,s,t.tilt,a),s.camera=await a.resolver.promise,s}function s9(i,e,t){const r=i.spatialReference,s=l2(e.position,r);return T(s)?null:((e=e.clone()).fov=i.camera.fov,e.position=s,jR(i,null,e,t))}function VK(i,e,t,r,s,n){const a=i.renderSpatialReference;return xs(t,iv,a),xs(e,gT,a),n.targetGeometry=new kt(e),s.position=new kt(t),ee(Fb,gT,iv),Nw(i,iv,Fb,r.up,s),n.scale=wp(i,Ni(iv,gT),n.targetGeometry.latitude),n.rotation=Uw(s.heading),n.camera=s,n}async function nS(i,e,t,r,s,n){if(T(t))throw new ue("createfromcenter","invalid point");n.targetGeometry=t.clone();const a=Np(i);if(e.position)return VK(i,n.targetGeometry,e.position,a,r,n);if(e.zoomFactor){const l=a.distance/e.zoomFactor,c=W(Ji,a.viewForward,-l);a.eye=J(Ji,a.center,c),n.scale=wp(i,l,t.latitude)}eg(i,a,r);const o=WR(r,e)?ys.LOCKED:ys.ADJUST;if(!e.zoomFactor){const l=qR(i,e);l==null?(xs(t,Ji,i.renderSpatialReference),YF(a.frustum,Ji)?n.scale=wp(i,Ni(a.eye,Ji),t.latitude):n.scale=e9(i,a)):n.scale=l;const c=new ug(s);QN(i,n.targetGeometry,n.scale,r,o,c),n.camera=await c.resolver.promise}return n}function BK(i,e,t,r){const s=Np(i);return X(Fb,s.viewForward),Nw(i,s.eye,Fb,s.up,_T),t.position=new kt(e.position),t.heading=e.heading!=null?e.heading:_T.heading,t.tilt=e.tilt!=null?e.tilt:_T.tilt,jR(i,null,t,r)}async function zK(i,e,t,r,s){const n=Np(i);return nS(i,e,Ud(n.center,i.renderSpatialReference,i.spatialReference),t,r,s)}async function kK(i,e,t,r,s,n){n.targetGeometry=t.clone();const a=Np(i);eg(i,a,r);const o=WR(r,e)?ys.LOCKED:ys.ADJUST,l=new ug(s);return Y_(i,t,r.heading,r.tilt,o,l),n.camera=await l.resolver.promise,n}function GK(i,e,t,r,s){let n=0;t.z!=null?n=t.z:i.basemapTerrain&&i.elevationProvider&&(n=Et(tc(i.elevationProvider,t))),Z(Ji,t.x,t.y,n),ch(i.spatialReference,Ji,iI,i.renderSpatialReference),hh(tv,iI),gh(tv,tv),Pi(Lg);const a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<a.length;y++){const g=a[y];let v=r[g[2]];isFinite(v)||(v=n),Z(Ji,r[g[0]],r[g[1]],v),vs(Ji,i.spatialReference,Ji,i.renderSpatialReference),jf(Lg,Jl(Ji,Ji,tv))}const o=a5(Lg),l=H2(Lg),c=o5(Lg),h=1/Math.tan(e.fovX/2),u=1/Math.tan(e.fovY/2),m=.5*Math.sqrt(o*o+c*c)*Math.max(u,h)+.5*l,f=.5*l*u+.5*Math.max(o,c);return Math.max(m,f)/s}async function HK(i,e,t,r,s,n,a,o){o.targetGeometry=t.clone();const l=Np(i),c=GK(i,l,t,r,s);eg(i,l,n);const h=WR(n,e)?ys.LOCKED:ys.ADJUST;o.scale=wp(i,c,o.targetGeometry.latitude);const u=new ug(a);return QN(i,o.targetGeometry,o.scale,n,h,u),o.camera=await u.resolver.promise,o}function qK(i,e){if(!e||!i.spatialReference)return null;const t={target:void 0};if("declaredClass"in e||Array.isArray(e))t.target=e;else{for(const r in e)t[r]=e[r];e.center&&!t.target&&(t.target=e.center)}return t}function nu(i){return i&&_(i.camera)&&(i.rotation=Uw(i.camera.heading)),i}function WK(i,e){const t=IK;if(!e.length)return t;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return t-r/Math.min(i.width,i.height)*2}const Ji=E(),iI=ve(),tv=Bs(),Lg=zs(),jK=Ot(),Fb=E(),iv=E(),gT=E(),_T={heading:0,tilt:0},Aa=new kt,XK={point(i,e,t){t[0]=i.x,t[1]=i.y,i.z!=null&&(t[2]=i.z),e(t)},polygon(i,e,t){const r=i.hasZ;for(let s=0;s<i.rings.length;s++){const n=i.rings[s];for(let a=0;a<n.length;a++)t[0]=n[a][0],t[1]=n[a][1],r&&(t[2]=n[a][2]),e(t)}},polyline(i,e,t){const r=i.hasZ;for(let s=0;s<i.paths.length;s++){const n=i.paths[s];for(let a=0;a<n.length;a++)t[0]=n[a][0],t[1]=n[a][1],r&&(t[2]=n[a][2]),e(t)}},multipoint(i,e,t){const r=i.points,s=i.hasZ;for(let n=0;n<r.length;n++)t[0]=r[n][0],t[1]=r[n][1],s&&(t[2]=r[n][2]),e(t)},extent(i,e,t){i.zmin!=null&&i.zmax!=null?(e(Z(t,i.xmin,i.ymin,i.zmin)),e(Z(t,i.xmax,i.ymin,i.zmin)),e(Z(t,i.xmin,i.ymax,i.zmin)),e(Z(t,i.xmax,i.ymax,i.zmin)),e(Z(t,i.xmin,i.ymin,i.zmax)),e(Z(t,i.xmax,i.ymin,i.zmax)),e(Z(t,i.xmin,i.ymax,i.zmax)),e(Z(t,i.xmax,i.ymax,i.zmax))):(e(Z(t,i.xmin,i.ymin,t[2])),e(Z(t,i.xmax,i.ymin,t[2])),e(Z(t,i.xmin,i.ymax,t[2])),e(Z(t,i.xmax,i.ymax,t[2])))},mesh(i,e,t){const r=i.vertexAttributes&&i.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)e(Z(t,r[s+0],r[s+1],r[s+2]))}};let YK=class{constructor(e,t,r){this.target=e,this.options=t,this.view=r,this.state="pending",this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const a=new AbortController;_(this.options.signal)&&Pd(this.options.signal,()=>{this.abort()}),this._abortController=a,this.waitForReady()})}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&_(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject($s())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await py(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,$K(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const t=e?this._getCameraFromViewpoint(e):null;if(!T(t))if(this.options.animate){if(T(this._animationController))return;this.startAnimation(t,this._animationController)}else this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var n;const t=!!(this.target instanceof hl&&this.target.camera||this.target instanceof bo),r=e.camera;if(T(r))return null;if(!this.view.stateManager.isCompatible(r)){const a=r.position,o=a&&a.spatialReference,l=o?o.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this.reject(new ue("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=Yc(this.view,r);return T(s)?(this.reject(new ue("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:t}}startAnimation(e,t){this.state="wait-for-animation-finish";const r=t.viewAnimation;if(T(r))return void this.reject(new ue("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!t.active||T(t.viewAnimation)||t.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==t)return this.abort();let s;e.isFullySpecified?(s=new X_({view:this.view,desiredCamera:e.camera}),cg(this.view,e.camera,fo.EYE_AND_CENTER)):tr(this.view,e.camera),t.begin(e.camera,this.options);const n=()=>{const o=this.view.state.cameraController;s&&(o&&o.active?o instanceof ih&&_(o.viewAnimation)&&o.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):_(t.viewAnimation)&&t.viewAnimation.target===e.viewpoint&&t.state==="finished"&&(this.view.state.cameraController=s))},a=o=>{if(!T(this.view.state))switch(t.state){case $i.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case $i.Ready:case $i.Rejected:case $i.Running:case $i.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(o)}}};r.when(n,o=>a(o)),t.asyncResult={resolve:()=>a(),reject:o=>a(o)}}_getAnimationController(){let e=null,t=null;const r=this.view.state.cameraController;return r instanceof ih&&(r.updateStateFromViewAnimation(),r.active&&(e=r,t=e.viewAnimation)),e!=null||(e=new ih({view:this.view,mode:"animation"}),t=e.viewAnimation,this.view.state.switchCameraController(e))?e:(_(t)&&t.stop(),this.reject(new ue("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},_r=class extends ge{get camera(){const e=this._get("camera");if(!this.ready)return e;const t=eg(this.view,this.view.state.camera,yT);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){var t,r;this._updatePropertyBeforeReady("camera",e)||((t=this.view.elevationProvider)==null||t.enableElevationCache(!0),this.setStateCamera(Yc(this.view,e),{applyConstraints:!1})||pe.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=eg(this.view,this.view.state.contentCamera,yT);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Yc(this.view,e);T(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.removeHandles(vT),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,s=so(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([z(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(vT),this.test.contentCameraResetState.clear())}),z(()=>this.zoom,a=>{a!==void 0&&t!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(a-t)/2),Math.abs(a-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),z(()=>this.view.state.camera,a=>{const o=nc(s,a.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],vT),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var t;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():pe.getLogger(this.declaredClass).error("#center=","Invalid center",e):pe.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):pe.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=SK(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){var t;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||pe.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):pe.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):pe.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return wp(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||pe.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(t[ht.TOP]/r),a=Math.round(t[ht.RIGHT]/r),o=Math.round(t[ht.BOTTOM]/r),l=Math.round(t[ht.LEFT]/r);return s!=null&&s.top===n&&s.right===a&&s.bottom===o&&s.left===l?s:{top:n,right:a,bottom:o,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,rv),this.view.state.updateCamera(t=>t.padding=rv))}_paddingToArray(e,t,r){e?Vs(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Vs(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*t)}get screenCenter(){const e=this.padding;return _o((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?LK(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var t;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||pe.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const r=_(e.camera)?e.camera.position:e.targetGeometry,s=_(r)&&r.spatialReference;pe.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e)}else pe.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?MK(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||pe.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get _pixelRatio(){var e;return _(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,(e=this.view)==null?void 0:e.qualitySettings.maximumPixelRatio)}get _rasterPixelRatio(){return _(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,t;return((t=(e=this.view)==null?void 0:e._stage)==null?void 0:t.renderer.isFeatureEnabled(Qi.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var t,r;const e=(r=(t=this.view)==null?void 0:t._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(Qi.PhysicalPixelRendering,bi.IDLE)||e.isFeatureEnabled(Qi.PhysicalPixelRendering,bi.INTERACTING)||e.isFeatureEnabled(Qi.PhysicalPixelRendering,bi.ANIMATING))}constructor(e){super(e),this._propertiesPool=new ph({frustum:wd},this),this._cameraSetByUser=!1,this._gotoOperation=null,this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._cameraChangeTime=0,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(t){this.viewStateManager._updatingIgnoreRenderState=t},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||_(this.renderState)}}}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Nr(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),z(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,t)=>this._cameraChangedHandler(e,t),ii)]),ha(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Vf({prepare:()=>this._prepareFrame()}),z(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(sv)}),Nr(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=we(this._propertiesPool)}init(){this.constraintsManager=new E_({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Se.Local&&this.addHandles(ha(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(sv),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),sv)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(sv),this.constraintsManager=we(this.constraintsManager))}async goTo(e,t){const r={animate:!0,...t};return _(this._gotoOperation)&&this._gotoOperation.abort(r.animate),this._gotoOperation=new YK(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Np(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t==null?void 0:t.cameraController;r&&(t.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){_(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:s}of ZK){const n=e.has(r),a=this._isOverridden(r);!n&&a&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||a)&&s.forEach(o=>e.add(o))}return t}_setInitialView(e){if(T(e)||this._cameraSetByUser)return;if(e instanceof bo)return void this.setStateCamera(Yc(this.view,e),{applyConstraints:!1});if(e instanceof hl){if(e.targetGeometry instanceof ms){const n=Y_(this.view,e.targetGeometry,0,.5,ys.LOCKED);return void(_(n)&&this.setStateCamera(Yc(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const t=Y_(this.view,e,0,.5,ys.LOCKED);_(t)&&this.setStateCamera(Yc(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&QK.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!T(e)&&(e instanceof hl?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof bo?this.isCompatible(e.position):e.spatialReference&&Q1(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=KK){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,r=Oh){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),a=Uy(this.view,s,n,e,t,ys.ADJUST);return T(a)?null:(r.copyFrom(this.view.state.camera),r.eye=a.eye,r.center=a.center,r.up=a.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),s=Y_(this.view,e,t,r,ys.ADJUST,yT);return s?Yc(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,s=t.location.latitude;if(s==null)return null;const n=GR(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(JN(this.view,e))}_viewpointToCamera(e){return Yc(this.view,i9(this.view,e))}setStateCamera(e,t){return!(T(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&tr(this.view,r)}),t.applyConstraints||(this.view.state.cameraController=new X_({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._pixelRatio,s=Math.round(e.clientWidth*r),n=Math.round(e.clientHeight*r);if(s!==0&&n!==0&&(t.width===s&&t.height===n||(t.width=s,t.height=n),this.view.state)){const a=this.view.state.camera;a.fullWidth===s&&a.fullHeight===n&&a.pixelRatio===r||(Oh.copyFrom(a),Oh.pixelRatio!==r&&(this._paddingToArray(this.padding,r,rv),Oh.padding=rv),Oh.fullWidth=s,Oh.fullHeight=n,Oh.pixelRatio=r,this.view.state.camera=Oh),this._updateViewState()}}_updateElevation(e){var n;const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=t?Iw(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){_(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=bi.ANIMATING:this.view.interacting?this.view.state.mode=bi.INTERACTING:(this.view.state.mode===bi.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=JK?this.view.state.mode=bi.INTERACTING:this.view.state.mode=bi.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio,this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([p({type:bo,dependsOn:["view.state.camera","ready"]})],_r.prototype,"camera",null),d([p({type:bo,dependsOn:["view.state.contentCamera","ready"]})],_r.prototype,"contentCamera",null),d([p({type:kt})],_r.prototype,"center",null),d([p({type:ms})],_r.prototype,"extent",null),d([p({readOnly:!0})],_r.prototype,"frustum",null),d([p({readOnly:!0})],_r.prototype,"hasInitialView",null),d([p({readOnly:!0,type:Boolean})],_r.prototype,"ready",void 0),d([p({type:Number})],_r.prototype,"scale",null),d([p()],_r.prototype,"padding",null),d([p({readOnly:!0})],_r.prototype,"screenCenter",null),d([p({constructOnly:!0})],_r.prototype,"view",void 0),d([p({type:hl})],_r.prototype,"viewpoint",null),d([p({type:Number})],_r.prototype,"zoom",null),d([p({readOnly:!0})],_r.prototype,"_pixelRatio",null),d([p({readOnly:!0})],_r.prototype,"_rasterPixelRatio",null),d([p({readOnly:!0})],_r.prototype,"_usePhysicalPixelRendering",null),d([p({readOnly:!0})],_r.prototype,"_usePhysicalPixelRenderingAny",null),d([p()],_r.prototype,"_windowDevicePixelRatio",void 0),d([p()],_r.prototype,"_devicePixelRatioOverride",void 0),_r=d([k("esri.views.3d.state.ViewStateManager")],_r);const QK=["camera","viewpoint","extent","scale","center","zoom"],ZK=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],KK={heading:0,tilt:0},yT=new bo,Oh=new ze,rv=Xt(),sv="pending-initial-view",vT="content-camera-reset",JK=300,rI=100;let ic=class extends Zc{constructor(){super(...arguments),this.startCamera=new ze,this.currentCamera=new ze,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<rI}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=$i.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),rI),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([p({readOnly:!0})],ic.prototype,"isInteractive",null),d([p()],ic.prototype,"_lastInteraction",void 0),ic=d([k("esri.views.3d.state.controllers.InteractiveController")],ic);var Zn;(function(i){i[i.CENTER=0]="CENTER",i[i.EYE=1]="EYE"})(Zn||(Zn={}));let Q_=class extends ic{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Zn.CENTER,this._rotScale=0,this._lastPoint=Ne(),this._tmpWorldUp=E(),this._tmpViewDir=E(),this._tmpRotCurPoint=Ne(),this._tmpTransf=ve(),this._tmpAxis=E(),this._tmpPivotPoint=E(),this._pivotPos=E(),this._constraintOptions={selection:hi.ALL,interactionType:ot.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:jr.TUMBLE}}initialize(){this._rotScale=this.pivot===Zn.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Zn.EYE:X(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=ot.LOOK_AROUND,this._constraintOptions.tiltMode=jr.LOOK_AROUND,this._constraintOptions.selection=hi.NONE;break;case Zn.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Up:{});t||X(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=ot.TUMBLE,this._constraintOptions.tiltMode=jr.TUMBLE,this._constraintOptions.selection=hi.ALL&~hi.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,op(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,s=E();ee(s,this._pivotPos,r.eye);const n=xe(s),a=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,sI);let o=Math.max(Math.min($Z,1/Math.abs(oe(sI,r.viewForward)))*a,FZ);t&&(o=Math.min(n,o));const l=qt(this.view.spatialReference),c=Fi(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),h=Fw(this.startCamera,c,l);let u=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*hT,hT),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,hT);(_(u)||_(m))&&(u=Ze(u,m),m=T(m)||h===qr.Horizontal?u:m,o=u>m?m:u,o=t?Math.min(o,n):o),K(s,s),X(this._pivotPos,J(this._tmpPivotPoint,r.eye,W(this._tmpPivotPoint,s,o)))}update(e){if(this.active){switch(this.pivot){case Zn.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Zn.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}tr(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),op(e,t,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,a=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ee(this._tmpViewDir,r,s);const o=xe(this._tmpViewDir),l=ws(oe(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===Zn.EYE){n*=-.5;const c=.5*Math.PI-l,h=.5*Math.PI*.99;n=c-Math.max(-h,Math.min(h,c+n))}return n=ie(n+l,ps.min,ps.max)-l,Xe(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Zn.CENTER&&(a=-a),ol(this._tmpTransf,a,this._tmpWorldUp),mo(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),Pe(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Pe(bT,e.up,this._tmpTransf),J(bT,s,this._tmpViewDir),as(this._lastPoint,this._tmpRotCurPoint),bT}};d([p()],Q_.prototype,"pivot",void 0),Q_=d([k("esri.views.3d.state.controllers.RotateController")],Q_);const bT=E(),sI=E();let wT=class extends ls{constructor(e,t,r,s){super(!0),this._view=e,this.pointerAction=t,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const t=e.data;if(t.pointers.size>1||!zR(e.data,this.pointerAction))return;const r=Fi(t.center.x,t.center.y);switch(t.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Q_({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},aS=class extends ic{constructor(){super(...arguments),this._pickPoint=E(),this._tmpP0=Ne(),this._panAxisAngle=Lw(),this._tmpRayDir=E(),this._tmpRayDirPick=E(),this._targetOnSphere=E(),this._navMode=qr.Horizontal,this._tmpRay={origin:E(),direction:E()},this.dragBeginPoint=Fi(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:hi.ALL_EXCEPT_COLLISION,interactionType:ot.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:jr.TUMBLE},this._sphere=yo(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;as(this.dragBeginPoint,e),op(this.startCamera,e,this._normalizedAnchorPoint);const t=qt(this.view.spatialReference),r=SN(this._intersectionHelper,this.startCamera,e,t,Jf.Ellipsoid,this.view.map.ground.opacity===0?Up:{});if(this._navMode=Fw(this.startCamera,e,t),this._navMode===qr.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=Ze(r.scenePickPoint,this._pickPoint),this._sphere=r.sphere;else{let s;hg(this.startCamera,e,this._tmpRay),K(this._tmpRay.direction,this._tmpRay.direction),_(r.scenePickPoint)&&(ee(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=xe(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,nI);let a=ie(Math.min(yN,1/Math.abs(oe(nI,this._tmpRay.direction)))*n,Eb[0],Eb[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,$w);a=_(o)?o:a,a=s!=null?Math.min(a,s):a,this._hasPickPoint=!0,W(this._tmpRay.direction,this._tmpRay.direction,a),J(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===qr.Horizontal){ee(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=xe(this._tmpRayDir);op(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(t-s)<1e-6)return;if(this._hasPickPoint&&s<t){const a=1-(1-s/t)*(1-this._sphere[3]/xe(this.currentCamera.center));this.currentCamera.center=W(nv,this.currentCamera.center,a)}W(this._tmpRayDir,this._tmpRayDir,-s/t),this.currentCamera.eye=J(nv,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Wo(vy(this.dragBeginPoint,e)),tr(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(Ny(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),$R(this._pickPoint,this._targetOnSphere,this._panAxisAngle),jd(this.currentCamera,this._sphere,this._panAxisAngle))}else{const t=xe(this._tmpRay.direction);op(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(t-s)<1e-6)return;W(this._tmpRayDir,this._tmpRay.direction,1-s/t),this.currentCamera.eye=J(nv,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=J(nv,this.currentCamera.center,this._tmpRayDir)}cg(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};aS=d([k("esri.views.3d.state.controllers.global.ZoomController")],aS);const nv=E(),nI=E();let oS=class extends ic{constructor(){super(...arguments),this._tmpP=E(),this._tmpDir=E(),this._tmpN=E(),this._tmpP0=Ne(),this._tmpPoi=E(),this._tmpRayDir=E(),this.dragBeginPoint=Fi(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:hi.ALL,interactionType:ot.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:E(),tiltMode:jr.TUMBLE},this._plane=sr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;as(this.dragBeginPoint,e),op(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Up:{});ee(this._tmpDir,this._tmpP,this.startCamera.eye);const r=xe(this._tmpDir);K(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=ie(Math.min(yN,1/Math.abs(oe(eJ,this._tmpDir)))*s,Eb[0],Eb[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,$w);n=_(a)?a:n,n=t?Math.min(n,r):n,W(this._tmpDir,this._tmpDir,n),J(this._tmpP,this.startCamera.eye,this._tmpDir),ee(this._tmpN,this.startCamera.eye,this.startCamera.center),K(this._tmpN,this._tmpN),this._tmpN[1]<0&&On(this._tmpN,this._tmpN),lw(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;NZ(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||X(this._tmpPoi,this.currentCamera.center),op(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);as(this._normalizedAnchorPoint,this._tmpP0),ee(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=xe(this._tmpRayDir);let s=r*(1-t);this._constraintOptions.interactionDirection&&(X(this._constraintOptions.interactionDirection,this._tmpRayDir),W(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/r));const n=this.view.state.constraints.minimumPoiDistance;t>=0&&s<n&&(s=n,t=-(s-r)/r),Math.abs(r-s)<1e-6||(W(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=J(au,this.currentCamera.eye,this._tmpRayDir),ns(au,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?au[2]=Math.max(this.startCamera.center[2],au[2]):au[2]=Math.min(this.startCamera.center[2],au[2]),this.currentCamera.center=au,this._constraintOptions.interactionFactor=Wo(vy(this.dragBeginPoint,e)),tr(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};oS=d([k("esri.views.3d.state.controllers.local.ZoomController")],oS);const au=E(),eJ=qe(0,0,1);let tJ=class extends ls{constructor(e,t,r){super(!0),this._view=e,this.pointerAction=t,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const t=e.data;if(t.pointers.size>1||!zR(e.data,this.pointerAction))return;const r=Fi(t.center.x,t.center.y);switch(t.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new aS({view:this._view}):this._cameraController=new oS({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function So(i){let e=i*i;return i<0&&(e*=-1),e}function aI(i,e,t){const r=t,s=i.state,n=i.device,a=e.tiltDirection==="forward-down"?1:-1,o=1;return n.deviceType==="standard"?(r.translation[0]=So(s.axes[0]),r.translation[1]=So(s.axes[1]),r.translation[2]=So(s.buttons[7])-So(s.buttons[6]),r.heading=So(s.axes[2]),r.tilt=So(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*So(s.axes[0]),r.translation[1]=1.2*So(s.axes[1]),r.translation[2]=2*-So(s.axes[2]),r.heading=1.2*So(s.axes[5]),r.tilt=1.2*So(s.axes[3])),r.tilt*=a,W(r.translation,r.translation,o),r}function oI(i,e){const t=e;return t.translation[0]=i[1]-i[0],t.translation[1]=i[3]-i[2],t.translation[2]=i[4]-i[5],t.heading=i[7]-i[6],t.tilt=i[8]-i[9],t.zoom=i[10]-i[11],t}function xT(i){return i.translation[0]===0&&i.translation[1]===0&&i.translation[2]===0&&i.heading===0&&i.tilt===0&&i.zoom===0}let ip=class extends ic{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new ze,this._headingStart=0,this._constraintOptions={selection:hi.ALL,interactionType:ot.NONE,interactionStartCamera:new ze,interactionFactor:0,interactionDirection:null,tiltMode:jr.LOOK_AROUND}}handleEventGamepad(e){const t=aI(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||xT(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,oI(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const t=oI(this._keysButtonState,this._transformation);xT(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(t-this._filteredSurfaceElevation)*e}stepController(e,t){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,ou),this._applyDisabledMovementTypes(ou),this._applyPan(ou.pan),this._applyRotate(ou.rotate),this._applyZoom(ou.zoom),this._applyAscend(ou.ascend),this._constraintOptions.interactionType=ot.NONE,this._constraintOptions.selection=hi.COLLISION,tr(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;ee(nn,t.center,t.eye),Pe(nn,nn,e.matrix),t.center=J(nn,nn,t.eye),t.up=Pe(nn,t.up,e.matrix),this._constraintOptions.interactionType=ot.LOOK_AROUND,this._constraintOptions.selection=hi.ALL_EXCEPT_COLLISION,tr(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=Pe(nn,t.eye,e.matrix),t.center=Pe(nn,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Pe(nn,t.up,e.matrix)),this._constraintOptions.interactionType=ot.PAN,this._constraintOptions.selection=hi.ALL,tr(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=J(nn,this.currentCamera.eye,W(We.get(),t,e)),X($g,t),On($g,$g),this._constraintOptions.interactionDirection=$g,this._constraintOptions.interactionType=ot.ZOOM,this._constraintOptions.selection=hi.ALL_EXCEPT_COLLISION,tr(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,We.get());if(this._constraintOptions.interactionDirection=X($g,t),this.view.state.isGlobal){const r=xe(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=W(nn,this.currentCamera.eye,s),this.currentCamera.center=W(nn,this.currentCamera.center,s)}else{const r=W(We.get(),t,e);this.currentCamera.eye=J(nn,this.currentCamera.eye,r),this.currentCamera.center=J(nn,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=ot.ASCEND,this._constraintOptions.selection=hi.COLLISION,tr(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=hi.ALL_EXCEPT_COLLISION,tr(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){lJ(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,t,r):this._calculateControlTransformationGlobal(s,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,nn)}_calculateControlTransformationLocal(e,t,r){const{viewRight:s,viewForward:n}=t,a=this._transformation,o=this.view.navigation.gamepad,l=Z(We.get(),n[0],n[1],0);K(l,l);const c=a.translation[0]*e.pan;if(c!==0){const g=W(We.get(),s,c);dc(r.pan.matrix,r.pan.matrix,g),r.pan.enabled=!0}switch(o.mode){case"pan":{const g=-a.translation[1]*e.pan;if(g!==0){const v=W(We.get(),l,g);dc(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=a.zoom*e.zoom;break}case"zoom":r.zoom=(-a.translation[1]+a.zoom)*e.zoom;break;default:ll(o.mode)}const h=a.translation[2]*e.ascend;r.ascend=h;const u=-a.heading*e.rotate;u!==0&&(mo(r.rotate.matrix,r.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,We.get())),r.rotate.enabled=!0);const m=a.tilt*e.rotate,f=Wd(this.view.renderCoordsHelper,t.center,t.eye),y=ie(f+m,ps.min,ps.max)-f;y&&(mo(r.rotate.matrix,r.rotate.matrix,y,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:s,viewRight:n}=t,a=this._transformation,o=this.view.navigation.gamepad,l=Xe(We.get(),n,s);K(l,l),On(l,l),GZ(this.startCamera,t,a,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(ou.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=a.translation[2]*e.ascend;r.ascend=h;const u=-a.heading*e.rotate;u!==0&&(mo(r.rotate.matrix,r.rotate.matrix,u,this._tmpCamera.eye),r.rotate.enabled=!0);const m=a.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(m,t.ray,c);f!==0&&(mo(r.rotate.matrix,r.rotate.matrix,f,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=a.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const s=qt(this.view.spatialReference),n=S1(ps.min,t.origin,r,s);let a=0,o=0;const l=We.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,l)){const c=Wd(this.view.renderCoordsHelper,l,t.origin);a=S1(c,t.origin,r,s),o=S1(ps.max,t.origin,r,s)}else{ow(g2(_2,r+s.radius),t,l);const c=ws(-oe(t.direction,K(l,l)));a=GM(c,t.origin,r,s),o=GM(ps.max,t.origin,r,s)}return ie(a+e,n,o)-a}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),a=t+Math.abs(n-t);return s.setAltitude(r,a,e),a}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=wK(this.view,t,0,n9,oJ),a=r.intersectManifoldClosestSilhouette(al(t,n),e,We.get()),o=Ni(t,a),l=r.intersectManifoldClosestSilhouette(al(t,Rp(We.get(),t,s.center)),e,We.get()),c=Ni(t,l);return Math.min(o,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:s,isGlobal:n}=r,a=t.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,We.get());if(n){const o=ee(We.get(),e,a),l=xe(o);W(o,o,1/l);const c=K(We.get(),e),h=ws(oe(c,o));return l*Math.sin(Math.min(rJ,h))}{const o=X(We.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),Ni(a,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:sJ}_computeVelocities(e){const t=this._filteredSurfaceElevation,r=t+qt(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,a=We.get(),o=this._getPointAbsoluteSurfaceElevation(s.eye,t,a),l=this._clampedDistanceToSurface(t,a),c=s.width/2,h=lI*s.width,u=lI*s.width,m=l*Math.tan(.5*s.fovX)/c,f=m/r,y=m/this._computeHeadingRotateRadius(a),g=o-t;return{pan:(n?f:m)*h*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(h*e/c)*g-g),zoom:2**(h*e/c)*l-l,rotate:ie(y*u,nJ,aJ)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&pp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&pp(e.rotate.matrix))}static activatesFor(e,t){const r=aI(t,e.navigation.gamepad,iJ);return!(t.action==="end"||xT(r))}};d([p({constructOnly:!0})],ip.prototype,"gamepadDevice",void 0),d([p({constructOnly:!0})],ip.prototype,"disableMovements",void 0),ip=d([k("esri.views.3d.state.controllers.GamepadKeyboardController")],ip);const iJ={translation:[0,0,0],heading:0,tilt:0,zoom:0},n9=80,rJ=vt(n9),lI=.75,sJ=5,nJ=vt(30),aJ=vt(80),ou={zoom:0,ascend:0,pan:{enabled:!1,matrix:ve()},rotate:{enabled:!1,matrix:ve()}},nn=E(),$g=E(),oJ=kR();function lJ(i){i.zoom=0,i.ascend=0,i.pan.enabled=!1,pp(i.pan.matrix),i.rotate.enabled=!1,pp(i.rotate.matrix)}let cJ=class extends ls{constructor(e){super(!0),this._view=e,this._watchHandles=new mi,this._handle=this.registerIncoming("gamepad",t=>this._handleEventGamepad(t)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([z(()=>this._view.navigation.gamepad.enabled,t=>{t?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Je),z(()=>this._view.navigation.gamepad.device,t=>{this._cameraControllerGamepad&&t&&this._cameraControllerGamepad.gamepadDevice!==t&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const t=this._view.navigation.gamepad.device;if(t&&e.data.device!==t)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||ip.activatesFor(this._view,e.data)){if(!r){const s=new ip({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var jn;(function(i){i[i.LEFT=0]="LEFT",i[i.RIGHT=1]="RIGHT",i[i.FORWARD=2]="FORWARD",i[i.BACKWARD=3]="BACKWARD",i[i.UP=4]="UP",i[i.DOWN=5]="DOWN",i[i.HEADINGLEFT=6]="HEADINGLEFT",i[i.HEADINGRIGHT=7]="HEADINGRIGHT",i[i.TILTUP=8]="TILTUP",i[i.TILTDOWN=9]="TILTDOWN",i[i.ZOOMIN=10]="ZOOMIN",i[i.ZOOMOUT=11]="ZOOMOUT"})(jn||(jn={}));let hJ=class extends ls{constructor(e,t){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Se.Local},this._keyToNumber={[t.left]:jn.LEFT,[t.right]:jn.RIGHT,[t.forward]:jn.FORWARD,[t.backward]:jn.BACKWARD,[t.up]:jn.UP,[t.down]:jn.DOWN,[t.headingLeft]:jn.HEADINGLEFT,[t.headingRight]:jn.HEADINGRIGHT,[t.tiltUp]:jn.TILTUP,[t.tiltDown]:jn.TILTDOWN,[t.zoomIn]:jn.ZOOMIN,[t.zoomOut]:jn.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this._keyToNumber[e.data.key];t!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new ip({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(t),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this._keyToNumber[e.data.key];t!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation())}},dJ=class extends ls{constructor(e,t){super(!0),this._view=e,this.registerIncoming("mouse-wheel",t,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const t=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new Pb({view:this._view,mode:"interaction"}):new Ob({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*t.deltaY,Fi(t.x,t.y)),e.preventDefault(),e.stopPropagation()}},Nb=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},xp=class extends $y{constructor(){super(...arguments),this._beginCamera=new ze,this._elapsedTimeSec=0,this.constraintOptions={selection:hi.ALL,interactionType:ot.PAN,interactionFactor:0,interactionStartCamera:new ze,interactionDirection:null,tiltMode:jr.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Zf}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),tr(this.view,t,this.constraintOptions)}};xp=d([k("esri.views.3d.state.controllers.momentum.MomentumController")],xp);let Z_=class extends xp{constructor(e){super(e),this.interactionType=ot.PAN,this._tmpPan=E()}momentumStep(e,t){const r=this.momentum.value(e);W(this._tmpPan,this.momentum.direction,r),t.eye=ee(cI,t.eye,this._tmpPan),t.center=ee(cI,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([p({constructOnly:!0})],Z_.prototype,"momentum",void 0),Z_=d([k("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],Z_);const cI=E(),uJ=E(),av=E();let A1=class extends xp{constructor(e){super(e),this.interactionType=ot.PAN}momentumStep(e,t){const r=this.momentum.value1(e),s=this.momentum.value2(e);X(av,t.eye),K(av,av),Xe(this.momentum.axis2,av,this.momentum.axis1),ON(t,uJ,this.momentum.axis1,r,this.momentum.axis2,s)}};d([p({constructOnly:!0})],A1.prototype,"momentum",void 0),A1=d([k("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],A1);let ju=class extends xp{set center(e){this._set("center",Pn(e))}set axis(e){this._set("axis",Pn(e))}constructor(e){super(e),this.interactionType=ot.TUMBLE}momentumStep(e,t){const r=this.momentum.value(e);jd(t,this.center,Fy(this.axis,r))}};d([p({constructOnly:!0})],ju.prototype,"momentum",void 0),d([p({constructOnly:!0})],ju.prototype,"center",null),d([p({constructOnly:!0})],ju.prototype,"axis",null),ju=d([k("esri.views.3d.state.controllers.momentum.MomentumController")],ju);let gf=class extends xp{set zoomCenter(e){this._set("zoomCenter",Pn(e))}constructor(e){super(e),this.interactionType=ot.ZOOM,this.constraintOptions.interactionDirection=E()}momentumStep(e,t){const{interactionDirection:r}=this.constraintOptions;if(!r)return;X(r,t.eye);const s=this.momentum.valueDelta(0,e);UR(t,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Rp(r,t.eye,r)}};d([p({constructOnly:!0})],gf.prototype,"momentum",void 0),d([p({constructOnly:!0})],gf.prototype,"zoomCenter",null),gf=d([k("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],gf);let $u=class extends xp{set screenCenter(e){this._set("screenCenter",Fi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Pn(e))}constructor(e){super(e),this.interactionType=ot.ZOOM,this.radius=0,this._tmpSceneCenter=E(),this._tmpZoomAxisAngle=Lw(),this._sphere=yo()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);CN(this._sphere,t,r),this.constraintOptions.interactionType=ot.ZOOM,tr(this.view,t,this.constraintOptions),Ny(this._sphere,t,this.screenCenter,this._tmpSceneCenter),$R(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),jd(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=ot.PAN}};d([p({constructOnly:!0})],$u.prototype,"momentum",void 0),d([p({constructOnly:!0})],$u.prototype,"screenCenter",null),d([p({constructOnly:!0})],$u.prototype,"sceneCenter",null),d([p({constructOnly:!0})],$u.prototype,"radius",void 0),$u=d([k("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],$u);let jo=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const t=this.computeDelta(e);this._updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},Vw=class{constructor(e,t,r){this._initialVelocity=e,this._stopVelocity=t,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const r=this.value(e);return this.value(e+t)-r}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const r=1-this.friction;return e*(r**t-1)/Math.log(r)}},pJ=class extends Vw{constructor(e,t,r,s,n){super(e,t,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},a9=class{constructor(e=300,t=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this.enabled=!0,this._time=new jo(.6),this._screen=[new jo(.4),new jo(.4)],this._scene=[new jo(.6),new jo(.6),new jo(.6)],this._tmpDirection=E()}add(e,t,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(t[0]),this._scene[1].update(t[1]),this._scene[2].update(t[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,r=e==null||t==null?0:Math.sqrt(e*e+t*t),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,t,r){Z(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=xe(this._tmpDirection);s>0&&W(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new pJ(e,t,r,n==null?0:s/n,this._tmpDirection)}},hI=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const dI=1e-5;let mJ=class extends Vw{constructor(e,t,r,s,n,a=0,o){super(e,t,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=a,this.axis2=o}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},fJ=class{constructor(e=300,t=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this.enabled=!0,this._tmpAxis1=E(),this._tmpAxis2=E(),this._tmpAngles=Ne(),this._time=new jo(.3),this._screen=[new jo(.4),new jo(.4)],this._angle1=new hI(.6),this._angle2=new hI(.6),this._axis1=E(),this._axis2=E(),this._lastScene=E()}addMomentumDirectRotation(e,t,r,s,n,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let o=AN(this._lastScene,t,this._tmpAxis2,s,n,a);this._angle2.update(0),Da(this._tmpAxis2)<dI?o=0:K(this._axis1,this._tmpAxis2),this._angle1.update(o),X(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,t,r,s,n,a,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;PN(this._lastScene,t,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,a,o,!1),Da(this._tmpAxis2)<dI?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),K(this._axis1,this._tmpAxis1),K(this._axis2,this._tmpAxis2)),X(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,r=e==null||t==null?null:Math.sqrt(e*e+t*t),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,t,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,a=this._angle2.filteredValue,o=s==null||a==null?0:a/s;return new mJ(e,t,r,s==null||n==null?0:n/s,this._axis1,o,this._axis2)}},o9=class{constructor(e=2.5,t=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new jo(.8),this.time=new jo(.3)}add(e,t){if(this.enabled&&t!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ie(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,t,r){return new Vw(e,t,r)}},l9=class extends o9{constructor(e=3,t=.01,r=.95,s=12){super(e,t,r,s)}add(e,t){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,t)}},gJ=class extends Vw{constructor(e,t,r){super(e,t,r)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const r=super.value(e),s=super.value(e+t)-r;return Math.exp(s)}},c9=class extends o9{constructor(e=2.5,t=.01,r=.95,s=12){super(e,t,r,s)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,r){return new gJ(e,t,r)}},lS=class extends ic{constructor(){super(...arguments),this._smoothRotation=new Nb(.05),this._rotationAxis=E(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=sr(),this._beginRadius=0,this._smoothScaling=new Nb(.05),this._zoomCenterScreen=Fi(),this._zoomMomentumEstimator=new c9,this._rotationMomentumEstimator=new l9,this._panSphericalMomentumEstimator=new fJ,this._panPlanarMomentumEstimator=new a9,this._adjustedSphere=yo(),this._tmp3d=E(),this._tmpScreenPointArray=Fi(),this._beginScreenPoint=Fi(),this._beginScenePoint=E(),this._screenPickPoint=Fi(),this._scenePickPoint=E(),this._mode=qr.Horizontal,this._sphere=yo(),this._pointerCount=0,this._tmpInteractionDirection=E(),this._constraintOptions={selection:hi.ALL,interactionType:ot.NONE,interactionFactor:0,interactionStartCamera:new ze,interactionDirection:null,tiltMode:jr.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var n;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panPlanarMomentumEstimator.enabled=t,this._panSphericalMomentumEstimator.enabled=t,this._beginHeading=-Nd.normalize(vt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Xl(e.center,this._screenPickPoint),as(this._beginScreenPoint,this._screenPickPoint);const r=qt(this.view.spatialReference),s=SN(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,Jf.Silhouette,this.view.map.ground.opacity===0?Up:{});T(s.scenePickPoint)||(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,X(this._beginScenePoint,this._scenePickPoint),this._mode=Fw(this.startCamera,this._screenPickPoint,r),this._mode===qr.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(n=this._constraintOptions.interactionStartCamera)==null||n.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._mode===qr.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._mode===qr.Horizontal?new $u({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new gf({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new ju({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===qr.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new A1({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new Z_({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,t){const r=On(this._tmp3d,this.startCamera.viewForward);lw(this._scenePickPoint,r,this._panningPlane);const s=Fi(this._screenPickPoint[0],0),n=E(),a=xe(this.startCamera.eye);this._adjustedSphere[3]=a<this._sphere[3]?a-100:this._sphere[3],Ny(this._adjustedSphere,this.startCamera,s,n);const o=_s();this.startCamera.projectToRenderScreen(n,o);const l=E(),c=E(),h=E();ee(l,this._scenePickPoint,this.currentCamera.eye);const u=xe(l);K(l,l);const m=xN*Math.max(Math.abs(this.view.camera.position.z),TN),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,$w);let y=_(f)?f:m;y=t?Math.min(y,u):y,X(h,J(c,this.currentCamera.eye,W(c,l,y))),this._panningPlane[3]=-oe(Js(this._panningPlane),h),this.startCamera.center=J(c,this.startCamera.eye,W(c,this.startCamera.viewForward,y));const g=Xl(e.center,this._tmpScreenPointArray);iS(this._panningPlane,this.startCamera,g,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),CN(this._sphere,this.currentCamera,this._smoothScaling.value),Xl(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=ot.ZOOM,this._constraintOptions.interactionFactor=Wo(e.radius-this._beginRadius),tr(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=Xl(e.center,this._tmpScreenPointArray);Ny(this._sphere,this.currentCamera,t,this._tmp3d),VR(this._beginScenePoint,oe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(IN(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(MN(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=ot.PAN,this._constraintOptions.interactionFactor=Wo(vy(this._screenPickPoint,t)),tr(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){K(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||On(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,r=t+tS(e.angle-t),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),jd(this.currentCamera,this._sphere,Fy(this._rotationAxis,n)),this._constraintOptions.interactionType=ot.TUMBLE,this._constraintOptions.interactionFactor=Wo(e.radius*r),tr(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=Xl(e.center,this._tmpScreenPointArray);iS(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(RN(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=ot.PAN,this._constraintOptions.interactionFactor=Wo(vy(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),tr(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),UR(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=ot.ZOOM,this._constraintOptions.interactionFactor=Wo(e.radius-this._beginRadius),tr(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){X(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||On(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let r=e.angle-t;r=tS(r);const s=t+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const a=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(a,.001*e.timestamp),jd(this.currentCamera,this._sphere,Fy(this._rotationAxis,a)),this._constraintOptions.interactionType=ot.TUMBLE,this._constraintOptions.interactionFactor=Wo(e.radius*a),tr(this.view,this.currentCamera,this._constraintOptions)}};lS=d([k("esri.views.3d.state.controllers.global.PinchAndPanController")],lS);const uI=qe(0,0,1),_J={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let cS=class extends ic{constructor(){super(...arguments),this._rotationValueSmooth=new Nb(.05),this._scalingValueSmooth=new Nb(.05),this._planeHorizontal=sr(),this._planeVertical=sr(),this._rotationMomentumEstimator=new l9,this._panMomentumEstimator=new a9(300,12,.9),this._zoomMomentumEstimator=new c9,this._beginRadius=0,this._beginCenter=E(),this._beginAngle=0,this._tmpPoints=[],this._panMode=qr.Horizontal,this._beginCenterScreen=Fi(),this._tmpCentroid3d=E(),this._tmpCentroid2d=Fi(),this._tmp2d=Fi(),this._pointerCount=0,this._constraintOptions={selection:hi.ALL,interactionType:ot.NONE,interactionFactor:0,interactionStartCamera:new ze,interactionDirection:null,tiltMode:jr.TUMBLE}}begin(e){var y;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Xl(e.center,this._beginCenterScreen),tF(uI,0,this._planeHorizontal);const r=E(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?Up:{}),n=E();On(n,this.startCamera.viewForward);const a=E();X(a,uI);const o=oe(n,a),l=hc(o<0?-o:o);this._panMode=l>=_J.ANGLE_THRESHOLD?qr.Horizontal:qr.Vertical;const c=Math.min(xN,1/Math.abs(oe(a,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),TN);rE(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||sE(this._planeHorizontal,this._planeHorizontal);const h=E(),u=E(),m=E();ee(h,r,this.currentCamera.eye);const f=xe(h);if(K(h,h),this._panMode===qr.Vertical){W(a,a,o),ee(this._planeVertical,n,a),K(this._planeVertical,this._planeVertical),rE(this._planeVertical,this._planeVertical,r);const g=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,$w);let v=_(g)?g:c;v=s?Math.min(v,f):v,X(m,J(u,this.currentCamera.eye,W(u,h,v))),this._planeVertical[3]=-oe(this._planeVertical,m),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),dT(this._tmpPoints,this._beginCenter)}else{const g=s?f:c;X(m,J(u,this.currentCamera.eye,W(u,h,g))),this._planeHorizontal[3]=-oe(Js(this._planeHorizontal),m),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),dT(this._tmpPoints,this._beginCenter)}(y=this._constraintOptions.interactionStartCamera)==null||y.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this._panMode===qr.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(t){const n=this._beginRadius/e.radius,a=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=a,this._scalingValueSmooth.update(n),UR(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=ot.ZOOM,this._constraintOptions.interactionFactor=Wo(Math.abs(e.radius-this._beginRadius)),tr(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),dT(this._tmpPoints,this._tmpCentroid3d),Xl(e.center,this._tmpCentroid2d),RN(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=ot.PAN,this._constraintOptions.interactionFactor=Wo(vy(this._beginCenterScreen,this._tmpCentroid2d)),tr(this.view,this.currentCamera,this._constraintOptions),t){const n=this._planeHorizontal,a=s,o=this._rotationValueSmooth.value,l=o+tS(e.angle-o),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const h=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(h,.001*e.timestamp),jd(this.currentCamera,a,Fy(n,h)),this._constraintOptions.interactionType=ot.TUMBLE,this._constraintOptions.interactionFactor=Wo(Math.abs(e.radius*h)),tr(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new gf({view:this.view,momentum:t,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new ju({view:this.view,momentum:r,center:this._beginCenter,axis:Js(this._planeHorizontal)});const s=this._panMomentumEstimator.evaluateMomentum();return s?new Z_({view:this.view,momentum:s}):null}_computePlanePoints(e,t,r,s){s.length=e.size;const n=this._tmp2d;let a=0;return e.forEach(o=>{n[0]=o.x,n[1]=o.y,s[a]===void 0&&(s[a]=E()),iS(t,r,n,s[a]),a+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};cS=d([k("esri.views.3d.state.controllers.local.PinchAndPanController")],cS);let pI=class extends ls{constructor(e,t,r){super(!0),this._view=e,this.pointerAction=t,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!zR(e.data,this.pointerAction))return;const t=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&t<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,t){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);t&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new lS({view:this._view}):new cS({view:this._view})}},yJ=class extends ls{constructor(e,t){super(!0),this.view=e,this.registerIncoming("pointer-down",t,()=>this.view.state.stopActiveCameraController())}},h9=class extends ls{constructor(e,t){super(!0),this.key=e,this.registerIncoming("key-down",t,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},vJ=class extends h9{constructor(e,t,r){super(t,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},bJ=class extends h9{constructor(e,t,r){super(t,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},wJ=class extends ls{constructor(e,t=!1){super(!0),this._view=e,this._invert=t,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,n,a;const t=this._invert?-1:1,r=Fi(0,e.data.delta*t);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new Q_({view:this._view,pivot:Zn.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(a=this._cameraController)==null||a.end(),this._cameraController=null}}};function mI(i){const e=i.native;return e?{buttons:e.buttons.map(t=>t.pressed?t.value?t.value:1:0),axes:e.axes.map(t=>CJ(t,i.axisThreshold))}:{buttons:[],axes:[]}}function xJ(i,e){if(i.axes.length!==e.axes.length||i.buttons.length!==e.buttons.length)return!1;for(let t=0;t<i.axes.length;t++)if(i.axes[t]!==e.axes[t])return!1;for(let t=0;t<i.buttons.length;t++)if(i.buttons[t]!==e.buttons[t])return!1;return!0}function TJ(i){for(let e=0;e<i.axes.length;e++)if(i.axes[e]!==0)return!1;for(let e=0;e<i.buttons.length;e++)if(i.buttons[e]!==0)return!1;return!0}function CJ(i,e){const t=Math.abs(i);return t<e?0:Math.sign(i)*(t-e)/(1-e)}let EJ=class{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const a=n.gamepad,o=a.index,l=this._inputDevices[o];l&&(this._emitGamepadEvent(a,mI(l),!1),this._inputDevices.splice(o,1),this._latestUpdate.splice(o,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const t=new _R(e);t.deviceType!=="unknown"&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=Vf({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!t;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const a=this._latestUpdate[s.index],o=mI(n),l=r||TJ(o);a&&(a.timestamp===s.timestamp||!a.active&&l||xJ(a.state,o))||this._emitGamepadEvent(s,o,!l)})}_forEachGamepad(e){const t=window.navigator.getGamepads();for(let r=0;r<t.length;r++){const s=t[r];this._validate(s)&&e(s)}}_emitGamepadEvent(e,t,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const a=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:a})}_validate(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}};const fI=Vt("edge"),SJ=Vt("chrome"),RJ=Vt("ff"),AJ=Vt("safari"),gI="esri-view-surface",dm={touchNone:`${gI}--touch-none`,touchPan:`${gI}--touch-pan`};let d9=class u9{constructor(e,t){this._input=t,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new EJ(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=we(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const r=this._active[t];this._element.removeEventListener(TT[t],r),delete this._active[t]}e&&e.forEach(t=>{if(!this._active[t]&&TT[t]){const r=(this._eventHandlers[t]||this._handleDefault).bind(this,t);this._element.addEventListener(TT[t],r),this._active[t]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?dm.touchNone:dm.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?dm.touchPan:dm.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(dm.touchNone),this._element.classList.remove(dm.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,t){const r=_4(this._element,e);return u9.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),t.x=r.x,t.y=r.y,t}_handleKey(e,t){const r=NW(t);r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:t,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,t){const r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,t){const r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,t){let r=t.deltaY;switch(t.deltaMode){case 0:fI&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}fI?r*=.7:SJ||AJ?r*=.6:RJ&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const a=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:r});this._callback(e,a)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const r={native:t};t.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};d9.test={disableSubpixelCoordinates:!1};const TT={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let PJ=class extends ls{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function p9(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}function OJ(i,e){const t=e.x-i.x,r=e.y-i.y;return Math.sqrt(t*t+r*r)}function MJ(i,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:_o()},i.length===0)return e;if(i.length===1)return e.center.x=i[0].x,e.center.y=i[0].y,e;if(i.length===2){const[w,S]=i,[P,A]=[S.x-w.x,S.y-w.y];return e.radius=Math.sqrt(P*P+A*A)/2,e.center.x=(w.x+S.x)/2,e.center.y=(w.y+S.y)/2,e}let t=0,r=0;for(let w=0;w<i.length;w++)t+=i[w].x,r+=i[w].y;t/=i.length,r/=i.length;const s=i.map(w=>w.x-t),n=i.map(w=>w.y-r);let a=0,o=0,l=0,c=0,h=0,u=0,m=0;for(let w=0;w<s.length;w++){const S=s[w],P=n[w],A=S*S,M=P*P;a+=A,o+=M,l+=S*P,c+=A*S,h+=M*P,u+=S*M,m+=P*A}const f=.5*(c+u),y=.5*(h+m),g=a*o-l*l,v=(f*o-y*l)/g,b=(a*y-l*f)/g,x=_o(v+t,b+r);return{radius:Math.sqrt(v*v+b*b+(a+o)/i.length),center:x}}function K_(i){const{native:e}=i,{pointerId:t,button:r,pointerType:s}=e;return s==="mouse"?`${t}:${r}`:`${s}`}let IJ=class extends ls{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:s,pointers:DJ(this._activePointerMap),pointer:t,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const t=e.native.pointerId,r=ov(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,s);const n=P1(s,m9(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const t=e.native.pointerId,r=this._activePointerMap.get(t);r?r.event=e:this._addPointer(e)}_removePointer(e){const t=ov(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=ov(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=P1(r,t)-e,r.lastAngle=P1(r,t)-e})}_emitEvent(e,t,r){const s=ov(this._activePointerMap);this._drag.emit(this._createPayload(e,t,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,r=tt(e.timestamp);this._activePointerMap.get(t)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,tt(e.timestamp))))}_handlePointerDrag(e){const t=e.data,r=t.currentEvent,s=tt(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function m9(i){const e=[];return i.forEach(t=>{e.push(_o(t.event.x,t.event.y))}),MJ(e)}function ov(i){const e=m9(i);let t=0;return i.forEach(r=>{let s=P1(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const a=s-r.initialAngle;t+=a}),t/=i.size||1,{angle:t,radius:e.radius,center:e.center}}function DJ(i){const e=new Map;return i.forEach((t,r)=>e.set(r,t.event)),e}function P1(i,e){const t=i.event,r=t.x-e.center.x,s=t.y-e.center.y;return Math.atan2(s,r)}var _I;(function(i){i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i[i.Back=3]="Back",i[i.Forward=4]="Forward",i[i.Undefined=-1]="Undefined"})(_I||(_I={}));const Rd={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let LJ=class extends ls{constructor(e=Rd.maximumDoubleClickDelay,t=Rd.maximumDoubleClickDistance,r=Rd.maximumDoubleTouchDelay,s=Rd.maximumDoubleTouchDistance,n=h2){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Us(e.doubleClickTimer))}get hasPendingInputs(){return fs(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,t){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Us(r.doubleClickTimer),t&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);t.pointerDownCount===1&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:t,pointerType:r,button:s}=e.native;return r==="mouse"?`${t}:${s}`:`${r}`}_handleImmediateClick(e){const t=e.data,{pointerType:r}=t.native,s=this._getPointerId(t);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:a,modifiers:o}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;p9(a,t)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(a,void 0,o))}_handlePointerDown(e){const t=K_(e.data),r=this._pointerState.get(t);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:r}}=t,s=K_(t),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),o=1;this._pointerState.set(s,{event:e,doubleClickTimer:a,pointerDownCount:o}),this.refreshHasPendingInputs()}},$J=class extends ls{constructor(e=Rd.maximumDoubleClickDelay,t=Rd.maximumDoubleClickDistance,r=Rd.maximumDoubleTouchDelay,s=Rd.maximumDoubleTouchDistance,n=h2){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const t=e.data,r=K_(t);if(!this._pointerState.has(r)){const s={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(t.native)}}_handlePointerUp(e){const t=e.data,r=K_(t),s=this._pointerState.get(r);if(s&&s.downButton===t.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const a=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;p9(n,e.data)>a?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(t))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,t){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const t=K_(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const Fg={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let FJ=class extends ls{constructor(e=Fg.maximumClickDelay,t=Fg.movementUntilMouseDrag,r=Fg.movementUntilPenDrag,s=Fg.movementUntilTouchDrag,n=Fg.holdDelay,a=h2){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=t,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Us(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const t=e.data,r=t.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const a=this._pointerState.get(r);if(a){if(!a.isDragging){const o=a.previousEvent;this._pointerHold.emit(o,void 0,e.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this._holdDelay));const n={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,t,r){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:r}}_handlePointerMove(e){const t=e.data,r=t.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,t),void 0,s.modifiers):OJ(t,s.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),s.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const t=e.data,r=t.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,t)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,t){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,t==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):t==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}},NJ=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const t=e.data,r=t.pointers.size;switch(t.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var t,r;this._startEvent=e,(r=(t=this._callbacks).condition)!=null&&r.call(t,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var t,r;(r=(t=this._callbacks).condition)!=null&&r.call(t,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var t,r;(r=(t=this._callbacks).condition)!=null&&r.call(t,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},UJ=class extends ls{constructor(e=20,t=40){super(!1),this._threshold=e,this._maxDelta=t,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new NJ({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,t){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),t.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,t,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this._checkMovementWithinLimits(t.data,r.data)?this._checkVerticalThresholdReached(t.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,t){let r=-1/0,s=1/0,n=-1/0,a=1/0;for(const{x:g,y:v}of t.pointers.values())r=Math.max(r,g),s=Math.min(s,g),n=Math.max(n,v),a=Math.min(a,v);let o=-1/0,l=1/0,c=-1/0,h=1/0;for(const{x:g,y:v}of e.pointers.values())o=Math.max(o,g),l=Math.min(l,g),c=Math.max(c,v),h=Math.min(h,v);const u=r-s,m=n-a,f=o-l,y=c-h;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(f-u)<=this._maxDelta&&Math.abs(y-m)<=this._maxDelta}_checkVerticalThresholdReached(e,t){let r=Math.abs(e.center.y-t.center.y);return e.pointers.forEach((s,n)=>{const a=t.pointers.get(n);r=Math.min(r,Math.abs(s.y-a.y))}),r>=this._threshold}},$o=class extends ge{constructor(){super(...arguments),this._handles=new mi}destroy(){this._handles=we(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return!!((e=this._inputManager)!=null&&e.hasPendingInputs)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=we(this._inputManager)}connect(){const e=this.view;this._source=new d9(this.view.surface,e.input);const t=[new $J,new FJ,new LJ,new IJ(this.view.navigation),new UJ],r=new Ml({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new PJ],Id.INTERNAL),this._modeDragPan=new pI(e,"primary"),this._modeDragRotate=new wT(e,"secondary",Zn.CENTER),this._modeDragZoom=new tJ(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new yJ(e),new QZ(e),new cJ(e),new hJ(e,s.pan),new dJ(e),new bJ(e,s.resetTilt),new vJ(e,s.resetHeading),new wT(e,"primary",Zn.EYE,[s.lookAround]),new wT(e,"secondary",Zn.CENTER,[s.lookAround]),new pI(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new wJ(e)],Id.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(z(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},Je))}_updateMode(){var s;const e=this.mode,t=this.primaryDragAction,r=(s=hS.get(e))==null?void 0:s.get(t);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};d([p()],$o.prototype,"view",void 0),d([p({value:"pan"})],$o.prototype,"primaryDragAction",null),d([p({value:"default"})],$o.prototype,"mode",null),d([p({readOnly:!0})],$o.prototype,"hasPendingInputs",null),d([p()],$o.prototype,"latestPointerType",null),d([p()],$o.prototype,"latestPointerLocation",null),d([p()],$o.prototype,"multiTouchActive",null),d([p()],$o.prototype,"_inputManager",void 0),$o=d([k("esri.views.3d.input.SceneInputManager")],$o);const hS=new Map,CT=new Map,ET=new Map;CT.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),CT.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),ET.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),ET.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),hS.set("default",CT),hS.set("pro",ET);const VJ=$o;let Pa,$f,dS=!1,uS=!1,pS=!1,mS=!1,J_=null;function BJ(i,e){if(!uS||!$f)return;f9();const t=$f;let r=0;for(let s=0;s<i.accBinsNumX;s++)for(let n=0;n<i.accBinsNumY;n++){const a=i.accBins[s][i.accBinsNumY-1-n];r+=a.length;const o=s*i.accBinsSizeX,l=(s+1)*i.accBinsSizeX,c=n*i.accBinsSizeY,h=(n+1)*i.accBinsSizeY;t.fillText(a.length.toFixed(),o+5,c+15),g9(o,l,c,h,"blue")}t.fillText("total totalShownLabels: "+r,70,40),t.fillText("total visible labels: "+e.size,70,50),t.fillText("total numTests: "+i.accNumTests,70,30)}function zJ(i){pS=zt.DECONFLICTOR_SHOW_VISIBLE,mS=zt.DECONFLICTOR_SHOW_INVISIBLE,dS=pS||mS,uS=zt.DECONFLICTOR_SHOW_GRID,J_=null,dS||uS?J_=()=>kJ(i):Pa&&(Pa.parentElement.removeChild(Pa),Pa=null)}function f9(){J_&&(J_(),J_=null)}function kJ(i){Pa==null&&(Pa=document.createElement("canvas"),Pa.setAttribute("id","canvas2d"),i.surface.parentElement.style.position="relative",i.surface.parentElement.appendChild(Pa));const{state:e}=i,{camera:t,pixelRatio:r}=e,{width:s,height:n}=t,a=s*r,o=n*r;Pa.setAttribute("width",`${a}px`),Pa.setAttribute("height",`${o}px`),Pa.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),$f=Pa.getContext("2d"),$f.clearRect(0,0,s,n),$f.font="12px Arial"}function g9(i,e,t,r,s){f9();const n=Pa.height,a=$f;a.beginPath(),a.lineWidth=1,a.strokeStyle=s,a.moveTo(i,n-t),a.lineTo(e,n-t),a.stroke(),a.lineTo(e,n-r),a.stroke(),a.lineTo(e,n-t),a.stroke(),a.lineTo(i,n-t),a.stroke(),a.lineTo(i,n-t),a.stroke(),a.closePath()}function GJ(i,e){dS&&(e&&pS||!e&&mS)&&g9(i.aabr[0],i.aabr[2],i.aabr[1],i.aabr[3],e?"green":"red")}var es,ra;(function(i){i[i.GRAPHIC=0]="GRAPHIC",i[i.LABEL=1]="LABEL",i[i._COUNT=2]="_COUNT"})(es||(es={})),function(i){i[i.USER_SETTING=0]="USER_SETTING",i[i.SCALE_RANGE=1]="SCALE_RANGE",i[i.FILTER=2]="FILTER",i[i.DECONFLICTION=3]="DECONFLICTION",i[i._COUNT=4]="_COUNT"}(ra||(ra={}));function HJ(i){return i instanceof Float32Array&&i.length>=16}function qJ(i){return Array.isArray(i)&&i.length>=16}function WJ(i){return HJ(i)||qJ(i)}let _9=class{constructor(){this.factor=new yI,this.factorAlignment=new yI}},yI=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}},y9=class v9 extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2,t.spherical=e.viewingMode===Se.Global}initializeProgram(e){return new Gt(e.rctx,v9.shader.get().build(this.configuration),Zt)}_setPipelineState(e){const t=this.configuration,r=e===It.NONE,s=e===It.FrontFace,n=this.configuration.hasPolygonOffset?jJ:null,a=(r||s)&&t.output!==$.Highlight&&(t.depthEnabled||t.occlusionPass)?ka:null;return it({blending:t.output===$.Color||t.output===$.Alpha||t.output===$.Highlight?r?XJ:Qd(e):null,depthTest:{func:Ts.LEQUAL},depthWrite:a,colorWrite:ut,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?bt.POINTS:bt.TRIANGLES}};y9.shader=new jt(Xk,()=>Y(()=>import("./HUDMaterial.glsl-582e08c1.js"),["./HUDMaterial.glsl-582e08c1.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./vec4f64-6d0e93be.js","./string-53224faa.js","./typedArrayUtil-bf9f210a.js","./floatRGBA-1f66d0a4.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Texture-ae652f15.js","./compilerUtils-7bf6df9e.js","./Error-5cdd6e0a.js","./Evented-686173eb.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./TextureOnly.glsl-469cc321.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ShaderBuilder-be7ca791.js","./VertexAttribute-15d1866a.js","./Float4PassUniform-9354414b.js","./Texture2DPassUniform-268e8d2d.js","./basicInterfaces-7449a8bf.js","./assets-94d592bf.js","./enums-fc527c7c.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./mat3f64-50f3b9f6.js","./aaBoundingBox-fb003858.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Matrix3PassUniform-df6e2166.js","./mat4-f0dc8788.js","./mat4f64-abdda1bb.js","./HUD.glsl-73b068b4.js","./ReadLinearDepth.glsl-0e6f5c47.js","./RgbaFloatEncoding.glsl-67199794.js","./VerticalOffset.glsl-109e8746.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./FloatPassUniform-0426669b.js","./TransparencyPassType-c3841b0a.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./Slice.glsl-cd30f0ea.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./AlphaCutoff-96178e0d.js"],import.meta.url));const jJ={factor:0,units:-4},XJ=fc(he.ONE,he.ONE_MINUS_SRC_ALPHA);let Yi=class extends gc{constructor(){super(...arguments),this.output=$.Color,this.screenCenterOffsetUnitsEnabled=kd.World,this.transparencyPassType=It.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([L({count:$.COUNT})],Yi.prototype,"output",void 0),d([L({count:kd.COUNT})],Yi.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([L({count:It.COUNT})],Yi.prototype,"transparencyPassType",void 0),d([L()],Yi.prototype,"spherical",void 0),d([L()],Yi.prototype,"occlusionTestEnabled",void 0),d([L()],Yi.prototype,"signedDistanceFieldEnabled",void 0),d([L()],Yi.prototype,"vvSize",void 0),d([L()],Yi.prototype,"vvColor",void 0),d([L()],Yi.prototype,"hasVerticalOffset",void 0),d([L()],Yi.prototype,"hasScreenSizePerspective",void 0),d([L()],Yi.prototype,"debugDrawLabelBorder",void 0),d([L()],Yi.prototype,"binaryHighlightOcclusionEnabled",void 0),d([L()],Yi.prototype,"hasSlicePlane",void 0),d([L()],Yi.prototype,"hasPolygonOffset",void 0),d([L()],Yi.prototype,"depthEnabled",void 0),d([L()],Yi.prototype,"pixelSnappingEnabled",void 0),d([L()],Yi.prototype,"isDraped",void 0),d([L()],Yi.prototype,"hasMultipassGeometry",void 0),d([L()],Yi.prototype,"hasMultipassTerrain",void 0),d([L()],Yi.prototype,"cullAboveGround",void 0),d([L()],Yi.prototype,"occlusionPass",void 0),d([L()],Yi.prototype,"objectAndLayerIdColorInstanced",void 0),d([L({constValue:!0})],Yi.prototype,"hasSliceInVertexProgram",void 0),d([L({constValue:!1})],Yi.prototype,"hasVvInstancing",void 0);let tg=class extends Mp{constructor(e){super(e,new see),this._configuration=new Yi}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?kd.Screen:kd.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=t.slot===ne.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===$.Color||e===$.Alpha),e===$.Color&&(this._configuration.debugDrawLabelBorder=!!zt.LABELS_SHOW_BORDER),e===$.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassGeometry=t.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,s,n,a){if(!r.options.selectionMode||!r.options.hud||!e.visible)return;const o=this.parameters;let l=1,c=1;if(hh(RT,t),_(e.shaderTransformer)){const x=e.shaderTransformer(wI);l=x[0],c=x[5],ZJ(RT)}const h=e.vertexAttributes.get(C.POSITION),u=e.vertexAttributes.get(C.SIZE),m=e.vertexAttributes.get(C.NORMAL),f=e.vertexAttributes.get(C.AUXPOS1);_t(h.size>=3);const y=r.point,g=r.camera,v=kP(o);l*=g.pixelRatio,c*=g.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<h.data.length/h.size;x++){const w=x*h.size;Z(As,h.data[w],h.data[w+1],h.data[w+2]),Pe(As,As,t);const S=x*u.size;Mh[0]=u.data[S]*l,Mh[1]=u.data[S+1]*c,Pe(As,As,g.viewMatrix);const P=x*f.size;if(Z(ga,f.data[P+0],f.data[P+1],f.data[P+2]),!b&&(As[0]+=ga[0],As[1]+=ga[1],ga[2]!==0)){const M=ga[2];K(ga,As),ee(As,As,W(ga,ga,M))}const A=x*m.size;if(Z(Ng,m.data[A],m.data[A+1],m.data[A+2]),this._normalAndViewAngle(Ng,RT,g,AT),this._applyVerticalOffsetTransformationView(As,AT,g,ST),g.applyProjection(As,Hs),Hs[0]>-1){Hs[0]=Math.floor(Hs[0]),Hs[1]=Math.floor(Hs[1]),b&&(ga[0]||ga[1])&&(Hs[0]+=ga[0],ga[1]!==0&&(Hs[1]+=Iz(ga[1],ST.factorAlignment)),g.unapplyProjection(Hs,As)),Hs[0]+=this.parameters.screenOffset[0],Hs[1]+=this.parameters.screenOffset[1],MF(Mh,ST.factor,Mh);const M=tee*g.pixelRatio;let O=0;if(o.textureIsSignedDistanceField&&(O=o.outlineSize*g.pixelRatio/2),y&&vI(y,Hs[0],Hs[1],Mh,M,O,o,v)){const I=r.ray;if(Pe(bI,As,aa(eee,g.viewMatrix)),Hs[0]=y[0],Hs[1]=y[1],g.unprojectFromRenderScreen(Hs,As)){const N=E();X(N,I.direction);const F=1/xe(N);W(N,N,F),a(Ni(I.origin,As)*F,N,-1,!0,1,bI)}}}}}intersectDraped(e,t,r,s,n,a){const o=e.vertexAttributes.get(C.POSITION),l=e.vertexAttributes.get(C.SIZE),c=this.parameters,h=kP(c);let u=1,m=1;if(_(e.shaderTransformer)){const y=e.shaderTransformer(wI);u=y[0],m=y[5]}u*=e.screenToWorldRatio,m*=e.screenToWorldRatio;const f=iee*e.screenToWorldRatio;for(let y=0;y<o.data.length/o.size;y++){const g=y*o.size,v=o.data[g],b=o.data[g+1],x=y*l.size;Mh[0]=l.data[x]*u,Mh[1]=l.data[x+1]*m;let w=0;c.textureIsSignedDistanceField&&(w=c.outlineSize*e.screenToWorldRatio/2),vI(s,v,b,Mh,f,w,c,h)&&n(a.dist,a.normal,-1,!1)}}createBufferWriter(){return new aee(this)}_normalAndViewAngle(e,t,r,s){return WJ(t)&&(t=hh(JJ,t)),Jl(s.normal,e,t),Pe(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=oe(b9,ree),s}_updateScaleInfo(e,t,r){const s=this.parameters;_(s.screenSizePerspective)?CP(r,t,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),_(s.screenSizePerspectiveAlignment)?CP(r,t,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,r,s,n,a,o){const l=this._normalAndViewAngle(t,r,n,AT);return this._applyVerticalGroundOffsetView(e,l,n,o),this._applyVerticalOffsetTransformationView(o,l,n,a),this._applyPolygonOffsetView(o,l,s[3],n,o),this._applyCenterOffsetView(o,s,o),o}applyShaderOffsetsNDC(e,t,r,s,n){return this._applyCenterOffsetNDC(e,t,r,s),_(n)&&X(n,s),this._applyPolygonOffsetNDC(s,t,r,s),s}_applyPolygonOffsetView(e,t,r,s,n){const a=s.aboveGround?1:-1;let o=Math.sign(r);o===0&&(o=a);const l=a*o;if(this.parameters.shaderPolygonOffset<=0)return X(n,e);const c=ie(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return W(n,e,l>0?h:1/h),n}_applyVerticalGroundOffsetView(e,t,r,s){const n=xe(e),a=r.aboveGround?1:-1,o=.5*r.computeRenderPixelSizeAtDist(n),l=W(As,t.normal,a*o);return J(s,e,l),s}_applyVerticalOffsetTransformationView(e,t,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=xe(e);this._updateScaleInfo(s,c,t.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const a=xe(e),o=Ze(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=Dz(r,a,n.verticalOffset,t.cosAngle,o);return this._updateScaleInfo(s,a,t.cosAngle),W(t.normal,t.normal,l),J(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&X(r,e),s&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(K(Ng,r),J(r,r,W(Ng,Ng,t[2])))),r}_applyCenterOffsetNDC(e,t,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&X(s,e),n||(s[0]+=t[0]/r.fullWidth*2,s[1]+=t[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,t,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&X(s,e),n){const a=r.aboveGround?1:-1,o=a*Math.sign(t[3]);s[2]-=(o||a)*n}return s}requiresSlot(e,t){if(t===$.Color||t===$.Alpha||t===$.Highlight||t===$.ObjectAndLayerIdColor){if(e===ne.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:s}=this.parameters;return e===(r?ne.LABEL_MATERIAL:ne.HUD_MATERIAL)||s&&e===ne.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new YJ(e)}calculateRelativeScreenBounds(e,t,r=Ot()){return QJ(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}},YJ=class extends QF{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(y9,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function QJ(i,e,t,r=KJ){return as(r,i.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=i.screenOffset[0]*t,r[1]+=i.screenOffset[1]*t,r}function ZJ(i){const e=i[0],t=i[1],r=i[2],s=i[3],n=i[4],a=i[5],o=i[6],l=i[7],c=i[8],h=1/Math.sqrt(e*e+t*t+r*r),u=1/Math.sqrt(s*s+n*n+a*a),m=1/Math.sqrt(o*o+l*l+c*c);return i[0]=e*h,i[1]=t*h,i[2]=r*h,i[3]=s*u,i[4]=n*u,i[5]=a*u,i[6]=o*m,i[7]=l*m,i[8]=c*m,i}function vI(i,e,t,r,s,n,a,o){let l=e-s-(o[0]>0?r[0]*o[0]:0),c=l+r[0]+2*s,h=t-s-(o[1]>0?r[1]*o[1]:0),u=h+r[1]+2*s;const m=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&_(m)&&(l+=r[0]*m[0],h+=r[1]*m[1],c-=r[0]*(1-m[2]),u-=r[1]*(1-m[3]),l-=n,c+=n,h-=n,u+=n),i[0]>l&&i[0]<c&&i[1]>h&&i[1]<u}const ST=new _9,KJ=Ne(),As=E(),Ng=E(),Hs=Xt(),b9=E(),bI=E(),RT=Bs(),JJ=Bs(),eee=ve(),ga=E(),AT={normal:b9,cosAngle:0},wI=ve(),tee=1,iee=2,Mh=[0,0],ree=qe(0,0,1);let see=class extends ck{constructor(){super(...arguments),this.renderOccluded=hr.Occlude,this.color=Ai(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ti(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Ai(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const w9=Rr().vec3f(C.POSITION).vec3f(C.NORMAL).vec2f(C.UV0).vec4u8(C.COLOR).vec2f(C.SIZE).vec4f(C.AUXPOS1).vec4f(C.AUXPOS2),nee=w9.clone().vec4u8(C.OBJECTANDLAYERIDCOLOR);let aee=class{constructor(e){this._material=e,this.vertexBufferLayout=Vt("enable-feature:objectAndLayerId-rendering")?nee:w9}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(C.POSITION).length}write(e,t,r,s,n){F2(r.indices.get(C.POSITION),r.vertexAttributes.get(C.POSITION).data,e,s.position,n,6),ZF(r.indices.get(C.NORMAL),r.vertexAttributes.get(C.NORMAL).data,t,s.normal,n,6);const a=r.vertexAttributes.get(C.UV0).data;let o,l,c,h;if(a==null||a.length<4){const b=this._material.parameters;o=0,l=0,c=b.texCoordScale[0],h=b.texCoordScale[1]}else o=a[0],l=a[1],c=a[2],h=a[3];c=Math.min(1.99999,c+1),h=Math.min(1.99999,h+1);let u=r.indices.get(C.POSITION).length,m=n;const f=s.uv0;for(let b=0;b<u;++b)f.set(m,0,o),f.set(m,1,l),m+=1,f.set(m,0,c),f.set(m,1,l),m+=1,f.set(m,0,c),f.set(m,1,h),m+=1,f.set(m,0,c),f.set(m,1,h),m+=1,f.set(m,0,o),f.set(m,1,h),m+=1,f.set(m,0,o),f.set(m,1,l),m+=1;KF(r.indices.get(C.COLOR),r.vertexAttributes.get(C.COLOR).data,4,s.color,n,6);const y=r.indices.get(C.SIZE),g=r.vertexAttributes.get(C.SIZE).data;u=y.length;const v=s.size;m=n;for(let b=0;b<u;++b){const x=g[2*y[b]],w=g[2*y[b]+1];for(let S=0;S<6;++S)v.set(m,0,x),v.set(m,1,w),m+=1}if(r.indices.get(C.AUXPOS1)&&r.vertexAttributes.get(C.AUXPOS1)?lb(r.indices.get(C.AUXPOS1),r.vertexAttributes.get(C.AUXPOS1).data,s.auxpos1,n,6):IP(s.auxpos1,n,6*u),r.indices.get(C.AUXPOS2)&&r.vertexAttributes.get(C.AUXPOS2)?lb(r.indices.get(C.AUXPOS2),r.vertexAttributes.get(C.AUXPOS2).data,s.auxpos2,n,6):IP(s.auxpos2,n,6*u),_(r.objectAndLayerIdColor)&&r.indices.get(C.POSITION)){const b=r.indices.get(C.POSITION).length,x=s.getField(C.OBJECTANDLAYERIDCOLOR,Gd);hk(r.objectAndLayerIdColor,x,b,n,6)}}};const _l=E(),um=Xt(),Ug=Xt(),PT=E(),oee=ve(),lee=yo(),OT=ea(),cee=E(),hee=Ot();class dee{constructor(){this.aabr=Ot(),this.distance=0,this.culled=!1,this.visible=!1}}class uee{constructor(e,t){this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info={}}}var Yn;(function(i){i[i.Idle=0]="Idle",i[i.Process=1]="Process",i[i.Sort=2]="Sort",i[i.Deconflict=3]="Deconflict",i[i.NumStates=4]="NumStates"})(Yn||(Yn={}));class x9{constructor(){this.camera=new ze,this.slicePlane=vh(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),Fp(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let _f=class extends ge{get dirty(){return this._dirty}get state(){return this._state}constructor(i){super(i),this._dirty=!1,this._runningViewState=new x9,this._state=Yn.Idle,this._active=new Map,this._visible=new Map,this._iterators=new gee,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Yn.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const i=this._state/Yn.NumStates;return this._dirty?.5*i:i}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(i){switch(this._state){case Yn.Idle:this._startUpdate(),i.madeProgress();case Yn.Process:if(this._state=Yn.Process,!this._processActiveGraphics(i))return;case Yn.Sort:if(this._state=Yn.Sort,!this._sortVisibleGraphics(i))return;case Yn.Deconflict:if(this._state=Yn.Deconflict,!this._deconflictVisibleGraphics(i))return;default:BJ(this,this._visible),this._state=Yn.Idle,this.notifyChange("updating")}}modifyGraphics(i,e){e?i.forEach(t=>this.addToActiveGraphics(t)):i.forEach(t=>this.removeFromActiveGraphics(t)),this.setDirty()}layerSupportsDeconfliction(i){if(T(i)||i.type!=="object3d")return!1;const e=i.stageObject;if((e?e.geometries.length:0)!==1)return!1;const t=e==null?void 0:e.geometries[0];return(t==null?void 0:t.material)instanceof tg}_startUpdate(){zJ(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:i,fullHeight:e}=this._runningViewState.camera;this._initBins(i,e),this._resetIterators()}addToActiveGraphics(i){i.info[this.visibilityGroup]=new dee,this._active.set(i.graphics3DGraphic.graphic.uid,i),this.setDirty()}removeFromActiveGraphics(i){this._visible.delete(i.graphics3DGraphic.graphic.uid),pee(i,this.visibilityGroup),delete i.info[this.visibilityGroup],this._active.delete(i.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(i){const e=this._ensureActiveGraphicsIterator(),t=n0(oee,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?lee:null;let s=0;for(_(r)&&(Pe(r,Va,this._runningViewState.camera.viewMatrix),r[3]=qt(this.view.spatialReference).radius,s=PB(r,Va));!i.done;){i.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const a=n.value,o=a&&a.info[this.visibilityGroup];o&&(this._collectGraphics3DGraphics(a,t,r,s),o.culled?this._visible.delete(a.graphics3DGraphic.graphic.uid):this._visible.set(a.graphics3DGraphic.graphic.uid,a))}return!1}_sortVisibleGraphics(i){const e=this._ensureSortGraphicsIterator();for(;!i.done;){const t=e.next();if(i.madeProgress(),t.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(i){const e=this._ensureVisibleGraphicsIterator(),t=this.visibilityGroup===es.LABEL;for(;!i.done;){i.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const a=s.graphics3DGraphic,o=(!t||a.isVisible())&&!this._isConflicted(s);o&&this._addToBins(s),n.visible=o,this._setGraphicVisibility(s,o),GJ(n,o)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=xI(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=xI(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=mee(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(i,e,t,r){const s=i.graphics3DGraphic;if(s.destroyed)return;const n=i.info[this.visibilityGroup];if(!s.isVisible(es.GRAPHIC,ra.DECONFLICTION))return void(n.culled=!0);const a=this.getGraphicsLayers(s);nl(n.aabr);let o=null;for(const l of a){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(T(o)){if(o=vee,this._getProjectionInfo(l,e,o),o.isOutsideScreen||this._isCulledBySlice(i,_l)||_(t)&&this._isCulledByHorizon(o,t,r))return void(n.culled=!0);!zt.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(o.distance*=.7)}this._expandBoundingRect(n,l,c,o)}T(o)?n.culled=!0:(n.distance=o.distance,n.culled=!1)}_getProjectionInfo(i,e,t){const r=this._runningViewState.camera,s=i.stageObject,n=s.geometries[0],a=n.material,o=y2(s.boundingVolumeWorldSpace.bounds);Pe(_l,o,r.viewMatrix);const l=n.vertexAttributes,c=l.get(C.NORMAL).data,h=l.get(C.AUXPOS1).data;a.applyShaderOffsetsView(_l,c,s.transformation,h,r,t.scaleInfo,_l),Vs(um,_l[0],_l[1],_l[2],1),Jc(Ug,um,r.projectionMatrix),W(t.positionNDC,Ug,1/Ug[3]),a.applyShaderOffsetsNDC(t.positionNDC,h,r,t.positionNDC,PT),t.distanceWithoutPolygonOffset=r.depthNDCToWorld(PT[2]),t.distance=PT[2]===t.positionNDC[2]?t.distanceWithoutPolygonOffset:r.depthNDCToWorld(t.positionNDC[2]),Vs(Ug,t.positionNDC[0],t.positionNDC[1],t.positionNDC[2],1),Jc(um,Ug,e),uw(um,um,1/um[3]),Z(t.positionView,_l[0],_l[1],_l[2])}_isCulledByHorizon(i,e,t){return X(OT.direction,i.positionView),Z(OT.origin,0,0,0),!!aw(e,OT,cee)&&i.distanceWithoutPolygonOffset>t}_isCulledBySlice(i,e){return i.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&tR(this._runningViewState.slicePlane,e)}_expandBoundingRect(i,e,t,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,a=e.getScreenSize(_ee);MF(a,s.factor,a),a[0]*=n.pixelRatio,a[1]*=n.pixelRatio;const o=J1(t.calculateRelativeScreenBounds(a,s.factorAlignment.scale,hee),dt(0,n.fullWidth,.5+.5*r[0]),dt(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Yl(o),Vd(o));o[0]-=c,o[1]-=c,o[2]+=c,o[3]+=c}Od(i.aabr,o,i.aabr)}_isConflicted(i){const e=i.graphics3DGraphic.graphic.uid,t=i.info[this.visibilityGroup];for(let r=Math.floor(t.aabr[0]/this._accBinsSizeX);r<=Math.floor(t.aabr[2]/this._accBinsSizeX);r++)if(!(r<0||r>=this._accBinsNumX))for(let s=Math.floor(t.aabr[1]/this._accBinsSizeY);s<=Math.floor(t.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[r][s];for(let a=0;a<n.length;a++){const o=n.data[a],l=o.info[this.visibilityGroup];if(l&&l.visible&&o.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,nw(l.aabr,t.aabr)))return!0}}return!1}_initBins(i,e){if(this._accBins==null){this._accBins=[];for(let t=0;t<this._accBinsNumX;t++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new Ht)}}else for(let t=0;t<this._accBinsNumX;t++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[t][r].clear();this._accBinsSizeX=i/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(i){const e=i.info[this.visibilityGroup],t=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let a=t;a<=r;a++)if(!(a<0||a>=this._accBinsNumX))for(let o=s;o<=n;o++)o<0||o>=this._accBinsNumY||this._accBins[a][o].push(i)}_setGraphicVisibility(i,e){const t=i.graphics3DGraphic;t.destroyed||(t.setVisibilityFlag(ra.DECONFLICTION,e,this.visibilityGroup),this.visibilityGroup===es.LABEL&&this.view.labeler.setLabelGraphicVisibility(t,e))}};function pee(i,e){const t=i.graphics3DGraphic;t.destroyed||t.clearVisibilityFlag(ra.DECONFLICTION,e)}function*xI(i){if(Map.prototype.entries){const e=i.entries();for(let t=e.next();!t.done;t=e.next())yield t.value[1]}else yield*i.values()}function*mee(i,e,t){e.clear(),i.forEach((s,n)=>{const a=e.pushNew();a.id=n,a.visible=s.graphics3DGraphic.hasVisibilityFlag(ra.DECONFLICTION,t),a.prio=s.info?s.info[t].distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.visible!==n.visible?s.visible?-1:1:s.prio!==n.prio?s.prio-n.prio:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=i.get(s.id);n&&(i.delete(s.id),i.set(s.id,n))}),e.clear()}d([p({constructOnly:!0})],_f.prototype,"view",void 0),d([p({type:Boolean,readOnly:!0})],_f.prototype,"updating",null),_f=d([k("esri.views.3d.layers.graphics.Deconflictor")],_f);class fee{}class gee{constructor(e=null,t=null,r=null){this.active=e,this.visible=t,this.sort=r,this.sortArray=new Ht({allocator:s=>s||new fee})}}const _ee=Ne();class yee{constructor(){this.positionView=E(),this.positionNDC=E(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new _9}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const vee=new yee,bee=2e3;let O1=class extends _f{constructor(e){super(e),this.visibilityGroup=es.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Mn.YIELD;const t=performance.now();if(e.state!==bi.IDLE&&t-this._lastDeconfliction<bee)return Mn.YIELD;super.runTask(e),this.state===Yn.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([p({constructOnly:!0})],O1.prototype,"parent",void 0),O1=d([k("esri.views.3d.layers.graphics.LabelDeconflictor")],O1);let fS=class extends _f{constructor(){super(...arguments),this._handles=new mi,this._contexts=new Map,this._viewState=new x9,this.visibilityGroup=es.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([z(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),z(()=>{var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),z(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Je)]),this._frameTask=this.view.resourceController.scheduler.registerTask(rr.GRAPHICS_DECONFLICTOR,this),this._labels=new O1({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&MT(e));t.setVisibilityFlag(ra.DECONFLICTION,r,es.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&I5(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){fs(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const t=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const s=r.graphic.uid,n=new uee(r,e.symbolCreationContext.slicePlaneEnabled);t.set(s,n),MT(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,t){const r=t.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=MT(e);r||wee(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.layers;if(!t||!t.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const t=this._contexts.get(e);if(t)return t;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function MT(i){const e=i.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function wee(i){const e=i.graphics3DGraphics;e&&e.forEach(t=>t.clearVisibilityFlag(ra.DECONFLICTION))}fS=d([k("esri.views.3d.layers.graphics.GraphicsDeconflictor")],fS);function T9(i){return"declaredClass"in i}function TI(i){return"declaredClass"in i}function xee(i){return"declaredClass"in i}function Tee(i,e){return i?xee(i)?i:new mc({layer:e,sourceLayer:e,visible:i.visible,symbol:il(i.symbol),attributes:il(i.attributes),geometry:C9(i.geometry)}):null}function C9(i){return T(i)?null:T9(i)?i:QC(Cee(i))}function Cee(i){const{wkid:e,wkt:t,latestWkid:r}=i.spatialReference,s={wkid:e,wkt:t,latestWkid:r};switch(i.type){case"point":{const{x:n,y:a,z:o,m:l}=i;return{x:n,y:a,z:o,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:a,hasM:o}=i;return{rings:CI(n),hasZ:a,hasM:o,spatialReference:s}}case"polyline":{const{paths:n,hasZ:a,hasM:o}=i;return{paths:CI(n),hasZ:a,hasM:o,spatialReference:s}}case"extent":{const{xmin:n,xmax:a,ymin:o,ymax:l,zmin:c,zmax:h,mmin:u,mmax:m,hasZ:f,hasM:y}=i;return{xmin:n,xmax:a,ymin:o,ymax:l,zmin:c,zmax:h,mmin:u,mmax:m,hasZ:f,hasM:y,spatialReference:s}}case"multipoint":{const{points:n,hasZ:a,hasM:o}=i;return{points:S9(n)?E9(n):n,hasZ:a,hasM:o,spatialReference:s}}default:return}}function CI(i){return Eee(i)?i.map(e=>E9(e)):i}function E9(i){return i.map(e=>Array.from(e))}function Eee(i){for(const e of i)if(e.length!==0)return S9(e);return!1}function S9(i){return i.length>0&&(E$(i[0])||S$(i[0]))}function See(i,e){if(!i)return null;let t;if(TI(i)){if(e==null)return i.clone();if(TI(e))return e.copy(i)}return e!=null?(t=e,t.x=i.x,t.y=i.y,t.spatialReference=i.spatialReference,i.hasZ?(t.z=i.z,t.hasZ=i.hasZ):(t.z=void 0,t.hasZ=!1),i.hasM?(t.m=i.m,t.hasM=!0):(t.m=void 0,t.hasM=!1)):(t=yh(i.x,i.y,i.z,i.spatialReference),i.hasM&&(t.m=i.m,t.hasM=!0)),t}function ube(i){const{wkid:e,wkt:t,latestWkid:r}=i,s={wkid:e,wkt:t,latestWkid:r};return ci.fromJSON(s)}let R9=class{constructor(e=null,t="center",r="center",s=null,n=[0,0,0],a=0,o=[0,0,0,1],l=[0,0],c="world",h=0,u=0){this.verticalOffset=e,this.horizontalPlacement=t,this.verticalPlacement=r,this.text=s,this.translation=n,this.elevationOffset=a,this.centerOffset=o,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=h,this.displayHeight=u}};function XR(i,e){if(i.type==="point")return Ih(i,e,!1);if(T9(i))switch(i.type){case"extent":return Ih(i.center,e,!1);case"polygon":return Ih(i.centroid,e,!1);case"polyline":return Ih(EI(i),e,!0);case"mesh":return Ih(i.origin,e,!1)}else switch(i.type){case"extent":return Ih(Ree(i),e,!0);case"polygon":return Ih(Aee(i),e,!0);case"polyline":return Ih(EI(i),e,!0)}}function EI(i){const e=i.paths[0];if(!e||e.length===0)return null;const t=hF(e,dF(e)/2);return yh(t[0],t[1],t[2],i.spatialReference)}function Ree(i){return yh(.5*(i.xmax+i.xmin),.5*(i.ymax+i.ymin),i.zmin!=null&&i.zmax!=null&&isFinite(i.zmin)&&isFinite(i.zmax)?.5*(i.zmax+i.zmin):void 0,i.spatialReference)}function Aee(i){const e=i.rings[0];if(!e||e.length===0)return null;const t=R7(i.rings,!!i.hasZ);return yh(t[0],t[1],t[2],i.spatialReference)}function Ih(i,e,t){const r=t?i:See(i);return e&&i?mB(i,r,e)?r:null:r}function mbe(i,e,t,r=0){if(i){e||(e=Ot());const s=i;let n=.5*s.width*(t-1),a=.5*s.height*(t-1);return s.width<1e-7*s.height?n+=a/20:s.height<1e-7*s.width&&(a+=n/20),Vs(e,s.xmin-n-r,s.ymin-a-r,s.xmax+n+r,s.ymax+a+r),e}return null}function A9(i,e){for(let t=0;t<i.geometries.length;++t){const r=i.geometries[t].getMutableAttribute(C.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,i.geometryVertexAttrsUpdated(i.geometries[t]))}}function ey(i,e){const t=dw(Yo);return _(i)&&(t[0]=i[0],t[1]=i[1],t[2]=i[2]),_(e)?t[3]=e:_(i)&&i.length>3&&(t[3]=i[3]),t}function fbe(i,e,t,r,s,n=[0,0,0,0]){for(let a=0;a<3;++a)_(i)&&i[a]!=null?n[a]=i[a]:_(t)&&t[a]!=null?n[a]=t[a]:n[a]=s[a];return _(e)?n[3]=e:_(r)?n[3]=r:n[3]=s[3],n}function SI(i=Cd,e,t,r=1){const s=new Array(3);if(T(e)||T(t))s[0]=1,s[1]=1,s[2]=1;else{let n,a=0;for(let o=2;o>=0;o--){const l=i[o];let c;const h=l!=null,u=o===0&&!n&&!h,m=t[o];l==="symbol-value"||u?c=m!==0?e[o]/m:1:h&&l!=="proportional"&&isFinite(l)&&(c=m!==0?l/m:1),c!=null&&(s[o]=c,n=c,a=Math.max(a,Math.abs(c)))}for(let o=2;o>=0;o--)s[o]==null?s[o]=n:s[o]===0&&(s[o]=.001*a)}for(let n=2;n>=0;n--)s[n]/=r;return so(s)}function Pee(i){return i.isPrimitive!=null}function Bw(i){return Ub(Pee(i)?[i.width,i.depth,i.height]:i)?null:"Symbol sizes may not be negative values"}function Ub(i){if(Array.isArray(i)){for(const e of i)if(!Ub(e))return!1;return!0}return i==null||i>=0}function Oee(i,e,t,r=ve()){const s=i||0,n=e||0,a=t||0;return s!==0&&fy(r,r,-s/180*Math.PI),n!==0&&gy(r,r,n/180*Math.PI),a!==0&&w2(r,r,a/180*Math.PI),r}function YR(i,e,t){if(t.minDemResolution!=null)return t.minDemResolution;const r=Yd(e),s=a5(i)*r,n=o5(i)*r,a=H2(i)*(e.isGeographic?1:r);return s===0&&n===0&&a===0?t.minDemResolutionForPoints:.01*Math.max(s,n,a)}function P9(i,e,t,r,s,n,a,o,l,c,h){const u=Uee[h.mode];let m,f,y=0;if(In(i,e,t,r,l.spatialReference,s,o))return u.requiresAlignment(h)?(y=u.applyElevationAlignmentBuffer(r,s,n,a,o,l,c,h),m=n,f=a):(m=r,f=s),In(m,l.spatialReference,f,n,c.spatialReference,a,o)?y:void 0}function pg(i,e,t,r,s){const n=(Mb(i)?i.z:qN(i)?i.array[i.offset+2]:i[2])||0;switch(t.mode){case"on-the-ground":{const a=Ze(tc(e,i,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=a,void(s.z=a)}case"relative-to-ground":{const a=Ze(tc(e,i,"ground"),0),o=t.geometryZWithOffset(n,r);return s.verticalDistanceToGround=o,s.sampledElevation=a,void(s.z=o+a)}case"relative-to-scene":{const a=Ze(tc(e,i,"scene"),0),o=t.geometryZWithOffset(n,r);return s.verticalDistanceToGround=o,s.sampledElevation=a,void(s.z=o+a)}case"absolute-height":{const a=t.geometryZWithOffset(n,r),o=Ze(tc(e,i,"ground"),0);return s.verticalDistanceToGround=a-o,s.sampledElevation=o,void(s.z=a)}default:return void(s.z=0)}}function Mee(i,e,t,r){return pg(i,e,t,r,yf),yf.z}function g0(i,e,t){return e==null||t==null?i.definedChanged:e==="on-the-ground"&&t==="on-the-ground"?i.staysOnTheGround:e===t||e!=="on-the-ground"&&t!=="on-the-ground"?Gi.UPDATE:i.onTheGroundChanged}function xo(i){return i==="relative-to-ground"||i==="relative-to-scene"}function Xd(i){return i!=="absolute-height"}function Iee(i,e,t,r,s){pg(e,t,s,r,yf),A9(i,yf.verticalDistanceToGround);const n=yf.sampledElevation,a=bs(Vee,i.transformation);return lv[0]=e.x,lv[1]=e.y,lv[2]=yf.z,ch(e.spatialReference,lv,a,r.spatialReference)?i.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function Dee(i,e,t,r,s,n){let a=0;const o=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=i[e+0],h=i[e+1],u=i[e+2],m=Ze(n.getElevation(c,h,u,o,"ground"),0);a+=m,t[r+0]=c,t[r+1]=h,t[r+2]=m,e+=3,r+=3}return a/s}function Lee(i,e,t,r,s,n,a,o){let l=0;const c=o.calculateOffsetRenderUnits(a),h=o.featureExpressionInfoContext,u=n.spatialReference;e*=3,r*=3;for(let m=0;m<s;++m){const f=i[e+0],y=i[e+1],g=i[e+2],v=Ze(n.getElevation(f,y,g,u,"ground"),0);l+=v,t[r+0]=f,t[r+1]=y,t[r+2]=h==null?g+v+c:v+c,e+=3,r+=3}return l/s}function $ee(i,e,t,r,s,n,a,o){let l=0;const c=o.calculateOffsetRenderUnits(a),h=o.featureExpressionInfoContext,u=n.spatialReference;e*=3,r*=3;for(let m=0;m<s;++m){const f=i[e+0],y=i[e+1],g=i[e+2],v=Ze(n.getElevation(f,y,g,u,"scene"),0);l+=v,t[r+0]=f,t[r+1]=y,t[r+2]=h==null?g+v+c:v+c,e+=3,r+=3}return l/s}function Fee(i){const e=i.meterUnitOffset,t=i.featureExpressionInfoContext;return e!==0||t!=null}function Nee(i,e,t,r,s,n,a,o){const l=o.calculateOffsetRenderUnits(a),c=o.featureExpressionInfoContext;e*=3,r*=3;for(let h=0;h<s;++h){const u=i[e+0],m=i[e+1],f=i[e+2];t[r+0]=u,t[r+1]=m,t[r+2]=c==null?f+l:l,e+=3,r+=3}return 0}let _0=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Gi;(function(i){i[i.NONE=0]="NONE",i[i.UPDATE=1]="UPDATE",i[i.RECREATE=2]="RECREATE"})(Gi||(Gi={}));const Uee={"absolute-height":{applyElevationAlignmentBuffer:Nee,requiresAlignment:Fee},"on-the-ground":{applyElevationAlignmentBuffer:Dee,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Lee,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:$ee,requiresAlignment:()=>!0}},Vee=ve(),yf=new _0,lv=E();function QR(i){return _(i.mapPositions)}function O9(i,e,t,r,s){const n=i.stageObject,a=n.geometries;let o=0;for(const l of a){if(!QR(l))continue;const{update:c,averageGeometrySampledElevation:h}=I9(l,e,t,r,s);o+=h,c&&n.geometryVertexAttrsUpdated(l)}return o/a.length}function Vy(i,e,t,r,s){var u;const n=i.stageObject,a=e.centerPointInElevationSR;let o=0;(u=n.metadata)!=null&&u.usesVerticalDistanceToGround?(r(a,Sn),A9(n,Sn.verticalDistanceToGround),o=Sn.sampledElevation):(r(a,Sn),e.mode!=="absolute-height"&&(o=Sn.sampledElevation));const l=bs(Bee,n.transformation),c=Z(M9,l[12],l[13],l[14]);zt.TESTS_DISABLE_OPTIMIZATIONS?(En[0]=a.x,En[1]=a.y,En[2]=Sn.z,ch(a.spatialReference,En,l,s.spatialReference)&&(n.transformation=l)):s.setAltitudeOfTransformation(Sn.z,l);const h=ZR/s.unitInMeters;return(Math.abs(l[12]-c[0])>=h||Math.abs(l[13]-c[1])>=h||Math.abs(l[14]-c[2])>=h)&&(n.transformation=l),o}const Bee=ve();function zee(i,e,t,r,s){const n=i.graphics3DSymbolLayer.lodRenderer;if(T(n))return 0;const a=e.centerPointInElevationSR;r(a,Sn);const o=e.mode!=="absolute-height"?Sn.sampledElevation:0,l=n.instanceData,c=i.instanceIndex,h=Gee;l.getGlobalTransform(c,h);const u=Z(M9,h[12],h[13],h[14]);zt.TESTS_DISABLE_OPTIMIZATIONS?(En[0]=a.x,En[1]=a.y,En[2]=Sn.z,ch(a.spatialReference,En,h,s.spatialReference)&&l.setGlobalTransform(c,h)):s.setAltitudeOfTransformation(Sn.z,h);const m=ZR/s.unitInMeters;return(zt.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(h[12]-u[0])>=m||Math.abs(h[13]-u[1])>=m||Math.abs(h[14]-u[2])>=m)&&l.setGlobalTransform(c,h),o}function kee(i,e,t,r,s){const n=i.stageObject,a=n.geometries;if(a.length===0)return 0;let o=0,l=null,c=0,h=!1;for(const u of a){if(!QR(u))continue;const m=u.vertexAttributes.get(C.POSITION);if(m!==l){const{update:f,averageGeometrySampledElevation:y}=I9(u,e,t,r,s);c=y,l=m,h=f}h&&n.geometryVertexAttrsUpdated(u),o+=c}return o/a.length}const ZR=.01,En=E(),Ga=E(),pm=E(),Gee=ve(),M9=E(),Sn=new _0;function I9(i,e,t,r,s){let n=!1;const a=i.shaderTransformation,o=e.requiresSampledElevationInfo;Ga[0]=a[12],Ga[1]=a[13],Ga[2]=a[14],i.invalidateBoundingInfo();const l=i.getMutableAttribute(C.POSITION),c=l.data,h=l.size,u=c.length/h,m=new HN(i.mapPositions,t);let f=0,y=0;for(let g=0;g<u;g++){if(pm[0]=c[f],pm[1]=c[f+1],pm[2]=c[f+2],r(m,Sn),o&&(y+=Sn.sampledElevation),zt.TESTS_DISABLE_OPTIMIZATIONS)c[f]=m.array[m.offset],c[f+1]=m.array[m.offset+1],c[f+2]=Sn.z,In(c,t,f,c,s.spatialReference,f,1),c[f]-=Ga[0],c[f+1]-=Ga[1],c[f+2]-=Ga[2],n=!0;else{En[0]=c[f]+Ga[0],En[1]=c[f+1]+Ga[1],En[2]=c[f+2]+Ga[2],s.setAltitude(En,Sn.z),c[f]=En[0]-Ga[0],c[f+1]=En[1]-Ga[1],c[f+2]=En[2]-Ga[2];const v=ZR/s.unitInMeters;(Math.abs(pm[0]-c[f])>=v||Math.abs(pm[1]-c[f+1])>=v||Math.abs(pm[2]-c[f+2])>=v)&&(n=!0)}f+=h,m.offset+=3}return y/=u,{update:n,averageGeometrySampledElevation:y}}const Hee=pe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function qee(i){return{cachedResult:i.cachedResult,arcade:i.arcade?{func:i.arcade.func,context:i.arcade.modules.arcadeUtils.createExecContext(null,{sr:i.arcade.context.spatialReference}),modules:i.arcade.modules}:null}}function _be(i){const e=i&&i.expression;if(typeof e=="string"){const t=$9(e);if(t!=null)return{cachedResult:t}}return null}async function ybe(i,e,t,r){const s=i&&i.expression;if(typeof s!="string")return null;const n=$9(s);if(n!=null)return{cachedResult:n};const a=await C2();Ti(t);const o=a.arcadeUtils,l=o.createSyntaxTree(s);return o.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(l),context:o.createExecContext(null,{sr:e}),modules:a}}}function D9(i,e,t){return i.arcadeUtils.createFeature(e.attributes,e.geometry,t)}function KR(i,e){if(i!=null&&!L9(i)){if(!e||!i.arcade)return void Hee.errorOncePerTick("Arcade support required but not provided");const t=e;t._geometry&&(t._geometry=C9(t._geometry)),i.arcade.modules.arcadeUtils.updateExecContext(i.arcade.context,e)}}function Wee(i){if(i!=null){if(L9(i))return i.cachedResult;const e=i.arcade;let t=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof t!="number"&&(i.cachedResult=0,t=0),t}return 0}function vbe(i,e=!1){let t=i&&i.featureExpressionInfo;const r=t&&t.expression;return e||r==="0"||(t=null),t??null}const jee={cachedResult:0};function L9(i){return i.cachedResult!=null}function $9(i){return i==="0"?0:null}let ml=class F9{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Jk(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(t+=Wee(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=eG(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Ze(e.offset,0)}updateFeatureExpressionInfoContext(e,t,r){if(T(e))return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&_(t)&&_(r)?(this._featureExpressionInfoContext=qee(e),KR(this._featureExpressionInfoContext,D9(s.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new F9;return _(e)&&t.setFromElevationInfo(e),t}},Xee=class{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}},Yee=class{constructor(e,t,r){this.baseMaterial=e,this.edgeMaterials=t,this.properties=r}},_c=class{get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}constructor(e,t,r,s,n,a,o,l=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=a,this.elevationContext=o,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e,t){this._stageLayer=t,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const t=this._stage.renderer.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,t){if(T(this._edgeState))return;const r=RI(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(t),this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,t){T(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!t),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stage!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),_(this._edgeState))){const t=this._stage.renderer.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(e,t,r,s){if(this.elevationAligner==null)return;_(r)&&KR(this.elevationContext.featureExpressionInfoContext,r);const n=(a,o)=>pg(a,e,this.elevationContext,t,o);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,Et(e.spatialReference),n,t),this._resetEdgeObject(s)}alignWithAbsoluteElevation(e,t,r){const s=(n,a)=>{a.sampledElevation=e,a.verticalDistanceToGround=0,a.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,t),this._resetEdgeObject(r)}getCenterObjectSpace(e=E()){return X(e,y2(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=zs()){const t=this.stageObject.boundingVolumeObjectSpace;return zk(e,t.min),kk(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else for(const t of this.stageObject.geometries)t.computeAttachmentOrigin(Pc)&&(Pe(Pc,Pc,this.stageObject.transformation),J(e.render.origin,e.render.origin,Pc),e.render.num++)}async getProjectedBoundingBox(e,t,r,s,n){const a=this.getBoundingBoxObjectSpace(n),o=Qee,l=k2(a)?1:o.length;for(let h=0;h<l;h++){const u=o[h];Dh[0]=a[u[0]],Dh[1]=a[u[1]],Dh[2]=a[u[2]],Pe(Dh,Dh,this.stageObject.transformation),lu[3*h+0]=Dh[0],lu[3*h+1]=Dh[1],lu[3*h+2]=Dh[2]}if(!e(lu,0,l))return null;Pi(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let u=0;u<3;u++)a[u]=Math.min(a[u],lu[h+u]),a[u+3]=Math.max(a[u+3],lu[h+u]);c&&r.push({location:lu.slice(h,h+3),screenSpaceBoundingRect:c})}if(t&&t.service&&this.elevationContext.mode!=="absolute-height"){Ko(a,Pc);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let u=0;if(t.useViewElevation)u=Ze(t.service.getElevation(Pc[0],Pc[1],h),0);else try{const m=YR(a,t.service.spatialReference,t);u=Ze(await t.service.queryElevation(Pc[0],Pc[1],s,m,h),0)}catch{}l5(a,0,0,-this.alignedSampledElevation+u)}return a}addObjectState(e,t){e===Yf.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===Yf.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}_resetEdgeObject(e){if(T(this._edgeState))return;const t=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,t){const r=this._edgeState;if(T(r))return;const s=RI(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!t).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function RI(i){return i.isVisible()?i.parameters.transparent?gt.TRANSPARENT:gt.OPAQUE:gt.INVISIBLE}const lu=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Dh=E(),Pc=E(),Qee=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let N9=class{constructor(e,t=null){this.labelText=t,this.elevationOffset=Ze(e,0)}};var Cr;(function(i){i[i.Recreate_Symbol=0]="Recreate_Symbol",i[i.Recreate_Graphics=1]="Recreate_Graphics",i[i.Fast_Update=2]="Fast_Update"})(Cr||(Cr={}));let JR=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Ma.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===Ma.LOADED?(e&&e(),Ze(this._loader,Promise.resolve())):this._loadStatus===Ma.FAILED?(t&&t(this._loadError),Ze(this._loader,Promise.resolve())):(T(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Ma.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Ma.FAILED,!za(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=sl(this._abortController):this._loadStatus===Ma.LOADING&&(this._loadStatus=Ma.FAILED),this._loader=null}};var Ma;(function(i){i[i.LOADING=0]="LOADING",i[i.LOADED=1]="LOADED",i[i.FAILED=2]="FAILED"})(Ma||(Ma={}));const U9=3,gS=3,V9=10;let B9=class{constructor(e,t=null){this.geometry=e,this.textures=t}};function cv(i){const e=[];return i.levels.forEach(t=>t.components.forEach(r=>e.push(r.geometry.material))),e0(e)}function AI(i){const e=new Array;return i.levels.forEach(t=>{t.components.forEach(r=>{_(r.textures)&&e.push(...r.textures)})}),e0(e)}function z9(i){const e=i.components.map(t=>t.geometry);return e0(e)}function PI(i){const e=[];return i.levels.forEach(t=>{t.components.forEach(r=>{e.push(r.geometry)})}),e0(e)}function Zee(i){switch(i){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function k9(i,e){const t=(r,s,n=!1)=>({levels:r.map(a=>{const o=s(a.tesselation);return n&&kX(o),{components:[new B9(o)],faceCount:o.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})});switch(i){case"sphere":return t([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>VX(e,.5,r,!0));case"cube":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>OX(e,1));case"cone":return t(IT,r=>aM(e,1,.5,r,!1),!0);case"inverted-cone":return t(IT,r=>aM(e,1,.5,r,!0),!0);case"cylinder":return t(IT,r=>zX(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>UX(e,1),!0);case"diamond":return t([{tesselation:0,minScreenSpaceRadius:0}],()=>LX(e,1),!0);default:return}}const IT=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}],eA={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function Sbe(i){return i.type==="web-style"?eA:tA(i.symbolLayers.toArray().map(e=>G9(i,e)))}function tA(i){let e=0,t=0,r=0,s=!1,n=0;const a={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const o of i)T(o)||(e+=o.primitivesPerFeature,t+=o.primitivesPerCoordinate,r+=o.drawCallsPerFeature,a.bytesPerFeature+=o.memory.bytesPerFeature,a.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.bytesPerCoordinate+=o.memory.bytesPerCoordinate,a.resourceBytes+=o.memory.resourceBytes,a.draped.bytesPerFeature+=o.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.draped.bytesPerCoordinate+=o.memory.bytesPerCoordinate,s=s||o.estimated,++n);return{primitivesPerFeature:e,primitivesPerCoordinate:t,drawCallsPerFeature:r,estimated:s,memory:a,numComplexities:n}}function Rbe(i){const e=tA(i);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const OI={};function G9(i,e){const t=H9(i,e),r=tG(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:t};case"fill":return i.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:t}:_(e.outline)&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:t}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:t};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:t};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:t};case"object":return e.resource&&e.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:t}:{...Kee(e.resource&&e.resource.primitive||oF),memory:t};case"path":{let s=0,n=0;switch(e.profile){case"circle":s=V9;break;case"quad":s=4;break;default:return void ll(e.profile)}switch(e.join??"simple"){case"round":n=U9;break;case"miter":case"bevel":n=1;break;default:return}const a=2*s,o=s*n*2;let l=-2*o-a;switch(e.cap){case"none":break;case"butt":case"square":l+=2*(s-1);break;case"round":l+=2*(s*(gS-1)*2+s);break;default:return}return{primitivesPerFeature:l,primitivesPerCoordinate:o+a,drawCallsPerFeature:0,estimated:!1,memory:t}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:t};default:return}}function H9(i,e){const t=i.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?an.EXTRUDE_EDGES:an.EXTRUDE;case"fill":return _(e.outline)&&e.outline.size>0?an.FILL_OUTLINE:an.FILL;case"water":return an.FILL;case"line":return e.join==="round"?an.LINE_ROUND:an.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return an.PATH_ROUND_CIRCLE;case"quad":return an.PATH_ROUND_QUAD;default:return void ll(e.profile)}case"miter":case"bevel":switch(e.profile){case"circle":return an.PATH_MITER_CIRCLE;case"quad":return an.PATH_MITER_QUAD;default:return void ll(e.profile)}default:return}case"object":return t?an.OBJECT_POINT:an.OBJECT_POLYGON;case"icon":case"text":return t?an.ICON_POINT:an.ICON_POLYGON;default:return}}function Kee(i){let e=OI[i];if(e)return e;const t=k9(i,null);return e={primitivesPerFeature:z9(t.levels[0]).reduce((r,s)=>r+s.indices.get(C.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},OI[i]=e,e}const an={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}},mm=pe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let yc=class extends JR{constructor(e,t,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=t,this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=mm,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new ml,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=MI(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this._ignoreDrivers)return!1;const t=this._drivenProperties,r=MI(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,s){const n=e.projectionSuccess,a="polygons"in e?e.polygons:null,o=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(t,r,s)&&a&&a.length===0&&r==="rings"&&t.length>0&&t[0].length>2&&(l=`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${o} (failed to project geometry to view spatial reference)`,l&&mm.warnOncePerTick(l)}_logGeometryValidationWarnings(e,t,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(mm.warnOncePerTick(`${s} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(mm.warnOncePerTick(`${s} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e,t=null,r=null){if(_(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const s=e;if(!isFinite(s.x)||!isFinite(s.y))return mm.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Jee}_defaultElevationInfoZ(){return ete}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t){const r=Et(e.geometry),s=this.getDefaultElevationInfo(r);t.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,t.mode=this.getGeometryElevationMode(r,s),t.offsetMeters=Ze(this._elevationContext.meterUnitOffset,Ze(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&t.mode==="on-the-ground";n&&(t.mode="relative-to-ground",t.offsetMeters=0);const a=n?jee:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(a,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=II){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(e)?r*=e.a:t.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,t=II){const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return ey(null,r);const s=_(e)?li.toUnitRGB(e):Cd;return ey(s,r)}_getVertexOpacityAndColor(e,t=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=ey(r,s);return _(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return G9(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,s)!==Gi.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,t,r){let s=Gi.UPDATE;return e.forEach(n=>{const a=t(n);if(_(a)){const o=n.graphic;this.setGraphicElevationContext(o,a.elevationContext),a.needsElevationUpdates=r(a.elevationContext.mode)}else s=Gi.RECREATE}),s}applyRendererDiff(e,t){return Cr.Recreate_Symbol}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,r=t.size?sh(t.size.field,e):0,s=t.color?sh(t.color.field,e):0,n=t.opacity?sh(t.opacity.field,e):0;return Ai(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&mm.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var t,r,s,n,a,o,l,c,h,u,m,f;return{size:((s=(r=(t=this._fastUpdates)==null?void 0:t.visualVariables)==null?void 0:r.size)==null?void 0:s.field)??null,color:((o=(a=(n=this._fastUpdates)==null?void 0:n.visualVariables)==null?void 0:a.color)==null?void 0:o.field)??null,opacity:((h=(c=(l=this._fastUpdates)==null?void 0:l.visualVariables)==null?void 0:c.opacity)==null?void 0:h.field)??null,rotation:((f=(m=(u=this._fastUpdates)==null?void 0:u.visualVariables)==null?void 0:m.rotation)==null?void 0:f.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function sh(i,e){const t=i!=null?e.attributes[i]:0;return t!=null&&isFinite(t)?t:0}function MI(i){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return i&&"visualVariables"in i&&i.visualVariables&&i.visualVariables.forEach(t=>{switch(t.type){case"color":if(e.color=!0,t.stops)for(let r=0;r<t.stops.length;r++){const s=t.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Jee={mode:"on-the-ground",offset:0,unit:"meters"},ete={mode:"absolute-height",offset:0,unit:"meters"},II={hasIntrinsicColor:!1};let bh=class extends IF{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){bs(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(e={}){super(),this.type=Ns.Object,this._geometries=new Array,this._transformation=ve(),this._bvObjectSpace=new DI,this._bvWorldSpace=new DI,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=e.castShadow==null||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new q9);const t=e.geometries;_(t)&&(this._geometries=Array.from(t))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){_t(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("objectGeometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const t of this._geometries)t.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new pE(Yf.MaskOccludee);for(const t of this._geometries)t.occludees=DP(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=LP(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new pE(Yf.Highlight);for(const t of this._geometries)t.highlights=DP(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=LP(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Sr(t,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return Sr(ve(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const s of this._geometries){const n=s.boundingInfo;_(n)&&(LI(n,this._bvObjectSpace,s.shaderTransformation),LI(n,this._bvWorldSpace,this._getCombinedShaderTransformation(s)))}ns(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),ns(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=E(),t=E(),r=yp(this.transformation);for(const s of this._geometries){const n=s.boundingInfo;if(T(n))continue;const a=s.shaderTransformation,o=yp(a);Pe(e,n.center,a);const l=Ni(e,this._bvObjectSpace.bounds),c=n.radius*o;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Pe(t,e,this.transformation);const h=Ni(t,this._bvWorldSpace.bounds),u=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+u)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){_(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}},q9=class{constructor(){this.min=qe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=qe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},DI=class extends q9{constructor(){super(...arguments),this.bounds=yo()}init(){Z(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Z(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),OB(this.bounds)}};function LI(i,e,t){const r=i.bbMin,s=i.bbMax;if(FB(t)){const n=Z(tte,t[12],t[13],t[14]);J(_a,r,n),J(Ro,s,n);for(let a=0;a<3;++a)e.min[a]=Math.min(e.min[a],_a[a]),e.max[a]=Math.max(e.max[a],Ro[a])}else if(Pe(_a,r,t),po(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],_a[n]),e.max[n]=Math.max(e.max[n],_a[n]);else{Pe(Ro,s,t);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],_a[n],Ro[n]),e.max[n]=Math.max(e.max[n],_a[n],Ro[n]);for(let n=0;n<3;++n){X(_a,r),X(Ro,s),_a[n]=s[n],Ro[n]=r[n],Pe(_a,_a,t),Pe(Ro,Ro,t);for(let a=0;a<3;++a)e.min[a]=Math.min(e.min[a],_a[a],Ro[a]),e.max[a]=Math.max(e.max[a],_a[a],Ro[a])}}}const tte=E(),_a=E(),Ro=E();function iA(i,e,t,r,s,n){const a=i.clippingExtent;if(xs(e,Ad,i.elevationProvider.spatialReference),_(a)&&!q2(a,Ad))return null;xs(e,Ad,i.renderCoordsHelper.spatialReference);const o=i.localOriginFactory.getOrigin(Ad),l=new bh({castShadow:!1,metadata:{layerUid:i.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0}});return t.shaderTransformer=n,t.localOrigin=o,l.addGeometry(t),{object:l,sampledElevation:Iee(l,e,i.elevationProvider,i.renderCoordsHelper,r)}}function By(i,e,t){const r=i.elevationContext,s=t.spatialReference;xs(e,Ad,s),r.centerPointInElevationSR=yh(Ad[0],Ad[1],e.hasZ?Ad[2]:0,_(s)?s:null)}function zy(i){switch(i.type){case"point":return i;case"polygon":case"extent":return XR(i);case"polyline":{const e=i.paths[0];if(!e||e.length===0)return null;const t=hF(e,dF(e)/2);return yh(t[0],t[1],t[2],i.spatialReference)}case"mesh":return i.origin}return null}const Ad=E();let W9=class j9 extends Wt{initializeConfiguration(e,t){t.spherical=e.viewingMode===Se.Global}initializeProgram(e){return new Gt(e.rctx,j9.shader.get().build(this.configuration),Zt)}setPipelineState(e){const t=e?Ts.ALWAYS:Ts.LESS;return this.configuration.depthHudEnabled?it({depthTest:{func:t},depthWrite:ka}):it({blending:os(he.ONE,he.SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:ut})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};W9.shader=new jt(oG,()=>Y(()=>import("./LineCallout.glsl-1af8bcca.js"),["./LineCallout.glsl-1af8bcca.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./vec4f64-6d0e93be.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./mat4f64-abdda1bb.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./HUD.glsl-73b068b4.js","./ReadLinearDepth.glsl-0e6f5c47.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./VerticalOffset.glsl-109e8746.js","./vec4-c7a19f0d.js","./Float4PassUniform-9354414b.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./FloatPassUniform-0426669b.js","./VertexAttribute-15d1866a.js","./LineCallout.glsl-76cd336e.js","./Slice.glsl-cd30f0ea.js"],import.meta.url));let Qa=class extends gc{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=kd.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};d([L({count:kd.COUNT})],Qa.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([L()],Qa.prototype,"spherical",void 0),d([L()],Qa.prototype,"occlusionTestEnabled",void 0),d([L()],Qa.prototype,"hasVerticalOffset",void 0),d([L()],Qa.prototype,"hasScreenSizePerspective",void 0),d([L()],Qa.prototype,"depthHudEnabled",void 0),d([L()],Qa.prototype,"depthHudAlignStartEnabled",void 0),d([L()],Qa.prototype,"hasSlicePlane",void 0),d([L()],Qa.prototype,"hasMultipassGeometry",void 0),d([L({constValue:!0})],Qa.prototype,"hasSliceInVertexProgram",void 0),d([L({constValue:!1})],Qa.prototype,"isDraped",void 0);let hv=class _S extends Mp{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new X9),this._configuration=new Qa,this._uniqueMaterialIdentifier=_S.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,t){const r=(t==null?void 0:t.slot)!==ne.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=_(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?kd.Screen:kd.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=t.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,t){if(t===$.Color)switch(e){case ne.LINE_CALLOUTS:case ne.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new ite(e)}createBufferWriter(){return new ste}validateParameters(e){const t=_S.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},ite=class extends Dp{beginSlot(e){return this.ensureTechnique(W9,e)}},X9=class extends h0{constructor(){super(...arguments),this.screenOffset=uc,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const rte=Rr().vec3f(C.POSITION).vec3f(C.NORMAL).vec2f(C.UV0).vec4f(C.AUXPOS1),$I=[ud(0,0),ud(1,0),ud(0,1),ud(1,0),ud(1,1),ud(0,1)];let ste=class{constructor(){this.vertexBufferLayout=rte}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(C.POSITION).length}write(e,t,r,s,n){F2(r.indices.get(C.POSITION),r.vertexAttributes.get(C.POSITION).data,e,s.position,n,6),ZF(r.indices.get(C.NORMAL),r.vertexAttributes.get(C.NORMAL).data,t,s.normal,n,6),lb(r.indices.get(C.AUXPOS1),r.vertexAttributes.get(C.AUXPOS1).data,s.auxpos1,n,6);for(let a=0;a<$I.length;++a)s.uv0.setVec(n+a,$I[a])}},Y9=class Q9 extends yc{constructor(e,t){super(e,null,t,ote),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new hv(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const t=this._materialParameters;return t.screenOffset=e.screenOffset||uc,t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get _materialParameters(){const e=new X9,t=this.symbol,r=t.callout;if(e.color=_(r.color)?li.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Rn(r.size||0),t.verticalOffset){const{screenLength:a,minWorldLength:o,maxWorldLength:l}=t.verticalOffset;e.verticalOffset={screenLength:Rn(a),minWorldLength:o||0,maxWorldLength:_(l)?l:1/0}}e.borderColor=_(r.border)&&_(r.border.color)?li.toUnitRGBA(r.border.color):null;const s=t.symbolLayers.getItemAt(0).type==="object",n=t.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return ate}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new ml,t.elevationOffset||0),n=t.symbol,a=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&a||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!lF(l)))return null;const o=XR(r.geometry);return T(o)?null:this._createAs3DShape(o,s,t,r.uid)}layerOpacityChanged(){_(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(e,t,r){const s=this._elevationContext.mode,n=g0(Q9.elevationModeChangeTypes,r,s);return n!==Gi.UPDATE||e.forEach(a=>{const o=t(a);_(o)&&this.updateGraphicElevationContext(a.graphic,o)}),n}slicePlaneEnabledChanged(){return T(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}setGraphicElevationContext(e,t,r=0){const s=super.setGraphicElevationContext(e,t);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,_(t.metadata)?t.metadata.elevationOffset:0),t.needsElevationUpdates=xo(t.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:eA.memory}}_createVertexData(e){const{translation:t,centerOffset:r}=e,s=new Ae(t?[t[0],t[1],t[2]]:[0,0,0],3,!0),n=new Ae(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],4,!0);return[[C.POSITION,s],[C.NORMAL,new Ae([0,0,1],3,!0)],[C.AUXPOS1,n]]}_getOrCreateMaterial(e){const t=this._perInstanceMaterialParameters(e),r=hv.uniqueMaterialIdentifier(t);if(_(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(_(e.materialCollection)){let s=e.materialCollection.get(r);return T(s)&&(s=new hv(t),e.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new hv(t),isUnique:!0}}_createAs3DShape(e,t,r,s){const n=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),o=this._getOrCreateMaterial(r),l=new Vr(o.material,this._createVertexData(r),nte,null,Ns.Point,a),c=iA(this._context,e,l,t,s);if(T(c))return null;const h=new _c(this,c.object,[l],o.isUnique?[o.material]:null,null,Vy,t);return h.metadata=new N9(r.elevationOffset),h.alignedSampledElevation=c.sampledElevation,h.needsElevationUpdates=xo(t.mode),By(h,e,this._context.elevationProvider),h}};Y9.elevationModeChangeTypes={definedChanged:Gi.UPDATE,staysOnTheGround:Gi.UPDATE,onTheGroundChanged:Gi.RECREATE};const DT=[0],nte=[[C.POSITION,DT],[C.NORMAL,DT],[C.AUXPOS1,DT]],ate={mode:"relative-to-ground",offset:0},ote={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let lte=class{constructor(e,t,r=E(),s=Xt(),n=Ne(),a="world",o=0,l=null){this.renderer=e,this.symbol=t,this.translation=r,this.centerOffset=s,this.screenOffset=n,this.centerOffsetUnits=a,this.elevationOffset=o,this.materialCollection=l}},cte=class extends Xee{};const FI=pe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function hte(i,e){if(!E2(i))return FI.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${i.type}' does not support callouts`),null;if(!i.callout)return null;const t=dte[i.callout.type];return t?new t(i,e):(FI.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${i.callout.type}`),null)}const dte={line:Y9},NI=new Qo(Array,i=>W2(i,Gk),null,10,5),ute=Ot();let pte=class{get labelLayers(){return this._labelLayers}get extent(){return this._extent}constructor(e,t,r,s,n){this.graphic=e,this.graphics3DSymbol=t,this.layers=r,this._labelLayers=new Array,this._auxiliaryLayers=new Array,this._visibilityFlags=mte(es._COUNT,ra._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++t.referenced,this._featureExpressionFeature=n?D9(n,e,s):null;for(const a of r)_(a)&&(this.isElevationSource=this.isElevationSource||a.isElevationSource)}initialize(e,t){this._layer=t,this._stage=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e,t),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this.layers=null,this._auxiliaryLayers=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers.length=0}addLabelGraphic(e,t,r){this._labelLayers.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(es.LABEL))}addAuxiliaryGraphic(e){this._auxiliaryLayers.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{t.type==="draped"&&(e=!0)}),e}isVisible(e=es.GRAPHIC,t){for(let r=0;r<=e;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==t)return!1}return!0}hasVisibilityFlag(e,t){return this._visibilityFlags[t][e]!=null}setVisibilityFlag(e,t,r){const s=this.isVisible(r);this._visibilityFlags[r][e]=t;const n=this.isVisible(r);if(s===n)return!1;if(r===es.LABEL)this._forEachLabelGraphic(a=>a.setVisibility(n));else{this._forEachSymbolLayerGraphic(o=>o.setVisibility(n));const a=this.isVisible(es.LABEL);this._forEachLabelGraphic(o=>o.setVisibility(a))}return!0}clearVisibilityFlag(e,t=es.GRAPHIC){return this.setVisibilityFlag(e,void 0,t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(T(t))return!1;this._extent=Ot(),Qk(t,this._extent);const r=t.spatialReference;if(!o2(r,e)&&!sw(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,t,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=S2.fromExtent(s.type==="mesh"?s.extent:s)),S7(s,t,r)}get usedMemory(){let e=ZB(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>{const r=t.graphics3DSymbolLayer.complexity;if(T(r))return;const s=t.type==="draped"?r.memory.draped:r.memory;e+=s.bytesPerFeature,s.bytesPerCoordinate&&(e+=Zk(this.graphic.geometry)*s.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:E(),num:0},draped:{origin:Ne(),num:0}};for(const t of this.layers)T(t)||t.computeAttachmentOrigin(e);return e.render.num>1&&W(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&La(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Pi(n.boundingBox):n.boundingBox=Pi(),n.requiresDrapedElevation=!1,await R2(this.layers,async a=>{if(T(a))return;const o=a.type==="draped"?t:e,l=NI.acquire(),c=await a.getProjectedBoundingBox(o,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&Xf(n.boundingBox,l),NI.release(l)}),Hk(n.boundingBox)||eE(G2(n.boundingBox,ute))?n:null}needsElevationUpdates(){for(const e of this.layers)if(_(e)&&(e.type==="object3d"||e.type==="lod-instance")&&e.needsElevationUpdates)return!0;for(const e of this._labelLayers)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,t,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,t,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,t,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,t,r)})}addObjectStateSet(e,t){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,t))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}_forEachGraphicList(e,t){e.forEach(r=>r&&t(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._forEachGraphicList(this._auxiliaryLayers,e)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}};function mte(i,e){const t=new Array(i);for(let r=0;r<t.length;r++)t[r]=new Array(e);return t}function zw(i,e){if(!i||i.symbol)return null;const t=e&&e.renderer;return i&&_(t)&&t.getObservationRenderer?t.getObservationRenderer(i):t}function fte(i,e){if(_(i.symbol))return i.symbol;const t=zw(i,e);return _(t)&&t.type!=="dot-density"?t.getSymbol(i,e):null}function Vbe(i,e){const t=zw(i,e),r=fte(i,e);if(T(r))return null;const s={renderer:t,symbol:r};if(T(t)||!("visualVariables"in t)||!t.visualVariables)return s;const n=m5(t,i,e)??[],a=["proportional","proportional","proportional"];for(const{variable:o,value:l}of n)switch(o.type){case"color":s.color=l.toRgba();break;case"size":if(o.target==="outline")s.outlineSize=l;else{const c=o.axis,h=o.useSymbolValue?"symbol-value":l;switch(c){case"width":a[0]=h;break;case"depth":a[1]=h;break;case"height":a[2]=h;break;case"width-and-depth":a[0]=a[1]=h;break;default:a[0]=a[1]=a[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(o.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return a[0]==="proportional"&&a[1]==="proportional"&&a[2]==="proportional"||(s.size=a),s}async function gte(i,e){if(_(i.symbol))return i.symbol;const t=zw(i,e);return _(t)?t.getSymbolAsync(i,e):null}async function Bbe(i,e){const t=zw(i,e),r=await gte(i,e);if(!r)return null;const s={renderer:t,symbol:r};if(!t||!("visualVariables"in t)||!t.visualVariables)return s;const n=m5(t,i,e)??[],a=["proportional","proportional","proportional"];for(const{variable:o,value:l}of n)if(o.type==="color")s.color=li.toUnitRGBA(l);else if(o.type==="size")if(o.target==="outline")s.outlineSize=l;else{const c=o.axis,h=o.useSymbolValue?"symbol-value":l;c==="width"?a[0]=h:c==="depth"?a[1]=h:c==="height"?a[2]=h:a[0]=a[1]=c==="width-and-depth"?h:a[2]=h}else o.type==="opacity"?s.opacity=l:o.type==="rotation"&&o.axis==="tilt"?s.tilt=l:o.type==="rotation"&&o.axis==="roll"?s.roll=l:o.type==="rotation"&&(s.heading=l);return(isFinite(a[0])||isFinite(a[1])||isFinite(a[2]))&&(s.size=a),s}function _te(i,e=0){const t=i[e];return typeof t=="number"&&isFinite(t)?t:null}function yte(i){for(let e=0;e<3;e++){const t=i[e];if(typeof t=="number")return isFinite(t)?t:0}return 0}function UI(i){const e=[[C.POSITION,i.indices]],t=[[C.POSITION,new Ae(i.attributeData.position,3,!0)]];return _(i.attributeData.color)&&(t.push([C.COLOR,new Ae(i.attributeData.color,4,!0)]),e.push([C.COLOR,new Array(i.indices.length).fill(0)])),_(i.attributeData.uvMapSpace)&&(t.push([C.UVMAPSPACE,new Ae(i.attributeData.uvMapSpace,4,!0)]),e.push([C.UVMAPSPACE,i.indices])),_(i.attributeData.boundingRect)&&(t.push([C.BOUNDINGRECT,new Ae(i.attributeData.boundingRect,9,!0)]),e.push([C.BOUNDINGRECT,i.indices])),new Vr(i.material,t,e,i.mapPositions,Ns.Mesh,i.attributeData.objectAndLayerIdColor)}function VI(i){const e=[[C.POSITION,i.indices],[C.UV0,i.indices]],t=[[C.POSITION,new Ae(i.attributeData.position,3,!0)],[C.UV0,new Ae(i.attributeData.uv0,2,!0)]];return new Vr(i.material,t,e,i.mapPositions)}function ky(i){switch(i.type){case"extent":if(i instanceof ms)return S2.fromExtent(i);break;case"polygon":return i}return null}let kw=class{constructor(e,t,r){this.renderData=e,this.layerUid=t,this.graphicUid=r,this.outGeometries=new Array}};var ty,Vb,yS;(function(i){i[i.RasterImage=0]="RasterImage",i[i.Features=1]="Features"})(ty||(ty={})),function(i){i[i.MapLayer=0]="MapLayer",i[i.ViewLayer=1]="ViewLayer",i[i.Outline=2]="Outline",i[i.SnappingHint=3]="SnappingHint"}(Vb||(Vb={})),function(i){i[i.WithRasterImage=0]="WithRasterImage",i[i.WithoutRasterImage=1]="WithoutRasterImage"}(yS||(yS={}));var Li,lo,ke,iy,ki,wr,Is;(function(i){i[i.INNER=0]="INNER",i[i.OUTER=1]="OUTER"})(Li||(Li={})),function(i){i[i.REGULAR=0]="REGULAR",i[i.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",i[i.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",i[i.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(lo||(lo={})),function(i){i[i.NORTH=0]="NORTH",i[i.NORTH_EAST=1]="NORTH_EAST",i[i.EAST=2]="EAST",i[i.SOUTH_EAST=3]="SOUTH_EAST",i[i.SOUTH=4]="SOUTH",i[i.SOUTH_WEST=5]="SOUTH_WEST",i[i.WEST=6]="WEST",i[i.NORTH_WEST=7]="NORTH_WEST"}(ke||(ke={})),function(i){i[i.OFF=0]="OFF",i[i.ON=1]="ON"}(iy||(iy={})),function(i){i[i.Color=0]="Color",i[i.ColorNoRasterImage=1]="ColorNoRasterImage",i[i.Highlight=2]="Highlight",i[i.Water=3]="Water",i[i.Occluded=4]="Occluded",i[i.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(ki||(ki={})),function(i){i[i.FADING=0]="FADING",i[i.IMMEDIATE=1]="IMMEDIATE",i[i.UNFADED=2]="UNFADED"}(wr||(wr={})),function(i){i[i.INSIDE=0]="INSIDE",i[i.INTERSECTS=1]="INTERSECTS",i[i.OUTSIDE=2]="OUTSIDE"}(Is||(Is={}));let vte=class{constructor(e,t){this.vec3=e,this.id=t}};function ry(i,e,t,r){return new vte(qe(i,e,t),r)}var Kn;(function(i){i[i.None=0]="None",i[i.ColorAndWater=1]="ColorAndWater",i[i.Highlight=2]="Highlight",i[i.Occluded=3]="Occluded",i[i.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Kn||(Kn={}));let BI=class{get extent(){return this._extent}constructor(e,t){this.index=e,this.renderTargets=t,this._extent=Ot(),this.resolution=0,this.renderLocalOrigin=ry(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new bte,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===Kn.ColorAndWater?this.renderTargets.getTarget(ki.Color):e===Kn.Highlight?this.renderTargets.getTarget(ki.Highlight):e===Kn.ObjectAndLayerIdColor?this.renderTargets.getTarget(ki.ObjectAndLayerIdColor):this.renderTargets.getTarget(ki.Occluded);return t?t.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(ki.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(ki.Color):null}getNormalTexture(e){const t=e===Kn.ColorAndWater?this.renderTargets.getTarget(ki.Water):null;return t?t.getTexture():null}draw(e,t){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==ki.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=e.drawTarget(this,s,t):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?db.CHANGED:db.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[ki.Color]|+e[ki.ColorNoRasterImage]<<1|+e[ki.Highlight]<<2|+e[ki.Water]<<3|+e[ki.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];J1(this._extent,e.range,0,r)}if(this._extent[2]+t>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];J1(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,my(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===Li.INNER?0:this.resolution,0,this.resolution,this.resolution)}},bte=class{constructor(){this.extents=[Ot(),Ot(),Ot()],this.numViews=0}},Z9=class{constructor(e,t){this._size=aG(),this._fbo=null,this._fbo=new Ur(e,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR_MIPMAP_LINEAR,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Le(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(e,t){this._size[0]=e,this._size[1]=t,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},fm=class{constructor(e,t,r,s=!0){this.output=t,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new Z9(e,s)}},wte=class{constructor(e){this.renderTargets=[new fm(e,$.Color,ki.Color),new fm(e,$.Color,ki.ColorNoRasterImage),new fm(e,$.Highlight,ki.Highlight,!1),new fm(e,$.Normal,ki.Water),new fm(e,$.Color,ki.Occluded)],Vt("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new fm(e,$.ObjectAndLayerIdColor,ki.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,r){if(e)t.lastUsed=r;else if(r-t.lastUsed>xte)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,t)=>e+t.fbo.gpuMemoryUsage,0)}};const xte=1e3;let K9=class{constructor(e){this._context=e,this._perConstructorInstances=new d0,this._frameCounter=0,this._keepAliveFrameCount=zI}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(t=>t.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,t=Cte){const r=t.key;let s=this._perConstructorInstances.get(e,r);if(T(s)){const n=new e(this._context,t,()=>this.release(n));s=new Tte(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,t,r){if(_(r)){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}release(e){if(T(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);T(t)||(--t.refCount,t.refCount===0&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==zI&&this._perConstructorInstances.forEach((e,t)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(t,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((t,r)=>{const s=async(n,a)=>{const o=a.shader;o&&(await o.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(t,r))}),await Promise.all(e)}},Tte=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const zI=-1,Cte=new Ln;let J9=class{constructor(e,t,r,s){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new d0}dispose(){this._textureRepository.destroy()}acquire(e,t,r){if(this._ownMaterial(e),!e.requiresSlot(t,r))return null;let s=this._id2glMaterialRef.get(r,e.id);if(T(s)){const n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});s=new Ete(n),this._id2glMaterialRef.set(r,e.id,s)}return s.ref(),s.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);_(r)&&(r.unref(),r.referenced||(Le(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){_(e.repository)&&e.repository!==this&&pe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Ete=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,_t(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Ste={orderedRepackingEnabled:!1},Rte={rootOrigin:null},Ate=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];var Ld;(function(i){i[i.ASYNC=0]="ASYNC",i[i.SYNC=1]="SYNC"})(Ld||(Ld={}));let e6=class extends IF{get objects(){return this._objects}constructor(e,t=""){super(),this.apiLayerUid=t,this.type=Ns.Layer,this.events=new Br,this.sliceable=!1,this._objects=new Ht,this._objectsAdded=new Ht,this._stageHandles=new mi,this.apiLayerUid=t,this.visible=(e==null?void 0:e.visible)??!0,this.pickable=(e==null?void 0:e.pickable)??!0,this.updatePolicy=(e==null?void 0:e.updatePolicy)??Ld.ASYNC,this._disableOctree=(e==null?void 0:e.disableOctree)??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of Ate)this._stageHandles.add(this.events.on(t,r=>e.handleEvent(t,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),_(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),_(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),_(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),t.length!==0){for(const r of t)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),_(this._octree)){for(let r=0;r<t.length;)this._objectsAdded.removeUnordered(t[r])?(t[r]=t[t.length-1],t.length-=1):++r;this._octree.remove(t)}}}sync(){_(this._stage)&&this.updatePolicy!==Ld.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){_(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return T(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new Zo(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):_(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=we(this._octree),this._objectsAdded.clear()}};function Bb(i){return _(i)&&i.type===Ns.Layer}const t6=new Map([[C.POSITION,0],[C.SUBDIVISIONFACTOR,1],[C.UV0,2],[C.AUXPOS1,3],[C.AUXPOS2,4],[C.COLOR,5],[C.COLORFEATUREATTRIBUTE,5],[C.SIZE,6],[C.SIZEFEATUREATTRIBUTE,6],[C.OPACITYFEATUREATTRIBUTE,7],[C.OBJECTANDLAYERIDCOLOR,8]]);let i6=class r6 extends Wt{initializeProgram(e){return new Gt(e.rctx,r6.shader.get().build(this.configuration),t6)}_makePipelineState(e,t){const r=this.configuration,s=e===It.NONE,n=e===It.FrontFace;return it({blending:r.output===$.Color||r.output===$.Alpha?s?go:Qd(e):null,depthTest:{func:Lp(e)},depthWrite:s?r.writeDepth?ka:null:gw(e),colorWrite:ut,stencilWrite:r.hasOccludees?dh:null,stencilTest:r.hasOccludees?t?fp:$p:null,polygonOffset:s||n?r.hasPolygonOffset?kI:null:N2})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?kI:null;this._occluderPipelineTransparent=it({blending:go,polygonOffset:t,depthTest:cb,depthWrite:null,colorWrite:ut,stencilWrite:null,stencilTest:JF}),this._occluderPipelineOpaque=it({blending:go,polygonOffset:t,depthTest:cb,depthWrite:null,colorWrite:ut,stencilWrite:e5,stencilTest:t5}),this._occluderPipelineMaskWrite=it({blending:null,polygonOffset:t,depthTest:U2,depthWrite:null,colorWrite:null,stencilWrite:dh,stencilTest:fp})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?bt.LINES:bt.TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===ne.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ne.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}};i6.shader=new jt(pG,()=>Y(()=>import("./RibbonLine.glsl-aec0bd16.js"),["./RibbonLine.glsl-aec0bd16.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-f0dc8788.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./context-util-34d303b7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./aaBoundingBox-fb003858.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./vec2f64-70cfd09e.js","./vec4f64-6d0e93be.js","./LineStipple.glsl-4eef2aea.js","./RgbaFloatEncoding.glsl-67199794.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./Float4PassUniform-9354414b.js","./FloatPassUniform-0426669b.js","./floatRGBA-1f66d0a4.js","./Texture-ae652f15.js","./compilerUtils-7bf6df9e.js","./Evented-686173eb.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./TextureOnly.glsl-469cc321.js","./ScreenSpacePass.glsl-44cc0c5e.js","./basicInterfaces-7449a8bf.js","./assets-94d592bf.js","./MarkerSizing.glsl-950a18f6.js","./sdfPrimitives-3ceeab79.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./TransparencyPassType-c3841b0a.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RibbonLine.glsl-8fe4662b.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Slice.glsl-cd30f0ea.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./MultipassTerrainTest.glsl-8b279fcd.js","./ReadLinearDepth.glsl-0e6f5c47.js","./PiUtils.glsl-49462ceb.js","./AlphaCutoff-96178e0d.js"],import.meta.url));const kI={factor:0,units:-4};var Xn;(function(i){i[i.LEFT_JOIN_START=-2]="LEFT_JOIN_START",i[i.LEFT_JOIN_END=-1]="LEFT_JOIN_END",i[i.LEFT_CAP_START=-4]="LEFT_CAP_START",i[i.LEFT_CAP_END=-5]="LEFT_CAP_END",i[i.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",i[i.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",i[i.RIGHT_CAP_START=4]="RIGHT_CAP_START",i[i.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Xn||(Xn={}));let vf=class extends Mp{constructor(e){super(e,new Ote),this._configuration=new mG,this._vertexAttributeLocations=t6,this._layout=this.createLayout()}isClosed(e,t){return n6(this.parameters,e,t)}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===ne.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern)&&e!==$.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!_(this.parameters.markerParameters)&&Ite(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===hr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,r,s,n,a){if(!r.options.selectionMode)return;const o=e.vertexAttributes.get(C.POSITION).data,l=e.vertexAttributes.get(C.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const g=e.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0];c*=ie(this.parameters.vvSizeOffset[0]+g*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const h=s[0],u=s[1],m=(c/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,y=0;for(let g=0;g<o.length-5;g+=3){const v=o[g],b=o[g+1],x=h-v,w=u-b,S=o[g+3]-v,P=o[g+4]-b,A=ie((S*x+P*w)/(S*S+P*P),0,1),M=S*A-x,O=P*A-w,I=M*M+O*O;I<f&&(f=I,y=g/3)}f<m*m&&n(a.dist,a.normal,y,!1)}intersect(e,t,r,s,n,a){if(!r.options.selectionMode||!e.visible)return;if(!s5(t))return void pe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const o=e.vertexAttributes,l=o.get(C.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const x=o.get(C.SIZEFEATUREATTRIBUTE).data[0];c*=ie(this.parameters.vvSizeOffset[0]+x*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(C.SIZE)&&(c*=o.get(C.SIZE).data[0]);const h=r.camera,u=Dte;as(u,r.point);const m=c*h.pixelRatio/2+4*h.pixelRatio;Z(Vg[0],u[0]-m,u[1]+m,0),Z(Vg[1],u[0]+m,u[1]+m,0),Z(Vg[2],u[0]+m,u[1]-m,0),Z(Vg[3],u[0]-m,u[1]-m,0);for(let x=0;x<4;x++)if(!h.unprojectFromRenderScreen(Vg[x],Oc[x]))return;ec(h.eye,Oc[0],Oc[1],$T),ec(h.eye,Oc[1],Oc[2],FT),ec(h.eye,Oc[2],Oc[3],NT),ec(h.eye,Oc[3],Oc[0],UT);let f=Number.MAX_VALUE,y=0;const g=s6(this.parameters,o,e.indices)?l.length-2:l.length-5;for(let x=0;x<g;x+=3){on[0]=l[x]+t[12],on[1]=l[x+1]+t[13],on[2]=l[x+2]+t[14];const w=(x+3)%l.length;if(ln[0]=l[w]+t[12],ln[1]=l[w+1]+t[13],ln[2]=l[w+2]+t[14],ji($T,on)<0&&ji($T,ln)<0||ji(FT,on)<0&&ji(FT,ln)<0||ji(NT,on)<0&&ji(NT,ln)<0||ji(UT,on)<0&&ji(UT,ln)<0)continue;if(h.projectToRenderScreen(on,hu),h.projectToRenderScreen(ln,du),hu[2]<0&&du[2]>0){ee(yl,on,ln);const P=h.frustum,A=-ji(P[Ki.NEAR],on)/oe(yl,Js(P[Ki.NEAR]));W(yl,yl,A),J(on,on,yl),h.projectToRenderScreen(on,hu)}else if(hu[2]>0&&du[2]<0){ee(yl,ln,on);const P=h.frustum,A=-ji(P[Ki.NEAR],ln)/oe(yl,Js(P[Ki.NEAR]));W(yl,yl,A),J(ln,ln,yl),h.projectToRenderScreen(ln,du)}else if(hu[2]<0&&du[2]<0)continue;hu[2]=0,du[2]=0;const S=x2(ap(hu,du,qI),u);S<f&&(f=S,X(GI,on),X(HI,ln),y=x/3)}const v=r.rayBegin,b=r.rayEnd;if(f<m*m){let x=Number.MAX_VALUE;if(K$(ap(GI,HI,qI),ap(v,b,Lte),cu)){ee(cu,cu,v);const w=xe(cu);W(cu,cu,1/w),x=w/Ni(v,b)}a(x,cu,y,!1)}}createLayout(){const e=Rr().vec3f(C.POSITION).f32(C.SUBDIVISIONFACTOR).vec2f(C.UV0).vec3f(C.AUXPOS1).vec3f(C.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(C.SIZEFEATUREATTRIBUTE):e.f32(C.SIZE),this.parameters.vvColorEnabled?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4f(C.COLOR),this.parameters.vvOpacityEnabled&&e.f32(C.OPACITYFEATUREATTRIBUTE),Vt("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(C.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Mte(this._layout,this.parameters)}requiresSlot(e,t){return t===$.Color||t===$.Alpha||t===$.Highlight||t===$.Depth||t===$.ObjectAndLayerIdColor?e===ne.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===hr.OccludeAndTransparentStencil?e===ne.OPAQUE_MATERIAL||e===ne.OCCLUDER_MATERIAL||e===ne.TRANSPARENT_OCCLUDER_MATERIAL:t===$.Color||t===$.Alpha?e===(this.parameters.writeDepth?ne.TRANSPARENT_MATERIAL:ne.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ne.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Pte(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),_(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}},Pte=class extends Dp{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==$.Color&&this._output!==$.Alpha||this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(i6,e)}},Ote=class extends DF{constructor(){super(...arguments),this.width=0,this.color=Yo,this.join="miter",this.cap=Rf.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Mte=class{constructor(e,t){this._parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=fG+r}}_isClosed(e){return s6(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.indices.get(C.POSITION).length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,t,r,s,n){var q;const a=$te,o=Fte,l=Nte,c=r.vertexAttributes.get(C.POSITION).data,h=r.indices&&r.indices.get(C.POSITION),u=(q=r.vertexAttributes.get(C.DISTANCETOSTART))==null?void 0:q.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let m=1,f=0;this._parameters.vvSizeEnabled?f=r.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(C.SIZE)&&(m=r.vertexAttributes.get(C.SIZE).data[0]);let y=[1,1,1,1],g=0;this._parameters.vvColorEnabled?g=r.vertexAttributes.get(C.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(C.COLOR)&&(y=r.vertexAttributes.get(C.COLOR).data);const v=Vt("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let b=0;this._parameters.vvOpacityEnabled&&(b=r.vertexAttributes.get(C.OPACITYFEATUREATTRIBUTE).data[0]);const x=c.length/3,w=new Float32Array(s.buffer),S=Vt("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,P=this.vertexBufferLayout.stride/4;let A=n*P;const M=A;let O=0;const I=u?(D,H,G)=>O=u[G]:(D,H,G)=>O+=Ni(D,H),N=Vt("enable-feature:objectAndLayerId-rendering"),F=(D,H,G,B,le,ce,_e)=>{if(w[A++]=H[0],w[A++]=H[1],w[A++]=H[2],w[A++]=B,w[A++]=_e,w[A++]=le,w[A++]=D[0],w[A++]=D[1],w[A++]=D[2],w[A++]=G[0],w[A++]=G[1],w[A++]=G[2],this._parameters.vvSizeEnabled?w[A++]=f:w[A++]=m,this._parameters.vvColorEnabled)w[A++]=g;else{const j=Math.min(4*ce,y.length-4);w[A++]=y[j],w[A++]=y[j+1],w[A++]=y[j+2],w[A++]=y[j+3]}this._parameters.vvOpacityEnabled&&(w[A++]=b),N&&(_(v)&&(S[4*A]=v[0],S[4*A+1]=v[1],S[4*A+2]=v[2],S[4*A+3]=v[3]),A++)};A+=P,Z(o,c[0],c[1],c[2]),e&&Pe(o,o,e);const V=this._isClosed(r);if(V){const D=c.length-3;Z(a,c[D],c[D+1],c[D+2]),e&&Pe(a,a,e)}else Z(l,c[3],c[4],c[5]),e&&Pe(l,l,e),F(o,o,l,1,Xn.LEFT_CAP_START,0,0),F(o,o,l,1,Xn.RIGHT_CAP_START,0,0),X(a,o),X(o,l);const Q=V?0:1,ae=V?x:x-1;for(let D=Q;D<ae;D++){const H=(D+1)%x*3;Z(l,c[H],c[H+1],c[H+2]),e&&Pe(l,l,e),I(a,o,D),F(a,o,l,0,Xn.LEFT_JOIN_END,D,O),F(a,o,l,0,Xn.RIGHT_JOIN_END,D,O);const G=this.numJoinSubdivisions;for(let B=0;B<G;++B){const le=(B+1)/(G+1);F(a,o,l,le,Xn.LEFT_JOIN_END,D,O),F(a,o,l,le,Xn.RIGHT_JOIN_END,D,O)}F(a,o,l,1,Xn.LEFT_JOIN_START,D,O),F(a,o,l,1,Xn.RIGHT_JOIN_START,D,O),X(a,o),X(o,l)}V?(Z(l,c[3],c[4],c[5]),e&&Pe(l,l,e),O=I(a,o,ae),F(a,o,l,0,Xn.LEFT_JOIN_END,Q,O),F(a,o,l,0,Xn.RIGHT_JOIN_END,Q,O)):(O=I(a,o,ae),F(a,o,o,0,Xn.LEFT_CAP_END,ae,O),F(a,o,o,0,Xn.RIGHT_CAP_END,ae,O)),LT(w,M+P,w,M,P),A=LT(w,A-P,w,A,P),this._parameters.wireframe&&this._addWireframeVertices(s,M,A,P)}_addWireframeVertices(e,t,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let o=0;const l=c=>o=LT(a,c,n,o,s);for(let c=0;c<a.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function LT(i,e,t,r,s){for(let n=0;n<s;n++)t[r++]=i[e++];return r}function s6(i,e,t){return n6(i,e.get(C.POSITION).data,t?t.get(C.POSITION):null)}function n6(i,e,t){return!!i.isClosed&&(t?t.length>2:e.length>6)}function Ite(i){return i.anchor===f5.Tip&&i.hideOnShortSegments&&i.placement==="begin-end"&&i.worldSpace}const on=E(),ln=E(),yl=E(),cu=E(),Dte=E(),hu=_s(),du=_s(),GI=E(),HI=E(),qI=ag(),Lte=ag(),$te=E(),Fte=E(),Nte=E(),Vg=[_s(),_s(),_s(),_s()],Oc=[E(),E(),E(),E()],$T=sr(),FT=sr(),NT=sr(),UT=sr();let rA=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Bf()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(t==null){const h=Rte.rootOrigin;if(_(h))return this._origins.set(this._rootOriginId,ry(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(e);const u=ry(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),a=Math.round(e[2]/r),o=`${s}/${n}/${a}`;let l=this._origins.get(o);const c=.5*r;if(ee(Xr,e,t.vec3),Xr[0]=Math.abs(Xr[0]),Xr[1]=Math.abs(Xr[1]),Xr[2]=Math.abs(Xr[2]),Xr[0]<c&&Xr[1]<c&&Xr[2]<c){if(l){const h=Math.max(...Xr);if(ee(Xr,e,l.vec3),Xr[0]=Math.abs(Xr[0]),Xr[1]=Math.abs(Xr[1]),Xr[2]=Math.abs(Xr[2]),Math.max(...Xr)<h)return l}return t}return l||(l=ry(s*r,n*r,a*r,o),this._origins.set(o,l)),l}_drawOriginBox(e,t=Ai(1,1,0,1)){const r=window.view,s=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new vf({width:2,color:t}),s.add(this._material);const f=new e6({pickable:!1}),y=new bh({castShadow:!1});s.add(y),f.add(y),s.add(f),this._objects.set(n,y)}const a=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=o.length,c=new Array(3*l),h=new Array,u=.5*this._gridSize;for(let f=0;f<l;f++)c[3*f+0]=e[0]+(1&o[f]?u:-u),c[3*f+1]=e[1]+(2&o[f]?u:-u),c[3*f+2]=e[2]+(4&o[f]?u:-u),f>0&&h.push(f-1,f);In(c,this._originSR,0,c,r.renderSpatialReference,0,l);const m=new Vr(this._material,[[C.POSITION,new Ae(c,3,!0)]],[[C.POSITION,h]],null,Ns.Line);s.add(m),a.addGeometry(m)}get test(){const e=this;return{set gridSize(t){e._gridSize=t}}}};const Xr=E();let a6=class{constructor(e,t,r,s=null){this.rctx=e,this.sliceHelper=s,this.lastFrameCamera=new ze,this.output=$.Color,this.renderOccludedMask=WI,this.bindParameters=new Aw(t,r,_(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=WI}},Ute=class extends a6{constructor(e,t,r,s,n){super(e,r,s,n),this.offscreenRenderingHelper=t,this.sliceHelper=n,this.time=tt(0)}};const WI=hr.Occlude|hr.OccludeAndTransparent|hr.OccludeAndTransparentStencil;let S_=class extends ze{constructor(){super(...arguments),this._projectionMatrix=ve()}get projectionMatrix(){return this._projectionMatrix}};d([p()],S_.prototype,"_projectionMatrix",void 0),d([p({readOnly:!0})],S_.prototype,"projectionMatrix",null),S_=d([k("esri.views.3d.webgl-engine.lib.CascadeCamera")],S_);var ig;(function(i){i[i.Highlight=0]="Highlight",i[i.Default=1]="Default"})(ig||(ig={}));let dv=class{constructor(){this.camera=new S_,this.lightMat=ve()}},sA=class{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return Vs(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,t){this._rctx=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=ve(),this._projectionViewInverse=ve(),this._modelViewLight=ve(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Xt(),this._cascades=[new dv,new dv,new dv,new dv],this._lastOrigin=null,this._maxTextureSize=Math.min(Vt("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=ie(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)BT[e]=this._cascades[e];return BT.length=this._numCascades,BT}start(e,t,r){_t(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:o}=e;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,o,a,t);this._lastOrigin=null,this.clear()}finish(e){_t(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!po(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||E(),X(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){dc(KI,this._cascades[t].lightMat,e);for(let r=0;r<16;++r)JI[16*t+r]=KI[r]}}return JI}takeCascadeSnapshotTo(e,t){_t(this.enabled);const r=this._ensureSnapshot(t);this._bindFbo();const s=this._rctx,n=s.bindTexture(r,ui.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(Qt.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),s.bindTexture(n,ui.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT)}_computeTextureSize(e,t){const r=.5*Math.log(e*e+t*t)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this._maxTextureSize,2*n)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new ui(this._rctx,e),this._fbo=new Ur(this._rctx,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let t=this._snapshots[e];if(_(t)&&t.descriptor.width===this._textureSize)return t;this._discardSnapshot(e);const r={target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return t=new ui(this._rctx,r),this._snapshots[e]=t,t}_discardDepthTexture(){this._fbo=Le(this._fbo),this._depthTexture=Le(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=Le(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,t,r,s){const n=this._cascades[e],a=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],l=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]),c=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]);_t(l<c);for(let f=0;f<8;++f){Vs(jI,f%4==0||f%4==3?-1:1,f%4==0||f%4==1?-1:1,f<4?l:c,1);const y=io[f];Jc(y,jI,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}On(VT,io[0]),n.camera.viewMatrix=dc(Vte,this._modelViewLight,VT);for(let f=0;f<8;++f)Pe(io[f],io[f],n.camera.viewMatrix);let h=io[0][2],u=io[0][2];for(let f=1;f<8;++f)h=Math.min(h,io[f][2]),u=Math.max(u,io[f][2]);h-=200,u+=200,n.camera.near=-u,n.camera.far=-h,Gte(r,s,h,u,n.camera),Sr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const m=this._textureSize/2;n.camera.viewport=[e%2==0?0:m,Math.floor(e/2)===0?0:m,m,m]}_setupMatrices(e,t){Sr(this._projectionView,e.projectionMatrix,e.viewMatrix),aa(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Se.Global?e.eye:Z(VT,0,0,1);b2(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_clampNearFar(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}_computeCascadeDistances(e,t){this._numCascades=Math.min(1+Math.floor(Mk(e/t,4)),this._maxNumCascades);const r=(e-t)/this._numCascades,s=(e/t)**(1/this._numCascades);let n=t,a=t;for(let o=0;o<this._numCascades+1;++o)this._cascadeDistances[o]=dt(n,a,this._splitSchemeLambda),n*=s,a+=r}get gpuMemoryUsage(){var e;return this._snapshots.reduce((t,r)=>t+ab(r),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(t){e._splitSchemeLambda=t},get splitSchemeLambda(){return e._splitSchemeLambda}}}};const Vte=ve(),jI=Xt(),io=[];for(let i=0;i<8;++i)io.push(Xt());const XI=Ne(),YI=Ne(),Bte=Ne(),QI=Ne(),ZI=Ne(),VT=E(),BT=[],KI=ve(),JI=new Float32Array(64),ya=Ne(),gm=Ne(),uu=[Ne(),Ne(),Ne(),Ne()],Ar=Ne(),zT=Ne(),Lh=Ne(),Bg=Ne(),_m=Ne(),ym=Ne(),uv=Ne();function zte(i,e,t,r,s,n,a,o){pi(ya,0,0);for(let P=0;P<4;++P)Hl(ya,ya,i[P]);La(ya,ya,.25),pi(gm,0,0);for(let P=4;P<8;++P)Hl(gm,gm,i[P]);La(gm,gm,.25),bg(uu[0],i[4],i[5],.5),bg(uu[1],i[5],i[6],.5),bg(uu[2],i[6],i[7],.5),bg(uu[3],i[7],i[4],.5);let l=0,c=vP(uu[0],ya);for(let P=1;P<4;++P){const A=vP(uu[P],ya);A<c&&(c=A,l=P)}yd(Ar,uu[l],i[l+4]);const h=Ar[0];let u,m;Ar[0]=-Ar[1],Ar[1]=h,yd(zT,gm,ya),Or(zT,Ar)<0&&yF(Ar,Ar),bg(Ar,Ar,zT,t),rb(Ar,Ar),u=m=Or(yd(Lh,i[0],ya),Ar);for(let P=1;P<8;++P){const A=Or(yd(Lh,i[P],ya),Ar);A<u?u=A:A>m&&(m=A)}as(r,ya),La(Lh,Ar,u-e),Hl(r,r,Lh);let f=-1,y=1,g=0,v=0;for(let P=0;P<8;++P){yd(Bg,i[P],r),rb(Bg,Bg);const A=Ar[0]*Bg[1]-Ar[1]*Bg[0];A>0?A>f&&(f=A,g=P):A<y&&(y=A,v=P)}Zp(f>0,"leftArea"),Zp(y<0,"rightArea"),La(_m,Ar,u),Hl(_m,_m,ya),La(ym,Ar,m),Hl(ym,ym,ya),uv[0]=-Ar[1],uv[1]=Ar[0];const b=S0(r,i[v],ym,Hl(Lh,ym,uv),1,s),x=S0(r,i[g],ym,Lh,1,n),w=S0(r,i[g],_m,Hl(Lh,_m,uv),1,a),S=S0(r,i[v],_m,Lh,1,o);Zp(b,"rayRay"),Zp(x,"rayRay"),Zp(w,"rayRay"),Zp(S,"rayRay")}function Pt(i,e){return 3*e+i}const e3=Ne();function Nn(i,e){return pi(e3,i[e],i[e+3]),e3}const cn=Ne(),Oe=Bs();function kte(i,e,t,r,s){yd(cn,t,r),La(cn,cn,.5),Oe[0]=cn[0],Oe[1]=cn[1],Oe[2]=0,Oe[3]=cn[1],Oe[4]=-cn[0],Oe[5]=0,Oe[6]=cn[0]*cn[0]+cn[1]*cn[1],Oe[7]=cn[0]*cn[1]-cn[1]*cn[0],Oe[8]=1,Oe[Pt(0,2)]=-Or(Nn(Oe,0),i),Oe[Pt(1,2)]=-Or(Nn(Oe,1),i);let n=Or(Nn(Oe,0),t)+Oe[Pt(0,2)],a=Or(Nn(Oe,1),t)+Oe[Pt(1,2)],o=Or(Nn(Oe,0),r)+Oe[Pt(0,2)],l=Or(Nn(Oe,1),r)+Oe[Pt(1,2)];n=-(n+o)/(a+l),Oe[Pt(0,0)]+=Oe[Pt(1,0)]*n,Oe[Pt(0,1)]+=Oe[Pt(1,1)]*n,Oe[Pt(0,2)]+=Oe[Pt(1,2)]*n,n=1/(Or(Nn(Oe,0),t)+Oe[Pt(0,2)]),a=1/(Or(Nn(Oe,1),t)+Oe[Pt(1,2)]),Oe[Pt(0,0)]*=n,Oe[Pt(0,1)]*=n,Oe[Pt(0,2)]*=n,Oe[Pt(1,0)]*=a,Oe[Pt(1,1)]*=a,Oe[Pt(1,2)]*=a,Oe[Pt(2,0)]=Oe[Pt(1,0)],Oe[Pt(2,1)]=Oe[Pt(1,1)],Oe[Pt(2,2)]=Oe[Pt(1,2)],Oe[Pt(1,2)]+=1,n=Or(Nn(Oe,1),e)+Oe[Pt(1,2)],a=Or(Nn(Oe,2),e)+Oe[Pt(2,2)],o=Or(Nn(Oe,1),t)+Oe[Pt(1,2)],l=Or(Nn(Oe,2),t)+Oe[Pt(2,2)],n=-.5*(n/a+o/l),Oe[Pt(1,0)]+=Oe[Pt(2,0)]*n,Oe[Pt(1,1)]+=Oe[Pt(2,1)]*n,Oe[Pt(1,2)]+=Oe[Pt(2,2)]*n,n=Or(Nn(Oe,1),e)+Oe[Pt(1,2)],a=Or(Nn(Oe,2),e)+Oe[Pt(2,2)],o=-a/n,Oe[Pt(1,0)]*=o,Oe[Pt(1,1)]*=o,Oe[Pt(1,2)]*=o,s[0]=Oe[0],s[1]=Oe[1],s[2]=0,s[3]=Oe[2],s[4]=Oe[3],s[5]=Oe[4],s[6]=0,s[7]=Oe[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Oe[6],s[13]=Oe[7],s[14]=0,s[15]=Oe[8]}function Gte(i,e,t,r,s){const n=1/io[0][3],a=1/io[4][3];_t(n<a);let o=n+Math.sqrt(n*a);const l=Math.sin(ws(i[2]*e[0]+i[6]*e[1]+i[10]*e[2]));o/=l,zte(io,o,l,XI,YI,Bte,QI,ZI),kte(XI,YI,QI,ZI,s.projectionMatrix),s.projectionMatrix[10]=2/(t-r),s.projectionMatrix[14]=-(t+r)/(t-r)}function Hte(i){return pl(i)&&i.intersector===Ri.TERRAIN&&!!i.target}let qte=class extends Pw{constructor(e,t,r){super(e,t),this.triangleNr=r}};function o6(i){return pl(i)&&i.intersector===Ri.OVERLAY&&!!i.target}let vS=class{constructor(){this.adds=new Ht,this.removes=new Ht,this.updates=new Ht({allocator:e=>e||new Wte,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Wte=class{},jte=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Di,Ir;(function(i){i[i.ADD=0]="ADD",i[i.UPDATE=1]="UPDATE",i[i.REMOVE=2]="REMOVE"})(Di||(Di={})),function(i){i[i.NONE=0]="NONE",i[i.VISIBILITY=1]="VISIBILITY",i[i.GEOMETRY=2]="GEOMETRY",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHT=8]="HIGHLIGHT",i[i.OCCLUDEE=16]="OCCLUDEE"}(Ir||(Ir={}));function l6(i){const e=new Map,t=r=>{let s=e.get(r);return s||(s=new jte,e.set(r,s)),s};return i.removes.forAll(r=>{kT(r)&&t(r.material).removes.push(r)}),i.adds.forAll(r=>{kT(r)&&t(r.material).adds.push(r)}),i.updates.forAll(r=>{kT(r.renderGeometry)&&t(r.renderGeometry.material).updates.push(r)}),e}function kT(i){return i.geometry.indexCount>=1}let Xte=class{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,t=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,t,new Map([]))}_createIndexbuffer(){return Yt.createIndex(this._rctx,ri.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Ct.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(bt.POINTS,1,oa.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},c6=class{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach((e,t)=>{_(e)&&this._repository.release(this._material,t)})}load(e,t,r){if(!this._material.requiresSlot(t,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const s=this._map.get(r);if(_(s)){if(s.ensureResources(e)===a1.LOADED)return s;this._repository.requestRender()}return null}},bS=class extends gG{constructor(e=E()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}};const Yte=Rr().vec3f(C.POSITION),Qte=Rr().vec3f(C.POSITION).vec2f(C.UV0),h6=Rr().vec3f(C.POSITION).vec4u8(C.COLOR);Rr().vec3f(C.POSITION).vec4u8(C.OBJECTANDLAYERIDCOLOR);Rr().vec3f(C.POSITION).vec2f(C.UV0).vec4u8(C.OBJECTANDLAYERIDCOLOR);const Zte=Rr().vec3f(C.POSITION).vec4u8(C.COLOR).vec4u8(C.OBJECTANDLAYERIDCOLOR);let nA=class extends Mp{intersect(e,t,r,s,n,a){return Lz(e,r,s,n,void 0,a)}},d6=class u6 extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2,t.spherical=e.viewingMode===Se.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gt(e.rctx,u6.shader.get().build(this.configuration),Zt)}_setPipelineState(e){const t=this.configuration,r=e===It.NONE,s=e===It.FrontFace;return it({blending:t.output!==$.Normal&&t.output!==$.Highlight&&t.transparent?r?go:Qd(e):null,depthTest:{func:Lp(e)},depthWrite:r?t.writeDepth?ka:null:gw(e),colorWrite:ut,polygonOffset:r||s?null:V2(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};d6.shader=new jt(wz,()=>Y(()=>import("./WaterSurface.glsl-554ff1f2.js"),["./WaterSurface.glsl-554ff1f2.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-f0dc8788.js","./vec4f64-6d0e93be.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./vec4-c7a19f0d.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./compilerUtils-7bf6df9e.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./mathUtils-ae09f98b.js","./Ellipsoid-89682c5e.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./ReadLinearDepth.glsl-0e6f5c47.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js"],import.meta.url));let Zr=class extends gc{constructor(){super(...arguments),this.output=$.Color,this.transparencyPassType=It.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};d([L({count:$.COUNT})],Zr.prototype,"output",void 0),d([L({count:It.COUNT})],Zr.prototype,"transparencyPassType",void 0),d([L()],Zr.prototype,"spherical",void 0),d([L()],Zr.prototype,"receiveShadows",void 0),d([L()],Zr.prototype,"hasSlicePlane",void 0),d([L()],Zr.prototype,"transparent",void 0),d([L()],Zr.prototype,"enableOffset",void 0),d([L()],Zr.prototype,"writeDepth",void 0),d([L()],Zr.prototype,"hasScreenSpaceReflections",void 0),d([L()],Zr.prototype,"doublePrecisionRequiresObfuscation",void 0),d([L()],Zr.prototype,"hasCloudsReflections",void 0),d([L()],Zr.prototype,"isDraped",void 0),d([L()],Zr.prototype,"hasMultipassTerrain",void 0),d([L()],Zr.prototype,"cullAboveGround",void 0),d([L({constValue:di.Water})],Zr.prototype,"pbrMode",void 0),d([L({constValue:!0})],Zr.prototype,"useCustomDTRExponentForWater",void 0),d([L({constValue:!0})],Zr.prototype,"highStepCount",void 0),d([L({constValue:!1})],Zr.prototype,"useFillLights",void 0);let Kte=class extends Dp{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const t=_(e.cloudsFade.data);t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===$.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(d6,e)}},p6=class extends nA{constructor(e){super(e,new m6),this._configuration=new Zr,this.animation=new AF}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<B2,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<Jte;const r=this.animation.advance(e);return this.setParameters({timeElapsed:i2(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}requiresSlot(e,t){switch(t){case $.Normal:return e===ne.DRAPED_WATER;case $.Color:if(this.parameters.isDraped)return e===ne.DRAPED_MATERIAL;break;case $.Alpha:break;case $.Highlight:return e===ne.OPAQUE_MATERIAL||e===ne.DRAPED_MATERIAL;default:return!1}let r=ne.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?ne.TRANSPARENT_MATERIAL:ne.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new Kte(e)}createBufferWriter(){return new u0(Qte)}},m6=class extends h0{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ti(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Ai(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}};const Jte=35e3;let aA=class{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}};function t3(i){const e=new Map;i.forAll(r=>e.set(r.from,r));let t=!0;for(;t;)t=!1,i.forEach(r=>{const s=e.get(r.to);s&&(r.to=s.to,e.delete(s.from),i.removeUnordered(s),t=!0)})}let i3=class extends aA{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return _(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return _(this.geometry.occludees)}},eie=class{constructor(){this.first=0,this.count=0}},tie=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Ht({allocator:e=>e||new aA,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=pv(),this.drawCommandsHighlight=pv(),this.drawCommandsOccludees=pv(),this.drawCommandsShadowHighlightRest=pv()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=t,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return _(this.vao)&&this.holes.length===1&&s.to===Math.floor(this.vao.size/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const t=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of t)r.isVisible&&(r3(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),r3(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function iie(i){return _(i.vao)}function pv(){return new Ht({allocator:i=>i||new eie,deallocator:i=>i})}function r3(i,e){const t=i.back();if(t==null){const r=i.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(rie(t,e)){const r=e.from-t.first+e.numElements;t.count=r}else{const r=i.pushNew();r.first=e.from,r.count=e.numElements}}function rie(i,e){return i.first+i.count>=e.from}let sie=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(t=>t.instances.has(e))}};const nie=TG+1;let aie=class{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=e.newCache(`VaoCache ${Bf()}`,oie)}dispose(){this._cache.destroy()}newVao(e){const t=e.toString(),r=this._cache.pop(t);if(_(r)){const n=r.pop();return r.length>0&&this._cache.put(t,r,e*r.length,nie),n}const s=new fh(this._rctx,this._locations,{geometry:this._layout},{geometry:Yt.createVertex(this._rctx,ri.STATIC_DRAW)});return s.vertexBuffers.geometry.setSize(e),s}deleteVao(e){if(T(e))return null;const t=e.size,r=t.toString(),s=this._cache.pop(r);return _(s)?(s.push(e),this._cache.put(r,s,t*s.length,-1)):this._cache.put(r,[e],t,-1),null}};function oie(i,e){if(e===xG.ALL)return void i.forEach(s=>s.dispose());const t=i.pop(),r=i.length*t.size;return t.dispose(),r}let f6=class{constructor(e,t,r){this._rctx=e,this._materialRepository=t,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new c6(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new aie(e,r.vertexAttributeLocations,ul(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new Xte(this._rctx))}dispose(){var e;this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof p6}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==hr.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(t=>e+=t.buffers.reduce((r,s)=>r+s.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(t=>t.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){var s;const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const n of e){const a=n.renderGeometry,o=(s=this._dataByOrigin.get(a.localOrigin.id))==null?void 0:s.findBuffer(a.id);if(T(o))return;const l=o.instances.get(a.id);if(n.updateType&(Ir.GEOMETRY|Ir.TRANSFORMATION)){const c=_v(t.elementCount(l.geometry.geometry)*r),h=t.vertexBufferLayout.createView(c.buffer);this._writeGeometry(a,h,0),o.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}n.updateType&(Ir.HIGHLIGHT|Ir.OCCLUDEE|Ir.VISIBILITY)&&(o.drawCommandsDirty=!0)}}_computeDeltas(e,t){var s;const r=new d0;for(const n of e){const a=n.localOrigin;if(T(a))continue;let o=r.get(a.id,null);T(o)&&(o=new s3(a.vec3),r.set(a.id,null,o)),o.changes.push(n)}for(const n of t){const a=n.localOrigin;if(T(a))continue;const o=(s=this._dataByOrigin.get(a.id))==null?void 0:s.findBuffer(n.id);if(T(o))continue;let l=r.get(a.id,o);T(l)&&(l=new s3(a.vec3),r.set(a.id,o,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(e,t){const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,a=this._computeDeltas(e,t);a.forEach((o,l)=>{const c=o.get(null),h=_(c)?c.changes:[];a.delete(l,null);let u=s.get(l);if(o.forEach((m,f)=>{if(a.delete(l,f),T(f))return void _t(!1,"No VAO for removed geometries");if(f.instances.size===m.changes.length)return this._vaoCache.deleteVao(f.vao),X1(u.buffers,f),void(u.buffers.length===0&&h.length===0&&s.delete(l));const y=f.numElements,g=f.vao.size/4,v=h.reduce((S,P)=>S+r.elementCount(P.geometry),0),b=m.changes.reduce((S,P)=>S+r.elementCount(P.geometry),0),x=Math.min((y+v-b)*n,gv),w=x>g;x>zb&&x<g/2?(m.changes.forEach(({id:S})=>f.deleteInstance(S)),f.instances.forEach(({geometry:S})=>h.push(S)),this._vaoCache.deleteVao(f.vao),X1(u.buffers,f)):w?this._applyAndRebuild(f,h,m):this._applyRemoves(f,m)}),h.length>0)for(T(u)&&(u=new sie(c.origin),s.set(l,u)),u.buffers.forEach(m=>this._applyAdds(m,h));h.length>0;)u.buffers.push(this._applyAndRebuild(new tie,h,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(t=>{t.drawCommandsDirty&&(t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,fs(t.instances,r=>(t.updateDrawState(r),t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees)),t.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||t.hasHighlights,this._hasOccludees=this._hasOccludees||t.hasOccludees})})}_applyAndRebuild(e,t,r){if(_(r))for(const y of r.changes)e.deleteInstance(y.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,a=n/4,o=Math.floor(gv/a);let l=e.numElements;for(;t.length>0;){const y=t.pop(),g=s.elementCount(y.geometry);if(l+g>o&&l>0){t.push(y);break}l+=g;const v=new i3(y,0,0);_t(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*a,h=_v(c),u=s.vertexBufferLayout.createView(h.buffer);let m=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,g)=>{this._writeGeometry(y.geometry,u,m);const v=m;m+=s.elementCount(y.geometry.geometry),e.updateInstance(g,v,m),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(a3(c)),e.vao.vertexBuffers.geometry.setSubData(h,0,0,m*a),e.holes.clear();const f=e.holes.pushNew();return f.from=m,f.to=Math.floor(e.vao.size/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(t.changes.length===0)return;for(const o of t.changes){const l=o.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const h=vl.back();if(h){if(h.to===c.from){h.to=c.to;continue}if(h.from===c.to){h.from=c.from;continue}}const u=vl.pushNew();u.from=c.from,u.to=c.to}t3(vl);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=vl.reduce((o,l)=>Math.max(o,l.numElements),0)*r,n=_v(s);n.fill(0,0,s);const a=e.vao.vertexBuffers.geometry;vl.forAll(o=>a.setSubData(n,o.from*r,0,o.numElements*r)),e.holes.pushArray(vl.data,vl.length),vl.forAll((o,l)=>vl.data[l]=null),vl.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(t.length===0)return;if(!iie(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,a=t.reduce((b,x)=>b+r.elementCount(x.geometry),0),o=Math.min((n+a)*s,gv),l=4*o;if(e.vao.size<a3(gv-zb)&&l>e.vao.size)return void this._applyAndRebuild(e,t,null);t3(e.holes);const c=new Array;for(const b of t){const x=r.elementCount(b.geometry),w=lie(e.holes,x);c.push(w)}const h=e.vao.vertexBuffers.geometry;let u=0,m=0,f=0;const y=_v(o),g=r.vertexBufferLayout.createView(y.buffer);t.forEach((b,x)=>{const w=c[x];if(T(w))return;if(f!==w){const A=f-m;A>0&&h.setSubData(y,m*s,0,A*s),m=w,u=0}const S=r.elementCount(b.geometry);this._writeGeometry(b,g,u),u+=S,f=w+S;const P=new i3(b,w,w+S);_t(e.instances.get(b.id)==null),e.addInstance(b.id,P),e.drawCommandsDirty=!0});const v=f-m;v>0&&h.setSubData(y,m*s,0,v*s),O8(t,(b,x)=>T(c[x]))}_writeGeometry(e,t,r){const s=e.localOrigin.vec3;Ik(n3,-s[0],-s[1],-s[2]);const n=Sr(cie,n3,e.transformation);aa(mv,n),v2(mv,mv),this._bufferWriter.write(n,mv,e.geometry,t,r)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,t){return this.material.requiresSlot(e,t)}render(e,t){var c;if(!this.requiresSlot(t.slot,e))return!1;const r=e===$.Highlight||e===$.ShadowHighlight;if(r&&!this._hasHighlights)return!1;const s=e===$.ShadowExcludeHighlight,n=!(r||s),a=this._rctx;let o;const l=()=>{if(_(o))return o;const h=this._glMaterials.load(a,t.slot,e);return T(h)?null:(o=h.beginSlot(t),T(o)?null:(a.bindTechnique(o,this.material.parameters,t),o))};(c=this._appleAmdDriverHelper)==null||c.resetIndicesType();for(const h of this._dataByOrigin.values())for(const u of h.buffers){if(r&&!u.hasHighlights)continue;const m=(r?u.drawCommandsHighlight:s&&u.needsMultipleCommands()?u.drawCommandsShadowHighlightRest:u.drawCommandsDefault)||null,f=n&&u.drawCommandsOccludees||null;if(m!=null&&m.length||f!=null&&f.length){const y=l();if(T(y))return!1;y.program.bindDraw(new bS(h.origin),t,this.material.parameters),y.ensureAttributeLocations(u.vao),a.bindVAO(u.vao),m!=null&&m.length&&(y.bindPipelineState(a,t.slot,!1),m.forAll(g=>a.drawArrays(y.primitiveType,g.first,g.count))),f!=null&&f.length&&(y.bindPipelineState(a,t.slot,!0),f.forAll(g=>a.drawArrays(y.primitiveType,g.first,g.count)))}}return _(o)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},s3=class{constructor(e){this.origin=e,this.changes=new Array}};function lie(i,e){let t;if(!i.some(s=>!(s.numElements<e)&&(t=s,!0)))return null;const r=t.from;return t.from+=e,t.from>=t.to&&i.removeUnordered(t),r}const n3=ve(),cie=ve(),mv=ve(),vl=new Ht({allocator:i=>i||new aA,deallocator:null}),zb=65536,fv=4*zb,g6=16777216,gv=g6/4;let GT=new Float32Array(zb);function _v(i){return GT.length<i&&(GT=new Float32Array(i)),GT}function a3(i){const e=4*i;return e<fv?fv:Math.max(Math.min(Math.ceil(1.5*e/fv)*fv,g6),e)}let Sa=class extends ge{constructor(e){super(e),this._pending=new hie,this._changes=new vS,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Ht,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return fs(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=l6(this._changes);let t=!1,r=!1,s=!1;return e.forEach((n,a)=>{let o=this._materialRenderers.get(a);if(!o&&n.adds.length>0&&(o=new f6(this.rctx,this._materialRepository,a),this._materialRenderers.set(a,o),t=!0,r=!0,s=!0),!o)return;const l=r||o.hasHighlights,c=s||o.hasWater;o.modify(n),r=r||l!==o.hasHighlights,s=s||c!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(a),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=fs(this._materialRenderers,n=>n.hasHighlights)),s&&(this._hasWater=fs(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),t===Di.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(Et(n.id));r&&!this._pending.empty&&this.notifyChange("updating"),t===Di.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case Ir.TRANSFORMATION:case Ir.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Ir.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(r=>t=r.updateAnimation(e)||t),t}render(e){this._sortedMaterialRenderers.forAll(t=>{t.material.shouldRender(e)&&t.render(e.output,e.bindParameters)})}intersect(e,t,r,s,n){return this._geometries.forEach(a=>{if(s&&!s(a))return;this._intersectRenderGeometry(a,r,t,0,e,n);const o=this.rendererContext.longitudeCyclical;o&&(a.boundingSphere[0]-a.boundingSphere[3]<o.min&&this._intersectRenderGeometry(a,r,t,o.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>o.max&&this._intersectRenderGeometry(a,r,t,-o.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(t)}),this._sortedMaterialRenderers.sort((t,r)=>{const s=r.material.renderPriority-t.material.renderPriority;return s!==0?s:t.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,s,n,a){if(!e.visible)return;let o=0;s+=e.transformation[12],o=e.transformation[13],HT[0]=r[0]-s,HT[1]=r[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,HT,(l,c,h)=>{die(t,h,e.material.renderPriority,a,n,e.layerUid,e.graphicUid)},t)}_notifyGraphicGeometryChanged(e){if(T(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const r of e){const s=r.graphicUid;_(s)&&s!==t&&(this.drapeSource.notifyGraphicGeometryChanged(s),t=s)}}_notifyGraphicVisibilityChanged(e){if(T(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const r of e){const s=r.graphicUid;_(s)&&s!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(s),t=s)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return T(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};d([p()],Sa.prototype,"drapeSource",void 0),d([p()],Sa.prototype,"updating",null),d([p()],Sa.prototype,"rctx",null),d([p()],Sa.prototype,"rendererContext",void 0),d([p()],Sa.prototype,"_materialRepository",null),d([p()],Sa.prototype,"_localOriginFactory",null),d([p({readOnly:!0})],Sa.prototype,"isEmpty",null),d([p()],Sa.prototype,"_materialRenderers",void 0),d([p()],Sa.prototype,"_geometries",void 0),Sa=d([k("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Sa);let hie=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function die(i,e,t,r,s,n,a){const o=new qte(n,a,e),l=c=>{c.set(Ri.OVERLAY,o,i.dist,i.normal,i.transformation,t,r)};if((s.results.min.drapedLayerOrder==null||t>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==rs.MIN&&(s.results.max.drapedLayerOrder==null||t<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===rs.ALL){const c=SR(s.ray);l(c),s.results.all.push(c)}}const HT=Ne();let oA=class _6 extends Wt{initializeProgram(e){return new Gt(e.rctx,_6.shader.get().build(),Zt)}initializePipeline(){return this.configuration.hasAlpha?it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut}):it({colorWrite:ut})}};oA.shader=new jt(cG,()=>Y(()=>import("./TextureOnly.glsl-3276a8c7.js"),["./TextureOnly.glsl-3276a8c7.js","./vec4f64-6d0e93be.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./TextureOnly.glsl-469cc321.js","./ScreenSpacePass.glsl-44cc0c5e.js","./Float4PassUniform-9354414b.js"],import.meta.url));let lA=class extends Ln{constructor(){super(...arguments),this.hasAlpha=!1}};d([L()],lA.prototype,"hasAlpha",void 0);let Fo=class extends ge{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new mi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Ht,this._passParameters=new hG,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new ze,this.worldToPCSRatio=1,this.events=new Br,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new _5(e.renderingContext),this._shaderTechniqueRepository=new K9({rctx:this._rctx,viewingMode:Se.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new a6(this._rctx,new sA(this._rctx,this.view.state.viewingMode),new SF(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([z(()=>t.updating,()=>this.events.emit("content-changed"),er),z(()=>this.spatialReference,r=>this._localOriginFactory=new rA(r),er),Nr(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new J9(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&kb)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ne.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=LF(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=It.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new EF(qe(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(rr.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=gr(this._debugTextureTechnique),this._passParameters.texture=Le(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Le(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=we(this._shaderTechniqueRepository),this._temporaryFBO=Le(this._temporaryFBO),this._quadVAO=Le(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||fs(this._renderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Sa)}createDrapeSourceRenderer(e,t,r){const s=this._renderers.get(e);_(s)&&s.destroy();const n=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(z(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(T(e))return;const t=this._renderers.get(e);T(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const[s,n]=this.overlays,a=s.validTargets[r.type]||!n.validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(a,r,e)||t}return t}get overlays(){return Ze(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>t.hasTargetWithoutRasterImage=ox(e,r=>r.drapeTargetType===yS.WithoutRasterImage))}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=ox(e,r=>r.drapeSourceType===ty.Features),t.hasDrapedRasterSource=ox(e,r=>r.drapeSourceType===ty.RasterImage)})}ensureOverlays(e,t){T(this._overlays)&&(this._overlayRenderTarget=new wte(this._rctx),this._overlays=[new BI(Li.INNER,this._overlayRenderTarget),new BI(Li.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Le(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||t(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(_(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(ta,e=>e.updatePolicy===Ld.SYNC)}get isEmpty(){return!zt.OVERLAY_DRAW_DEBUG_TEXTURE&&!fs(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._renderers.forEach(r=>t=r.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,r){const s=e.canvasGeometries;if(s.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const n=t.output;if(this.isEmpty||n===$.Highlight&&!this.hasHighlights||n===$.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const a=t.fbo;if(!a.isValid())return!1;const o=2*e.resolution,l=e.resolution;a.resize(o,l);const c=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*r,this._renderContext.output=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=n===$.Normal?ne.DRAPED_WATER:ne.DRAPED_MATERIAL,e.applyViewport(this._rctx),a.bind(c),e.index===Li.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Si.COLOR_BUFFER_BIT)),t.type===ki.Occluded&&(this._renderContext.renderOccludedMask=kb),zt.OVERLAY_DRAW_DEBUG_TEXTURE&&t.type!==ki.Occluded)for(let h=0;h<s.numViews;h++)this._setViewParameters(s.extents[h],e),this._drawDebugTexture(e.resolution,pie[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:h,renderer:u})=>{if(t.type===ki.ColorNoRasterImage&&h.drapeSourceType===ty.RasterImage)return;const{fullOpacity:m}=h,f=_(m)&&m<1&&n===$.Color;f&&(this.bindTemporaryFramebuffer(this._rctx,o,l),c.clearSafe(Si.COLOR_BUFFER_BIT));for(let y=0;y<s.numViews;y++)this._setViewParameters(s.extents[y],e),u.render(this._renderContext);f&&_(this._temporaryFBO)&&(a.bind(c),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),m,e.index))}),c.bindFramebuffer(null),a.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){T(this._temporaryFBO)&&(this._temporaryFBO=new Z9(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,s){var a;let n=0;for(const o of this._renderers.values())n=((a=o.intersect)==null?void 0:a.call(o,e,t,r,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((t,r)=>{const s=e.indexOf(r.layer),n=s>=0,a=this._renderers.size*(r.renderGroup??(n?Vb.MapLayer:Vb.ViewLayer))+(n?s:0);this._sortedRenderers.push(new uie(r,t,a))}),this._sortedRenderers.sort((t,r)=>t.index-r.index)}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],NB(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),X$(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=fs(this._renderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=fs(this._renderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=fs(this._renderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e,t);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(bt.TRIANGLE_STRIP,0,Qs(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t,r){if(Z(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const s=new Uint8Array(e*t*4);let n=0;for(let o=0;o<t;o++)for(let l=0;l<e;l++){const c=Math.floor(l/10),h=Math.floor(o/10);c<2||h<2||10*c>e-20||10*h>t-20?(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=255):(s[n++]=255,s[n++]=255,s[n++]=255,s[n++]=1&c&&1&h?1&l^1&o?0:255:1&c^1&h?0:128)}this._passParameters.texture=new ui(this._rctx,{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,width:e,height:t},s);const a=new lA;a.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(oA,a),this._quadVAO=Dn(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};d([p()],Fo.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([p({autoDestroy:!0})],Fo.prototype,"_shaderTechniqueRepository",void 0),d([p({autoDestroy:!0})],Fo.prototype,"_stippleTextureRepository",void 0),d([p({constructOnly:!0})],Fo.prototype,"view",void 0),d([p()],Fo.prototype,"worldToPCSRatio",void 0),d([p()],Fo.prototype,"spatialReference",void 0),d([p({type:Boolean,readOnly:!0})],Fo.prototype,"updating",null),d([p()],Fo.prototype,"isEmpty",null),Fo=d([k("esri.views.3d.terrain.OverlayRenderer")],Fo);let uie=class{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}};const pie=[[1,.5,.5],[.5,.5,1]],cA=-2,kb=hr.OccludeAndTransparent;function hA(i,e,t,r){const s=_w(i.rings,!!i.hasZ,Wf.CCW_IS_HOLE),n=vo(s.position.length),a=P9(s.position,i.spatialReference,0,n,0,s.position,0,s.position.length/3,e,t,r),o=a!=null;return new gie(s.position,n,b6(s.polygons,s.position,n),v6(s.outlines,s.position,n),o,a)}function y6(i,e){const t=_w(i.rings,!1,Wf.CCW_IS_HOLE),r=In(t.position,i.spatialReference,0,t.position,e,0,t.position.length/3);for(let s=2;s<t.position.length;s+=3)t.position[s]=cA;return{position:t.position,polygons:b6(t.polygons,t.position),outlines:v6(t.outlines,t.position),projectionSuccess:r}}function v6(i,e,t=null){return i.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,a=3*s;return _(t)?new w6(r,s,rl(e,n,a),rl(t,n,a)):new dA(r,s,rl(e,n,a))})}function b6(i,e,t=null){const r=new Array;for(const{index:s,count:n,holeIndices:a,pathLengths:o}of i){if(n<=1)continue;const l=3*s,c=3*n,h=a.map(m=>m-s),u=_(t)?new mie(s,n,rl(e,3*s,3*n),rl(t,l,c),h,o):new fie(s,n,rl(e,3*s,3*n),h,o);r.push(u)}return r}let dA=class{constructor(e,t,r){this.index=e,this.count=t,this.position=r}},w6=class extends dA{constructor(e,t,r,s){super(e,t,r),this.mapPositions=s}},mie=class extends w6{constructor(e,t,r,s,n,a){super(e,t,r,s),this.holeIndices=n,this.pathLengths=a}},fie=class extends dA{constructor(e,t,r,s,n){super(e,t,r),this.holeIndices=s,this.pathLengths=n}},gie=class{constructor(e,t,r,s,n,a){this.position=e,this.mapPositions=t,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=a}};const _ie=["polygon","extent"];let yie=class extends yc{constructor(e,t,r,s){super(e,t,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const o=Bw(this._getSymbolSize());if(o)throw new ue("graphics3dextrudesymbollayer:invalid-size",o)}const e=ts(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e),r=so(t),s=t[3],n=s<1||this.needsDrivenTransparentPass,a={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Fr.None:Fr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new Ty(a),this._bottomMaterial=new Ty({...a,cullFace:Fr.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,_ie,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(t,new ml);return this._createAs3DShape(t,e.renderingInfo,r,s,t.uid)}layerOpacityChanged(e,t){const r=ts(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const a=this._getLayerOpacity();e.forEach(o=>{const l=t(o);_(l)&&l.layerOpacityChanged(a,this._context.isAsync)})}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Xd)}slicePlaneEnabledChanged(e,t){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const s=t(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getExtrusionSize(e){let t;return t=e.size&&this._drivenProperties.size?_te(e.size,2)??0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(e,t){return this._drivenPropertiesChanged(t)?Cr.Recreate_Symbol:Cr.Recreate_Graphics}async queryForSnapping(e,t,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/z8(t),{objectId:a,target:o}=e,l=il(o);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:h}=e,u=il(c),m=il(h);return u.z=(u.z??0)+n,m.z=(m.z??0)+n,[HP(a,l,1/0,u,m)]}case"vertex":return[lG(a,l,1/0),HP(a,o,1/0,o,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,t,r,s,n){const a=ky(e.geometry);if(T(a))return null;if(a.rings.length===0||!a.rings.some(Q=>Q.length>0))return this._logGeometryValidationWarnings(a.rings,"rings","ExtrudeSymbol3DLayer"),null;const o=hA(a,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(o,a.rings,"rings","ExtrudeSymbol3DLayer");const l=XR(a);if(T(l))return null;const c=new Array,h=zs(),u=ve(),m=E(),f=this._context.renderCoordsHelper.viewingMode===Se.Global;f||this._context.renderCoordsHelper.worldUpAtPosition(null,m),ch(a.spatialReference,[l.x,l.y,0],u,this._context.renderCoordsHelper.spatialReference);const y=ve();aa(y,u);const g=Bs();jz(g,y);const{polygons:v,mapPositions:b,position:x}=o,w=x.length/3,S=new Float64Array(3*w*6),P=new Float64Array(3*w*6),A=new Float64Array(3*w*6),M=new Float64Array(1*w*6);let O=0;for(let Q=0;Q<v.length;++Q){const ae=v[Q],q=ae.count;if(this._context.clippingExtent&&(Pi(h),Ua(h,ae.mapPositions),!Jo(h,this._context.clippingExtent)))continue;const D=Ry(ae.mapPositions,ae.holeIndices,3);if(D.length===0)continue;const H=3*q*2+D.length,G=new Array(H),B=new Array(D.length),le=6*q,ce=3*S.BYTES_PER_ELEMENT,_e=new hb(S.buffer,O*ce,ce,(O+le)*ce),j=3*P.BYTES_PER_ELEMENT,de=new hb(P.buffer,O*j,j,(O+le)*j),te=new Float64Array(A.buffer,3*O*A.BYTES_PER_ELEMENT,3*le),me=new Float64Array(M.buffer,1*O*M.BYTES_PER_ELEMENT,1*le),ye=this._getExtrusionSize(t);vie(x,b,D,ae,_e.typedBuffer,te,de.typedBuffer,me,G,B,ye,m,f),u5(_e,_e,y),ub(de,de,g),O+=6*q;const Ue=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),De=new Cie(_e.typedBuffer,te,de.typedBuffer,me);c.push(o3(this._material,G,G.length-B.length,De,r,Ue)),c.push(o3(this._bottomMaterial,B,0,De,r,Ue))}if(c.length===0)return null;const I=new bh({geometries:c,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});I.transformation=u;const N=d5(this.symbolLayer,{opacity:this._getLayerOpacity()}),F=_(N)?{baseMaterial:this._material,edgeMaterials:[N],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,V=new _c(this,I,c,null,null,xie,s,F);return V.alignedSampledElevation=o.sampledElevation,V.needsElevationUpdates=Xd(s.mode),V}};function o3(i,e,t,r,s,n){const a=new Array(e.length).fill(0),o=[[C.POSITION,new Ae(r.positions,3,!0)],[C.NORMAL,new Ae(r.normals,3,!0)],[C.COLOR,new Ae(s,4,!0)],[C.SIZE,new Ae(r.heights,1,!0)]],l=[[C.POSITION,e],[C.NORMAL,e],[C.COLOR,a]];return new Vr(i,o,l,r.elevation,Ns.Mesh,n,t)}function vie(i,e,t,r,s,n,a,o,l,c,h,u,m){const f=t.length/3;let y=0,g=2*r.count;bie(i,e,r.index,r.count,t,0,f,s,n,a,o,l,c,g,h,u,m);let v=2*r.count;g=0,l3(s,n,o,a,y,r.pathLengths[0],r.count,v,l,g,h),v+=4*r.pathLengths[0],g+=2*r.pathLengths[0],y+=r.pathLengths[0];for(let b=1;b<r.pathLengths.length;++b)l3(s,n,o,a,y,r.pathLengths[b],r.count,v,l,g,h),v+=4*r.pathLengths[b],g+=2*r.pathLengths[b],y+=r.pathLengths[b]}function bie(i,e,t,r,s,n,a,o,l,c,h,u,m,f,y,g,v){X(hn,g);const b=y>0?1:-1;let x=3*t,w=0,S=3*w,P=r,A=3*P;for(let I=0;I<r;++I)v&&(hn[0]=i[x+0],hn[1]=i[x+1],hn[2]=i[x+2],K(hn,hn)),o[S+0]=i[x+0],o[S+1]=i[x+1],o[S+2]=i[x+2],l[S+0]=e[x+0],l[S+1]=e[x+1],l[S+2]=e[x+2],c[S+0]=-b*hn[0],c[S+1]=-b*hn[1],c[S+2]=-b*hn[2],h[w]=0,o[A+0]=i[x+0]+y*hn[0],o[A+1]=i[x+1]+y*hn[1],o[A+2]=i[x+2]+y*hn[2],l[A+0]=e[x+0],l[A+1]=e[x+1],l[A+2]=e[x+2],c[A+0]=b*hn[0],c[A+1]=b*hn[1],c[A+2]=b*hn[2],h[P]=y,S+=3,A+=3,x+=3,w+=1,P+=1;x=3*n,S=0,A=3*f;const M=y<0?m3:p3,O=y<0?p3:m3;for(let I=0;I<a;++I)m[S+0]=s[x+M[0]],m[S+1]=s[x+M[1]],m[S+2]=s[x+M[2]],u[A+0]=s[x+O[0]]+r,u[A+1]=s[x+O[1]]+r,u[A+2]=s[x+O[2]]+r,S+=3,A+=3,x+=3}function yv(i,e,t,r,s,n,a){r[n]=r[a],a*=3,i[(n*=3)+0]=i[a+0],i[n+1]=i[a+1],i[n+2]=i[a+2],e[n+0]=e[a+0],e[n+1]=e[a+1],e[n+2]=e[a+2],t[n+0]=s[0],t[n+1]=s[1],t[n+2]=s[2]}const zg=E();function l3(i,e,t,r,s,n,a,o,l,c,h){let u=s,m=s+1,f=s+a,y=s+a+1,g=o,v=o+1,b=o+2*n,x=o+2*n+1;h<0&&(u=s+a+1,y=s),c*=3;for(let w=0;w<n;++w)w===n-1&&(h>0?(m=s,y=s+a):(m=s,u=s+a)),wie(i,u,m,f,zg),yv(i,e,r,t,zg,g,u),yv(i,e,r,t,zg,v,m),yv(i,e,r,t,zg,b,f),yv(i,e,r,t,zg,x,y),l[c++]=g,l[c++]=b,l[c++]=x,l[c++]=g,l[c++]=x,l[c++]=v,u++,m++,f++,y++,g+=2,v+=2,b+=2,x+=2}const qT=E(),c3=E(),h3=E(),d3=E(),u3=E();function wie(i,e,t,r,s){e*=3,t*=3,r*=3,Z(qT,i[e++],i[e++],i[e++]),Z(c3,i[t++],i[t++],i[t++]),Z(h3,i[r++],i[r++],i[r++]),ee(d3,c3,qT),ee(u3,h3,qT),Xe(s,u3,d3),K(s,s)}const vm=E();function xie(i,e,t,r,s){const n=i.stageObject,a=n.geometries,o=a.length,l=e.mode!=="absolute-height";let c=0;const h=n.transformation,u=n0(ve(),h);for(let m=0;m<o;m+=2){const f=a[m];if(!QR(f))continue;const y=f.getMutableAttribute(C.POSITION).data,g=f.vertexAttributes.get(C.SIZE).data,v=new HN(f.mapPositions),b=y.length/3;let x=0,w=!1,S=0;for(let P=0;P<b;P++){vm[0]=y[x],vm[1]=y[x+1],vm[2]=y[x+2],r(v,vv),l&&(S+=vv.sampledElevation),zt.TESTS_DISABLE_OPTIMIZATIONS?(Z(Un,v.array[v.offset+0],v.array[v.offset+1],vv.z+g[x/3]),_(t)&&s.toRenderCoords(Un,t,Un),Pe(Un,Un,u)):(Z(Un,y[x+0],y[x+1],y[x+2]),Pe(Un,Un,h),s.setAltitude(Un,vv.z+g[x/3]),Pe(Un,Un,u)),y[x]=Un[0],y[x+1]=Un[1],y[x+2]=Un[2];const A=Tie/s.unitInMeters;(Math.abs(vm[0]-y[x])>=A||Math.abs(vm[1]-y[x+1])>=A||Math.abs(vm[2]-y[x+2])>=A)&&(w=!0),v.offset+=3,x+=3}w&&(f.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[m+1])),c+=S/b}return c/o}const Un=E(),hn=E(),vv=new _0,p3=[0,2,1],m3=[0,1,2],Tie=.01;let Cie=class{constructor(e,t,r,s){this.positions=e,this.elevation=t,this.normals=r,this.heights=s}};const zwe=1.2,Eie=Cf;let Gw=class{constructor(e,t,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Di.ADD);if(e||this._addedToStage){for(const t of this.renderGeometries)t.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ir.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Di.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=E()){return Z(e,0,0,0)}getBoundingBoxObjectSpace(e=zs()){return Pi(e)}addObjectState(e,t){e===Yf.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();t.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ir.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(t=>{e.removeRenderGeometry(t)})}removeRenderGeometryObjectState(e,t){e.geometry.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Ir.HIGHLIGHT)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.geometry.computeAttachmentOrigin(bm)&&(e.draped.origin[0]+=bm[0],e.draped.origin[1]+=bm[1],e.draped.num++)}async getProjectedBoundingBox(e,t,r,s,n){Pi(n);for(let a=0;a<this.renderGeometries.length;a++){const o=this.renderGeometries[a];this._getRenderGeometryProjectedBoundingRect(o,e,f3,r),qk(n,f3)}if(t){let a;Ko(n,bm);const o=YR(n,t.service.spatialReference,t);try{a=await t.service.queryElevation(bm[0],bm[1],s,o,"ground")}catch{}_(a)&&(n[2]=Math.min(n[2],a),n[5]=Math.max(n[5],a))}return n}_getRenderGeometryProjectedBoundingRect(e,t,r,s){if(this.boundingBox)W2(bl,this.boundingBox);else{const n=e.boundingSphere,a=n[3];bl[0]=n[0]-a,bl[1]=n[1]-a,bl[2]=n[2]-a,bl[3]=n[0]+a,bl[4]=n[1]+a,bl[5]=n[2]+a}return t(bl,0,2),this.calculateRelativeScreenBounds&&s.push({location:Ko(bl),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),G2(bl,r)}};const f3=Ot(),bl=zs(),bm=E();let x6=class{constructor(e,t,r,s=2048){this.text=e,this._alignment=t,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),t=this._lineHeight;return Math.ceil(e+t+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(T(this._metricsCached)){const e=wS(g3,bv,bv).getContext("2d");this._setFontProperties(e,this._fontSize);let t=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(t+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s,n,a=0,o=0,l=0;this._lines.forEach((y,g)=>{const v=e.measureText(y),b=v.width,x=b+t;this._textWidths.push(b),this._lineWidths.push(x),a=Math.max(a,x),o=Math.max(o,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),g===0&&(s=v),g===this._lines.length-1&&(n=v)});const c=e.font;let h=y3.get(c);if(!h){const y=e.measureText(Rie);h=new Pie(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),y3.set(c,h)}o=Math.max(o,h.actualBoundingBoxAscent),l=Math.max(l,h.actualBoundingBoxDescent);const u=o+l,m=this._hasBackground?s.actualBoundingBoxAscent:o,f=this._hasBackground?n.actualBoundingBoxDescent:l;this._metricsCached=new Aie(o-m,l-f,u,a,o)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*Sie}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(T(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case $d.Left:return this._backgroundHorizontalPadding;case $d.Center:return(this.displayWidth-this._lineWidths[e])/2;case $d.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,t=0,r=0){e.save();const s=t/=this.renderPixelRatio,n=r/=this.renderPixelRatio,a=this._haloSize,o=this._firstLineYOffset;t+=a,r+=o+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,a,o),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],u=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,h,t+u,r),this._renderLineDecoration(e,t+u,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,h,t+this._getLineXOffset(c),r),this._renderLineDecoration(e,t+u,r,this._textWidths[c]),r+=this._lineSpacing}if(zt.TEXT_SHOW_BASELINE){e.strokeStyle=_3,e.setLineDash([2,2]),e.lineWidth=1;let c=n+o;for(let h=0;h<this._lines.length;++h){const u=c+this._baselinePosition;this._drawLine(e,[s,u],[s+this.displayWidth,u]),c+=this._lineSpacing}}if(zt.TEXT_SHOW_BORDER&&(e.strokeStyle=_3,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const a=1,o=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":r+=2*o;break;case"line-through":r-=.33*this._baselinePosition}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(o+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(t-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,t,r,s){t=this._toRenderUnit(t),r=this._toRenderUnit(r);const n=this.renderedWidth,a=this.renderedHeight;s!==0?(s=ie(s,0,Math.floor(a/2)),e.beginPath(),e.moveTo(t,r+s),e.arcTo(t,r,t+s,r,s),e.lineTo(t+n-s,r),e.arcTo(t+n,r,t+n,r+s,s),e.lineTo(t+n,r+a-s),e.arcTo(t+n,r+a,t+n-s,r+a,s),e.lineTo(t+s,r+a),e.arcTo(t,r+a,t,r+a-s,s),e.closePath()):e.rect(t,r,n,a)}_renderHalo(e,t,r,s,n){const a=this.renderedWidth,o=this.renderedHeight,l=wS(g3,Math.max(a,bv),Math.max(o,bv)),c=l.getContext("2d");c.clearRect(0,0,a,o),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this._renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let u=n+this._baselinePosition;for(let m=0;m<this._lines.length;++m){const f=this._getLineXOffset(m);this._renderLineDecoration(c,s+f,u,this._textWidths[m],!0),u+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,a,o,this._toRenderUnit(t),this._toRenderUnit(r),a,o),e.globalAlpha=1}_renderHaloEmulated(e,t,r){r+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],a=this._getLineXOffset(s);for(const[o,l]of T6)this._fillText(e,n,t+a+this._haloSize*o,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,t,r){const s=2*this._haloSize;r+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const a=this._lines[n],o=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const u=1-(l-1)*c+h*c;e.lineWidth=this._toRenderUnit(u*s),this._strokeText(e,a,t+o,r)}r+=this._lineSpacing}}_setFontProperties(e,t){e.font=this._parameters.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,r,s){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,t,r,s){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,t,r){const s=this._toRenderUnit(t[0]),n=this._toRenderUnit(t[1]),a=this._toRenderUnit(r[0]),o=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+a)-.5,h=Math.floor(n)+.5,u=Math.ceil(n+o)-.5;e.beginPath(),e.moveTo(l,h),e.lineTo(c,h),e.lineTo(c,u),e.lineTo(l,u),e.lineTo(l,h),e.stroke()}};const T6=[];for(let e=0;e<360;e+=360/16)T6.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var $d;function wS(i,e,t){return i.canvas||(i.canvas=document.createElement("canvas")),i.canvas.width=e,i.canvas.height=t,i.canvas}(function(i){i[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"})($d||($d={}));const g3={canvas:null},Sie=.2,bv=512,_3="rgb(255, 0, 255, 0.5)",Rie=(()=>{let i="";for(let e=32;e<127;e++)i+=String.fromCharCode(e);return i})();let Aie=class{constructor(e,t,r,s,n){this.paddingTop=e,this.paddingBottom=t,this.lineHeight=r,this.displayWidth=s,this.baselinePosition=n}},Pie=class{constructor(e,t){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=t}};const y3=new Map,Oie=Object.freeze({left:0,center:.5,right:1}),M1=Object.freeze({"bottom-left":ti(0,0),bottom:ti(.5,0),"bottom-right":ti(1,0),left:ti(0,.5),center:ti(.5,.5),right:ti(1,.5),"top-left":ti(0,1),top:ti(.5,1),"top-right":ti(1,1)});function C6(i){switch(i){case"left":return $d.Left;case"right":return $d.Right;default:return $d.Center}}function v3(i){switch(i){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Mie(i){switch(i){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Iie(i,e){switch(e){case"bottom":return i==="left"?"bottom-left":i==="right"?"bottom-right":"bottom";case"center":return i;case"top":return i==="left"?"top-left":i==="right"?"top-right":"top"}}function Die(i){return i==="middle"?"center":i}var Ds,b3;function kg(i){return i!=null}function wm(i){return typeof i=="number"}function Hw(i){return typeof i=="string"}function Lie(i){return i==null||Hw(i)}function xr(i,e){i&&i.push(e)}function $ie(i,e,t,r=ve()){const s=i||0,n=e||0,a=t||0;return s!==0&&fy(r,r,-s/180*Math.PI),n!==0&&gy(r,r,n/180*Math.PI),a!==0&&w2(r,r,a/180*Math.PI),r}function $h(i,e,t,r,s){const n=i.minSize,a=i.maxSize;if(i.expression)return xr(s,"Could not convert size info: expression not supported"),!1;if(i.useSymbolValue){const o=r.symbolSize[t];return e.minSize[t]=o,e.maxSize[t]=o,e.offset[t]=e.minSize[t],e.factor[t]=0,e.type[t]=Ds.DefinedSize,!0}if(kg(i.field))return kg(i.stops)?i.stops.length===2&&wm(i.stops[0].size)&&wm(i.stops[1].size)?(w3(i.stops[0].size,i.stops[1].size,i.stops[0].value,i.stops[1].value,e,t),e.type[t]=Ds.DefinedSize,!0):(xr(s,"Could not convert size info: stops only supported with 2 elements"),!1):wm(n)&&wm(a)&&kg(i.minDataValue)&&kg(i.maxDataValue)?(w3(n,a,i.minDataValue,i.maxDataValue,e,t),e.type[t]=Ds.DefinedSize,!0):WP[i.valueUnit]!=null?(e.minSize[t]=-1/0,e.maxSize[t]=1/0,e.offset[t]=0,e.factor[t]=1/WP[i.valueUnit],e.type[t]=Ds.DefinedSize,!0):i.valueUnit==="unknown"?(xr(s,"Could not convert size info: proportional size not supported"),!1):(xr(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!kg(i.field)){if(i.stops&&i.stops[0]&&wm(i.stops[0].size))return e.minSize[t]=i.stops[0].size,e.maxSize[t]=i.stops[0].size,e.offset[t]=e.minSize[t],e.factor[t]=0,e.type[t]=Ds.DefinedSize,!0;if(wm(n))return e.minSize[t]=n,e.maxSize[t]=n,e.offset[t]=n,e.factor[t]=0,e.type[t]=Ds.DefinedSize,!0}return xr(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function w3(i,e,t,r,s,n){const a=Math.abs(r-t)>0?(e-i)/(r-t):0;s.minSize[n]=a>0?i:e,s.maxSize[n]=a>0?e:i,s.offset[n]=i-t*a,s.factor[n]=a}function Fie(i,e,t,r){if(i.normalizationField||i.valueRepresentation)return xr(r,"Could not convert size info: unsupported property"),null;if(!Lie(i.field))return xr(r,"Could not convert size info: field is not a string"),null;if(e.size){if(i.field)if(e.size.field){if(i.field!==e.size.field)return xr(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=i.field}else e.size={field:i.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Ds.Undefined,Ds.Undefined,Ds.Undefined]};let s;switch(i.axis){case"width":return s=$h(i,e.size,0,t,r),s?e:null;case"height":return s=$h(i,e.size,2,t,r),s?e:null;case"depth":return s=$h(i,e.size,1,t,r),s?e:null;case"width-and-depth":return s=$h(i,e.size,0,t,r),s&&$h(i,e.size,1,t,r),s?e:null;case null:case void 0:case"all":return s=$h(i,e.size,0,t,r),s=s&&$h(i,e.size,1,t,r),s=s&&$h(i,e.size,2,t,r),s?e:null;default:return xr(r,`Could not convert size info: unknown axis "${i.axis}""`),null}}function Nie(i,e,t){for(let s=0;s<3;++s){let n=e.unitInMeters;i.type[s]===Ds.DefinedSize&&(n*=e.modelSize[s],i.type[s]=Ds.DefinedScale),i.minSize[s]=i.minSize[s]/n,i.maxSize[s]=i.maxSize[s]/n,i.offset[s]=i.offset[s]/n,i.factor[s]=i.factor[s]/n}let r;if(i.type[0]!==Ds.Undefined)r=0;else if(i.type[1]!==Ds.Undefined)r=1;else{if(i.type[2]===Ds.Undefined)return xr(t,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)i.type[s]===Ds.Undefined&&(i.minSize[s]=i.minSize[r],i.maxSize[s]=i.maxSize[r],i.offset[s]=i.offset[r],i.factor[s]=i.factor[r],i.type[s]=i.type[r]);return!0}function x3(i,e,t){i[4*e+0]=t.r/255,i[4*e+1]=t.g/255,i[4*e+2]=t.b/255,i[4*e+3]=t.a}function Uie(i,e,t){if(i.normalizationField)return xr(t,"Could not convert color info: unsupported property"),null;if(Hw(i.field)){if(!i.stops)return xr(t,"Could not convert color info: missing stops or colors"),null;{if(i.stops.length>8)return xr(t,"Could not convert color info: too many color stops"),null;e.color={field:i.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=i.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,x3(e.color.colors,s,n.color)}}}else{if(!(i.stops&&i.stops.length>=0))return xr(t,"Could not convert color info: no field and no colors/stops"),null;{const r=i.stops&&i.stops.length>=0&&i.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,x3(e.color.colors,s,r)}}return e}function Vie(i,e,t){if(i.normalizationField)return xr(t,"Could not convert opacity info: unsupported property"),null;if(Hw(i.field)){if(!i.stops)return xr(t,"Could not convert opacity info: missing stops or opacities"),null;{if(i.stops.length>8)return xr(t,"Could not convert opacity info: too many opacity stops"),null;e.opacity={field:i.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=i.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(i.stops&&i.stops.length>=0))return xr(t,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=i.stops&&i.stops.length>=0?i.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function WT(i,e,t){const r=t===2&&i.rotationType==="arithmetic";e.offset[t]=r?90:0,e.factor[t]=r?-1:1,e.type[t]=1}function Bie(i,e,t){if(!Hw(i.field))return xr(t,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(i.field)if(e.rotation.field){if(i.field!==e.rotation.field)return xr(t,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=i.field}else e.rotation={field:i.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(i.axis){case"tilt":return WT(i,e.rotation,0),e;case"roll":return WT(i,e.rotation,1),e;case null:case void 0:case"heading":return WT(i,e.rotation,2),e;default:return xr(t,`Could not convert rotation info: unknown axis "${i.axis}""`),null}}function E6(i,e,t){if(!i)return null;const r=!e.supportedTypes||!!e.supportedTypes.size,s=!e.supportedTypes||!!e.supportedTypes.color,n=!e.supportedTypes||!!e.supportedTypes.rotation,a=!!e.supportedTypes&&!!e.supportedTypes.opacity,o=i.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return xr(t,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?Fie(c,l,e,t):l;case"color":return s?Uie(c,l,t):l;case"opacity":return a?Vie(c,l,t):null;case"rotation":return n?Bie(c,l,t):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(i.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o&&o.size&&!Nie(o.size,e,t)?null:o:null}function uA(i){return i&&i.size!=null}function Gy(i,e){if(!i)return{enabled:!1};if(zt.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const t=E6(i.visualVariables,e);return t?{enabled:!0,visualVariables:t,materialParameters:S6(t,e),requiresShaderTransformation:uA(t)}:{enabled:!1}}function Hy(i,e,t){if(!e||!i.enabled)return!1;const r=i.visualVariables,s=E6(e.visualVariables,t);return!!s&&!!(wv(r.size,s.size,"size")&&wv(r.color,s.color,"color")&&wv(r.rotation,s.rotation,"rotation")&&wv(r.opacity,s.opacity,"opacity"))&&(i.visualVariables=s,i.materialParameters=S6(s,t),i.requiresShaderTransformation=uA(s),!0)}function wv(i,e,t){if(!!i!=!!e||i&&i.field!==e.field)return!1;if(i&&t==="rotation"){const r=i,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function S6(i,e){const t={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=uA(i);return i&&i.size?(t.vvSizeEnabled=!0,t.vvSizeMinSize=i.size.minSize,t.vvSizeMaxSize=i.size.maxSize,t.vvSizeOffset=i.size.offset,t.vvSizeFactor=i.size.factor):i&&r&&(t.vvSizeValue=e.transformation.scale),i&&r&&(t.vvSymbolAnchor=e.transformation.anchor,t.vvSymbolRotationMatrix=Bs(),pp(sy),$ie(e.transformation.rotation[2],e.transformation.rotation[0],e.transformation.rotation[1],sy),hh(t.vvSymbolRotationMatrix,sy)),i&&i.color&&(t.vvColorEnabled=!0,t.vvColorValues=i.color.values,t.vvColorColors=i.color.colors),i&&i.opacity&&(t.vvOpacityEnabled=!0,t.vvOpacityValues=i.opacity.values,t.vvOpacityOpacities=i.opacity.opacityValues),t}function xS(i,e,t){if(!i.vvSizeEnabled)return t;bs(Fh,t);const r=i.vvSymbolRotationMatrix;Y$(sy,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Sr(Fh,Fh,sy);for(let s=0;s<3;++s){const n=i.vvSizeOffset[s]+e[0]*i.vvSizeFactor[s];T3[s]=ie(n,i.vvSizeMinSize[s],i.vvSizeMaxSize[s])}return Q$(Fh,Fh,T3),dc(Fh,Fh,i.vvSymbolAnchor),Fh}function zie(i,e,t){if(!e.vvSizeEnabled)return Z(i,1,1,1);for(let r=0;r<3;++r){const s=e.vvSizeOffset[r]+t[0]*e.vvSizeFactor[r];i[r]=ie(s,e.vvSizeMinSize[r],e.vvSizeMaxSize[r])}return i}(function(i){i[i.Undefined=0]="Undefined",i[i.DefinedSize=1]="DefinedSize",i[i.DefinedScale=2]="DefinedScale"})(Ds||(Ds={})),function(i){i[i.Undefined=0]="Undefined",i[i.DefinedAngle=1]="DefinedAngle"}(b3||(b3={}));const Fh=ve(),T3=E(),sy=ve();let rg=class{constructor(e,t={}){this.geometry=e,this.boundingSphere=Xt(),this.screenToWorldRatio=1,this._transformation=ve(),this._shaderTransformationDirty=!0,this.id=Bf(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.boundingInfo=t.boundingInfo,this.shaderTransformer=t.shaderTransformer,this.castShadow=!!t.castShadow&&t.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,r=yp(e)){T(this.boundingInfo)||(Pe(t,this.boundingInfo.center,e),t[3]=this.boundingInfo.radius*r)}get hasShaderTransformation(){return _(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return T(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=ve()),bs(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const kie=ve(),C3=qe(0,0,1),Gie=16,Hie=1.5,rp=RG,qie=[rp/2,rp/2,1-rp/2,1-rp/2],Wie=[jP*rp,jP*rp];let TS=class R6 extends yc{getCachedSize(){return{size:this._getIconSize()}}constructor(e,t,r,s){super(e,t,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(_(r))this._prepareResourcesPrimitive(t,r);else{const s=g7(this.symbolLayer),n=C7(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(t,JSON.parse(n.data),e):await this._prepareResourcesHref(t,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=Bw(this._getIconSize());if(e)throw new ue("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(e.size!=null?Rn(e.size):Gie);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let r=t===""?null:this._cimSymbolTextures.get(t);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",s,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const a={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:j2.PAD};r=new yw(n.imageData,a),this._cimSymbolTextures.set(t,r),this._context.stage.add(r)}return r}_computeSize(e,t){const r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(jie(t)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:Rn(r),minWorldLength:s||0,maxWorldLength:_(n)?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(jT(t)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,_(this._context.sharedResources.textures)){const n=this._context.sharedResources.textures.fromData(`${t}-icon`,()=>SG(t));this._texture=n.texture,this._releaseTexture=n,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=qie;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/rp,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(_(this._context.sharedResources.textures)){const a=await yy(this._context.sharedResources.textures.fromUrl(t,n,{signal:r}));if(a.ok===!1)throw tB(a.error),new ue("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);this._releaseTexture=a.value;const o=a.value.texture,l=o.params;this._size=this._computeSize(l,s),e.textureId=o.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,r){const s=new AG({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await Y(()=>import("./CIMSymbolRasterizer-45c30c8c.js"),["./CIMSymbolRasterizer-45c30c8c.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./typedArrayUtil-bf9f210a.js","./ArrayPool-b51874dd.js","./string-53224faa.js","./Error-5cdd6e0a.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./promiseUtils-5940888c.js","./screenUtils-410d12c0.js","./cimAnalyzer-4cb8e677.js","./arcadeOnDemand-dd48afd7.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./jsonMap-ffa742d3.js","./nextTick-3ee5a785.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./BidiEngine-836b7ef6.js","./aaBoundingRect-2fb32e32.js","./jsonUtils-36bf3d33.js","./TileClipper-ae6eca9e.js","./enums-c655c737.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./vec2-848c6cf0.js","./vec2f32-eaf29605.js","./number-b10bd8f5.js","./floatRGBA-1f66d0a4.js","./_commonjsHelpers-2f3e7994.js","./imageutils-aac1ec05.js","./rasterizingUtils-2f530e4d.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js"],import.meta.url)).CIMSymbolRasterizer;Ti(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let a,o;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const u=h.scaleExpression,m=await d7(u,this._context.layer.spatialReference,n);o=(f,y,g)=>{const v=L7(m,f,{$view:g},"esriGeometryPoint",y);return v!==null?v:1}}else a=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=a||o||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Ti(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||v7}_getOutlineSize(){let e=0;const t=this.symbolLayer;return _(t.outline)&&t.outline.size!=null?Math.max(Rn(t.outline.size),0):(e=jT(this._getPrimitive())?Hie:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,r=ts(t,"outline","color");if(_(r)){const s=li.toUnitRGB(r),n=r.a*e;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(jT(this._getPrimitive()))return Eie;const e=T(this._getPrimitive()),t=ts(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return e==="relative"?ti((t.x||0)+.5,.5-(t.y||0)):e in M1?M1[e]:M1.center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=Gy(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=_(e.textureId)?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new tg(e),this._cimSymbolMaterials.set(Ze(e.textureId,0),r),t.add(r)),r}return this._material=new tg(e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=gr(this._releaseTexture)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=Rn(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,s=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const u=this._generateTextureCIM(t),m={textureId:u.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(m,this._context.stage),s=[u.params.width,u.params.height]}else s=this._size,r=Et(this._material);const n=zy(t.geometry);if(T(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const a=e.renderingInfo,o=this._getVertexOpacityAndColor(a);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const u=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(a,u)}l*=this._symbolTextureRatio;const c=ti(s[0]*l,s[1]*l),h=this.setGraphicElevationContext(t,new ml);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,n,r,o,c,e.layer.uid):this._createAs3DShape(t,n,r,o,c,h,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:t})})}layerElevationInfoChanged(e,t,r){const s=this._elevationContext.mode,n=g0(R6.elevationModeChangeTypes,r,s);if(n!==Gi.UPDATE)return n;const a=xo(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,t){for(const r in e.diff){if(r!=="visualVariables"||!Hy(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return Cr.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Cr.Fast_Update}_defaultElevationInfoNoZ(){return Xie}_createAs3DShape(e,t,r,s,n,a,o){const l=this.getFastUpdateAttrValues(e),c=l?g=>xS(this._fastUpdates.materialParameters,l,g):void 0,h=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:h}),m=XE(r,C3,null,s,n,Yie,null,l,u),f=iA(this._context,t,m,a,o,c);if(T(f))return null;const y=new _c(this,f.object,[m],null,null,Vy,a);return y.alignedSampledElevation=f.sampledElevation,y.needsElevationUpdates=xo(a.mode)||a.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(n,c),y.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(y.getScreenSize(),1,g),By(y,t,this._context.elevationProvider),y}_createAsOverlay(e,t,r,s,n,a){r.renderPriority=this._renderPriority;const o=Xt();xs(t,o,this._context.overlaySR),o[2]=cA;const l=this._context.clippingExtent;if(_(l)&&!q2(l,o))return null;const c=this.getFastUpdateAttrValues(e),h=c?g=>xS(this._fastUpdates.materialParameters,c,g):void 0,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),m=XE(r,C3,o,s,n,null,null,c,u),f=new rg(m,{layerUid:a,graphicUid:e.uid,shaderTransformer:h});o[3]=0,Sd(f.boundingSphere,o);const y=new Gw(this,[f],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(n,h),y.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(y.getScreenSize(),1,g),y}_createScreenSizeGetter(e,t){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(a=Ne())=>{const o=t(kie);return a[0]=o[0]*s+r,a[1]=o[5]*n+r,a}}{const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(a=Ne())=>(a[0]=s,a[1]=n,a)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=qe(e,e,e),r=KC(1),s=e*r;return{modelSize:t,symbolSize:qe(s,s,s),unitInMeters:r,transformation:{anchor:Va,scale:Cd,rotation:Va}}}_getGraphicHash(e){let t="";for(const r of this._cimRequiredFields)t+=r+e.attributes[r];return t}_forEachMaterial(e){_(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function jie(i){return i&&i.type==="point-3d"&&i.hasVisibleVerticalOffset()}function jT(i){return!T(i)&&(i==="cross"||i==="x")}TS.PRIMITIVE_SIZE=Wie,TS.elevationModeChangeTypes={definedChanged:Gi.UPDATE,staysOnTheGround:Gi.NONE,onTheGroundChanged:Gi.RECREATE};const Xie={mode:"relative-to-ground",offset:0},Yie=Ai(0,0,0,1);function CS(i){switch(i){case"butt":return Rf.BUTT;case"square":return Rf.SQUARE;case"round":return Rf.ROUND;default:return null}}function Qie(i){return i==="diamond"?"kite":i}function ES(i,e,t=null){const r=[],s=[],n=e.mapPositions;Zie(e,s,r);const a=s[0][1].data,o=r[0][1].length,l=new Array(o).fill(0);return Kie(e,s,r,l),tre(e,s,r,l),Jie(e,s,r,l),ere(e,s,r,l),ire(e,s,r,l),rre(e,s,r,l),sre(e,s,r,a),new Vr(i,s,r,n,Ns.Line,t)}function Zie(i,e,t){const{attributeData:{position:r},removeDuplicateStartEnd:s}=i,n=nre(r)&&s,a=r.length/3-(n?1:0),o=new Array(2*(a-1)),l=n?r.slice(0,r.length-3):r;let c=0;for(let h=0;h<a-1;h++)o[c++]=h,o[c++]=h+1;e.push([C.POSITION,new Ae(l,3,n)]),t.push([C.POSITION,o])}function Kie(i,e,t,r){if(_(i.attributeData.colorFeature))return;const s=i.attributeData.color;e.push([C.COLOR,new Ae(Ze(s,Yo),4)]),t.push([C.COLOR,r])}function Jie(i,e,t,r){if(!_(i.attributeData.normal))return;const s=i.attributeData.normal;e.push([C.NORMAL,new Ae(s,3)]),t.push([C.NORMAL,r])}function ere(i,e,t,r){const s=i.attributeData.colorFeature;T(s)||(e.push([C.COLORFEATUREATTRIBUTE,new Ae([s],1,!0)]),t.push([C.COLOR,r]))}function tre(i,e,t,r){if(_(i.attributeData.sizeFeature))return;const s=i.attributeData.size;e.push([C.SIZE,new Ae([Ze(s,1)],1,!0)]),t.push([C.SIZE,r])}function ire(i,e,t,r){const s=i.attributeData.sizeFeature;T(s)||(e.push([C.SIZEFEATUREATTRIBUTE,new Ae([s],1,!0)]),t.push([C.SIZEFEATUREATTRIBUTE,r]))}function rre(i,e,t,r){const s=i.attributeData.opacityFeature;T(s)||(e.push([C.OPACITYFEATUREATTRIBUTE,new Ae([s],1,!0)]),t.push([C.OPACITYFEATUREATTRIBUTE,r]))}function sre(i,e,t,r){if(T(i.overlayInfo)||i.overlayInfo.renderCoordsHelper.viewingMode!==Se.Global||!i.overlayInfo.spatialReference.isGeographic)return;const s=vo(r.length),n=qt(i.overlayInfo.spatialReference);for(let m=0;m<s.length;m+=3)N$(r,m,s,m,n);const a=r.length/3,o=ir(a+1);let l=are,c=ore,h=0,u=0;Z(l,s[u++],s[u++],s[u++]),o[0]=0;for(let m=1;m<a+1;++m)m===a&&(u=0),Z(c,s[u++],s[u++],s[u++]),h+=az(l,c),o[m]=h,[l,c]=[c,l];e.push([C.DISTANCETOSTART,new Ae(o,1,!0)]),t.push([C.DISTANCETOSTART,t[0][1]])}function nre(i){const e=i.length;return i[0]===i[e-3]&&i[1]===i[e-2]&&i[2]===i[e-1]}const are=E(),ore=E();function jwe(i,e){if(T(i)||i.length===0)return[];const t=[];return i.forEach(r=>{const s=r.length,n=vo(3*s);r.forEach((o,l)=>{n[3*l+0]=o[0],n[3*l+1]=o[1],n[3*l+2]=o[2]});const a={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};t.push(a)}),t}function lre(i,e,t,r){const s=i.type==="polygon"?Wf.CCW_IS_HOLE:Wf.NONE,n=i.type==="polygon"?i.rings:i.paths,{position:a,outlines:o}=_w(n,!!i.hasZ,s),l=vo(a.length),c=P9(a,i.spatialReference,0,l,0,a,0,a.length/3,e,t,r),h=c!=null;return{lines:h?A6(o,a,l):[],projectionSuccess:h,sampledElevation:c}}function cre(i,e){const t=i.type==="polygon"?Wf.CCW_IS_HOLE:Wf.NONE,r=i.type==="polygon"?i.rings:i.paths,{position:s,outlines:n}=_w(r,!1,t),a=In(s,i.spatialReference,0,s,e,0,s.length/3);for(let o=2;o<s.length;o+=3)s[o]=cA;return{lines:a?A6(n,s):[],projectionSuccess:a}}function A6(i,e,t=null){const r=new Array;for(const{index:s,count:n}of i){if(n<=1)continue;const a=3*s,o=3*n;r.push({position:rl(e,3*s,3*n),mapPositions:_(t)?rl(t,a,o):void 0})}return r}const P6=new Map([[C.POSITION,0],[C.UV0,2],[C.AUXPOS1,3],[C.NORMAL,4],[C.COLOR,5],[C.COLORFEATUREATTRIBUTE,5],[C.SIZE,6],[C.SIZEFEATUREATTRIBUTE,6],[C.OPACITYFEATUREATTRIBUTE,7]]);let O6=class M6 extends Wt{initializeProgram(e){return new Gt(e.rctx,M6.shader.get().build(this.configuration),P6)}_makePipelineState(e,t){const r=this.configuration,s=e===It.NONE;return it({blending:r.output===$.Color||r.output===$.Alpha?s?go:Qd(e):null,depthTest:{func:Lp(e)},depthWrite:s?r.writeDepth?ka:null:gw(e),colorWrite:ut,stencilWrite:r.hasOccludees?dh:null,stencilTest:r.hasOccludees?t?fp:$p:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=it({blending:go,depthTest:cb,depthWrite:null,colorWrite:ut,stencilWrite:null,stencilTest:JF}),this._occluderPipelineOpaque=it({blending:go,depthTest:cb,depthWrite:null,colorWrite:ut,stencilWrite:e5,stencilTest:t5}),this._occluderPipelineMaskWrite=it({blending:null,depthTest:U2,depthWrite:null,colorWrite:null,stencilWrite:dh,stencilTest:fp})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===ne.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===ne.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}};O6.shader=new jt(PG,()=>Y(()=>import("./LineMarker.glsl-c28f3cc6.js"),["./LineMarker.glsl-c28f3cc6.js","./string-53224faa.js","./typedArrayUtil-bf9f210a.js","./floatRGBA-1f66d0a4.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Texture-ae652f15.js","./compilerUtils-7bf6df9e.js","./Error-5cdd6e0a.js","./Evented-686173eb.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./request-09e7d9b2.js","./preload-helper-41c905a7.js","./TextureOnly.glsl-469cc321.js","./vec4f64-6d0e93be.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ShaderBuilder-be7ca791.js","./VertexAttribute-15d1866a.js","./Float4PassUniform-9354414b.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./basicInterfaces-7449a8bf.js","./assets-94d592bf.js","./enums-fc527c7c.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./mat3f64-50f3b9f6.js","./aaBoundingBox-fb003858.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Matrix3PassUniform-df6e2166.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./mat4-f0dc8788.js","./MarkerSizing.glsl-950a18f6.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./FloatPassUniform-0426669b.js","./sdfPrimitives-3ceeab79.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./TransparencyPassType-c3841b0a.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./LineMarker.glsl-2c017de2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Slice.glsl-cd30f0ea.js","./OutputDepth.glsl-17bf0574.js","./RgbaFloatEncoding.glsl-67199794.js","./MultipassTerrainTest.glsl-8b279fcd.js","./ReadLinearDepth.glsl-0e6f5c47.js","./AlphaCutoff-96178e0d.js"],import.meta.url));let hre=class extends Mp{constructor(e){super(e,new ure),this._vertexAttributeLocations=P6,this._configuration=new dG,this._layout=this.createLayout()}dispose(){}getConfiguration(e,t){return this._configuration.output=e,this._configuration.space=t.slot===ne.DRAPED_MATERIAL?yx.Draped:this.parameters.worldSpace?yx.World:yx.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Rf.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===hr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Rr().vec3f(C.POSITION).vec2f(C.UV0).vec3f(C.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(C.NORMAL),this.parameters.vvSizeEnabled?e.f32(C.SIZEFEATUREATTRIBUTE):e.f32(C.SIZE),this.parameters.vvColorEnabled?e.f32(C.COLORFEATUREATTRIBUTE):e.vec4f(C.COLOR),this.parameters.vvOpacityEnabled&&e.f32(C.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new pre(this._layout,this.parameters)}requiresSlot(e,t){return t===$.Color||t===$.Alpha||t===$.Highlight||t===$.Depth?e===ne.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===hr.OccludeAndTransparentStencil?e===ne.OPAQUE_MATERIAL||e===ne.OCCLUDER_MATERIAL||e===ne.TRANSPARENT_OCCLUDER_MATERIAL:t===$.Color||t===$.Alpha?e===(this.parameters.writeDepth?ne.TRANSPARENT_MATERIAL:ne.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===ne.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new dre(e)}},dre=class extends QF{_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(O6,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==$.Color&&this._output!==$.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},ure=class extends DF{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Rf.BUTT,this.anchor=f5.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}},pre=class{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,t,r,s,n){const a=r.vertexAttributes.get(C.POSITION).data,o=a.length/3;let l=[1,0,0];const c=r.vertexAttributes.get(C.NORMAL);this._parameters.worldSpace&&_(c)&&(l=c.data);let h=1,u=0;this._parameters.vvSizeEnabled?u=r.vertexAttributes.get(C.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(C.SIZE)&&(h=r.vertexAttributes.get(C.SIZE).data[0]);let m=[1,1,1,1],f=0;this._parameters.vvColorEnabled?f=r.vertexAttributes.get(C.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(C.COLOR)&&(m=r.vertexAttributes.get(C.COLOR).data);let y=0;this._parameters.vvOpacityEnabled&&(y=r.vertexAttributes.get(C.OPACITYFEATUREATTRIBUTE).data[0]);const g=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(P,A,M,O)=>{if(g[v++]=P[0],g[v++]=P[1],g[v++]=P[2],g[v++]=M[0],g[v++]=M[1],g[v++]=A[0],g[v++]=A[1],g[v++]=A[2],this._parameters.worldSpace&&(g[v++]=l[0],g[v++]=l[1],g[v++]=l[2]),this._parameters.vvSizeEnabled?g[v++]=u:g[v++]=h,this._parameters.vvColorEnabled)g[v++]=f;else{const I=Math.min(4*O,m.length-4);g[v++]=m[I+0],g[v++]=m[I+1],g[v++]=m[I+2],g[v++]=m[I+3]}this._parameters.vvOpacityEnabled&&(g[v++]=y)};let x;(function(P){P[P.ASCENDING=1]="ASCENDING",P[P.DESCENDING=-1]="DESCENDING"})(x||(x={}));const w=(P,A)=>{const M=Z(mre,a[3*P],a[3*P+1],a[3*P+2]),O=fre;let I=P+A;do Z(O,a[3*I],a[3*I+1],a[3*I+2]),I+=A;while(dp(M,O)&&I>=0&&I<o);e&&(Pe(M,M,e),Pe(O,O,e)),b(M,O,[-1,-1],P),b(M,O,[1,-1],P),b(M,O,[1,1],P),b(M,O,[-1,-1],P),b(M,O,[1,1],P),b(M,O,[-1,1],P)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||w(0,x.ASCENDING),S!=="end"&&S!=="begin-end"||w(o-1,x.DESCENDING)}};const mre=E(),fre=E(),Ps={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},gre={dash:Ps.dash,"dash-dot":[...Ps.dash,...Ps.dot],dot:Ps.dot,"long-dash":Ps["long-dash"],"long-dash-dot":[...Ps["long-dash"],...Ps.dot],"long-dash-dot-dot":[...Ps["long-dash"],...Ps.dot,...Ps.dot],none:null,"short-dash":Ps["short-dash"],"short-dash-dot":[...Ps["short-dash"],...Ps["short-dot"]],"short-dash-dot-dot":[...Ps["short-dash"],...Ps["short-dot"],...Ps["short-dot"]],"short-dot":Ps["short-dot"],solid:null},_re=8;function yre(i,e=2){return T(i)?i:{pattern:i.slice(),pixelRatio:e}}function Kwe(i,e=2){return{pattern:[i,i],pixelRatio:e}}function I6(i){return _(i)&&i.type==="style"?vre(i.style):null}function vre(i){return _(i)?yre(gre[i],_re):null}const bre=["polyline","polygon","extent"];let D6=class L6 extends yc{constructor(e,t,r,s){super(e,t,r,s)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Gy(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:KC(1))<0)throw new ue("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=_(this.symbolLayer.marker)&&_(this._context.sharedResources.textures)?uG(this._context.sharedResources.textures,Qie(this.symbolLayer.marker.style)):null}_getMaterialParameters(e,t=!1){var n;const r=this._getCombinedOpacityAndColor(t&&this._markerColor||this._materialColor);this._patternHidesLine&&!t&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:CS(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:I6(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return sa(this.symbolLayer.material,e=>e.color)}get _markerColor(){return sa(this.symbolLayer.marker,e=>e.color)}get _lineMaterial(){return T(this._lineMaterialCached)&&(this._lineMaterialCached=new vf(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return T(this._ringMaterialCached)&&(this._ringMaterialCached=new vf(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return T(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new vf({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return T(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new vf({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return T(this._markerMaterialCached)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterialCached=new hre({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=gr(this._markerTexture)}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Rn(yte(e.size)):1}_getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?sh(this._fastUpdates.visualVariables.size.field,e):null}_getDrivenColor(e){const t=Ai(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}_getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?sh(this._fastUpdates.visualVariables.color.field,e):null}_getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?sh(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,bre,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new ml);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}applyRendererDiff(e,t){for(const r in e.diff){if(r!=="visualVariables"||!Hy(this._fastUpdates,t,this._vvConvertOptions))return Cr.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return Cr.Fast_Update}prepareSymbolLayerPatch(e){var n,a;if(e.diff.type!=="partial")return;const t=e.diff.diff,r={};((n=t.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(t.size.newValue),delete t.size),((a=t.cap)==null?void 0:a.type)==="complete"&&(r.cap=CS(Ze(t.cap.newValue,"butt")),delete t.cap);const s=this._prepareMarkerPatch(e,t);this._prepareMaterialPatch(e,t,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(o=>o.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,t)=>this._updateMaterialLayerOpacity(e,t))}_forEachMaterial(e){_(this._lineMaterialCached)&&e(this._lineMaterialCached),_(this._ringMaterialCached)&&e(this._ringMaterialCached),_(this._wireframeLineMaterialCached)&&e(this._wireframeLineMaterialCached),_(this._wireframeRingMaterialCached)&&e(this._wireframeRingMaterialCached),_(this._markerMaterialCached)&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,t=!1){const r=e.parameters.color,s=ts(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!t?0:this._getCombinedOpacity(s),a=Ai(r[0],r[1],r[2],n);e.setParameters({color:a})}layerElevationInfoChanged(e,t,r){const s=this._elevationContext.mode,n=g0(L6.elevationModeChangeTypes,r,s);if(n!==Gi.UPDATE)return n;const a=xo(s);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(t=>t.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof ms)return S2.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,t,r){const s=e.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),a=n.type==="polygon"?n.rings:n.paths,o=new Array,l=zs(),c=lre(n,this._context.elevationProvider,this._context.renderCoordsHelper,t),h=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,a,h,"LineSymbol3DLayer");for(let f=0;f<c.lines.length;f++){const y=c.lines[f],g=y.position,v=y.mapPositions;if(_(this._context.clippingExtent)&&(Pi(l),Ua(l,v),!Jo(l,this._context.clippingExtent)))continue;const b=this._createGeometry(n.type==="polygon"?this._ringMaterial:this._lineMaterial,e,g,v,n.type,ny.ELEVATED,r);o.push(b),zt.LINE_WIREFRAMES&&o.push(b.instantiate({material:n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),_(this._markerMaterial)&&o.push(b.instantiate({material:this._markerMaterial}))}if(o.length===0)return null;const u=new bh({geometries:o,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),m=new _c(this,u,o,null,null,kee,t);return m.alignedSampledElevation=c.sampledElevation,m.needsElevationUpdates=xo(t.mode),m}_createGeometry(e,t,r,s,n,a,o){const l=n==="polygon",c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,h=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid});return ES(e,{overlayInfo:a===ny.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:l,mapPositions:s,attributeData:{position:r,size:h?null:this._getDrivenSize(t.renderingInfo),color:c?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}},u)}_createAsOverlay(e,t){const r=e.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,a=s.type==="polygon"?this._ringMaterial:this._lineMaterial;a.renderPriority=this._renderPriority;const o=zt.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;_(o)&&(o.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=zs(),u=Pi(),m=cre(s,this._context.overlaySR),f=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(m,n,f,"LineSymbol3DLayer");for(const y of m.lines){if(Pi(h),Ua(h,y.position),!Jo(h,this._context.clippingExtent))continue;Xf(u,h);const g=b=>{const x=this._createGeometry(b,e,y.position,void 0,s.type,ny.DRAPED,r.uid),w=new rg(x,{layerUid:t,graphicUid:r.uid});return c.push(w),w};if(_(l)){const b=g(l),x=Et(this.symbolLayer.marker).placement;x!=="begin"&&x!=="begin-end"||Ua(h,y.position,0,1),x!=="end"&&x!=="begin-end"||Ua(h,y.position,y.position.length-3,1),this._updateBoundingSphere(b,h)}const v=g(a);if(this._updateBoundingSphere(v,h),zt.LINE_WIREFRAMES){const b=g(o);this._updateBoundingSphere(b,h)}}return new Gw(this,c,u,this._context.drapeSourceRenderer)}_updateBoundingSphere(e,t){Vs(e.boundingSphere,.5*(t[0]+t[3]),.5*(t[1]+t[4]),0,.5*Math.sqrt((t[3]-t[0])*(t[3]-t[0])+(t[4]-t[1])*(t[4]-t[1])))}get _patternHidesLine(){const e=this.symbolLayer.pattern;return _(e)&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){return e=Ze(e,KC(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Rn(1):1:Rn(e)}_prepareMaterialPatch(e,t,r){var o;const s=t.material;if(T(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(s.type==="collection")return;const n=s.type==="complete"?sa(s.newValue,l=>l.color):((o=s.diff.color)==null?void 0:o.type)==="complete"?s.diff.color.newValue:null,a=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(dw(a),this._markerMaterialCached,e),this._patternHidesLine&&(a[3]=0),this._patchMaterialColor(a,this._lineMaterialCached,e),delete t.material}_prepareMarkerPatch(e,t){const r=t.marker;if(T(r)||r.type!=="partial"||_(r.diff.style)||_(r.diff.placement)||_(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:T(this._markerColor)};const s=r.diff.color;if(T(s))return delete t.marker,{changed:!1,useMaterialColor:T(this._markerColor)};const n=Et(s.newValue);return T(n)?(delete t.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,e),delete t.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(e,t,r){T(t)||r.symbolLayerStatePatches.push(()=>t.setParameters({color:e}))}};var ny;D6.elevationModeChangeTypes={definedChanged:Gi.RECREATE,staysOnTheGround:Gi.NONE,onTheGroundChanged:Gi.RECREATE},function(i){i[i.DRAPED=0]="DRAPED",i[i.ELEVATED=1]="ELEVATED"}(ny||(ny={}));let $6=class F6 extends Wt{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==$.Highlight}initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,F6.shader.get().build(this.configuration),Zt)}initializePipeline(){const e=this.configuration,t=os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),r=(s,n=null,a=null)=>it({blending:n,depthTest:U2,depthWrite:a,colorWrite:ut,stencilWrite:e.hasOccludees?dh:null,stencilTest:e.hasOccludees?s?fp:$p:null});return e.output===$.Color?(this._occludeePipelineState=r(!0,e.transparent||this._stippleEnabled?t:null,ka),r(!1,e.transparent||this._stippleEnabled?t:null,ka)):r(!1)}get primitiveType(){return bt.LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}};$6.shader=new jt(MG,()=>Y(()=>import("./NativeLine.glsl-e46f4dab.js"),["./NativeLine.glsl-e46f4dab.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./vec4f64-6d0e93be.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./LineStipple.glsl-4eef2aea.js","./RgbaFloatEncoding.glsl-67199794.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Float4PassUniform-9354414b.js","./FloatPassUniform-0426669b.js","./floatRGBA-1f66d0a4.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./enums-fc527c7c.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./NativeLine.glsl-9893bc56.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./VertexColor.glsl-2f905a78.js","./OutputHighlight.glsl-ca02d1ee.js","./AlphaCutoff-96178e0d.js"],import.meta.url));let Ta=class extends gc{constructor(){super(...arguments),this.output=$.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};d([L({count:$.COUNT})],Ta.prototype,"output",void 0),d([L()],Ta.prototype,"hasSlicePlane",void 0),d([L()],Ta.prototype,"hasVertexColors",void 0),d([L()],Ta.prototype,"transparent",void 0),d([L()],Ta.prototype,"draped",void 0),d([L()],Ta.prototype,"stippleEnabled",void 0),d([L()],Ta.prototype,"stippleOffColorEnabled",void 0),d([L()],Ta.prototype,"stipplePreferContinuous",void 0),d([L()],Ta.prototype,"hasOccludees",void 0),d([L({constValue:!1})],Ta.prototype,"stippleRequiresClamp",void 0),d([L({constValue:!1})],Ta.prototype,"stippleScaleWithLineWidth",void 0),d([L({constValue:!1})],Ta.prototype,"stippleRequiresStretchMeasure",void 0);var Gb;(function(i){i[i.START=0]="START",i[i.END=1]="END"})(Gb||(Gb={}));let E3=class extends Mp{constructor(e){super(e,new Tre),this._configuration=new Ta}getConfiguration(e,t){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=t.slot===ne.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern);return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,t,r,s,n,a){if(!r.options.selectionMode||!e.visible)return;if(!s5(t))return void pe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const o=e.vertexAttributes.get(C.POSITION).data,l=r.camera,c=Ere;as(c,r.point);const h=2;Z(Gg[0],c[0]-h,c[1]+h,0),Z(Gg[1],c[0]+h,c[1]+h,0),Z(Gg[2],c[0]+h,c[1]-h,0),Z(Gg[3],c[0]-h,c[1]-h,0);for(let g=0;g<4;g++)if(!l.unprojectFromRenderScreen(Gg[g],Mc[g]))return;ec(l.eye,Mc[0],Mc[1],XT),ec(l.eye,Mc[1],Mc[2],YT),ec(l.eye,Mc[2],Mc[3],QT),ec(l.eye,Mc[3],Mc[0],ZT);let u=Number.MAX_VALUE,m=0;for(let g=0;g<o.length-5;g+=3){if(Ws[0]=o[g]+t[12],Ws[1]=o[g+1]+t[13],Ws[2]=o[g+2]+t[14],js[0]=o[g+3]+t[12],js[1]=o[g+4]+t[13],js[2]=o[g+5]+t[14],ji(XT,Ws)<0&&ji(XT,js)<0||ji(YT,Ws)<0&&ji(YT,js)<0||ji(QT,Ws)<0&&ji(QT,js)<0||ji(ZT,Ws)<0&&ji(ZT,js)<0)continue;if(l.projectToRenderScreen(Ws,mu),l.projectToRenderScreen(js,fu),mu[2]<0&&fu[2]>0){ee(wl,Ws,js);const b=l.frustum,x=-ji(b[Ki.NEAR],Ws)/oe(wl,Js(b[Ki.NEAR]));W(wl,wl,x),J(Ws,Ws,wl),l.projectToRenderScreen(Ws,mu)}else if(mu[2]>0&&fu[2]<0){ee(wl,js,Ws);const b=l.frustum,x=-ji(b[Ki.NEAR],js)/oe(wl,Js(b[Ki.NEAR]));W(wl,wl,x),J(js,js,wl),l.projectToRenderScreen(js,fu)}else if(mu[2]<0&&fu[2]<0)continue;mu[2]=0,fu[2]=0;const v=x2(ap(mu,fu,A3),c);v<u&&(u=v,X(S3,Ws),X(R3,js),m=g/3)}const f=r.rayBegin,y=r.rayEnd;if(u<h*h){let g=Number.MAX_VALUE;if(K$(ap(S3,R3,A3),ap(f,y,Cre),pu)){ee(pu,pu,f);const v=xe(pu);W(pu,pu,1/v),g=v/Ni(f,y)}a(g,pu,m,!1)}}intersectDraped(e,t,r,s,n,a){if(!r.options.selectionMode)return;const o=e.vertexAttributes.get(C.POSITION).data,l=e.vertexAttributes.get(C.SIZE),c=l?l.data[0]:0,h=s[0],u=s[1],m=((c+1)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,y=0;for(let g=0;g<o.length-5;g+=3){const v=o[g],b=o[g+1],x=h-v,w=u-b,S=o[g+3]-v,P=o[g+4]-b,A=ie((S*x+P*w)/(S*S+P*P),0,1),M=S*A-x,O=P*A-w,I=M*M+O*O;I<f&&(f=I,y=g/3)}f<m*m&&n(a.dist,a.normal,y,!1)}requiresSlot(e,t){return!(t!==$.Color&&t!==$.Highlight&&t!==$.ObjectAndLayerIdColor||e!==ne.OPAQUE_MATERIAL&&e!==ne.DRAPED_MATERIAL)}createGLMaterial(e){return new wre(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?h6:Yte;return T(this.parameters.stipplePattern)?new u0(e):new xre(e.clone().vec3f(C.AUXPOS1).vec2f(C.UV0))}},wre=class extends Dp{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===$.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique($6,e)}},xre=class{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(C.POSITION).length}write(e,t,r,s,n){dk(r,this.vertexBufferLayout,e,t,s,n),this._writeAuxpos1(e,r,s,n),this._writeUV0(e,r,s,n)}_writeAuxpos1(e,t,r,s){const n=r.getField(C.AUXPOS1,Hd),a=t.indices.get(C.POSITION),o=t.vertexAttributes.get(C.POSITION).data,l=e,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let u=0;u<a.length-1;u+=2)for(const m of[1,0]){const f=3*a[u+m],y=o[f],g=o[f+1],v=o[f+2],b=l[0]*y+l[4]*g+l[8]*v+l[12],x=l[1]*y+l[5]*g+l[9]*v+l[13],w=l[2]*y+l[6]*g+l[10]*v+l[14];h[s]=b,h[s+1]=x,h[s+2]=w,s+=c}}_writeUV0(e,t,r,s){var w;const n=r.getField(C.UV0,h5),a=t.indices.get(C.POSITION),o=t.vertexAttributes.get(C.POSITION).data,l=(w=t.vertexAttributes.get(C.DISTANCETOSTART))==null?void 0:w.data,c=n.typedBufferStride,h=n.typedBuffer;let u=0;h[s*=c]=Gb.START,h[s+1]=u,s+=c;const m=3*a[0],f=Z(Ws,o[m],o[m+1],o[m+2]);e&&Pe(f,f,e);const y=js,g=a.length-1;let v=1;const b=l?(S,P,A)=>u=l[A]:(S,P,A)=>u+=Ni(S,P);for(let S=1;S<g;S+=2){const P=3*a[S];Z(y,o[P],o[P+1],o[P+2]),e&&Pe(y,y,e),b(f,y,v++);for(let A=0;A<2;++A)h[s]=1-A,h[s+1]=u,s+=c;X(f,y)}const x=3*a[g];Z(y,o[x],o[x+1],o[x+2]),e&&Pe(y,y,e),b(f,y,v),h[s]=Gb.END,h[s+1]=u}},Tre=class extends h0{constructor(){super(...arguments),this.color=Yo,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Ws=E(),js=E(),wl=E(),pu=E(),mu=_s(),fu=_s(),S3=E(),R3=E(),A3=ag(),Cre=ag(),Ere=E(),Gg=[_s(),_s(),_s(),_s()],Mc=[E(),E(),E(),E()],XT=sr(),YT=sr(),QT=sr(),ZT=sr(),Sre=["mesh"];class Rre extends yc{constructor(e,t,r,s){super(e,t,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){zt.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new E3({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new E3({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Sre,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(t,new ml),s=e.renderingInfo;return this._createAs3DShape(t,s,r,t.uid)}layerOpacityChanged(e,t){const r=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{const n=t(s);_(n)&&n.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Xd)}slicePlaneEnabledChanged(e,t){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{const s=t(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(t=>t.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return T(e)?"-":e instanceof li?e.toHex():e.contentHash}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${t},svc:${r}`}}_materialProperties(e,t,r){const s=this._materialPropertiesDefault(e,r);if(!t.material)return s;const{color:n,colorTexture:a,normalTexture:o,doubleSided:l,alphaCutoff:c,alphaMode:h}=t.material,u=this._colorOrTextureUid(n),m=this._colorOrTextureUid(a),f=this._colorOrTextureUid(o);if(s.color=n,s.colorTexture=a,s.normalTexture=o,s.uid=`${s.uid},cmuid:${u},ctmuid:${m},ntmuid:${f},ds:${l},ac:${c},am:${h}`,t.material instanceof Pk){const{metallic:y,roughness:g,metallicRoughnessTexture:v,emissiveColor:b,emissiveTexture:x,occlusionTexture:w}=t.material,S=this._colorOrTextureUid(v),P=this._colorOrTextureUid(b),A=this._colorOrTextureUid(x),M=this._colorOrTextureUid(w);s.metallic=y,s.roughness=g,s.metallicRoughnessTexture=v,s.emissiveColor=b,s.emissiveTexture=x,s.occlusionTexture=w,s.colorTextureTransform=t.material.colorTextureTransform,s.normalTextureTransform=t.material.normalTextureTransform,s.emissiveTextureTransform=t.material.emissiveTextureTransform,s.occlusionTextureTransform=t.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=t.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${y},mrr:${g},mrt:${S},emuid:${P},etmuid:${A},otmuid:${M}`}return s}_setInternalColorValueParameters(e,t){t.diffuse=li.toUnitRGB(e),t.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const t=this._getInternalTexture(e,Oa.Opaque);return _(t)?t.id:null}_getInternalTexture(e,t){const r=this._getLoadableTextureResource(e);if(!r)return null;const s=`${e.contentHash}/${t}`;let n=this._textures.get(s);return n||(n=new yw(vx(r)?r.data:r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!vx(r)&&t!==Oa.Opaque,encoding:vx(r)&&_(r.encoding)?r.encoding:void 0}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(e="repeat"){if(typeof e=="string"){const t=this._castTextureWrapIndividual(e);return{s:t,t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Dt.CLAMP_TO_EDGE;case"mirror":return Dt.MIRRORED_REPEAT;default:return Dt.REPEAT}}_setInternalMaterialParameters(e,t){if(_(e.color)&&this._setInternalColorValueParameters(e.color,t),_(e.colorTexture)){const r=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);_(r)?(t.textureId=r.id,t.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):t.textureId=void 0}_(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),_(e.emissiveColor)&&(t.emissiveFactor=li.toUnitRGB(e.emissiveColor)),_(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),_(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),_(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),t.colorTextureTransformMatrix=wg(e.colorTextureTransform),t.normalTextureTransformMatrix=wg(e.normalTextureTransform),t.occlusionTextureTransformMatrix=wg(e.occlusionTextureTransform),t.emissiveTextureTransformMatrix=wg(e.emissiveTextureTransform),t.metallicRoughnessTextureTransformMatrix=wg(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let r=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=Yo;else{const s=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(s)?e.externalColor=li.toUnitRGBA(s):(r=null,e.externalColor=Yo)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if(T(t))return!1;for(let r=3;r<t.length;r+=4)if(t[r]!==255)return!0;return!1}_getOrCreateMaterial(e,t){var y,g,v;const r=(y=t.material)==null?void 0:y.color,s=(g=t.material)==null?void 0:g.colorTexture,n=(v=t.material)==null?void 0:v.alphaMode,a=n==="blend",o=n!=="opaque"&&(this._hasTransparentVertexColors(e)||_(r)&&r.a<1||_(s)&&s.transparent||a),l=this._materialProperties(e,t,o),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:o,alphaMode:t.material?t.material.alphaMode:"opaque"},u=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,m={usePBR:this._usePBR(),isSchematic:u,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Va,diffuse:Cd,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Fr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};u||(m.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),t.material&&(m.doubleSided=t.material.doubleSided,m.cullFace=t.material.doubleSided?Fr.None:Fr.Back,m.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(m),this._setMaterialTransparentParameter(m,h),this._setInternalMaterialParameters(l,m);const f=new Ty(m);return h.material=f,this._materials.set(l.uid,h),this._context.stage.add(f),f}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,t.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Oa.MaskBlend:Oa.Opaque:e.textureAlphaMode=t.alphaMode==="opaque"?Oa.Opaque:t.alphaMode==="mask"?Oa.Mask:Oa.Blend}_addDebugNormals(e,t){const r=t.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),a=[],o=[],l=[],c=[];for(let f=0;f<r;f++){const y=t[f],g=y.vertexAttributes.get(C.POSITION),v=y.vertexAttributes.get(C.NORMAL),b=y.indices.get(C.POSITION),x=y.indices.get(C.NORMAL),w=g.data,S=v.data;for(let P=0;P<b.length;P++){const A=3*b[P],M=3*x[P];for(let O=0;O<3;O++)a.push(w[A+O]);for(let O=0;O<3;O++)a.push(w[A+O]+S[M+O]*n);if(o.push(o.length),o.push(o.length),P%3==0){this._calculateFaceNormal(w,b,P,Cm),this._getFaceVertices(w,b,P,ds,xm,Tm),J(ds,ds,xm),J(ds,ds,Tm),W(ds,ds,1/3);for(let O=0;O<3;O++)l.push(ds[O]);for(let O=0;O<3;O++)l.push(ds[O]+Cm[O]*n);c.push(c.length),c.push(c.length)}}}const h=t[0].transformation,u=new Vr(this._debugVertexNormalMaterial,[[C.POSITION,new Ae(a,3,!0)]],[[C.POSITION,o]],null,Ns.Line);t.push(u),u.transformation=h;const m=new Vr(this._debugFaceNormalMaterial,[[C.POSITION,new Ae(l,3,!0)]],[[C.POSITION,c]],null,Ns.Line);m.transformation=h,t.push(m)}_createAs3DShape(e,t,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const a=this._createGeometryInfo(n,t,s);if(T(a))return null;const{geometries:o,objectTransformation:l}=a;zt.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,o);const c=new bh({geometries:o,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});c.transformation=l;const h=d5(this.symbolLayer,{opacity:this._getLayerOpacity()}),u=_(h)?new Yee(o[0].material,[h],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,m=new _c(this,c,o,null,null,Vy,r,u);m.needsElevationUpdates=Xd(r.mode),m.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c);const{elevationProvider:f,renderCoordsHelper:y}=this._context,g=(v,b)=>pg(v,f,r,y,b);return m.alignedSampledElevation=Vy(m,r,f.spatialReference,g,y),m}_getCenterPointInElevationSR(e){const t=yh(0,0,0,_(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return U$([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,r,s){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,t,r,s);case"flat":return this._createComponentNormalsFlat(e,s);case"smooth":return this._createComponentNormalsSmooth(e,s)}}_createComponentNormalsSource(e,t,r,s){if(T(t))return this._createComponentNormalsFlat(e,s);let n=!1;if(!r.trustSourceNormals)for(let a=0;a<s.length;a+=3){this._calculateFaceNormal(e,s,a,Cm);for(let o=0;o<3;o++){const l=3*s[a+o];ds[0]=t[l+0],ds[1]=t[l+1],ds[2]=t[l+2],oe(Cm,ds)<0&&(t[l+0]=-t[l+0],t[l+1]=-t[l+1],t[l+2]=-t[l+2],n=!0)}}return new KT(t,s,n)}_createComponentNormalsFlat(e,t){const r=ir(t.length),s=new Array(3*t.length);for(let n=0;n<t.length;n+=3){const a=this._calculateFaceNormal(e,t,n,Cm);for(let o=0;o<3;o++)r[n+o]=a[o],s[n+o]=n/3}return new KT(r,s,!1)}_createComponentNormalsSmooth(e,t){const r={};for(let a=0;a<t.length;a+=3){const o=this._calculateFaceNormal(e,t,a,Cm);for(let l=0;l<3;l++){const c=t[a+l];let h=r[c];h||(h={normal:E(),count:0},r[c]=h),J(h.normal,h.normal,o),h.count++}}const s=ir(3*t.length),n=new Array(3*t.length);for(let a=0;a<t.length;a++){const o=r[t[a]];o.count!==1&&(K(o.normal,o.normal),o.count=1);for(let l=0;l<3;l++)s[3*a+l]=o.normal[l];n[a]=a}return new KT(s,n,!1)}_getFaceVertices(e,t,r,s,n,a){const o=3*t[r+0],l=3*t[r+1],c=3*t[r+2];s[0]=e[o+0],s[1]=e[o+1],s[2]=e[o+2],n[0]=e[l+0],n[1]=e[l+1],n[2]=e[l+2],a[0]=e[c+0],a[1]=e[c+1],a[2]=e[c+2]}_calculateFaceNormal(e,t,r,s){return this._getFaceVertices(e,t,r,ds,xm,Tm),ee(xm,xm,ds),ee(Tm,Tm,ds),Xe(ds,xm,Tm),K(s,ds),s}_getOrCreateComponents(e){return Ze(e.components,Are)}_createPositionBuffer(e,t){let r=e.vertexAttributes.position;const s=t.reprojection===Ra.ECEF?t.transformBeforeProject:null;if(_(s)&&(r=Lk(r,new Float64Array(r.length),s)),t.reprojection===Ra.NONE)return t.needsBufferCopy?new Float64Array(r):r;const n=_(s)?r:new Float64Array(r.length);return In(r,e.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(e,t,r){let s=e.vertexAttributes.normal;if(T(s))return null;const n=r.reprojection===Ra.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=$k(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Ra.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const a=e.vertexAttributes.position,o=_(n)?s:new Float32Array(s.length);return Fk(s,a,t,e.spatialReference,o)}_createTangentBuffer(e,t,r){let s=e.vertexAttributes.tangent;if(T(s))return null;const n=r.reprojection===Ra.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=Nk(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===Ra.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===s?new Float32Array(s):s;const a=e.vertexAttributes.position,o=_(n)?s:new Float32Array(s.length);return Uk(s,a,t,e.spatialReference,o)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=OG(ts(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return y5(t,r,s),s}return null}_createBuffers(e,t){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,a=e.vertexAttributes.tangent;if(_(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(a)&&a.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,o),c=this._createColorBuffer(e),h=this._createSymbolColorBuffer(t),u=this._createNormalBuffer(e,l,o),m=this._createTangentBuffer(e,l,o);return{positionBuffer:l,normalBuffer:u,tangentBuffer:m,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:o.reprojection===Ra.NONE&&_(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(e,l,u,m),geometryTransformation:o.reprojection===Ra.NONE&&_(o.geometryTransformation)?o.geometryTransformation:ve()}}_computeReprojectionInfo(e){const t=_(e.transform),r=t&&e.transform.geographic||this._context.renderCoordsHelper.viewingMode===Se.Local?Ra.NONE:Ra.ECEF;if(t){if(r===Ra.NONE){const n=ve();return ch(e.spatialReference,e.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:VB(e.transform.localMatrix),needsBufferCopy:!1}}const s=X$(ve(),e.transform.origin);return Sr(s,s,e.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(e,t,r,s){const n=this._context.renderCoordsHelper.spatialReference,a=e.anchor;xv[0]=a.x,xv[1]=a.y,xv[2]=a.z;const o=ve();ch(e.spatialReference,xv,o,n);const l=hb.fromTypedArray(t);if(aa(P3,o),u5(l,l,P3),_(r)||_(s)){if(hh(Hg,o),gh(Hg,Hg),_(r)){const c=Hd.fromTypedArray(r);ub(c,c,Hg)}if(_(s)){const c=Hd.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);ub(c,c,Hg)}}return o}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,s=t.faces;if(s){let n=-1;for(let a=0;a<s.length;a++){const o=s[a];o>n&&(n=o)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,t){return t.faces?t.faces:z2(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=t.length/3;return _(r)&&!e.spatialReference.equals(r)?(s=new Float64Array(t.length),In(e.vertexAttributes.position,e.spatialReference,0,s,r,0,n)):s=t,Pi(JT),Ua(JT,s,0,n),!Jo(JT,this._context.clippingExtent)}_createGeometryInfo(e,t,r){if(!u2(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,t);if(T(s))return null;const{positionBuffer:n,uvBuffer:a,colorBuffer:o,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:h,objectTransformation:u,geometryTransformation:m}=s,f=this._getOrCreateComponents(e),y=new Array;let g=!1;for(const v of f){if(!this._validateFaces(e,v))return null;const b=this._getOrCreateFaces(e,v);if(b.length===0)continue;const x=this._createComponentNormals(n,c,v,b);x.didFlipNormals&&(g=!0);const w=[[C.POSITION,new Ae(n,3,!0)],[C.NORMAL,new Ae(x.normals,3,!0)]],S=[[C.POSITION,b],[C.NORMAL,x.indices]];_(o)&&(w.push([C.COLOR,new Ae(o,4,!0)]),S.push([C.COLOR,b])),_(l)&&(w.push([C.SYMBOLCOLOR,new Ae(l,4,!0)]),S.push([C.SYMBOLCOLOR,new Array(b.length).fill(0)])),_(a)&&(w.push([C.UV0,new Ae(a,2,!0)]),S.push([C.UV0,b])),_(h)&&(w.push([C.TANGENT,new Ae(h,4,!0)]),S.push([C.TANGENT,b]));const P=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),A=this._getOrCreateMaterial(e,v),M=new Vr(A,w,S,null,Ns.Mesh,P);M.transformation=m,y.push(M)}return g&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:u}}}let KT=class{constructor(e,t,r){this.normals=e,this.indices=t,this.didFlipNormals=r}};const xv=E(),ds=E(),xm=E(),Tm=E(),Cm=E(),P3=ve(),Hg=Bs(),JT=zs(),Are=[new Ak];var Ra;(function(i){i[i.NONE=0]="NONE",i[i.ECEF=1]="ECEF"})(Ra||(Ra={}));let Pre=class{constructor(e,t,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this._lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,r){if(this.elevationAligner){KR(this.elevationContext.featureExpressionInfoContext,r);const s=(a,o)=>pg(a,e,this.elevationContext,t,o),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,t);_(n)&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=E()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xl),Pe(e,this._lodRenderer.baseBoundingSphere.center,xl)}getBoundingBoxObjectSpace(e=zs()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xl);const t=this._lodRenderer.baseBoundingBox;Pi(e);for(let r=0;r<8;++r)Z(Ha,1&r?t[3]:t[0],2&r?t[4]:t[1],4&r?t[5]:t[2]),Pe(Ha,Ha,xl),jf(e,Ha);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xl),e.render.origin[0]+=xl[12],e.render.origin[1]+=xl[13],e.render.origin[2]+=xl[14],e.render.num++}async getProjectedBoundingBox(e,t,r,s,n){const a=this.getBoundingBoxObjectSpace(n),o=Ore,l=k2(a)?1:o.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xl);for(let h=0;h<l;h++){const u=o[h];Ha[0]=a[u[0]],Ha[1]=a[u[1]],Ha[2]=a[u[2]],Pe(Ha,Ha,xl),gu[3*h+0]=Ha[0],gu[3*h+1]=Ha[1],gu[3*h+2]=Ha[2]}if(!e(gu,0,l))return null;Pi(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let u=0;u<3;u++)a[u]=Math.min(a[u],gu[h+u]),a[u+3]=Math.max(a[u+3],gu[h+u]);c&&r.push({location:gu.slice(h,h+3),screenSpaceBoundingRect:c})}if(t&&(Ko(a,eC),this.elevationContext.mode!=="absolute-height")){let h;const u=YR(a,t.service.spatialReference,t);try{h=await t.service.queryElevation(eC[0],eC[1],s,u,"ground")}catch{}_(h)&&l5(a,0,0,-this.alignedSampledElevation+h)}return a}addObjectState(e,t){if(e===Yf.Highlight){const r=new pE(e);this._addHighlightId(r),t.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(t=>e.remove(t))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const gu=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ha=E(),eC=E(),Ore=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],xl=ve();function Mre(i){const e=new Array;return i.stageResources.geometries.forEach(t=>{const r=i.stageResources.textures;e.push(new B9(t,r))}),{components:e,minScreenSpaceRadius:Ze(i.lodThreshold,0),pivotOffset:i.pivotOffset}}function Ire(i){return{levels:i.map(e=>Mre(e))}}var vi;function Dre(i){let e=Rr().mat4f64(C.LOCALTRANSFORM).mat4f64(C.GLOBALTRANSFORM).vec4f64(C.BOUNDINGSPHERE).vec3f64(C.MODELORIGIN).mat3f(C.MODEL).mat3f(C.MODELNORMAL).vec2f(C.MODELSCALEFACTORS);return i.includes("color")&&(e=e.vec4f(C.COLOR)),i.includes("featureAttribute")&&(e=e.vec4f(C.FEATUREATTRIBUTE)),e=e.u8(C.STATE).u8(C.LODLEVEL),i.includes(C.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(C.OBJECTANDLAYERIDCOLOR)),e.alignTo(8),e}(function(i){i[i.ALLOCATED=1]="ALLOCATED",i[i.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",i[i.VISIBLE=4]="VISIBLE",i[i.HIGHLIGHT=8]="HIGHLIGHT",i[i.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",i[i.REMOVE=32]="REMOVE",i[i.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",i[i.ACTIVE=18]="ACTIVE"})(vi||(vi={}));let Lre=class{constructor(e){this.localTransform=e.getField(C.LOCALTRANSFORM,BP),this.globalTransform=e.getField(C.GLOBALTRANSFORM,BP),this.modelOrigin=e.getField(C.MODELORIGIN,hb),this.model=e.getField(C.MODEL,Cy),this.modelNormal=e.getField(C.MODELNORMAL,Cy),this.modelScaleFactors=e.getField(C.MODELSCALEFACTORS,h5),this.boundingSphere=e.getField(C.BOUNDINGSPHERE,jk),this.color=e.getField(C.COLOR,Ey),this.featureAttribute=e.getField(C.FEATUREATTRIBUTE,Ey),this.state=e.getField(C.STATE,zP),this.lodLevel=e.getField(C.LODLEVEL,zP),this.objectAndLayerIdColor=e.getField(C.OBJECTANDLAYERIDCOLOR,Gd)}},Zm=class extends ge{constructor(e,t){super(e),this.events=new Br,this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=Dre(t)}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,vi.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;_t(e>=0&&e<this._capacity&&(t.get(e)&vi.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,vi.ACTIVE)?this._setStateFlags(e,vi.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;_t(e>=0&&e<this._capacity&&(t.get(e)&vi.ALLOCATED)!=0,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=Nh,s=Ao;t.localTransform.getMat(e,O3),t.globalTransform.getMat(e,tC);const n=Sr(tC,tC,O3);Z(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),hh(s,n),t.model.setMat(e,s);const a=nH(Nh,n);a.sort(),t.modelScaleFactors.set(e,0,a[1]),t.modelScaleFactors.set(e,1,a[2]),lg(s,s),gh(s,s),t.modelNormal.setMat(e,s),this._setStateFlags(e,vi.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,Ao),r.modelOrigin.getVec(e,Nh),t[0]=Ao[0],t[1]=Ao[1],t[2]=Ao[2],t[3]=0,t[4]=Ao[3],t[5]=Ao[4],t[6]=Ao[5],t[7]=0,t[8]=Ao[6],t[9]=Ao[7],t[10]=Ao[8],t[11]=0,t[12]=Nh[0],t[13]=Nh[1],t[14]=Nh[2],t[15]=1}applyShaderTransformation(e,t){_(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),_(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),_(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(_(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Nh,this,e);t*=Math.max(r[0],r[1],r[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(_(this.shaderTransformation)){const r=this.shaderTransformation.scaleFactor(Nh,this,e);t*=$re(r[0],r[1],r[2])}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,vi.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,vi.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,vi.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,vi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){const e=Math.max(Fre,Math.floor(this._capacity*Nre)),t=this._layout.createBuffer(e);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(r)}this._capacity=e,this._buffer=t,this._view=new Lre(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&vi.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function $re(i,e,t){return Math.max(Math.min(i,e),Math.min(Math.max(i,e),t))}d([p({constructOnly:!0})],Zm.prototype,"shaderTransformation",void 0),d([p()],Zm.prototype,"_size",void 0),d([p({readOnly:!0})],Zm.prototype,"size",null),Zm=d([k("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],Zm);const Fre=1024,Nre=2,Nh=E(),Ao=Bs(),O3=ve(),tC=ve();let Ure=class extends Zo{constructor(e,t){super(r=>MB(this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere)),{maximumDepth:25}),this._tmpSphere=yo(),this._tmpMat4=ve(),this._instanceData=e,this._boundingSphere=t}addInstance(e){const t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Pe(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*yp(r),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Vre=class{constructor(e,t){this._worldSpaceRadius=e,this._minScreenSpaceRadii=t}selectLevel(e,t,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/s;let a=0;for(let o=1;o<this._minScreenSpaceRadii.length;++o)n>=this._minScreenSpaceRadii[o]&&(a=o);return a}},Bre=class extends Pw{constructor(e,t,r,s,n,a){super(e,t),this.layerUid=e,this.graphicUid=t,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=a}};function pA(i){return pl(i)&&i.intersector===Ri.LOD&&!!i.target}let zre=class{constructor(e,t){const r=e.renderContext.rctx,s=t.geometry;this._materialRepository=e.materialRepository,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),a=n.vertexBufferLayout,o=n.elementCount(s),l=n.allocate(o);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new c6(s.material,this._materialRepository),this.vertexBufferLayout=a,this.vbo=Yt.createVertex(r,ri.STATIC_DRAW,l.buffer),this.vao=new fh(r,Zt,{geometry:ul(a)},{geometry:this.vbo}),this.vertexCount=o}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,s,n,a,o,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(h,u,m,f,y)=>{if(h>=0){if(t!=null&&!t(e.rayBegin,e.rayEnd,h))return;const g=new Bre(a.layerUid,a.graphicUid(n),c,m,o,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||h<e.results.min.dist)&&e.results.min.set(Ri.LOD,g,h,u,e.transform.transform,y),e.options.store!==rs.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||h>e.results.max.dist)&&e.results.max.set(Ri.LOD,g,h,u,e.transform.transform,y),e.options.store===rs.ALL){const v=SR(e.results.min.ray);v.set(Ri.LOD,g,h,u,e.transform.transform,y),e.results.all.push(v)}}})}},kre=class N6{static async create(e,t,r){const s=await Promise.allSettled(t.components.map(a=>e.controller.schedule(()=>new zre(e,a),r))),n=s.map(a=>a.status==="fulfilled"?a.value:null).filter(_);if(Xo(r)||n.length!==s.length){n.forEach(a=>a.destroy()),Ti(r);for(const a of s)if(a.status==="rejected")throw a.reason}return new N6(t.minScreenSpaceRadius,n)}constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,t,r,s,n,a,o){this.components.forEach(l=>l.intersect(e,t,r,s,n,a,this.boundingSphere,o))}get boundingBox(){if(T(this._boundingBox)){const e=Pi();this.components.forEach(t=>{_(t.boundingInfo)&&(jf(e,t.boundingInfo.bbMin),jf(e,t.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(T(this._boundingSphere)){const e=this.boundingBox,t=E();Ko(e,t),this._boundingSphere={center:t,radius:.5*c5(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,t)=>e+t.triangleCount,0)}},Gre=class{constructor(e,t,r){this._elementSize=t,this._buffer=Yt.createVertex(e,ri.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,t,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,s=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}},Hre=class{constructor(e){this.modelOriginHi=e.getField(C.MODELORIGINHI,Hd),this.modelOriginLo=e.getField(C.MODELORIGINLO,Hd),this.model=e.getField(C.MODEL,Cy),this.modelNormal=e.getField(C.MODELNORMAL,Cy),this.color=e.getField(C.INSTANCECOLOR,Ey),this.featureAttribute=e.getField(C.INSTANCEFEATUREATTRIBUTE,Ey),this.objectAndLayerIdColor=e.getField(C.OBJECTANDLAYERIDCOLOR_INSTANCED,Gd)}},M3=class{constructor(e,t){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){_t(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){_t(this._updating,"not updating"),this.size<Wre*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){_t(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),_t(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){_t(this._updating,"not updating"),_t(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(I3,Math.floor(this._capacity*qre));this._resize(e)}_shrink(){const e=Math.max(I3,Math.floor(this._capacity*jre));this._resize(e)}_resize(e){if(_t(this._updating,"not updating"),e===this._capacity)return;const t=new Gre(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(t);_t(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Hre(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}};const I3=1024,qre=2,Wre=.3,jre=.5,Xre=i=>{const e=i.baseBoundingSphere.radius,t=i.levels.map(r=>r.minScreenSpaceRadius);return new Vre(e,t)};let Za=class extends ge{constructor(e,t){super(e),this.type=Ri.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new ze,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[ne.OPAQUE_MATERIAL,ne.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new Zm({shaderTransformation:e.shaderTransformation},e.optionalFields),this._frameTask=t.registerTask(rr.LOD_RENDERER,this)}initialize(){this._instanceBufferLayout=Qre(this.optionalFields),this._glInstanceBufferLayout=ul(this._instanceBufferLayout,1),this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))}destroy(){this._frameTask.remove()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],a=this._highlightRenderInstanceData[s],o=n.size+a.size,l=r.triangleCount;t.push({renderedInstances:o,renderedTriangles:o*l,trianglesPerInstance:l})}),{totalInstances:e,renderedInstances:t.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:t.reduce((r,s)=>r+s.renderedTriangles,0),levels:t}}async initializeRenderContext(e,t){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(a=>(this._defaultRenderInstanceData.push(new M3(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new M3(r,this._instanceBufferLayout)),kre.create(e,a,t)))),n=s.map(a=>a.status==="fulfilled"?a.value:null).filter(_);if(Xo(t)||n.length!==s.length){n.forEach(a=>a.destroy()),Ti(t);for(const a of s)if(a.status==="rejected")throw a.reason}this._levels=n,this._levelSelector=Xre(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(t=>t.material.requiresSlot(ne.TRANSPARENT_MATERIAL,$.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(e=>e.size>0)}prepareRender(e){if(!zt.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(ta),this._needFullCycle=!1)}}render(e){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output)||(e.rctx.bindVAO(),e.output!==$.Highlight&&e.output!==$.ShadowHighlight&&this._renderComponents(e,this._defaultRenderInstanceData),e.output!==$.ShadowExcludeHighlight&&this._renderComponents(e,this._highlightRenderInstanceData))}intersect(e,t,r,s){if(!this.baseMaterial.isVisible()||T(this._octree))return;const n=E();ee(n,s,r);const a=o=>{this._instanceData.getCombinedModelTransform(o,$3),e.transform.set($3),Pe(F3,r,e.transform.inverse),Pe(N3,s,e.transform.inverse);const l=this._instanceData.getState(o),c=this._instanceData.getLodLevel(o),h=this._levels.length;_t((l&vi.ACTIVE)!=0,"invalid instance state"),_t(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(e,t,F3,N3,o,this.metadata,h)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(a):this._octree.forEachAlongRay(r,n,a)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(T(this._octreeCached)){const t=this._instanceData,r=(e=t.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new Ure(t,this.baseBoundingSphere);for(let s=0;s<t.capacity;++s)r.get(s)&vi.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=we(this._octreeCached)}_queryDepthRangeOctree(e){if(T(this._octree))return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,Zo.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(t,Zo.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,a=this._instanceData.view;a.boundingSphere.getVec(r,Tl),ee(Tl,Tl,n);const o=oe(Tl,t)-Tl[3];a.boundingSphere.getVec(s,Tl),ee(Tl,Tl,n);const l=oe(Tl,t)+Tl[3];return{near:Math.max(e.near,o),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>e.startUpdateCycle()),this._highlightRenderInstanceData.forEach(e=>e.startUpdateCycle())}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:r,_levelSelector:s}=this;this._defaultRenderInstanceData.forEach(h=>h.beginUpdate()),this._highlightRenderInstanceData.forEach(h=>h.beginUpdate());const n=this._instanceData,a=n.view;let o=n.size;const l=n.capacity;let c=this._instanceIndex;for(let h=0;h<o&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const u=a.state.get(c);let m=0;if(!(u&vi.ALLOCATED)){c=c+1===l?0:c+1,o++;continue}const f=a.lodLevel.get(c);if(u&vi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),u&vi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[f].freeTail(),u&vi.REMOVE)n.freeInstance(c);else if(u&vi.VISIBLE){let y=0;t&&(a.modelOrigin.getVec(c,L3),y=s.selectLevel(L3,n.getCombinedMedianScaleFactor(c),r)),m=u&~(vi.ACTIVE|vi.TRANSFORM_CHANGED),y>=0&&(u&vi.HIGHLIGHT?(D3(this._highlightRenderInstanceData[y],a,c),m|=vi.HIGHLIGHT_ACTIVE):(D3(this._defaultRenderInstanceData[y],a,c),m|=vi.DEFAULT_ACTIVE)),a.state.set(c,m),a.lodLevel.set(c,y)}else m=u&~(vi.ACTIVE|vi.TRANSFORM_CHANGED),a.state.set(c,m);if(_(this._octreeCached)){const y=!!(u&vi.ACTIVE),g=!!(m&vi.ACTIVE);!y&&g?this._octreeCached.addInstance(c):y&&!g?this._octreeCached.removeInstance(c):y&&g&&u&vi.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>h.endUpdate()),this._highlightRenderInstanceData.forEach(h=>h.endUpdate()),this._context.requestRender()}_renderComponents(e,t){this.levels.forEach((r,s)=>{const n=r.components.map(a=>this._beginComponent(e,t[s],a));r.components.forEach((a,o)=>this._renderComponent(e,n[o],t[s],a,s))})}_beginComponent(e,t,r){const{bindParameters:s,rctx:n,output:a}=e;if(t.size===0||!r.material.requiresSlot(s.slot,e.output))return null;const o=r.glMaterials.load(n,s.slot,a);return _(o)?o.beginSlot(s):null}_renderComponent(e,t,r,s,n){if(T(t))return;const{bindParameters:a,rctx:o}=e,l=o.bindTechnique(t,s.material.parameters,a);o.bindVAO(s.vao),t.ensureAttributeLocations(s.vao),l.bindDraw(Zre,a,s.material.parameters),zt.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===$.Color&&(l.setUniform4fv("externalColor",U3[Math.min(n,U3.length-1)]),l.setUniform1i("colorMixMode",$z.replace));const c=o.capabilities.instancing,h=r.capacity,u=r.headIndex,m=r.tailIndex,f=r.firstIndex,y=this._glInstanceBufferLayout,g=(v,b)=>{PF(o,Zt,r.buffer,y,v),c.drawArraysInstanced(t.primitiveType,0,s.vertexCount,b-v),OF(o,Zt,r.buffer,y)};s.material.parameters.transparent&&f!=null?u>m?(_t(f>=m&&f<=u,"invalid firstIndex"),g(f,u),g(m,f)):u<m&&(f<=u?(_t(f>=0&&f<=u,"invalid firstIndex"),g(f,u),g(m,h),g(0,f)):(_t(f>=m&&f<=h,"invalid firstIndex"),g(f,h),g(0,u),g(m,f))):u>m?g(m,u):u<m&&(g(0,u),g(m,h)),o.bindVAO(null)}};function D3(i,e,t){const r=i.allocateHead();Yre(e,t,i.view,r)}function Yre(i,e,t,r){pk(i.modelOrigin,e,t.modelOriginHi,t.modelOriginLo,r),t.model.copyFrom(r,i.model,e),t.modelNormal.copyFrom(r,i.modelNormal,e),i.color&&t.color&&t.color.copyFrom(r,i.color,e),i.objectAndLayerIdColor&&t.objectAndLayerIdColor&&t.objectAndLayerIdColor.copyFrom(r,i.objectAndLayerIdColor,e),i.featureAttribute&&t.featureAttribute&&t.featureAttribute.copyFrom(r,i.featureAttribute,e)}function Qre(i){let e=Rr().vec3f(C.MODELORIGINHI).vec3f(C.MODELORIGINLO).mat3f(C.MODEL).mat3f(C.MODELNORMAL);return _(i)&&i.includes("color")&&(e=e.vec4f(C.INSTANCECOLOR)),_(i)&&i.includes("featureAttribute")&&(e=e.vec4f(C.INSTANCEFEATUREATTRIBUTE)),_(i)&&i.includes("objectAndLayerIdColor")&&(e=e.vec4u8(C.OBJECTANDLAYERIDCOLOR_INSTANCED)),e}d([p({constructOnly:!0})],Za.prototype,"symbol",void 0),d([p({constructOnly:!0})],Za.prototype,"optionalFields",void 0),d([p({constructOnly:!0})],Za.prototype,"metadata",void 0),d([p({constructOnly:!0})],Za.prototype,"shaderTransformation",void 0),d([p()],Za.prototype,"_instanceData",void 0),d([p()],Za.prototype,"_cycleStartIndex",void 0),d([p({readOnly:!0})],Za.prototype,"_enableLevelSelection",null),d([p()],Za.prototype,"_updateCyclesWithStaticCamera",void 0),d([p({readOnly:!0})],Za.prototype,"running",null),Za=d([k("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Za);const L3=E(),Tl=Xt(),$3=ve(),F3=E(),N3=E(),U3=[Ai(1,0,1,1),Ai(0,0,1,1),Ai(0,1,0,1),Ai(1,1,0,1),Ai(1,0,0,1)],Zre=new uk;let V3=class{constructor(e,t,r,s,n,a,o,l,c,h,u,m){this.lodResources=e,this.lodRenderer=t,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=a,this.isWosr=o,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=u,this.pivotOffset=m}},Kre=class extends yc{getCachedSize(){const[e,t,r]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:r}}constructor(e,t,r,s){super(e,t,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&Bw(this.symbolLayer))throw new Error;const t=this.symbolLayer;if(this._isPrimitive){const r=t.resource?t.resource.primitive:oF;this._resources=await this._createResourcesForPrimitive(r,e)}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return _(this._resources)?this._resources.lodRenderer:null}_setMaterialTransparencyParams(e,t=ts(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(t),s=r<1||this.needsDrivenTransparentPass;return e.transparent=s,e.opacity=r,e.cullFace=s?Fr.None:Fr.Back,e}async _createResourcesForPrimitive(e,t){if(!Zee(e))throw new Error(`Unknown object symbol primitive: ${e}`);const r=this.symbolLayer,s=zs(IG(e)),n=so(R0(s)),a=so(bx(n,r)),o=xe(a),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Cd,diffuse:Cd,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},u=!!h.usePBR;this._setMaterialTransparencyParams(h);const m=this.symbol;if(m.type==="point-3d"&&m.verticalOffset){const{screenLength:x,minWorldLength:w,maxWorldLength:S}=m.verticalOffset;h.verticalOffset={screenLength:Rn(x),minWorldLength:w||0,maxWorldLength:_(S)?S:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Yo;else{const x=_(r.material)?r.material.color:null,w=_(x)?li.toUnitRGBA(x):Yo;h.externalColor=w}this._fastUpdates=Gy(this._context.renderer,this._fastVisualVariableConvertOptions(s,a,n,Xp)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color")),Vt("enable-feature:objectAndLayerId-rendering")&&(h.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const f=new Ty(h),y=k9(e,f);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const g=cv(y).map(x=>({opacity:1,transparent:x.parameters.transparent})),v=await this._createStageResources(y,u,t),b=await this._createLodRenderer(y,t);return new V3(y,b,v,g,n,l,c,s,a,o,u,Xp)}async _createResourcesForUrl(e,t){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=Gy(this._context.renderer,this._fastVisualVariableConvertOptions(Xp,Xp,Xp,Xp)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color")),Vt("enable-feature:objectAndLayerId-rendering")&&(r.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:N,minWorldLength:F,maxWorldLength:V}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:Rn(N),minWorldLength:F||0,maxWorldLength:_(V)?V:1/0},s.materialParamsMixin.castShadows=!1}s.signal=t,s.usePBR=this._context.physicalBasedRenderingEnabled,s.skipHighLods=this._context.skipHighSymbolLods;const a=s.usePBR,o=await mk(e,s),l=o.isEsriSymbolResource,c=o.isWosr,h=Ire(o.lods);h.levels.sort((N,F)=>N.minScreenSpaceRadius-F.minScreenSpaceRadius);const u=this._context,m=this.symbolLayer.material,f=this._getExternalColorParameters(m),y=ts(this.symbolLayer,"material","color"),g=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),v=this.needsDrivenTransparentPass,b=cv(h),x=cv(h).map(N=>({opacity:N.parameters.opacity||1,transparent:N.parameters.transparent}));b.forEach(N=>{const F=N.parameters;N.setParameters(f);const V=F.opacity*g,Q=V<1||v||F.transparent;N.setParameters({opacity:V,transparent:Q}),u.screenSizePerspectiveEnabled&&N.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,S=so(R0(w)),P=so(h.levels[0].pivotOffset),A=so(bx(S,this.symbolLayer)),M=xe(A);Hy(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(w,A,S,P))&&b.forEach(N=>N.setParameters(this._fastUpdates.materialParameters));const O=await this._createStageResources(h,a,t),I=await this._createLodRenderer(h,t);return new V3(h,I,O,x,S,l,c,w,A,M,a,P)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,t,r){const s=this._context.stage,n=cv(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const a=AI(e);s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),await s.load(a,r),Ti(r);const o=PI(e);return s.addMany(o),this._addDisposeResource(()=>s.removeMany(o)),{materials:n,textures:a,geometries:o}}async _createLodRenderer(e,t){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:o=>this._instanceIndexToGraphicUid.get(o),notifyGraphicGeometryChanged:o=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(o)),notifyGraphicVisibilityChanged:o=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(o))},n=this._fastUpdates.enabled?{applyTransform:(o,l,c)=>{o.getFeatureAttribute(l,Tv),bs(c,xS(this._fastUpdates.materialParameters,Tv,c))},scaleFactor:(o,l,c)=>(l.getFeatureAttribute(c,Tv),zie(o,this._fastUpdates.materialParameters,Tv))}:null,a=new Za({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:n},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a.slots,a,t),a}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=Yo:_(e)&&_(e.color)?t.externalColor=li.toUnitRGBA(e.color):(t.externalColor=Yo,t.colorMixMode="ignore"),t}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const r=zy(t.geometry);if(T(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${t.geometry.type}`),null;const s=this.setGraphicElevationContext(t,new ml),n=e.renderingInfo;return this._createAs3DShape(t,r,n,s,t.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(T(this._resources))return;const e=this._drivenProperties.opacity,t=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const a=r[n],o=ts(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*l.opacity,h=c<1||e||l.transparent;a.setParameters({opacity:c,transparent:h}),this._isPrimitive&&a.setParameters({cullFace:h?Fr.None:Fr.Back})}}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Xd)}slicePlaneEnabledChanged(){if(T(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(T(this._resources))return!0;const{stageResources:e,isWosr:t}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!1}applyRendererDiff(e,t){if(T(this._resources))return Cr.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:a,resourceSize:o,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!Hy(this._fastUpdates,t,this._fastVisualVariableConvertOptions(n,a,o,l)))return Cr.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Cr.Fast_Update}computeComplexity(){if(T(this._resources))return super.computeComplexity();const e=this._resources.lodResources,t=z9(e.levels[0]).reduce((n,a)=>n+a.indices.get(C.POSITION).length,0)/3,r=n=>Array.from(n.vertexAttributes.values()).reduce((a,o)=>{var l;return a+(((l=o.data.buffer)==null?void 0:l.byteLength)??0)},0)+Array.from(n.indices.values()).reduce((a,o)=>a+(Array.isArray(o)?12*o.length:o.buffer.byteLength),0),s=AI(e).reduce((n,a)=>n+(a.params.encoding&&a.params.encoding==="image/ktx2"?a.estimatedTexMemRequired:a.estimatedTexMemRequired/4),0)+PI(e).reduce((n,a)=>n+r(a),0);return{primitivesPerFeature:t,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...H9(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(e,t,r,s,n,a){if(!this._hasLodRenderer()||T(this._resources))return null;const o=this.getFastUpdateAttrValues(e),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?ey(r.color,r.opacity):null,c=this._context.clippingExtent;if(xs(t,Em,this._context.elevationProvider.spatialReference),_(c)&&!q2(c,Em))return null;const h=this._requiresTerrainElevation(s),u=this._computeGlobalTransform(t,s,iC,Cv),m=this._computeLocalTransform(this._resources,this.symbolLayer,r,B3),f=this._resources.lodRenderer.instanceData,y=f.addInstance();this._instanceIndexToGraphicUid.set(y,n),f.setLocalTransform(y,m,!1),f.setGlobalTransform(y,u),o&&f.setFeatureAttribute(y,o),l&&f.setColor(y,l),_(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&f.setObjectAndLayerIdColor(y,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:a}));const g=new Pre(this,y,zee,s);return h&&(g.alignedSampledElevation=Cv.sampledElevation),g.needsElevationUpdates=Xd(s.mode),By(g,t,this._context.elevationProvider),g}_computeGlobalTransform(e,t,r,s){return pg(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,s),Em[0]=e.x,Em[1]=e.y,Em[2]=s.z,ch(e.spatialReference,Em,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,t,r,s){return pp(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(t,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,t,s),s}_applyObjectScale(e,t,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=SI(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||Q$(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(T(this._resources))return!0;const r=t&&zy(t);if(T(r))return!1;const s=this.getGeometryElevationMode(t);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,iC,Cv),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=Cv.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,iC,!0),By(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition)||T(this._resources))return;const r=(y,g,v)=>Ze(y!=null&&y.type==="complete"?y.newValue:g,v),s=r(t.heading,this.symbolLayer.heading,0),n=r(t.tilt,this.symbolLayer.tilt,0),a=r(t.roll,this.symbolLayer.roll,0),o=r(t.width,this.symbolLayer.width,void 0),l=r(t.height,this.symbolLayer.height,void 0),c=r(t.depth,this.symbolLayer.depth,void 0),h=r(t.anchor,this.symbolLayer.anchor,void 0),u=r(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const m={heading:s,tilt:n,roll:a,anchor:h,anchorPosition:u},f=this._resources;this.loadStatus===Ma.LOADED&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=so(bx(f.resourceSize,{width:o,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,g)=>{const v=this._computeLocalTransform(f,m,g,B3),b=y.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,t){if(!t.material||t.material.type!=="partial")return;const r=t.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=_(s)?li.toUnitRGBA(s):Yo;delete r.color;const a=this._resources;T(a)||e.graphics3DGraphicPatches.push(o=>{let l;this._hasPerInstanceColor()?(a.lodRenderer.instanceData.setColor(o.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of a.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,t,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return Oee(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,t,r){const s=E();switch(r.anchor){case"center":X(s,Ko(e)),On(s,s);break;case"top":{const n=Ko(e);Z(s,-n[0],-n[1],-e[5]);break}case"bottom":{const n=Ko(e);Z(s,-n[0],-n[1],-e[2]);break}case"relative":{const n=Ko(e),a=R0(e),o=r.anchorPosition,l=o?qe(o.x,o.y,o.z):Va;oB(s,a,l),J(s,s,n),On(s,s);break}default:_(t)?On(s,t):X(s,Va)}return s}_applyAnchor(e,t,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);s&&dc(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,r,s){const n=_(e)?so(R0(e)):Cd,a=_(e)?this._computeAnchor(e,s,this.symbolLayer):Va,o=this._context.renderCoordsHelper.unitInMeters,l=SI(_(t)?t:void 0,t,r,o),c=qe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:_(t)?t:Cd,unitInMeters:o,transformation:{anchor:a,scale:l,rotation:c}}}};const Em=E(),B3=ve(),iC=ve(),Tv=Xt(),Cv=new _0;function Jre(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function ese(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i}function SS(i,e,t,r,s){return i[0]=e,i[1]=t,i[2]=r,i[3]=s,i}function tse(i,e){if(i===e){const t=e[1];i[1]=e[2],i[2]=t}else i[0]=e[0],i[1]=e[2],i[2]=e[1],i[3]=e[3];return i}function ise(i,e){const t=e[0],r=e[1],s=e[2],n=e[3];let a=t*n-s*r;return a?(a=1/a,i[0]=n*a,i[1]=-r*a,i[2]=-s*a,i[3]=t*a,i):null}function rse(i,e){const t=e[0];return i[0]=e[3],i[1]=-e[1],i[2]=-e[2],i[3]=t,i}function sse(i){return i[0]*i[3]-i[2]*i[1]}function U6(i,e,t){const r=e[0],s=e[1],n=e[2],a=e[3],o=t[0],l=t[1],c=t[2],h=t[3];return i[0]=r*o+n*l,i[1]=s*o+a*l,i[2]=r*c+n*h,i[3]=s*c+a*h,i}function nse(i,e,t){const r=e[0],s=e[1],n=e[2],a=e[3],o=Math.sin(t),l=Math.cos(t);return i[0]=r*l+n*o,i[1]=s*l+a*o,i[2]=r*-o+n*l,i[3]=s*-o+a*l,i}function ase(i,e,t){const r=e[0],s=e[1],n=e[2],a=e[3],o=t[0],l=t[1];return i[0]=r*o,i[1]=s*o,i[2]=n*l,i[3]=a*l,i}function ose(i,e){const t=Math.sin(e),r=Math.cos(e);return i[0]=r,i[1]=t,i[2]=-t,i[3]=r,i}function lse(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=e[1],i}function cse(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"}function hse(i){return Math.sqrt(i[0]**2+i[1]**2+i[2]**2+i[3]**2)}function dse(i,e,t,r){return i[2]=r[2]/r[0],t[0]=r[0],t[1]=r[1],t[3]=r[3]-i[2]*t[1],[i,e,t]}function use(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function V6(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i}function pse(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]}function mse(i,e){const t=i[0],r=i[1],s=i[2],n=i[3],a=e[0],o=e[1],l=e[2],c=e[3],h=X2();return Math.abs(t-a)<=h*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(r-o)<=h*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-l)<=h*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=h*Math.max(1,Math.abs(n),Math.abs(c))}function fse(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function gse(i,e,t,r){return i[0]=e[0]+t[0]*r,i[1]=e[1]+t[1]*r,i[2]=e[2]+t[2]*r,i[3]=e[3]+t[3]*r,i}const _se=U6,yse=V6;Object.freeze(Object.defineProperty({__proto__:null,LDU:dse,add:use,adjoint:rse,copy:Jre,determinant:sse,equals:mse,exactEquals:pse,frob:hse,fromRotation:ose,fromScaling:lse,identity:ese,invert:ise,mul:_se,multiply:U6,multiplyScalar:fse,multiplyScalarAndAdd:gse,rotate:nse,scale:ase,set:SS,str:cse,sub:yse,subtract:V6,transpose:tse},Symbol.toStringTag,{value:"Module"}));let vse=class extends Vr{constructor(e,t,r,s,n,a,o,l){super(e,t,r,null,Ns.Mesh,l),this.path=s,this.geometrySR=n,this.upVectorAlignment=a,this.stencilWidth=o}};var Fd;function B6(i){return"upVectorAlignment"in i}(function(i){i[i.World=0]="World",i[i.Path=1]="Path"})(Fd||(Fd={}));function z6(){return[1,0,0,1]}function bse(i){return[i[0],i[1],i[2],i[3]]}function wse(i,e,t,r){return[i,e,t,r]}function xse(i,e){return new Float64Array(i,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:bse,create:z6,createView:xse,fromValues:wse},Symbol.toStringTag,{value:"Module"}));function k6(){return{up:E(),right:E()}}function Tse(i,e,t){Pe(i.up,e.up,t),Pe(i.right,e.right,t)}function Cse(i,e,t){pi(i,oe(t,e.right),oe(t,e.up))}let Ese=class{constructor(){this.pos=E(),this.posES=E(),this.vLeft=E(),this.vRight=E(),this.vMinSiblingLength=0,this.frame=k6(),this.rotationFrameUp=E(),this.rotationRight=Ne(),this.rotationAngle=0,this.miterStretch=z6(),this.maxStretchDistance=0}setFrameFromUpVector(e){X(this.frame.up,e),J(Km,this.vLeft,this.vRight),K(Km,Km),W(RS,this.frame.up,oe(Km,this.frame.up)),ee(Sv,Km,RS),K(Sv,Sv),Xe(this.frame.right,Sv,this.frame.up)}},G6=class{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[]}addVertex(e,t){return this.vertices.push(E0(e)),this.vertexNormals.push(E0(t)),this.vertices.length-1}addPole(e,t=null){return this.poles.push({position:E0(e),normal:t?E0(t):null}),this.poles.length-1}addSegment(e,t=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.poleIndices.push(t.v0),this.poleIndices.push(t.v1))}get numSegments(){return this.vertexIndices.length/2}translate(e,t){for(const r of this.vertices)r[0]+=e,r[1]+=t;for(const r of this.poles)r.position[0]+=e,r.position[1]+=t}};function Sse(i=20){const t=new G6,r={v0:0,v1:0};t.addPole(ti(0,0));for(let n=0;n<i;++n){const a=2*n*Math.PI/i,o=Math.cos(a),l=Math.sin(a),c=ti(o*.5,l*.5),h=ti(o,l);t.addVertex(c,h)}for(let n=0;n<i-1;++n){const a={v0:n,v1:n+1};t.addSegment(a,r)}const s={v0:i-1,v1:0};return t.addSegment(s,r),t}function Rse(){const t=new G6,r=ti(.5*-1,.5*-1),s=ti(.5*1,.5*-1),n=ti(.5*1,.5*1),a=ti(.5*-1,.5*1),o=ti(0,-1),l=ti(1,0),c=ti(0,1),h=ti(-1,0);return t.addPole(ti(0,.5*1),c),t.addPole(ti(0,.5*1)),t.addPole(ti(0,.5*-1)),t.addPole(ti(0,.5*-1),o),t.addVertex(r,o),t.addVertex(s,o),t.addSegment({v0:0,v1:1},{v0:3,v1:3}),t.addVertex(s,l),t.addVertex(n,l),t.addSegment({v0:2,v1:3},{v0:2,v1:1}),t.addVertex(n,c),t.addVertex(a,c),t.addSegment({v0:4,v1:5},{v0:0,v1:0}),t.addVertex(a,h),t.addVertex(r,h),t.addSegment({v0:6,v1:7},{v0:1,v1:2}),t}let Ase=class{constructor(e){this.vertices=e,this.offset=E(),this.xform=ve();const t=Math.floor((e.length-1)/2);X(this.offset,this.vertices[t].pos);for(const r of this.vertices)ee(r.pos,r.pos,this.offset);dc(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,t=this.vertices[0];t.index=0,t.vLeft=E(),ee(t.vRight,this.vertices[1].pos,t.pos);let r=xe(t.vRight);t.vMinSiblingLength=r,K(t.vRight,t.vRight);let s=t;for(let n=1;n<e;++n){const a=this.vertices[n];if(a.index=n,a.vLeft=s.vRight,n<e-1){ee(a.vRight,this.vertices[n+1].pos,a.pos);const o=xe(a.vRight);a.vMinSiblingLength=Math.min(r,o),r=o,K(a.vRight,a.vRight)}else X(a.vRight,a.vLeft),a.vMinSiblingLength=r;s=a}}};function Pse(i,e){let t=null;const r=i.vertices.length,s=.99619469809,n=E(),a=E(),o=E(),l=E(),c=E(),h=E(),u=sr();let m=i.vertices[0];X(a,e),Z(n,0,1,0),wb(m.vRight,a,n,n,o,a,s),X(m.frame.up,a),X(m.frame.right,o),t=m;for(let f=1;f<r;++f){m=i.vertices[f],J(c,m.vLeft,m.vRight);let y=xe(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=m.vRight[0],c[1]=m.vRight[1],c[2]=m.vRight[2]),J(h,t.pos,t.frame.up),lw(m.pos,c,u),Ap(u,al(h,m.vLeft),l)?(ee(l,l,m.pos),K(a,l),Xe(o,c,a),K(o,o)):wb(c,t.frame.up,t.frame.right,n,o,a,s),X(m.frame.up,a),X(m.frame.right,o),t=m}}let Ose=class{numProfilesPerJoin(){return 1}extrude(e,t,r){for(let s=0;s<t.vertices.length;++s)r(e.index,e.frame,t.vertices[s],t.vertexNormals[s],!1)}},rC=class{constructor(e=.8*Math.PI,t=1){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,r){const s=Nse;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){ol(G3,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrameUp),Tse(s,e.frame,G3);for(let a=0;a<t.vertices.length;++a)Or(t.vertices[a],e.rotationRight)*e.rotationAngle>=0?r(e.index,s,t.vertices[a],t.vertexNormals[a],!1):(bP(sp,t.vertices[a],e.miterStretch),r(e.index,e.frame,sp,t.vertexNormals[a],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let a=0;a<t.vertices.length;++a){const o=Or(t.vertices[a],e.rotationRight)*e.rotationAngle>=0;bP(sp,t.vertices[a],e.miterStretch),r(e.index,e.frame,sp,t.vertexNormals[a],!o)}}},mA=class{rebuildConnectingProfileGeometry(e,t,r){for(let s=0;s<t.vertices.length;++s)r(e.index,e.frame,t.vertices[s],t.vertexNormals[s],0,0)}},z3=class extends mA{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}},Ev=class extends mA{constructor(e,t=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,r){for(let s=0;s<t.vertices.length;++s)r(e.index,e.frame,t.vertices[s],t.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(e,t){const r=fA;pi(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)t(e.index,e.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(e,t){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],a=this.profile.vertexIndices[2*s+1],o=this.vertexBufferStart+n,l=this.vertexBufferStart+a;this.flip?t(l,o,r):t(r,o,l)}}},k3=class extends mA{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let t=0;t<this.profile.numSegments;++t){const r=this.profile.vertexIndices[2*t+0],s=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const r=e.frame,s=.5*this.sign,n=sp,a=fA;pi(a,0,0);for(let o=0;o<this.profile.poles.length;++o){const l=this.profile.poles[o];l.normal?t(e.index,r,l.position,l.normal,s,0):t(e.index,r,l.position,a,s,this.sign)}if(this.breakNormals)for(let o=0;o<this.profile.vertices.length;++o)t(e.index,r,this.profile.vertices[o],this.profile.vertexNormals[o],0,0);for(let o=0;o<this.numSegments-1;++o){const l=(1-(o+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let u=0;u<this.profile.vertices.length;++u){const m=this.profile.poles[this.profile.poleIndices[u]];yd(n,this.profile.vertices[u],m.position),La(n,n,c),m.normal?(Hl(n,n,m.position),t(e.index,r,n,m.normal,s*h,0)):(rb(a,n),La(a,a,c),Hl(n,n,m.position),t(e.index,r,n,a,s*h,this.sign*h))}}}buildTopology(e,t){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const a=this.profile.vertexIndices[2*n+0],o=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[a],c=this.vertexBufferStart+this.profile.poleIndices[o];let h=r+a,u=r+o;for(let m=0;m<this.numSegments-1;++m){const f=s+m*this.profile.vertices.length+a,y=s+m*this.profile.vertices.length+o;this.flip?(t(f,u,h),t(u,f,y)):(t(h,u,f),t(y,f,u)),h=f,u=y}this.flip?(t(l,u,h),l!==c&&t(l,c,u)):(t(h,u,l),l!==c&&t(u,c,l))}}},Mse=class{constructor(e,t,r,s,n,a={}){this.options=a,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.profile=t,this.path=e,this.extruder=r,this.startCap=s,this.endCap=n;const o=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*o+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=ir(1*this.numVerticesTotal),this.profileRightAxisData=ir(4*this.numVerticesTotal),this.profileUpAxisData=ir(4*this.numVerticesTotal),this.profileVertexAndNormalData=ir(4*this.numVerticesTotal),this.originData=ir(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,t,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,r,s,n,a){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a,++this._extrusionVertexCount}_rebuildGeometry(){const e=(r,s,n,a,o)=>this.emitVertex(r,s,n,a,o),t=(r,s,n,a,o,l)=>this.emitCapVertex(r,s,n,a,o,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,t);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,e);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,t),this.startCap.rebuildCapGeometry(this.path.vertices[0],t),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],t)}buildTopology(){const e=this.profile.vertices.length,t=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(t*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,a=new Array,o=new Array,l=(c,h,u)=>{n.push(c),n.push(h),n.push(u),a.push(c),a.push(h),a.push(u),o.push(this.pathVertexData[c]),o.push(this.pathVertexData[h]),o.push(this.pathVertexData[u])};for(let c=0;c<t;++c){const h=this.profile.vertexIndices[2*c],u=this.profile.vertexIndices[2*c+1];for(let m=0;m<r;++m){const f=m*e+h,y=(m+1)*e+u,g=m*e+u;l(f,(m+1)*e+h,y),l(f,y,g)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=_x(n),this.normalIndices=_x(a),this.pathVertexIndices=_x(o)}onPathChanged(){this._rebuildGeometry()}},H6=class{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}},q6=class extends H6{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=ir(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=ir(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let t=0;t<this.builder.numVerticesTotal;++t){let r=this.builder.pathVertexData[t];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=Dse;Z(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const a=4*t,o=RS,l=sp,c=Km,h=$se,u=Fse;let m=0,f=0;if(Z(h,this.builder.profileRightAxisData[a],this.builder.profileRightAxisData[a+1],this.builder.profileRightAxisData[a+2]),Z(u,this.builder.profileUpAxisData[a],this.builder.profileUpAxisData[a+1],this.builder.profileUpAxisData[a+2]),pi(l,this.builder.profileVertexAndNormalData[a]*e[0],this.builder.profileVertexAndNormalData[a+1]*e[1]),s)Xe(c,u,h),m=this.builder.profileRightAxisData[a+3]*e[0],f=this.builder.profileUpAxisData[a+3];else{const g=fA,v=Lse;pi(g,this.builder.profileRightAxisData[a+3],this.builder.profileUpAxisData[a+3]);const b=oz(g);rb(g,g);const x=Or(l,g);if(Math.abs(x)>b){pi(v,-g[1],g[0]);const w=Or(l,v);La(g,g,b*Math.sign(x)),La(v,v,w),Hl(l,g,v)}Z(c,0,0,0)}Z(o,h[0]*l[0]+u[0]*l[1],h[1]*l[0]+u[1]*l[1],h[2]*l[0]+u[2]*l[1]),this.vertexAttributePosition[3*t+0]=n[0]+o[0]+c[0]*m,this.vertexAttributePosition[3*t+1]=n[1]+o[1]+c[1]*m,this.vertexAttributePosition[3*t+2]=n[2]+o[2]+c[2]*m;const y=sp;pi(y,this.builder.profileVertexAndNormalData[a+2],this.builder.profileVertexAndNormalData[a+3]),this.vertexAttributeNormal[3*t+0]=h[0]*y[0]+u[0]*y[1]+c[0]*f,this.vertexAttributeNormal[3*t+1]=h[1]*y[0]+u[1]*y[1]+c[1]*f,this.vertexAttributeNormal[3*t+2]=h[2]*y[0]+u[2]*y[1]+c[2]*f}}createGeometryData(){const e=[[C.POSITION,this.builder.vertexIndices],[C.NORMAL,this.builder.normalIndices]],t=[[C.POSITION,new Ae(this.vertexAttributePosition,3,!0)],[C.NORMAL,new Ae(this.vertexAttributeNormal,3,!0)]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;e.push([C.COLOR,new Array(r).fill(0)]),t.push([C.COLOR,new Ae(this.vertexAttributeColor,4)])}return{vertexAttributes:t,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,t,r){const s=this.builder.vertexIndices,n=new Ae(this.vertexAttributePosition,3),a=s.length/3;$2(e,t,0,a,s,n,void 0,void 0,r)}},Ise=class extends H6{constructor(e,t,r,s){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new q6(e),this.vvData=ir(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=t,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const a=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=a?1:0}}createGeometryData(){return{vertexAttributes:[[C.POSITION,new Ae(this.builder.originData,3,!0)],[C.PROFILERIGHT,new Ae(this.builder.profileRightAxisData,4,!0)],[C.PROFILEUP,new Ae(this.builder.profileUpAxisData,4,!0)],[C.PROFILEVERTEXANDNORMAL,new Ae(this.builder.profileVertexAndNormalData,4,!0)],[C.FEATUREVALUE,new Ae(this.vvData,4,!0)]],indices:[[C.POSITION,this.builder.pathVertexIndices],[C.PROFILERIGHT,this.builder.vertexIndices],[C.PROFILEUP,this.builder.vertexIndices],[C.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[C.FEATUREVALUE,this.builder.pathVertexIndices]]}}};const Dse=E(),sp=Ne(),fA=Ne(),Lse=Ne(),RS=E(),Km=E(),$se=E(),Fse=E(),Sv=E(),Nse=k6(),G3=ve(),W6=new Map([[C.POSITION,0],[C.PROFILERIGHT,1],[C.PROFILEUP,2],[C.PROFILEVERTEXANDNORMAL,3],[C.FEATUREVALUE,4]]);let Use=class extends LG{constructor(){super(...arguments),this.ambient=qe(.2,.2,.2),this.diffuse=qe(.8,.8,.8),this.specular=qe(0,0,0),this.opacity=1}},j6=class X6 extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2,t.spherical=e.viewingMode===Se.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gt(e.rctx,X6.shader.get().build(this.configuration),W6)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,r=e===It.NONE,s=e===It.FrontFace;return it({blending:t.output!==$.Color&&t.output!==$.Alpha||!t.transparent?null:r?go:Qd(e),culling:t.hasSlicePlane&&!t.transparent&&t.doubleSidedMode!==na.None?Az:null,depthTest:{func:Lp(e)},depthWrite:r||s?ka:null,colorWrite:ut,stencilWrite:t.hasOccludees?dh:null,stencilTest:t.hasOccludees?$p:null,polygonOffset:r||s?null:N2})}};j6.shader=new jt(DG,()=>Y(()=>import("./Path.glsl-91b99672.js"),["./Path.glsl-91b99672.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-f0dc8788.js","./vec2f64-70cfd09e.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./context-util-34d303b7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./aaBoundingBox-fb003858.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./vec4f64-6d0e93be.js","./vec2-848c6cf0.js","./Texture2DPassUniform-268e8d2d.js","./EvaluateSceneLighting.glsl-14c608ff.js","./compilerUtils-7bf6df9e.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./preload-helper-41c905a7.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./Normals.glsl-6a1bc6fb.js","./TransparencyPassType-c3841b0a.js","./Path.glsl-2eb74a31.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js"],import.meta.url));let Gr=class extends gc{constructor(){super(...arguments),this.output=$.Color,this.doubleSidedMode=na.None,this.transparencyPassType=It.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};d([L({count:$.COUNT})],Gr.prototype,"output",void 0),d([L({count:na.COUNT})],Gr.prototype,"doubleSidedMode",void 0),d([L({count:It.COUNT})],Gr.prototype,"transparencyPassType",void 0),d([L()],Gr.prototype,"spherical",void 0),d([L()],Gr.prototype,"receiveShadows",void 0),d([L()],Gr.prototype,"receiveAmbientOcclusion",void 0),d([L()],Gr.prototype,"vvSize",void 0),d([L()],Gr.prototype,"vvColor",void 0),d([L()],Gr.prototype,"vvOpacity",void 0),d([L()],Gr.prototype,"hasSlicePlane",void 0),d([L()],Gr.prototype,"transparent",void 0),d([L()],Gr.prototype,"hasOccludees",void 0),d([L()],Gr.prototype,"hasMultipassTerrain",void 0),d([L()],Gr.prototype,"cullAboveGround",void 0),d([L()],Gr.prototype,"doublePrecisionRequiresObfuscation",void 0),d([L({constValue:di.Disabled})],Gr.prototype,"pbrMode",void 0),d([L({constValue:!0})],Gr.prototype,"hasVvInstancing",void 0),d([L({constValue:!1})],Gr.prototype,"useCustomDTRExponentForWater",void 0),d([L({constValue:!1})],Gr.prototype,"useFillLights",void 0);let Vse=class Y6 extends Mp{constructor(e){super(e,new zse),this.supportsEdges=!0,this._vertexAttributeLocations=W6,this._configuration=new Gr,this._vertexBufferLayout=Y6.getVertexBufferLayout()}getConfiguration(e,t){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==$.Color&&e!==$.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?na.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?na.WindingOrder:na.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==$.Shadow&&e!==$.ShadowExcludeHighlight&&e!==$.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,t,r,s,n,a){const o=e;if(!B6(o))return;const l=o.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const v=this.parameters.vvSizeOffset,b=this.parameters.vvSizeFactor,x=this.parameters.vvSizeMinSize,w=this.parameters.vvSizeMaxSize,S=l.sizeAttributeValue;c[0]*=ie(v[0]+S*b[0],x[0],w[0]),c[1]*=ie(v[2]+S*b[2],x[2],w[2])}const h=Math.max(c[0],c[1]),u=e.boundingInfo;if(T(u))return void this._intersectTriangles(l,c,s,n,a);const m=gE(u.bbMin[0]-h,u.bbMin[1]-h,u.bbMin[2]-h,u.bbMax[0]+h,u.bbMax[1]+h,u.bbMax[2]+h),f=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),g=[y/f[0],y/f[1],y/f[2]];$F(m,s,g,r.tolerance)&&this._intersectTriangles(l,c,s,n,a)}_intersectTriangles(e,t,r,s,n){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,s,n)}createBufferWriter(){return new u0(this._vertexBufferLayout)}requiresSlot(e,t){switch(t){case $.Shadow:case $.ShadowHighlight:case $.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case $.Color:case $.Alpha:case $.Depth:case $.Normal:case $.Highlight:case $.ObjectAndLayerIdColor:return e===(this.parameters.transparent?ne.TRANSPARENT_MATERIAL:ne.OPAQUE_MATERIAL)||e===ne.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new Bse(e)}static getVertexBufferLayout(){return Rr().vec3f(C.POSITION).vec4f(C.PROFILERIGHT).vec4f(C.PROFILEUP).vec4f(C.PROFILEVERTEXANDNORMAL).vec4f(C.FEATUREVALUE)}},Bse=class extends Dp{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){(T(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==$.Color&&this._output!==$.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(j6,e)}},zse=class extends Use{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const kse=["polyline"];let Gse=class extends yc{constructor(e,t,r,s){super(e,t,r,s),this._intrinsicSize=ti(1,1),this._upVectorAlignment=Fd.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,t=_(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,t],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=Gy(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Fd.World:Fd.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=Sse(V9);break;case"quad":this._profile=Rse()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join){case"round":this._extruder=new rC(0,U9);break;case"bevel":this._extruder=new rC(0,1);break;case"miter":this._extruder=new rC(.8*Math.PI,1);break;default:this._extruder=new Ose}const a=this.symbolLayer.cap||"butt";switch(a){case"none":this._startCap=new z3,this._endCap=new z3;break;case"butt":default:this._startCap=new Ev(this._profile,0),this._endCap=new Ev(this._profile,0,!0);break;case"square":this._startCap=new Ev(this._profile,-.5),this._endCap=new Ev(this._profile,.5,!0);break;case"round":{const f=s==="quad";this._startCap=new k3({profile:this._profile,flip:!1,breakNormals:f,subdivisions:gS}),this._endCap=new k3({profile:this._profile,flip:!0,breakNormals:f,subdivisions:gS});break}}const o=ts(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(o),c=so(l),h=l[3],u=h<1||this.needsDrivenTransparentPass,m={diffuse:c,ambient:c,opacity:h,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||a==="none"?Fr.None:Fr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(pi(this._intrinsicSize,e,t),!Ub(this._intrinsicSize[0])||!Ub(this._intrinsicSize[1])))throw new ue("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||La(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const f={...m,...this._fastUpdates.materialParameters,size:dz(this._intrinsicSize)};this._material=new Vse(f)}else m.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new Ty(m);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,kse,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new ml),s=e.renderingInfo;return this._createAs3DShape(t,s,r,t.uid)}layerOpacityChanged(){const e=ts(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:t,transparent:r})}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,Xd)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}applyRendererDiff(e,t){for(const r in e.diff){if(r!=="visualVariables"||!Hy(this._fastUpdates,t,this._vvConvertOptions))return Cr.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Cr.Fast_Update}_getVertexData(e){let t=0;const r=e.paths,s=[],n=e.spatialReference,a=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const m of r)t+=m.length;const l=vo(3*t),c=vo(3*t);let h=0;for(const m of r){s.push({index:h,numVertices:m.length});for(const f of m)l[h++]=f[0],l[h++]=f[1],l[h++]=e.hasZ?f[2]:0}let u=!0;return _(a)&&!n.equals(a)&&(u=In(l,n,0,l,a,0,t)),_(a)&&!a.equals(o)?In(l,a,0,c,o,0,t):this._copyVertices(l,0,c,0,t),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c,projectionSuccess:u,terrainElevation:0}}_copyVertices(e,t,r,s,n){t*=3,s*=3;for(let a=0;a<n;++a)r[s++]=e[t++],r[s++]=e[t++],r[s++]=e[t++]}_createAs3DShape(e,t,r,s){const n=e.geometry,a=new Array,o=n.spatialReference,l=zs(),c=this._context.renderCoordsHelper;Z6.spatialReference=o;const h=this._getVertexData(n);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(h.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(y=>y.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const y of h.pathVertexDataInfos){const g=y.index,v=y.numVertices;if(v<2||_(this._context.clippingExtent)&&(Pi(l),Ua(l,h.vertexDataES,3*g,v),!Jo(l,this._context.clippingExtent)))continue;const b=[];for(let I=g;I<g+3*v;){const N=I++,F=I++,V=I++,Q=new Ese;Z(Q.posES,h.vertexDataES[N],h.vertexDataES[F],h.vertexDataES[V]);const ae=Mee(Q.posES,this._context.elevationProvider,r,c);Z(_i,h.vertexDataRS[N],h.vertexDataRS[F],h.vertexDataRS[V]),c.setAltitude(_i,ae),X(Q.pos,_i),b.push(Q)}const x=new Ase(b);Q6(x,this._upVectorAlignment,this._context.renderCoordsHelper);const w=new Mse(x,this._profile,this._extruder,this._startCap,this._endCap);let S=null;if(this._fastUpdates.enabled){const I=this._fastUpdates.visualVariables,N=I.size?sh(I.size.field,e):0,F=I.color?sh(I.color.field,e):0,V=I.opacity?sh(I.opacity.field,e):0;S=new Ise(w,N,F,V)}else{const I=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const V=t.size;I[0]*=H3(V[0],V[2]==="symbol-value"?this.symbolLayer.height||0:V[2],this.symbolLayer.width||0),I[1]*=H3(V[2],V[0]==="symbol-value"?this.symbolLayer.width||0:V[0],this.symbolLayer.height||0)}let N;this._drivenProperties.color&&(N=t.color),this._drivenProperties.opacity&&t.opacity!=null&&(N=N?[N[0],N[1],N[2],t.opacity]:[1,1,1,t.opacity]);const F=new q6(w);F.bake(I),N&&F.bakeVertexColors(N),S=F}const{vertexAttributes:P,indices:A}=S.createGeometryData(),M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),O=new vse(this._material,P,A,S,o,this._upVectorAlignment,this._stencilWidth,M);O.transformation=S.xform,a.push(O)}if(a.length===0)return null;const u={layerUid:this._context.layer.uid,graphicUid:s},m=new bh({geometries:a,metadata:u}),f=new _c(this,m,a,null,null,qse,r);return f.alignedSampledElevation=h.terrainElevation,f.needsElevationUpdates=Xd(r.mode),f}};function Q6(i,e,t){switch(e){default:case Fd.World:for(const r of i.vertices){J(_i,r.pos,i.offset),t.worldUpAtPosition(_i,_i),r.setFrameFromUpVector(_i),r.rotationFrameUp=r.frame.up,pi(r.rotationRight,1,0),W(_i,r.frame.up,oe(r.frame.up,r.vLeft)),ee(_i,r.vLeft,_i),On(_i,_i),K(_i,_i),W(Uh,r.frame.up,oe(r.frame.up,r.vRight)),ee(Uh,r.vRight,Uh),K(Uh,Uh),Xe(q3,r.rotationFrameUp,r.vLeft);const s=Math.sign(oe(q3,r.vRight));if(r.rotationAngle=s*(Math.PI-ws(oe(_i,Uh))),Math.abs(r.rotationAngle)>0){const a=cx(Math.cos(.5*r.rotationAngle));SS(r.miterStretch,a-1+1,0,0,1)}const n=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength/Math.cos(.5*n))}break;case Fd.Path:J(_i,i.vertices[0].pos,i.offset),t.worldUpAtPosition(_i,_i),Pse(i,_i);for(const r of i.vertices){const s=Math.sign(oe(r.frame.right,r.vRight));Xe(r.rotationFrameUp,r.vRight,r.vLeft),W(r.rotationFrameUp,r.rotationFrameUp,s),K(r.rotationFrameUp,r.rotationFrameUp);const n=oe(r.rotationFrameUp,r.frame.up),a=oe(r.rotationFrameUp,r.frame.right);if(W(_i,r.frame.up,-a),W(Uh,r.frame.right,n),J(_i,_i,Uh),K(_i,_i),Cse(r.rotationRight,r.frame,_i),On(_i,r.vLeft),r.rotationAngle=-s*(Math.PI-ws(oe(_i,r.vRight))),Math.abs(r.rotationAngle)>0){const l=cx(Math.cos(.5*r.rotationAngle));SS(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const o=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(r.vMinSiblingLength*cx(Math.cos(.5*o)))}}}function H3(i,e,t){switch(i){case"symbol-value":return t;case"proportional":return e;default:return i}}function Hse(i,e,t,r){let s=0;for(const n of i.vertices)t(n.posES,sC),s+=sC.sampledElevation,J(_i,n.pos,i.offset),r.setAltitude(_i,sC.z),ee(n.pos,_i,i.offset);return i.updatePathVertexInformation(),s/i.vertices.length}function qse(i,e,t,r,s){const n=i.stageObject,a=n.geometries;let o=0;Wse.spatialReference=s.spatialReference;for(const l of a){if(!B6(l))continue;const c=l.path,h=c.builder.path,u=l.geometrySR;Z6.spatialReference=u,o+=Hse(h,e,r,s),l.upVectorAlignment!==Fd.World&&Q6(h,l.upVectorAlignment,s),c.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(l)}return o/a.length}const Wse=yh(0,0,0,null),Z6=yh(0,0,0,null),_i=E(),Uh=E(),q3=E(),sC=new _0;function jse(i,e,t,r,s=1){if(t.isGeographic&&r===Se.Global){const c=vo(e.length),h=e.length,u=qt(t);for(let m=0;m<h;m+=3)N$(e,m,c,m,u);e=c}pi(br,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)br[0]=Math.min(br[0],e[c]),br[1]=Math.min(br[1],e[c+1]);const n=br[0]%s,a=br[1]%s,o=br[0]-n,l=br[1]-a;for(let c=0;c<e.length;c+=3){const h=c/3*4;i[h]=(e[c]-o)/s,i[h+1]=(e[c+1]-l)/s,i[h+2]=o/s,i[h+3]=l/s}}function K6(i,e,t,r,s=1){Z(_u,1,0,0),Z(yu,0,1,0),Z(Rm,0,0,1),Qse(nC,t),Xse(t,W3)&&Yse(W3,_u,yu,Rm,r,nC),pi(br,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),pi(vu,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let h=0;h<t.length;h+=3){Z(Sm,t[h],t[h+1],t[h+2]);const u=oe(_u,Sm),m=oe(yu,Sm);br[0]=Math.min(br[0],u),br[1]=Math.min(br[1],m),vu[0]=Math.max(vu[0],u),vu[1]=Math.max(vu[1],m)}const n=oe(Rm,nC);oC(Vh,br[0],br[1],n,_u,yu,Rm),oC(bu,vu[0],br[1],n,_u,yu,Rm),oC(wu,br[0],vu[1],n,_u,yu,Rm),ee(bu,bu,Vh),W(bu,bu,.5),ee(wu,wu,Vh),W(wu,wu,.5),J(Vh,Vh,bu),J(Vh,Vh,wu);const a=br[0]%s,o=br[1]%s,l=br[0]-a,c=br[1]-o;for(let h=0;h<t.length;h+=3){Z(Sm,t[h],t[h+1],t[h+2]);const u=h/3,m=4*u;i[m]=(oe(_u,Sm)-l)/s,i[m+1]=(oe(yu,Sm)-c)/s,i[m+2]=l/s,i[m+3]=c/s;const f=9*u;for(let y=0;y<3;y++)e[f+y]=Vh[y],e[f+y+3]=bu[y],e[f+y+6]=wu[y]}}const nC=E(),Sm=E(),W3=sr(),_u=E(),yu=E(),Rm=E(),br=Ne(),vu=Ne(),Vh=E(),bu=E(),wu=E();function Xse(i,e){const t=i.length/3-1;return qB(i,e,0,Math.floor(t/3),Math.floor(t*(2/3)))}function Yse(i,e,t,r,s,n){_(s)?(s.basisMatrixAtPosition(n,Cl),Z(Rv,Cl[0],Cl[1],Cl[2]),Z(Av,Cl[4],Cl[5],Cl[6]),Z(aC,Cl[8],Cl[9],Cl[10])):(Z(Rv,1,0,0),Z(Av,0,1,0),Z(aC,0,0,1));const a=Js(i);oe(a,aC)<0&&W(a,a,-1),X(r,a);const o=oe(a,Av),l=oe(a,Rv);Math.abs(o)<Math.abs(l)?(aP(e,Rv,a,-l),K(e,e),Xe(t,e,a),K(t,t),W(t,t,-1)):(aP(t,Av,a,-o),K(t,t),Xe(e,t,a),K(e,e))}const Cl=ve(),Rv=E(),Av=E(),aC=E();function Qse(i,e){Z(qg,0,0,0);for(let t=0;t<e.length-3;t+=3)qg[0]+=e[t],qg[1]+=e[t+1],qg[2]+=e[t+2];W(i,qg,1/(e.length/3-1))}const qg=E();function oC(i,e,t,r,s,n,a){Z(i,e*s[0]+t*n[0]+r*a[0],e*s[1]+t*n[1]+r*a[1],e*s[2]+t*n[2]+r*a[2])}let J6=class eU extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,eU.shader.get().build(this.configuration),Zt)}_createPipeline(e,t){const r=this.configuration,s=e===It.NONE,n=e===It.FrontFace;return it({blending:r.output!==$.Color&&r.output!==$.Alpha||!r.transparent?null:s?go:Qd(e),culling:L2(r.cullFace),depthTest:{func:Lp(e)},depthWrite:(s||n)&&r.writeDepth?ka:null,colorWrite:ut,stencilWrite:r.hasOccludees?dh:null,stencilTest:r.hasOccludees?t?fp:$p:null,polygonOffset:s||n?r.polygonOffset?Zse:null:V2(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}};J6.shader=new jt($G,()=>Y(()=>import("./ColorMaterial.glsl-727a6236.js"),["./ColorMaterial.glsl-727a6236.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-f0dc8788.js","./vec4f64-6d0e93be.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./TransparencyPassType-c3841b0a.js","./ColorMaterial.glsl-1d45c81e.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./VertexColor.glsl-2f905a78.js","./OutputDepth.glsl-17bf0574.js","./RgbaFloatEncoding.glsl-67199794.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./ReadLinearDepth.glsl-0e6f5c47.js","./AlphaCutoff-96178e0d.js","./Float4PassUniform-9354414b.js"],import.meta.url));const Zse={factor:1,units:1};let Hn=class extends gc{constructor(){super(...arguments),this.output=$.Color,this.cullFace=Fr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=It.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}};d([L({count:$.COUNT})],Hn.prototype,"output",void 0),d([L({count:Fr.COUNT})],Hn.prototype,"cullFace",void 0),d([L()],Hn.prototype,"hasSlicePlane",void 0),d([L()],Hn.prototype,"hasVertexColors",void 0),d([L()],Hn.prototype,"transparent",void 0),d([L()],Hn.prototype,"polygonOffset",void 0),d([L()],Hn.prototype,"enableOffset",void 0),d([L()],Hn.prototype,"writeDepth",void 0),d([L()],Hn.prototype,"hasOccludees",void 0),d([L({count:It.COUNT})],Hn.prototype,"transparencyPassType",void 0),d([L()],Hn.prototype,"hasMultipassTerrain",void 0),d([L()],Hn.prototype,"cullAboveGround",void 0),d([L()],Hn.prototype,"objectAndLayerIdColorInstanced",void 0);let j3=class extends nA{constructor(e){super(e,new Jse),this.supportsEdges=!0,this._configuration=new Hn}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<B2,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,t){return t===$.Color||t===$.Alpha||t===$.Highlight||t===$.Depth&&this.parameters.writeLinearDepth||t===$.ObjectAndLayerIdColor?e===ne.DRAPED_MATERIAL?!0:t===$.Highlight?e===ne.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?ne.TRANSPARENT_MATERIAL:ne.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:ne.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Kse(e)}createBufferWriter(){return new u0(Vt("enable-feature:objectAndLayerId-rendering")?Zte:h6)}},Kse=class extends Dp{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==$.Color&&this._output!==$.Alpha||this._updateOccludeeState(e),this.ensureTechnique(J6,e)}},Jse=class extends h0{constructor(){super(...arguments),this.color=Cf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Fr.None,this.hasOccludees=!1}},tU=class iU extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,iU.shader.get().build(this.configuration),rU)}_setPipelineState(e,t){const r=this.configuration,s=e===It.NONE,n=e===It.FrontFace;return it({blending:r.output===$.Color||r.output===$.Alpha?s?go:Qd(e):null,culling:L2(r.cullFace),depthTest:{func:Lp(e)},depthWrite:s?r.writeDepth?ka:null:gw(e),colorWrite:ut,stencilWrite:r.hasOccludees?dh:null,stencilTest:r.hasOccludees?t?fp:$p:null,polygonOffset:s||n?r.polygonOffset?ene:null:V2(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}};tU.shader=new jt(FG,()=>Y(()=>import("./Pattern.glsl-a183b6f5.js"),["./Pattern.glsl-a183b6f5.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-f0dc8788.js","./vec4f64-6d0e93be.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./TransparencyPassType-c3841b0a.js","./Pattern.glsl-698f2083.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./VertexColor.glsl-2f905a78.js","./OutputDepth.glsl-17bf0574.js","./RgbaFloatEncoding.glsl-67199794.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./ReadLinearDepth.glsl-0e6f5c47.js","./AlphaCutoff-96178e0d.js","./Float4PassUniform-9354414b.js","./FloatPassUniform-0426669b.js"],import.meta.url));const ene={factor:1,units:1};let Xs=class extends gc{constructor(){super(...arguments),this.output=$.Color,this.cullFace=Fr.None,this.transparencyPassType=It.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};d([L({count:$.COUNT})],Xs.prototype,"output",void 0),d([L({count:Fr.COUNT})],Xs.prototype,"cullFace",void 0),d([L({count:pd.COUNT})],Xs.prototype,"style",void 0),d([L({count:It.COUNT})],Xs.prototype,"transparencyPassType",void 0),d([L()],Xs.prototype,"hasSlicePlane",void 0),d([L()],Xs.prototype,"hasVertexColors",void 0),d([L()],Xs.prototype,"polygonOffset",void 0),d([L()],Xs.prototype,"writeDepth",void 0),d([L()],Xs.prototype,"hasOccludees",void 0),d([L()],Xs.prototype,"patternSpacing",void 0),d([L()],Xs.prototype,"lineWidth",void 0),d([L()],Xs.prototype,"enableOffset",void 0),d([L()],Xs.prototype,"draped",void 0),d([L()],Xs.prototype,"hasMultipassTerrain",void 0),d([L()],Xs.prototype,"cullAboveGround",void 0);const rU=new Map([[C.POSITION,0],[C.COLOR,3],[C.UVMAPSPACE,4],[C.BOUNDINGRECT,5]]);let gA=class extends nA{constructor(e){super(e,new rne),this.supportsEdges=!0,this._vertexAttributeLocations=rU,this._configuration=new Xs}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<B2,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,t){return t===$.Color||t===$.Alpha||t===$.Highlight||t===$.Depth&&this.parameters.writeLinearDepth?e===ne.DRAPED_MATERIAL?!0:t===$.Highlight?e===ne.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?ne.TRANSPARENT_MATERIAL:ne.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new tne(e)}createBufferWriter(){const e=Rr().vec3f(C.POSITION).vec4u8(C.COLOR).vec4f(C.UVMAPSPACE);return this.parameters.draped||e.mat3f(C.BOUNDINGRECT),new ine(e)}},tne=class extends Dp{_updateParameters(e){return this.ensureTechnique(tU,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==$.Color&&this._output!==$.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},ine=class extends u0{write(e,t,r,s,n){for(const a of this.vertexBufferLayout.fieldNames){const o=r.vertexAttributes.get(a),l=r.indices.get(a);if(o&&l)switch(a){case C.POSITION:{_t(o.size===3);const c=s.getField(a,Hd);c&&F2(l,o.data,e,c,n);break}case C.COLOR:{_t(o.size===3||o.size===4);const c=s.getField(a,Gd);c&&KF(l,o.data,o.size,c,n);break}case C.UVMAPSPACE:{_t(o.size===4);const c=s.getField(a,Ey);c&&lb(l,o.data,c,n);break}case C.BOUNDINGRECT:{_t(o.size===9);const c=s.getField(a,Cy);c&&this.writeBoundingRect(l,o.data,e,c,n);break}}}}writeBoundingRect(e,t,r,s,n){const a=r,o=s.typedBuffer,l=s.typedBufferStride,c=e.length;n*=l;for(let h=0;h<c;++h){const u=9*e[h],m=t[u],f=t[u+1],y=t[u+2];o[n]=a[0]*m+a[4]*f+a[8]*y+a[12],o[n+1]=a[1]*m+a[5]*f+a[9]*y+a[13],o[n+2]=a[2]*m+a[6]*f+a[10]*y+a[14];for(let g=3;g<9;++g)o[n+g]=t[u+g];n+=l}}},rne=class extends h0{constructor(){super(...arguments),this.color=Ai(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Fr.None,this.hasOccludees=!1,this.style=pd.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function sne(i,e,t){return ane(nne(i),e,t)}function nne(i){return i&&i.pattern||null}function ane(i,e,t){return _(i)?i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=Ai(0,0,0,0),e.transparent=!0),new j3(e)):(e.style=one(i.style),e.draped=t.isDraped,new gA(e)):new j3(e)}function one(i){switch(i){case"horizontal":return pd.Horizontal;case"vertical":return pd.Vertical;case"cross":return pd.Cross;case"forward-diagonal":return pd.ForwardDiagonal;case"backward-diagonal":return pd.BackwardDiagonal;case"diagonal-cross":return pd.DiagonalCross;default:return}}function lne(i){return i.material instanceof gA&&!i.material.parameters.draped}function cne(i,e){if(lne(i)){const t=i.vertexAttributes.get(C.POSITION).data,r=i.getMutableAttribute(C.UVMAPSPACE).data,s=i.getMutableAttribute(C.BOUNDINGRECT).data;K6(r,s,t,e)}}function hne(i,e,t,r,s){const n=O9(i,e,t,r,s),a=i.stageObject.geometries;for(const o of a)cne(o,s);return n}const dne=["polyline","polygon","extent"];let sU=class nU extends yc{constructor(e,t,r,s){super(e,t,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const e=ts(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=sne(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof gA,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const t=r=>{const s=I6(e.pattern);return new vf({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:CS(e.patternCap||"butt")})};this._outlineMaterial=t(Rn(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return _(e)&&e.size!=null&&e.size>0&&_(e.color)&&(T(e.pattern)||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,dne,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(t,new ml);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,s)}layerOpacityChanged(){if(_(this._material)){const e=this._material.parameters.color,t=ts(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t);this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,t,r){const s=this._elevationContext.mode,n=g0(nU.elevationModeChangeTypes,r,s);if(n!==Gi.UPDATE)return n;const a=xo(s);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,t,r){var h;const s=ky(e.geometry);if(T(s))return null;const n=hA(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),a=new une(n,t,this._context.layer.uid,e.uid),o=a.renderData.position.length/3;if(this._needsUV&&(a.uvMapSpace=ir(4*o,!0),a.boundingRect=vo(9*o,!0),K6(a.uvMapSpace,a.boundingRect,a.renderData.position,this._context.renderCoordsHelper)),a.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(a),this._createAs3DShapeFill(a),this._hasOutline&&this._createAs3DShapeOutline(a),this._logGeometryCreationWarnings(a.renderData,s.rings,"rings","FillSymbol3DLayer"),a.outGeometries.length===0)return null;const l=new bh({geometries:a.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),c=new _c(this,l,a.outGeometries,null,null,hne,r);return c.alignedSampledElevation=a.renderData.sampledElevation,c.needsElevationUpdates=xo(r.mode),c}_createAs3DShapeFill(e){const t=e.renderData.polygons;for(const{position:r,mapPositions:s,holeIndices:n,index:a,count:o}of t){if(_(this._context.clippingExtent)&&(Pi(qa),Ua(qa,s),!Jo(qa,this._context.clippingExtent)))continue;const l=Ry(s,n,3);if(l.length===0)continue;const c=UI({material:Et(this._material),indices:l,mapPositions:s,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?nM(e.uvMapSpace,4*a,4*o):null,boundingRect:this._needsUV?rl(e.boundingRect,9*a,9*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(c)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let r=0;r<t.length;++r){const{mapPositions:s,position:n}=t[r];if(_(this._context.clippingExtent)&&(Pi(qa),Ua(qa,s),!Jo(qa,this._context.clippingExtent)))continue;const a=ES(Et(this._outlineMaterial),{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:s,attributeData:{position:n}},e.objectAndLayerIdColor),o=a.vertexAttributes.get(C.POSITION);o.data===n&&(o.data=Ok(n)),e.outGeometries.push(a)}}_createAsOverlay(e,t){var o;const r=ky(e.geometry);if(T(r))return null;Et(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=y6(r,this._context.overlaySR),n=new pne(s,t,this._context.layer.uid,e.uid),a=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=ir(4*a,!0),jse(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Pi(),n.objectAndLayerIdColor=(o=this._context.stage.renderView)==null?void 0:o.getObjectAndLayerIdColor(n),this._createAsOverlayFill(n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new Gw(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:a}of t){const o=Pi(qa);if(Ua(o,r),!Jo(o,this._context.clippingExtent))continue;const l=Ry(r,s,3);if(l.length===0)continue;Xf(e.outBoundingBox,o);const c=UI({material:Et(this._material),indices:l,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?nM(e.uvMapSpace,4*n,4*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}}),h=new rg(c,e);Vs(h.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),e.outGeometries.push(h)}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let r=0;r<t.length;++r){const{position:s}=t[r];if(Pi(qa),Ua(qa,s),!Jo(qa,this._context.clippingExtent))continue;Xf(e.outBoundingBox,qa);const n=ES(Et(this._outlineMaterial),{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor),a=new rg(n,e),o=qa;Vs(a.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),e.outGeometries.push(a)}}_getOutlineOpacity(){const e=ts(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(e)?e.a:0)}_getOutlineColor(){const e=ts(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return ey(_(e)?li.toUnitRGB(e):null,t)}test(){return{...super.test(),createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,r)=>this._createAs3DShape(e,t,r)}}};sU.elevationModeChangeTypes={definedChanged:Gi.RECREATE,staysOnTheGround:Gi.NONE,onTheGroundChanged:Gi.RECREATE};const qa=zs();let une=class extends kw{constructor(e,t,r,s){super(e,r,s),this.color=t}},pne=class extends kw{constructor(e,t,r,s){super(e,r,s),this.color=t}},aU=class oU{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const t=this.definition.font;return`${t.style} ${t.weight} ${e}px ${t.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(t=>Math.floor(255*t)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(t=>Math.floor(255*t)).toString()},${e[3]})`}static async fromSymbol(e,t){const r=ts(e,"material","color"),s=hd(r,Cf,li.toUnitRGBA),n=hd(e.size,12,Rn),a=e.lineHeight,o=_(e.background)?Et(li.toUnitRGBA(e.background.color)):Cf,l={family:hd(e.font,"sans-serif",f=>f.family),decoration:hd(e.font,"none",f=>f.decoration),weight:hd(e.font,"normal",f=>f.weight),style:hd(e.font,"normal",f=>f.style)},c=e.halo,h=_(c)&&_(c.color)&&c.size>0?{size:Rn(c.size),color:li.toUnitRGBA(c.color)}:{size:0,color:Cf},u=new oU({color:s,size:n,background:{color:o,padding:_(e.background)?[.65*n,.5*n]:[0,0],borderRadius:_(e.background)?n*(6/16):0},lineSpacingFactor:a,font:l,halo:h,pixelRatio:t}),m=u.fontString(n);try{await document.fonts.load(m)}catch{pe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}return u}},mne=class{constructor(e,t,r){this._renderer=new x6(e,t,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=wS(fne,this._renderer.renderedWidth,this._renderer.renderedHeight),t=e.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new yw(e,{wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:j2.PAD})}};const fne={canvas:null},gne=[0,0,1];let _ne=class extends yc{constructor(e,t,r,s){super(e,t,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Bw(this.symbolLayer.size);if(e)throw new ue("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await aU.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,r=zy(t.geometry);if(T(r))return this.logger.warn(`unsupported geometry type for text symbol: ${t.geometry.type}`),null;const s=this.symbolLayer.text;if(T(s)||s==="")return null;const n=E2(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(n)&&!lF(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const a=new R9(n,this.symbolLayer.horizontalAlignment,Die(this.symbolLayer.verticalAlignment));return this._createAs3DShape(t,r,s,a)}createLabel(e,t,r,s){const n=e.graphic,a=zy(n.geometry);if(T(a))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const o=t.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(n,a,o,t,r,s)}setGraphicElevationContext(e,t,r=0){const s=super.setGraphicElevationContext(e,t);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return X3(e,t,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Gi.UPDATE}slicePlaneEnabledChanged(e,t){return X3(e,t,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}skipHighSymbolLodsChanged(){return!0}updateGraphicElevationContext(e,t){const r=t.elevationContext;this.setGraphicElevationContext(e,r,_(t.metadata)?t.metadata.elevationOffset:0),t.needsElevationUpdates=xo(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return vne}_createAs3DShape(e,t,r,s,n,a){const o=this.setGraphicElevationContext(e,new ml,s.elevationOffset),l=ts(e.geometry,"type")==="polyline",c=e.uid;let h=null,u=null;if(T(a)){const O=C6(s.horizontalPlacement);h=new mne(r,O,this._textRenderParameters);let I=null;if(_(this._context.sharedResources.textures)){u=this._context.sharedResources.textures.fromData(h.key,()=>Et(h).create(),()=>{_(I)&&I.release()});const N=this._context.stage.renderView.textureRepository.acquire(u.texture.id);if(T(N)||r0(N))return u.release(),null;I=N}}const m=yne(h,s),f={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,drawInSecondSlot:!0};if(_(a)?f.textureId=a.id:_(u)&&(f.textureId=u.texture.id),_(s.verticalOffset)){const{screenLength:O,minWorldLength:I,maxWorldLength:N}=s.verticalOffset;f.verticalOffset={screenLength:Rn(O),minWorldLength:I||0,maxWorldLength:_(N)?N:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:O,screenSizePerspectiveSettingsLabels:I}=this._context.sharedResources;f.screenSizePerspective=I.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),f.screenSizePerspectiveAlignment=O}let y;if(l&&(f.shaderPolygonOffset=1e-4),f.hasSlicePlane=this._context.slicePlaneEnabled,_(n)){const O=JSON.stringify(f);y=n.get(O),T(y)&&(y=new tg(f),n.add(O,y))}else y=new tg(f);const g=s.translation,v=_(h)?ti(h.displayWidth,h.displayHeight):uc,b=s.centerOffset,x=XE(y,gne,g,null,v,b,[0,0],null),w=iA(this._context,t,x,o,c);if(T(w))return null;const S=new _c(this,w.object,[x],T(n)?[y]:null,u,Vy,o);S.alignedSampledElevation=w.sampledElevation,S.needsElevationUpdates=xo(o.mode)||o.mode==="absolute-height";const{displayWidth:P,displayHeight:A}=_(h)?h:s;S.getScreenSize=(O=Ne())=>(O[0]=P,O[1]=A,O);const M=new N9(s.elevationOffset,r);return S.metadata=M,By(S,t,this._context.elevationProvider),S}};function X3(i,e,t){i&&i.forEach(r=>{const s=e(r);_(s)&&t(s,r.graphic)})}function yne(i,e){if(e.verticalPlacement==="baseline"){const r=Oie[e.horizontalPlacement],s=_(i)?i.baselineAnchorY:0;return ti(r,s)}const t=Iie(e.horizontalPlacement,e.verticalPlacement);return M1[t]}const vne={mode:"relative-to-ground",offset:0},bne={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},wne=["polyline","polygon","extent"];let AS=class Fu extends yc{constructor(e,t,r,s){super(e,t,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,wne,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new ml);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(_(this._material))return;const e=new m6,t=this.symbolLayer.color;_(t)&&(e.color=li.toUnitRGBA(t));const r=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=_(this.symbolLayer.waveDirection)?Fu.headingVectorFromAngle(this.symbolLayer.waveDirection):ti(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=bne[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new p6(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(T(this._material))return;const e=this._material.parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],t],transparent:r})}layerElevationInfoChanged(e,t,r){const s=this._elevationContext.mode,n=g0(Fu.elevationModeChangeTypes,r,s);if(n!==Gi.UPDATE)return n;const a=xo(s);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}skipHighSymbolLodsChanged(){return!0}_createAs3DShape(e,t,r){const s=ky(e.geometry);if(T(s))return null;const n=hA(s,this._context.elevationProvider,this._context.renderCoordsHelper,t),a=n.position.length/3,o=vo(2*a);this._createUVCoordsFromVertices(o,n.mapPositions,a,this._context.elevationProvider.spatialReference);const l=new xne(n,o);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new bh({geometries:l.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),h=new _c(this,c,l.outGeometries,null,null,O9,t);return h.alignedSampledElevation=l.renderData.sampledElevation,h.needsElevationUpdates=xo(t.mode),h}_createUVCoordsFromVertices(e,t,r,s){const n=Yd(s);nl(Bh);for(let l=0;l<r;l++)pi(Y3,t[3*l],t[3*l+1]),p2(Bh,Y3);uw(Bh,Bh,n);const a=Bh[0]%Fu.unitSizeOfTexture,o=Bh[1]%Fu.unitSizeOfTexture;Pv[0]=Bh[0]-a,Pv[1]=Bh[1]-o;for(let l=0;l<r;l++)e[2*l]=(t[3*l]*n-Pv[0])/Fu.unitSizeOfTexture,e[2*l+1]=(t[3*l+1]*n-Pv[1])/Fu.unitSizeOfTexture}_create3DShapeGeometries(e){const t=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:a,mapPositions:o,holeIndices:l}of t){if(_(this._context.clippingExtent)&&(Pi(zh),Ua(zh,o),!Jo(zh,this._context.clippingExtent)))continue;const c=Ry(o,l,3);if(c.length===0)continue;const h=rl(r,2*n,2*s),u=VI({material:Et(this._material),indices:c,mapPositions:o,attributeData:{position:a,uv0:h}});e.outGeometries.push(u)}}_createAsOverlay(e){const t=ky(e.geometry);if(T(t))return null;Et(this._material).renderPriority=this._renderPriority;const r=y6(t,this._context.overlaySR),s=r.position.length/3,n=vo(2*s);this._createUVCoordsFromVertices(n,r.position,s,this._context.overlaySR);const a=new Tne(r,n,this._context.layer.uid,e.uid);return a.outBoundingBox=Pi(),this._createAsOverlayWater(a),this._logGeometryCreationWarnings(a.renderData,t.rings,"rings","WaterSymbol3DLayer"),a.outGeometries.length===0?null:new Gw(this,a.outGeometries,a.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const t=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:a,count:o}of r){if(Pi(zh),Ua(zh,s),!Jo(zh,this._context.clippingExtent))continue;Xf(e.outBoundingBox,zh);const l=Ry(s,n,3);if(l.length===0)continue;const c=rl(t,2*a,2*o),h=VI({material:Et(this._material),indices:l,attributeData:{position:s,uv0:c}}),u=new rg(h,e),m=zh;Vs(u.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),e.outGeometries.push(u)}}static headingVectorFromAngle(e){const t=Ne(),r=Y2(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};AS.unitSizeOfTexture=100,AS.elevationModeChangeTypes={definedChanged:Gi.RECREATE,staysOnTheGround:Gi.NONE,onTheGroundChanged:Gi.RECREATE};const Pv=Ne(),Bh=Ot(),Y3=Ne(),zh=zs();let xne=class extends kw{constructor(e,t){super(e,null,null),this.uvCoords=t}},Tne=class extends kw{constructor(e,t,r,s){super(e,r,s),this.uvCoords=t}};function Cne(i,e,t,r){const s=Q3[i.type]&&Q3[i.type][e.type]||Ene[e.type];return s?new s(i,e,t,r):(pe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const Ene={icon:TS,object:Kre,line:D6,path:Gse,fill:sU,extrude:yie,text:_ne,water:AS},Q3={"mesh-3d":{fill:Rre}};let Sne=class extends JR{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,r)=>{const s=this.symbolLayers[r];_(s)&&(s.symbol=e,s.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const s=[];for(let n=0;n<r;n++){const a=t.getItemAt(n);if(a.enabled===!1)continue;Ov.renderPriority=1-(1+n)/r,Ov.renderPriorityStep=1/r,Ov.ignoreDrivers=a._ignoreDrivers;const o=Cne(this.symbol,a,this._context,Ov),l=iB(e,()=>{this.symbolLayers[n]=null,o.destroy()});l&&s.push(l),this.symbolLayers[n]=o}if(await R2(this.symbolLayers,async(n,a)=>{if(_(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[a]=null}}),s.forEach(n=>n.remove()),Ti(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return _(t)?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>_(e)&&e.queryForSnapping)}createGraphics3DGraphic(e,t){const r=e.graphic,s=new Array(this.symbolLayers.length);for(let a=0;a<this.symbolLayers.length;a++){const o=this.symbolLayers[a];s[a]=_(o)?o.createGraphics3DGraphic(e):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new pte(r,t||this,s,e.layer,n)}get complexity(){return tA(this.symbolLayers.map(e=>ts(e,"complexity")))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],a=o=>{const l=o.layers[s];return l instanceof _c?l:null};if(_(n)&&!n.globalPropertyChanged(e,t,a))return!1}return!0}applyRendererDiff(e,t){return this.loadStatus!==Ma.LOADED?Cr.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==Cr.Recreate_Symbol&&_(s)?Math.min(r,s.applyRendererDiff(e,t)):r,Cr.Fast_Update)}prepareSymbolPatch(e){if(this.loadStatus===Ma.FAILED||e.diff.type!=="partial")return;const t=e.diff.diff;if(!t.symbolLayers||t.symbolLayers.type!=="partial")return;const r=t.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(T(s))return;const a=r[n];if(a){const o={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(o),e.symbolStatePatches.push(...o.symbolLayerStatePatches),o.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const h=l.layers[n];_(h)&&o.graphics3DGraphicPatches.forEach(u=>u(h,c))})}})}updateGeometry(e,t){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(T(s))continue;const n=e.layers[r];if(T(n)||!s.updateGeometry(n,t))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(T(r))continue;const s=e.layers[t];_(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,t=0,r=0;return this.symbolLayers.forEach(s=>{T(s)||(s.loadStatus===Ma.LOADING?e++:s.isFastUpdatesEnabled()?r++:t++)}),{loading:e,slow:t,fast:r}}async queryForSnapping(e,t,r,s){const n=this.symbolLayers.filter(_).filter(o=>_(o.queryForSnapping)).map(o=>o.queryForSnapping(e,t,r,s)),a=await Promise.all(n);return Ti(s),a.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)_(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const Ov={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};let Rne=class extends JR{constructor(e,t,r){super(t),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:eA}globalPropertyChanged(e,t){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,t):Cr.Recreate_Symbol}prepareSymbolPatch(e){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function _A(i){return i instanceof Rne?i.graphics3DSymbol:i instanceof Sne?i:null}const qy=pe.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Ane(i){const e=Nne(i);if(T(e))return null;const t=Pne(i,e);if(T(t))return null;const r=t.anchor,s=!!e.hasLabelVerticalOffset;return Mne({anchor:r,verticalOffset:e.verticalOffset,screenOffset:Ne(),centerOffset:Ai(0,0,0,-1),centerOffsetUnits:"world",translation:E(),elevationOffset:0,hasLabelVerticalOffset:s},t,i)}function Pne(i,e){if(e.anchor)return e;const t=i.labelClass.labelPlacement,r=el[t],s=r||Hb(i);return t&&!r&&qy.warnOncePerTick(`the requested label placement '${t}' is currently unsupported in SceneView.`),One(s,i)}function yA(i){const e=i.graphics3DGraphic.graphics3DSymbol,t=_A(e);return _(t)?t.symbol.symbolLayers.getItemAt(0):null}function One(i,e){const t=e.graphics3DGraphic.graphic.geometry;if(T(t))return null;if(_(e.disablePlacement))return e.labelClass.labelPlacement?(qy.warnOncePerTick(Z3(i.placement,e.disablePlacement.logEntityDescription)),Hb(e)):i;const r=t.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return qy.warnOncePerTick(Z3(i.placement,`'${r}' geometries`)),Hb(e);break;case"point":case"mesh":return i}return i}function Z3(i,e){return`the requested label placement '${i}' is currently unsupported for ${e} in SceneView.`}function Hb(i){const e=i.graphics3DGraphic.graphic.geometry;if(T(e))return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const t=yA(i);return _(t)&&t.type==="extrude"?el["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return el["above-center"];default:return}}function Mne(i,e,t){const r=t.graphics3DGraphic.graphic.geometry;if(T(r))return null;switch(r.type){case"point":Dne(i,e,t);break;case"polygon":Ine(i,e,t);break;case"mesh":vA(i,e,t.graphics3DGraphic.layers[0])}return i}function Ine(i,e,t){const r=yA(t);if(!T(r))switch(r.type){case"extrude":{const s=t.graphics3DGraphic.layers[0];_(s)?(s.getBoundingBoxObjectSpace(ay),Ko(ay,i.translation),i.translation[2]=H2(ay)/2):Z(i.translation,0,0,0),vA(i,e,s);break}}}function Dne(i,e,t){const r=yA(t);if(T(r))return;const s=t.graphics3DGraphic.layers[0];switch(_(s)?s.getCenterObjectSpace(i.translation):Z(i.translation,0,0,0),r.type){case"icon":case"text":Lne(i,e,t,s);break;case"object":vA(i,e,s)}}function Lne(i,e,t,r){const{graphics3DGraphic:s}=t,n=_(r)?r.getScreenSize():null;if(!s.isDraped&&_(n)){const a=$ne(t);Wg[0]=n[0]/2*(e.normalizedOffset[0]-a[0]),Wg[1]=n[1]/2*(e.normalizedOffset[1]-a[1]),i.screenOffset[0]=Wg[0],i.hasLabelVerticalOffset?(i.centerOffset[1]=Wg[1],i.centerOffsetUnits="screen"):i.screenOffset[1]=Wg[1]}else i.hasLabelVerticalOffset||i.anchor==="center"||(el[t.labelClass.labelPlacement]&&qy.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),i.anchor="center")}function $ne(i,e=Une){const{graphics3DGraphic:t}=i,r=t.layers[0],s=_(r)?r.stageObject.geometries[0].material:null;if(s&&s instanceof tg){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function vA(i,e,t){const r=_(t)?t.getBoundingBoxObjectSpace(ay):ay,s=qe(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);i.centerOffset[0]=n/2*e.normalizedOffset[0];const a=i.translation[2],o=s[2]/2*e.normalizedOffset[1];i.translation[2]=0,i.elevationOffset=a+o;const l=xe(s);i.centerOffset[2]=l/2*e.normalizedOffset[2]}function Fne(i){return i==="above-center"}function Nne(i){const e=i.labelClass.labelPlacement,{labelSymbol:t,graphics3DGraphic:r}=i,s=_A(r.graphics3DSymbol),n=sa(s,o=>o.symbol.type==="point-3d"?o.symbol:null),a=el[e]||Hb(i);return _(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:K3(n.verticalOffset),anchor:null,normalizedOffset:null}:t&&t.hasVisibleVerticalOffset()&&(T(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?Fne(a.placement)?{placement:"above-center",verticalOffset:K3(t.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(qy.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function K3(i){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=i;return{screenLength:e,minWorldLength:t,maxWorldLength:r}}const el={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},J3={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const i in J3){const e=J3[i],t=el[i];e.forEach(r=>{el[r]=t})}Object.freeze&&(Object.freeze(el),Object.keys(el).forEach(i=>{Object.freeze(el[i]),Object.freeze(el[i].normalizedOffset)}));const Wg=[0,0],Une=[0,0],ay=zs();let eD=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,t){this._materials.set(e,t),this._stage.add(t)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const lC=512,cC=4096,Vne=.85,Bne=.95;let zne=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Xt()}},kne=class{constructor(e,t){this.textId=e,this.textRenderer=t,this.placement=new zne,this.rendered=!1}},R_=class extends ge{constructor(e){super(e),this.type=Ns.Texture,this.id=Bf(),this.events=new Br,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Le(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,flipped:!0,samplingMode:Rt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new ui(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(rr.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Us(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Le(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",lC.toString()),e.setAttribute("height",lC.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=lC){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let r=Math.max(e,t);return r+=256,r=s2(r),r=Math.min(r,cC),r}_resizeAtlas(e,t){t=t||e;const r=this._atlas;r.size.width=e,r.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=jg,e.cursor.y=jg+tD,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,t=this._elementsToAddOrUpdate.size,r=this._elements.size;return this._getAtlasUsage()/r*(r+t-e)}_addAtlasElement(e,t,r,s){const n=this._atlas,{renderedWidth:a,renderedHeight:o}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,Vs(e.placement.uvMinMax,e.placement.offset.x/n.size.width,1-(e.placement.offset.y+o)/n.size.height,(e.placement.offset.x+a)/n.size.width,1-e.placement.offset.y/n.size.height),n.cursor.x+=r,n.lineHeight=Math.max(n.lineHeight,s),this._elements.set(t,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const t=e.placement.offset;this._ctx.clearRect(t.x,t.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const t=this._stageObjects.get(e);if(t)return t;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this._stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].vertexAttributes.get(C.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometries[0]))}_processAddition(e,t){const r=this._atlas,s=e.textId,n=e.textRenderer.renderedWidth,a=e.textRenderer.renderedHeight,o=n+jg,l=a+jg+tD;if(r.cursor.x+o<r.size.width&&r.cursor.y+l<r.size.height)this._addAtlasElement(e,s,o,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s);else{if(!(r.cursor.y+l+r.lineHeight<r.size.height)){const c=this._getExpectedAtlasUsage(),h=c>Vne&&r.size.width<cC;return h&&this._resizeAtlas(2*r.size.width,2*r.size.height),!t||!h&&c>Bne&&r.size.width===cC?(this._processRemovals(),bf.OK):(this._repack(),bf.REPACK)}r.cursor.x=jg,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,s,o,l),this._elementsToRender.set(s,e),this._elementsToAddOrUpdate.delete(s)}return bf.OK}_processRemovals(){this._elementsToRemove.forEach((e,t)=>{const r=this._stageObjects.get(t);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(t)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,t)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(t,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const t=this._stageObjects.get(e.textId);t&&t.forEach(r=>{r.geometries[0].vertexAttributes.get(C.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(C.SIZE).data=[e.textRenderer.displayWidth,e.textRenderer.displayHeight],r.geometryVertexAttrsUpdated(r.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(T(this._glTexture))return Mn.YIELD;let r=!1;if(fs(this._elementsToAddOrUpdate,(n,a)=>{const o=this._elements.get(a);if(o&&o.rendered){const l=this._stageObjects.get(a);return l&&l.forEach(c=>{const h=c.geometries[0].vertexAttributes,u=this._elements.get(a);h.get(C.UV0).data=u.placement.uvMinMax,h.get(C.SIZE).data=[u.textRenderer.displayWidth,u.textRenderer.displayHeight],c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(a),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(a),t)===bf.REPACK&&(r=!0,!0)}),r)return this.runTask(ta,!1),void e.madeProgress();let s=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),fs(this._elementsToRender,(n,a)=>(this._processRenderingRequest(n),this._elementsToRender.delete(a),s=!0,e.madeProgress(),e.done)),s&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&Ste.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,t){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,new kne(r,e)),this._addStageObject(r,t),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,t){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,s)=>e.push({element:r,key:s}));let t=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this._elementsToRemove.size){e.sort((r,s)=>r.key.localeCompare(s.key)),this._elements.clear();for(const{element:r,key:s}of e)this._elements.set(s,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:t,_elementsToRemove:r,_atlas:s}=this,n=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:s,resizeAtlas:(a,o)=>n._resizeAtlas(a,o),run:(a,o)=>n.runTask(a,o)}}};d([p({constructOnly:!0})],R_.prototype,"view",void 0),d([p({type:Boolean})],R_.prototype,"updating",void 0),R_=d([k("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],R_);const jg=2,tD=2;var bf;(function(i){i[i.OK=0]="OK",i[i.REPACK=1]="REPACK"})(bf||(bf={}));let iD=class{constructor(e,t){this.labelingContext=e,this.graphics3DGraphic=t,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},Gne=class{constructor(e,t,r,s,n){this.labelClass=e,this.graphics3DSymbol=t,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},Hne=class{constructor(e,t,r,s,n,a,o){this.layer=e,this.graphics3DCore=t,this.scaleVisibility=r,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=n,this.disablePlacement=a,this.active=o,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new e6({pickable:!0,disableOctree:!0},e.uid)}},Nu=class extends ge{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new mi,this._handles.add([z(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),z(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(rr.LABELER,this)]),this._textTextureAtlas=new R_({view:this.view}),this._hudMaterialCollection=new eD(this.view._stage),this._calloutMaterialCollection=new eD(this.view._stage)}dispose(){this._handles=we(this._handles),this._textTextureAtlas=Le(this._textTextureAtlas),this._hudMaterialCollection=Le(this._hudMaterialCollection),this._calloutMaterialCollection=Le(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.graphics.forEach((t,r)=>{const s=new iD(e,t);this._labels.set(r,s),e.labelsToInitialize.set(r,s),t.setVisibilityFlag(ra.USER_SETTING,!0,es.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((t,r)=>{t.setVisibilityFlag(ra.USER_SETTING,!1,es.LABEL),this.setLabelGraphicVisibility(t,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];_(r)&&this._textTextureAtlas.addTextTexture(r,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];_(r)&&this._textTextureAtlas.removeTextTexture(r,t.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Mn.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(t.active){if(!rD(t)){if(qne(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),hC(t)){this._dirty=!0;continue}if(!rD(t))continue}fs(t.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var a,o,l;const t=(a=e.labelClassAbortController)==null?void 0:a.signal;await((l=(o=e.layer).when)==null?void 0:l.call(o)),Ti(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=s.labelingInfo&&s.labelingInfo.filter(c=>!!c.symbol);!n||n.length===0||(await R2(n,async(c,h)=>{const u=c.symbol,m=_A(r.getOrCreateGraphics3DSymbol(u));if(T(m))return void pe.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await m.load(),Ti(t);let f=null;E2(u)&&u.hasVisibleCallout()&&(f=hte(u,r.symbolCreationContext),await f.load(),Ti(t));const y=await yy(Kk(c,e.layer.fieldsIndex,this.view.spatialReference));if(Ti(t),y.ok===!0){const g=await this._createTextRenderParameters(m.symbol);Ti(t),e.labelClassContexts[h]=new Gne(c,m,f,g,y.value)}else pe.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${y.error}`)}),Ti(t))}async _createLabelClassContext(e){return T(e.labelClassPromise)&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(za(t))throw t;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?aU.fromSymbol(t,this.view.state.rasterPixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,sl(t),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,s,n){const a=new R9(r.verticalOffset,v3(r.anchor),Mie(r.anchor),e.text,r.translation,r.elevationOffset,r.centerOffset,r.screenOffset,r.centerOffsetUnits,e.displayWidth,e.displayHeight);return kh.graphic=t,kh.renderingInfo=null,kh.layer=s,n.createLabel(kh,a,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,r,s,n){return kh.graphic=e,kh.layer=n,kh.renderingInfo=new lte(null,t,s.translation,s.centerOffset,s.screenOffset,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(kh)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.layers.length===0)return!1;let n=!1;const a=t.graphic,o=r.layer,l=Mv(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const u=e.textRenderers[h],m=e.textLabelPlacements[h];if(T(u)||T(m))continue;const f=s[h],y=f.graphics3DSymbol,g=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,v=y.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(r.elevationInfoOverride);const b=this._createTextSymbolGraphic(u,a,m,o,v);if(T(b))return!1;b._labelClass=f.labelClass,b._labelIndex=h,t.addLabelGraphic(b,c,r.stageLayer),t.setVisibilityFlag(ra.USER_SETTING,l,es.LABEL),t.clearVisibilityFlag(ra.SCALE_RANGE,es.LABEL),t.setVisibilityFlag(ra.DECONFLICTION,!1,es.LABEL),n=!0;const x=f.graphics3DCalloutSymbolLayer;if(x&&m.hasLabelVerticalOffset){x.setElevationInfoOverride(r.elevationInfoOverride);const w=this._createLineCalloutGraphic(a,g,x,m,o);_(w)&&(f.calloutSymbolLayerIndex=t.labelLayers.length,t.addLabelGraphic(w,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];s!=null&&s.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const t=e.labelingContext,r=t.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let a=0;a<r.length;a++){const o=r[a];if(e.textRenderers[a]=null,e.textLabelPlacements[a]=null,!o.textRenderParameters)continue;const l=o.labelFunction;let c;if(l.type==="arcade")try{const x=l.needsHydrationToEvaluate()?Tee(s,t.layer):s;c=l.evaluate(x)}catch{c=null}else c=l.evaluate(s);if(T(c)||c===""||/^\s+$/.test(c))continue;const h=o.graphics3DSymbol,u=((n=h.symbol)==null?void 0:n.type)==="label-3d"?h.symbol:null;if(!h.symbolLayers[0])continue;const m=e.graphics3DGraphic,f=o.labelClass,y=t.disablePlacement,g=Ane({graphics3DGraphic:m,labelSymbol:u,labelClass:f,disablePlacement:y});if(T(g))continue;const v=v3(g.anchor),b=C6(v);e.textRenderers[a]=new x6(c,b,o.textRenderParameters),e.textLabelPlacements[a]=g}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,t){const r=t.graphic.uid;if(e.graphics.set(r,t),e.active){const s=new iD(e,t);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const s=new Map;t.graphics.forEach(a=>s.set(a.graphic.uid,a));const n=a=>a.labelLayers[0];if(Et(r.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const a=o=>o.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,a)}}}_visibilityInfoChange(e){const t=Mv(e.layer);t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((t,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,s.rendered=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const s=r&&r.emptySymbolLabelSupported||!1,n=r&&r.elevationInfoOverride||null,a=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,l=new Hne(o,e,t,s,n,a,Mv(o));return this.view._stage.add(l.stageLayer),this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>Mv(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.graphics.forEach(s=>this._removeGraphic(t,s)),this.view._stage.remove(t.stageLayer),this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==t&&(t&&!s.rendered?(this._labelsToAdd.set(r,s),this._labelsToRemove.delete(r),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!t&&s.rendered&&(this._labelsToRemove.set(r,s),this._labelsToAdd.delete(r)),s.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>hC(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,r)=>t+(hC(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function hC(i){return!!i.labelClassPromise&&!!i.labelClassAbortController}function rD(i){return i.labelClassContexts&&i.labelClassContexts.length}function qne(i){return i.labelClassContexts===null}function Mv(i){var e;return i.labelsVisible===!0&&!!((e=i.labelingInfo)!=null&&e.some(t=>!!t.symbol))}d([p({constructOnly:!0})],Nu.prototype,"view",void 0),d([p({constructOnly:!0})],Nu.prototype,"deconflictor",void 0),d([p()],Nu.prototype,"_textTextureAtlas",void 0),d([p({type:Boolean,readOnly:!0})],Nu.prototype,"updating",null),Nu=d([k("esri.views.3d.layers.graphics.Labeler")],Nu);const kh=new cte(null,null,null);let A_=class Jm{constructor(e,t,r,s=null){this.lij=[0,0,0],this.extent=Ot(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Ms.VISIBLE_ON_SURFACE,screenRect:Ot(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,t,r,s)}acquire(e,t,r,s){this.tilingScheme=s,this.id=Jm.id(e,t,r),this.lij[0]=e,this.lij[1]=t,this.lij[2]=r,s.getExtent(e,t,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const t=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(t,r,s,this.tilingScheme),e[1].acquire(t,r+1,s,this.tilingScheme),e[2].acquire(t,r,s+1,this.tilingScheme),e[3].acquire(t,r+1,s+1,this.tilingScheme),e):[new Jm(t,r,s,this.tilingScheme),new Jm(t,r+1,s,this.tilingScheme),new Jm(t,r,s+1,this.tilingScheme),new Jm(t,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,my(e.measures.screenRect,this.measures.screenRect)}static id(e,t,r){return`${e}/${t}/${r}`}};var Ms;(function(i){i[i.INVISIBLE=0]="INVISIBLE",i[i.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",i[i.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Ms||(Ms={}));const lU=.5*Math.PI,Wne=lU/Math.PI*180;let jne=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:E(),direction:E()};for(let t=0;t<4;t++)this._extent[t]={origin:E(),direction:E(),cap:{next:null,direction:E()}},this._planes[t]=sr();this._planes[Ki.NEAR]=sr(),this._planes[Ki.FAR]=sr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,t,r),J(this._center.origin,n[0].origin,n[2].origin),W(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||W(this._center.direction,this._center.direction,-1);for(let a=0;a<4;a++){const o=n[a];this._renderCoordsHelper.worldUpAtPosition(o.origin,o.direction);const l=n[a===3?0:a+1];o.cap.next=l.origin,Rp(o.cap.direction,o.origin,l.origin),_y(o.direction,o.cap.direction,o.origin,this._planes[a]),s||W(o.direction,o.direction,-1)}_y(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Ki.NEAR]),s?sE(this._planes[Ki.NEAR],this._planes[Ki.FAR]):(J$(this._planes[Ki.FAR],this._planes[Ki.NEAR]),sE(this._planes[Ki.NEAR],this._planes[Ki.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*qt(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Se.Global){const n=this._maxSpanSpatialReference.isGeographic?Wne:lU*t;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(al(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const a=this._extent[n];if(!r&&e.intersectsRay(al(a.origin,a.direction))||e.intersectsLineSegment(ap(a.origin,a.cap.next,Yne),a.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const a=e.lines[n];if(jY(s,a.origin,a.endpoint,a.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,r){m2(e,Po),Po[2]=r,ch(t,Po,dC,this._renderCoordsHelper.spatialReference),aa(sD,dC),Pi(Vn);for(const{x0:n,x1:a,y0:o,y1:l}of Xne)for(let c=0;c<5;c++){const h=c/4;Po[0]=dt(e[n],e[a],h),Po[1]=dt(e[o],e[l],h),Po[2]=r,vs(Po,t,Po,this._renderCoordsHelper.spatialReference),Pe(Po,Po,sD),jf(Vn,Po)}Z(this._extent[0].origin,Vn[0],Vn[1],Vn[2]),Z(this._extent[1].origin,Vn[3],Vn[1],Vn[2]),Z(this._extent[2].origin,Vn[3],Vn[4],Vn[2]),Z(this._extent[3].origin,Vn[0],Vn[4],Vn[2]);for(let n=0;n<4;++n)Pe(this._extent[n].origin,this._extent[n].origin,dC)}_toRenderBoundingExtentLocal(e,t,r){sw(e,t,Ic,this._renderCoordsHelper.spatialReference),Z(this._extent[0].origin,Ic[0],Ic[1],r),Z(this._extent[1].origin,Ic[2],Ic[1],r),Z(this._extent[2].origin,Ic[2],Ic[3],r),Z(this._extent[3].origin,Ic[0],Ic[3],r)}_toRenderBoundingExtent(e,t,r){switch(this._renderCoordsHelper.viewingMode){case Se.Global:this._toRenderBoundingExtentGlobal(e,t,r);break;case Se.Local:this._toRenderBoundingExtentLocal(e,t,r);break;default:ll(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if(ji(e.planes[Ki.NEAR],this._center.origin)<0&&oe(this._center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const r=this._extent[t];if(ji(e.planes[Ki.NEAR],r.origin)<0&&oe(r.direction,e.direction)<0)return!0}return!1}};const Xne=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Po=E(),dC=ve(),sD=ve(),Vn=zs(),Ic=Ot(),Yne=ag();let Qne=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new wd(e),this._extendedFrustum=new wd(e),this._intersector=new jne({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,t){this._surfaceElevation=t,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>t,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Ms.INVISIBLE;const t=this._renderCoordsHelper.viewingMode===Se.Global&&e.lij[0]>=Zne&&e.lij[0]<Kne,r=this._getOrCalculateSingleTileVisibility(e,!t);return r!==Ms.INVISIBLE&&t?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const t=wd.nearFarLineIndices,r=e.mutablePoints;for(const s of t){const[n,a]=s,o=r[n],l=r[a];ee(va,l,o),W(va,va,eae),J(r[a],o,va)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let t=Ms.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=lD.acquire();e.getChildren(s);for(const n of s){const a=this.calculate(n);if(a!==Ms.INVISIBLE&&(t=a,a===Ms.VISIBLE_ON_SURFACE))break}return lD.release(s),this._cache.set(e.id,t),t}_getOrCalculateSingleTileVisibility(e,t){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return t&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Se.Global&&e.lij[0]<Jne?this._calculateSingleTileVisibilitySided(e,!1)===Ms.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,t){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,t);const r=qt(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?Ms.VISIBLE_ON_SURFACE:Ms.VISIBLE_WHEN_EXTENDED:Ms.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const t=this._renderCoordsHelper.worldUpAtPosition(e.eye,va);this._aboveGround||On(t,t);const r=ws(-oe(t,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let a=0;a<4;a++){const o=s.pointIndices[a],l=n[o],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,va),o){case yi.FAR_BOTTOM_LEFT:case yi.FAR_TOP_LEFT:case yi.NEAR_BOTTOM_LEFT:case yi.NEAR_TOP_LEFT:dP(this._extendedFrustum.planes[Ki.LEFT],va,va);break;case yi.FAR_BOTTOM_RIGHT:case yi.FAR_TOP_RIGHT:case yi.NEAR_BOTTOM_RIGHT:case yi.NEAR_TOP_RIGHT:dP(this._extendedFrustum.planes[Ki.RIGHT],va,va)}W(va,va,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(al(l,va),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),ec(n[yi.NEAR_BOTTOM_LEFT],n[yi.NEAR_BOTTOM_RIGHT],n[yi.NEAR_TOP_RIGHT],aD),ec(n[yi.NEAR_BOTTOM_RIGHT],n[yi.NEAR_TOP_RIGHT],n[yi.NEAR_TOP_LEFT],oD),oe(Js(aD),Js(oD))<0){const a=this._extendedFrustum.mutablePoints;this._aboveGround?[a[yi.NEAR_BOTTOM_LEFT],a[yi.NEAR_BOTTOM_RIGHT]]=[a[yi.NEAR_BOTTOM_RIGHT],a[yi.NEAR_BOTTOM_LEFT]]:[a[yi.NEAR_TOP_LEFT],a[yi.NEAR_TOP_RIGHT]]=[a[yi.NEAR_TOP_RIGHT],a[yi.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(a)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-nD;return{zWithMargin:e,pointIndices:wd.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:t=>t>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+nD;return{zWithMargin:e,pointIndices:wd.planePointIndices.top,direction:1,needsAltitudeAdjustment:t=>t<e}}};const Zne=2,Kne=6,Jne=12,eae=.95,nD=1,va=E(),aD=sr(),oD=sr(),lD=new Qo(Array,i=>{i.length!==4&&(i[0]=new A_,i[1]=new A_,i[2]=new A_,i[3]=new A_)},i=>{i[0].release(),i[1].release(),i[2].release(),i[3].release()});let tae=class{constructor(e){this._camera=new ze,this._focusOnMap=[0,0],this._screenRect=Ot(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Qne(e.renderCoordsHelper)}begin(e,t,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=t.x,this._focusOnMap[1]=t.y,z$(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=yB(e.extent,this._focusOnMap),e.measures.visibility!==Ms.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const t=iae,r=1<<t,s=e.measures.screenRect;nl(s);let n=0;const a=e.lij[0]+t,o=e.lij[1]<<t,l=e.lij[2]<<t,c=this._tileSizeWithBias(e),h=c*c;for(let u=0;u<r;u++)for(let m=0;m<r;m++)if(n+=this._computeScreenArea(e,a,o+u,l+m,s),n>h)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Ms.VISIBLE_WHEN_EXTENDED?this._tileSize*rae:this._tileSize}_computeScreenArea(e,t,r,s,n){const a=e.measures.visibility===Ms.VISIBLE_WHEN_EXTENDED;this._projectToScreen(t,r,s,a,Gh),nl(uC);for(let o=0;o<4;o++)p2(uC,Gh[o]);return Od(n,uC,n),$P(Gh[0],Gh[1],Gh[2])+$P(Gh[0],Gh[2],Gh[3])}_projectToScreen(e,t,r,s,n){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,t,r,Xg),this._toRenderCoords(Xg,0,3,Hh[0]),this._toRenderCoords(Xg,2,3,Hh[1]),this._toRenderCoords(Xg,2,1,Hh[2]),this._toRenderCoords(Xg,0,1,Hh[3]),s&&(this._projectToPlane(Hh,this._camera.frustum[Ki.NEAR]),this._projectToPlane(Hh,this._camera.frustum[Ki.TOP]),this._projectToPlane(Hh,this._camera.frustum[Ki.BOTTOM]));for(let a=0;a<4;a++)this._camera.projectToRenderScreen(Hh[a],cD),this._camera.renderToScreen(cD,n[a])}_projectToPlane(e,t){for(let s=0;s<4;s++)Qg[s]=ji(t,e[s]);const r=Math.max(Qg[0],Qg[1],Qg[2],Qg[3]);if(r>0){const s=W(Yg,Js(t),-r);for(let n=0;n<4;n++)J(e[n],e[n],s)}}_toRenderCoords(e,t,r,s){return Yg[0]=e[t],Yg[1]=e[r],Yg[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(Yg,this._tilingScheme.spatialReference,s),s}};const uC=Ot(),iae=2,rae=5,Gh=[Fi(),Fi(),Fi(),Fi()],Xg=Ot(),Yg=E(),Hh=[E(),E(),E(),E()],Qg=[0,0,0,0],cD=_s();function dTe(i,e,t){if(T(i)||T(t))return!1;let r=!0;return vr[0]=i.xmin!=null?i.xmin:0,vr[1]=i.ymin!=null?i.ymin:0,vr[2]=i.zmin!=null?i.zmin:0,r=r&&In(vr,i.spatialReference,0,e,t,0,1),vr[0]=i.xmax!=null?i.xmax:0,vr[1]=i.ymax!=null?i.ymax:0,vr[2]=i.zmax!=null?i.zmax:0,r=r&&In(vr,i.spatialReference,0,e,t,3,1),i.xmin==null&&(e[0]=-1/0),i.ymin==null&&(e[1]=-1/0),i.zmin==null&&(e[2]=-1/0),i.xmax==null&&(e[3]=1/0),i.ymax==null&&(e[4]=1/0),i.zmax==null&&(e[5]=1/0),r}function cU(i,e,t){if(T(i)||T(t))return!1;let r=!0;return vr[0]=i.xmin!=null?i.xmin:0,vr[1]=i.ymin!=null?i.ymin:0,vr[2]=i.zmin!=null?i.zmin:0,r=r&&In(vr,i.spatialReference,0,vr,t,0,1),e[0]=vr[0],e[1]=vr[1],vr[0]=i.xmax!=null?i.xmax:0,vr[1]=i.ymax!=null?i.ymax:0,vr[2]=i.zmax!=null?i.zmax:0,r=r&&In(vr,i.spatialReference,0,vr,t,0,1),e[2]=vr[0],e[3]=vr[1],i.xmin==null&&(e[0]=-1/0),i.ymin==null&&(e[1]=-1/0),i.xmax==null&&(e[2]=1/0),i.ymax==null&&(e[3]=1/0),r}const vr=E();let Jr=class extends ge{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void pe.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const r=_(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(T(this.filterExtent))return null;const e=Ot();return cU(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Oi,this.tileSize=512,this._idToTile=new Map,this._handles=new mi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Ht}initialize(){this._handles.add([z(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),ii),z(()=>{var e,t,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),er)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(rr.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Us(this._frameWorker),this._handles=we(this._handles)}addClient(){const e=nae();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(ta))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=rr.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=rr.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new tae({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(t=>new A_(t[0],t[1],t[2],e))}_purgeHorizonTiles(e){e.sort((t,r)=>{const s=t.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),nl(Iv);for(let t=0;t<e.length;t++)if(Od(Iv,e.data[t].measures.screenRect,Iv),Vd(Iv)>aae)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:t}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!nw(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==Ms.INVISIBLE&&(r.measures.shouldSplit?(t.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const t=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===Ms.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};d([p({constructOnly:!0})],Jr.prototype,"scheduler",void 0),d([p({constructOnly:!0})],Jr.prototype,"renderCoordsHelper",void 0),d([p({constructOnly:!0})],Jr.prototype,"tilingSchemeOwner",void 0),d([p({constructOnly:!0})],Jr.prototype,"cameraOnSurface",void 0),d([p({constructOnly:!0})],Jr.prototype,"focus",void 0),d([p({constructOnly:!0})],Jr.prototype,"viewState",void 0),d([p({constructOnly:!0})],Jr.prototype,"terrain",void 0),d([p()],Jr.prototype,"tiles",void 0),d([p()],Jr.prototype,"tileSize",void 0),d([p({readOnly:!0})],Jr.prototype,"tilingScheme",null),d([p()],Jr.prototype,"filterExtent",null),d([p({readOnly:!0})],Jr.prototype,"_filterExtentRect",null),d([p({readOnly:!0})],Jr.prototype,"_rootTileIds",null),d([p({value:!1})],Jr.prototype,"suspended",null),d([p({readOnly:!0})],Jr.prototype,"updating",null),Jr=d([k("esri.views.3d.layers.support.FeatureTileTree3D")],Jr);let sae=0;function nae(){return sae++}const Iv=Ot(),aae=10;let yr=class extends ge{constructor(){super(...arguments),this._propertiesPool=new ph({camera:ze},this),this._lastSeenCameraProjectionValues=new ze,this.mode=bi.ANIMATING,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Br,this.viewingMode=Se.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new Gc({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new ph({camera:ze},this)}createInitialCamera(){if(this.viewingMode===Se.Global){const e=qt(this.spatialReference).radius;this.camera=new ze({eye:qe(4*e,0,0),center:qe(e,0,0),up:qe(0,0,1)})}else this.camera=new ze({eye:qe(0,0,100),center:qe(0,0,0),up:qe(0,1,0)})}get animation(){return this.cameraController instanceof $y&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Wa&&Wa.copyFrom(e),Wa.computeUp(this.viewingMode),this.events.emit("before-camera-change",Wa);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Wa)&&(this._lastSeenCameraProjectionValues.copyFrom(Wa),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),(!t||!t.equals(Wa))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Wa)),this._cameraChanged=!t||!t.almostEquals(Wa),this._cameraChanged)){const r=v$(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return Ze(this._contentCamera,this.camera)}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===Se.Global}get isLocal(){return this.viewingMode===Se.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.removeHandles(hD),this.addHandles(ha(()=>e.state===$i.Finished||e.state===$i.Stopped,()=>{this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t))},{sync:!0,once:!0}),hD),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=$i.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==$i.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Wa.copyFrom(this._get("camera")),e(Wa),this.camera=Wa,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[ht.TOP]!==t.padding[ht.TOP]||e.padding[ht.RIGHT]!==t.padding[ht.RIGHT]||e.padding[ht.BOTTOM]!==t.padding[ht.BOTTOM]||e.padding[ht.LEFT]!==t.padding[ht.LEFT]}};d([p()],yr.prototype,"mode",void 0),d([p({readOnly:!0,type:Zf})],yr.prototype,"animation",null),d([p({type:ze})],yr.prototype,"camera",null),d([p({readOnly:!0})],yr.prototype,"pixelRatio",null),d([p()],yr.prototype,"rasterPixelRatio",void 0),d([p()],yr.prototype,"contentPixelRatio",void 0),d([p({})],yr.prototype,"_contentCamera",void 0),d([p({type:ze})],yr.prototype,"contentCamera",null),d([p({readOnly:!0})],yr.prototype,"fixedContentCamera",null),d([p({readOnly:!0})],yr.prototype,"constraints",void 0),d([p({readOnly:!0})],yr.prototype,"events",void 0),d([p({readOnly:!0})],yr.prototype,"isGlobal",null),d([p({readOnly:!0})],yr.prototype,"isLocal",null),d([p({readOnly:!0})],yr.prototype,"viewingMode",void 0),d([p({readOnly:!0})],yr.prototype,"spatialReference",void 0),d([p()],yr.prototype,"navigating",null),d([p()],yr.prototype,"stationary",null),d([p()],yr.prototype,"_cameraChanged",void 0),d([p()],yr.prototype,"cameraController",null),yr=d([k("esri.views.3d.state.ViewState")],yr);const oae=yr,Wa=new ze,hD="ViewStateHandles";let lae=class{constructor(e,t,r){this.viewingMode=e,this._forEachLayer=t,this._view=r,this._externalIntersectionHandlers=new Ht,this._tolerance=Kf,this._tmpRay=ea(),this._tmpRegion=Ot(),this._validateHUDIntersector=wo(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,t,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),dD(this.viewingMode),t,r)}intersectScreenFreePointFallback(e,t,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),t,r)}intersectRayFreePointFallback(e,t,r){return this.intersectRay(e,dD(this.viewingMode),t,r)||this._intersectRayFreePointLocal(e,t)}intersectRay(e,t,r,s){return t.options.selectionMode=!1,t.options.store=rs.MIN,this.computeIntersection(e,t,s),!!t.results.min&&t.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,t,r=.5,s=.5){return e.getRenderCenter($v,r,s),$v[0]+=.0466,$v[1]-=.0123,FR(e,$v,t)}intersectIntersectorScreen(e,t,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),t,r)}intersectToolIntersectorScreen(e,t,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,t,r)}intersectToolIntersectorRay(e,t,r){t.options.selectionMode=!0,this.computeIntersection(e,t,r);const s=t.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||pl(s)&&s.intersector!==Ri.TERRAIN||(t.options.selectionMode=!1,this.computeIntersection(e,t,r))}setTolerance(e=Kf){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((t,r)=>t.type===Ri.TERRAIN?1:r.type===Ri.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((t,r)=>t.type===Ri.TERRAIN?1:r.type===Ri.TERRAIN?-1:0)}_getPickRay(e,t){const r=this._view.state.camera;return _N(r,e,t)}_intersectRayFreePointLocal(e,t){return this.viewingMode!==Se.Local||T(e)||J(t,e.origin,K(We.get(),e.direction)),!1}intersectElevationFromScreen(e,t,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),t,r,s)}_intersectElevation(e,t,r=0,s=null){if(T(e))return null;const n=_(t)?t.mode:"absolute-height",a=_(t)?Ze(t.offset,0):0,o=n!=="on-the-ground"?a+r:0,l=o/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,o,Lv)){const x=this._view.computeMapPointFromVec3d(Lv);return x.z??(x.z=0),x.z-=a,x}return null}const c=this._view.state.camera,h=Hf(We.get());c.projectToRenderScreen(e.origin,h);const u=new uD(null,this._forEachLayer),m=this._view.slicePlane,f=_(m)?DM(m):null,y=wo(this.viewingMode);y.options.store=rs.MIN,y.options.verticalOffset=l;const g=e.origin,v=J(We.get(),g,e.direction);y.reset(g,v,c),y.point=h;const b=_(s)?"type"in s&&s.type==="graphics"?x=>{var w;return((w=x.metadata)==null?void 0:w.layerUid)!==s.uid}:x=>{var w;return((w=x.metadata)==null?void 0:w.graphicUid)!==s.uid}:null;switch(n){case"relative-to-scene":{const x=w=>{var S;return(T(b)||b(w))&&!!((S=w.metadata)!=null&&S.isElevationSource)};y.intersect(u.layers,h,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(w=>{if(w.type===Ri.I3S||w.type===Ri.TERRAIN){const S=w.slicePlaneEnabled?f:null;w.intersect(y,S,y.rayBegin,y.rayEnd,h)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const w=x.slicePlaneEnabled?f:null;x.intersect(y,w,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(Lv)){const x=this._view.computeMapPointFromVec3d(Lv);return x.z=r,x}return null}computeIntersection(e,t,r){var y;if(T(e))return;const s=this._view.state.camera,n=Hf(We.get());s.projectToRenderScreen(e.origin,n);const a=new uD(r,this._forEachLayer);t.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const o=e.origin,l=J(We.get(),e.origin,e.direction);t.reset(o,l,s),t.intersect(a.layers,n,this._tolerance);const c=this._view.slicePlane,h=_(c)?DM(c):null;t.intersect(a.sliceableLayers,n,this._tolerance,h);const u=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(g=>{const v=g.layerUid,b=Array.isArray(v),x=b?v:[v];b&&(t.options.filteredLayerUids=[]);let w=!1;for(const S of x)a.filterLayerUid(S)?w=!0:b&&t.options.filteredLayerUids.push(S);if(t.options.isFiltered=!w,g.isGround&&u||!t.options.isFiltered){const S=g.slicePlaneEnabled?h:null;g.intersect(t,S,o,l,n)}});const m=We.get(),f=this._view.basemapTerrain;if(r&&r.enableDraped&&_(f.spatialReference)&&t.results.ground.getIntersectionPoint(m)){const g=f.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,b=We.get();this._view.renderCoordsHelper.fromRenderCoords(m,b,f.spatialReference),b[2]=Ze((y=this._view.elevationProvider)==null?void 0:y.getElevation(m[0],m[1],m[2],v,"ground"),0),g.intersect(t,b,t.results.ground,x=>a.filterRenderGeometry(x))}t.sortResults(),this._processHUDResults(t)}_processHUDResults(e){const t=e.results.hud;my(this._tmpRegion,vB);const r=this._view.state.camera,s=[],n=this._tmpRegion,a=b=>{const x=new hae(b);r.projectToRenderScreen(b.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),s.push(x),p2(n,x.screenPoint)};e.sortResults(t.all),_(t.min.dist)&&a(t.min);for(const b of t.all)t.min.target.object!==b.target.object&&t.max.target.object!==b.target.object&&a(b);if(_(t.max.dist)&&t.max.target.object!==t.min.target.object&&a(t.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const o=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-P_),h=Math.max(0,n[1]-P_),u=Math.min(Yl(n)+2*P_,o-c),m=Math.min(Vd(n)+2*P_,l-h),f=new Uint8Array(u*m*4);this._view._stage.renderer.readHUDVisibility(c,h,u,m,f);let y=!0;const g=T(e.results.max.dist);let v=0;for(const b of s)for(const x of cae)if(f[4*(Math.min(b.screenPoint[0]+x[0],o)-n[0]+(Math.min(b.screenPoint[1]+x[1],l)-n[1])*u)]){y&&(e.results.min.copy(b.result),y=!1),g&&e.results.max.copy(b.result),e.options.store===rs.ALL&&e.results.all.splice(v++,0,b.result);break}}};const P_=1,cae=(()=>{const i=[],e=P_;for(let t=-e;t<=e;t++)for(let r=-e;r<=e;r++)i.push([r+e,t+e]);return i})();let hae=class{constructor(e){this.result=e,this.screenPoint=_s()}},Dv;function dD(i){return Dv&&Dv.viewingMode===i||(Dv=wo(i)),Dv}let uD=class{constructor(e,t){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,t(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:t,exclude:r}=this;return T(e)?t==null&&r==null:(t==null||t.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function pD(i){return typeof i=="object"&&"intersect"in i}const Lv=E(),$v=_s();let _Te=class{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,s,n){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,s)}},dae=class{constructor(e,t,r,s){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(rr.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,t,r,s=0){return new Promise((n,a)=>{const o={x:e,y:t,minDemResolution:s,result:{resolve:n,reject:a},signal:r};this._queries.push(o),Pd(r,()=>{M8(this._queries,o),a($s())})})}get running(){return this._queries.length>0}runTask(e){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return t.forEach(h=>h.result.reject()),void e.madeProgress();const s=t.map(h=>[h.x,h.y]),n=t.reduce((h,u)=>Math.min(h,u.minDemResolution),1/0),a=new A7({points:s,spatialReference:this.spatialReference}),o=t.length>1&&t.some(h=>!!h.signal)?new AbortController:null,l=_(o)?o.signal:t[0].signal;if(_(o)){let h=0;t.forEach(u=>Pd(u.signal,()=>{h++,u.result.reject($s()),h===t.length&&o.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(a,c).then(h=>{t.forEach((u,m)=>{_(u.signal)&&u.signal.aborted?u.result.reject($s()):u.result.resolve(h.geometry.points[m][2])})}).catch(h=>{t.forEach(u=>u.result.reject(h))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(ta)}}},O_=class extends Br.EventedMixin(ge){get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:t.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=we(this._elevationQueryCached)}get _elevationQuery(){return T(this._elevationQueryCached)&&(this._elevationQueryCached=new dae(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,r,s,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&r===o.z&&o2(s,o.spatialReference)&&n===o.queryContext)return o.result}let a=null;return a=Fv(a,this._im,e,t,r,s,n),T(a)&&(a=Fv(a,this._ground,e,t,r,s,n)),n==="scene"&&(a=Fv(a,this._scene,e,t,r,s,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:s,queryContext:n,result:a}),a}queryElevation(e,t,r,s,n,a=null,o=0){const l=hp();return this._elevationQuery.queryElevation(e,t,a,o).then(c=>{n==="scene"&&(c=Fv(c,this._scene,e,t,r,s,n)),l.resolve(c)}).catch(c=>{za(c)?l.reject(c):l.resolve(this.getElevation(e,t,r,s,n))}),l.promise}register(e,t){this._handles.set(t,t.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(t)}unregister(e){var t;this._handles.has(e)&&((t=this._handles.get(e))==null||t.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const s=r.indexOf(e);s>-1&&r.splice(s,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function Fv(i,e,t,r,s,n,a){for(const o of e){const l=o.getElevation(t,r,s,n,a);_(l)&&(i=_(i)?Math.max(l,i):l)}return i}d([p({constructOnly:!0})],O_.prototype,"view",void 0),d([p()],O_.prototype,"spatialReference",null),O_=d([k("esri.views.3d.support.CombinedElevationProvider")],O_);let M_=class PS{static isValidProfile(e){return e in PS.profiles}static getDefaultProfile(){return Vt("esri-iPhone")?"low":"medium"}static apply(e,t){const r=PS.profiles[e];t.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,t.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,t.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,t.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,t.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,t.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const s=t.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration,t.sceneService.point.lodFactor=r.sceneService.point.lodFactor,t.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,t.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,t.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,t.tiledSurface.lodBias=r.tiledSurface.lodBias,t.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,t.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,t.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,t.heatmap.pixelRatio=r.heatmap.pixelRatio,t.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,t.fadeDuration=r.fadeDuration,t.antialiasingEnabled=r.antialiasingEnabled,t.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,t.highQualityTransparency=r.highQualityTransparency,t.memoryLimit=r.memoryLimit,t.additionalCacheMemory=r.additionalCacheMemory,t.frameRate=r.frameRate,t.maximumPixelRatio=r.maximumPixelRatio}};function mD(){const i=!!Vt("esri-mobile"),e=!!Vt("ios"),t=tt(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:tt(0),lodCrossfadeoutDuration:tt(0),lodCrossfadeUncoveredDuration:tt(0)},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:tt(0)},fadeDuration:tt(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:i?.8:1,polylineLodFactor:i?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:tt(0),lodCrossfadeoutDuration:tt(0),lodCrossfadeUncoveredDuration:t},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:i},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Vt("disable-feature:reduce-map-tile-levels"),textureFadeDuration:t},fadeDuration:t,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:i?600:750,additionalCacheMemory:i?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:i?1.2:2,polylineLodFactor:i?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:tt(0),lodCrossfadeoutDuration:tt(0),lodCrossfadeUncoveredDuration:t},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Vt("disable-feature:reduce-map-tile-levels"),textureFadeDuration:t},fadeDuration:t,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:i?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:i?1:1/0}}}M_.test={reset(){const i=mD();for(const e in i)M_.profiles[e]=i[e]}},function(i){i.profiles=mD()}(M_||(M_={}));const I1=M_;function hU(){return new Float32Array(4)}function uae(i){const e=new Float32Array(4);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function dl(i,e,t,r){const s=new Float32Array(4);return s[0]=i,s[1]=e,s[2]=t,s[3]=r,s}function pae(i,e){return new Float32Array(i,e,4)}function dU(){return hU()}function uU(){return dl(1,1,1,1)}function pU(){return dl(1,0,0,0)}function mU(){return dl(0,1,0,0)}function fU(){return dl(0,0,1,0)}function gU(){return dl(0,0,0,1)}const mae=dU(),fae=uU(),gae=pU(),_ae=mU(),yae=fU(),vae=gU();Object.freeze(Object.defineProperty({__proto__:null,ONES:fae,UNIT_W:vae,UNIT_X:gae,UNIT_Y:_ae,UNIT_Z:yae,ZEROS:mae,clone:uae,create:hU,createView:pae,fromValues:dl,ones:uU,unitW:gU,unitX:pU,unitY:mU,unitZ:fU,zeros:dU},Symbol.toStringTag,{value:"Module"}));const fD=new li([0,255,255]),gD=new li([0,0,0]),_D=1,yD=.25,vD=.4,bD=.2;let Ll=class extends ge{constructor(){super(...arguments),this.color=fD.clone(),this.haloColor=null,this.haloOpacity=_D,this.fillOpacity=yD,this.shadowOpacity=vD,this.shadowColor=gD.clone(),this.shadowDifference=bD}static toEngineOptions(e){const t=li.toUnitRGBA(e.color??fD),r=_(e.haloColor)?li.toUnitRGBA(e.haloColor):t,s=li.toUnitRGBA(e.shadowColor??gD),n=e.haloOpacity??_D,a=e.fillOpacity??yD,o=e.shadowOpacity??vD,l=e.shadowDifference??bD;return{color:dl(t[0],t[1],t[2],t[3]),haloColor:dl(r[0],r[1],r[2],r[3]),haloOpacity:n,haloOpacityOccluded:.25*n,fillOpacity:a,fillOpacityOccluded:.25*a,shadowOpacity:o,shadowColor:Ai(s[0],s[1],s[2],s[3]),occludedShadowOpacity:o*(1-l)}}};d([p({type:li})],Ll.prototype,"color",void 0),d([p({type:li})],Ll.prototype,"haloColor",void 0),d([p()],Ll.prototype,"haloOpacity",void 0),d([p()],Ll.prototype,"fillOpacity",void 0),d([p()],Ll.prototype,"shadowOpacity",void 0),d([p({type:li})],Ll.prototype,"shadowColor",void 0),d([p()],Ll.prototype,"shadowDifference",void 0),Ll=d([k("esri.views.3d.support.HighlightOptions")],Ll);const OS=Ll;let Uu=class extends da{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:P$(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};d([p()],Uu.prototype,"geometries",void 0),d([p({json:{read:{source:"outSR"}}})],Uu.prototype,"outSpatialReference",void 0),d([p()],Uu.prototype,"transformation",void 0),d([p()],Uu.prototype,"transformForward",void 0),Uu=d([k("esri.rest.support.ProjectParameters")],Uu);const bA=Uu,bae=iw(bA);async function _U(i,e,t){e=bae(e);const r=P7(i),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,a=P$(e.geometries[0]),o=O7(s,t);return G_(r.path+"/project",o).then(({data:{geometries:l}})=>M7(l,a,n))}async function wA(i=null,e){var s,n;if(K1.geometryServiceUrl)return K1.geometryServiceUrl;if(!i)throw new ue("internal:geometry-service-url-not-configured");let t;t="portal"in i?i.portal||U7.getDefault():i,await t.load({signal:e});const r=(n=(s=t.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new ue("internal:geometry-service-url-not-configured");return r}async function wae(i,e,t=null,r){const s=await wA(t,r),n=new bA;n.geometries=[i],n.outSpatialReference=e;const a=await _U(s,n,{signal:r});if(a&&Array.isArray(a)&&a.length===1)return a[0];throw new ue("internal:geometry-service-projection-failed")}const xae=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:wA,projectGeometry:wae},Symbol.toStringTag,{value:"Module"}));let Tae=class{constructor(e,t){this.spatialReference=t,this.unitInMeters=Yd(this.spatialReference,qt(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=wA(e&&e.get("portalItem")).catch(()=>{throw new ue("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const t=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof kt?l:new kt(l,this.spatialReference)),a=new bA({geometries:n,outSpatialReference:ci.WGS84}),o=(await _U(t,a)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?o:o[0]}},Bo=class extends ge{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};d([p()],Bo.prototype,"minTotalNumberOfFeatures",void 0),d([p()],Bo.prototype,"maxTotalNumberOfFeatures",void 0),d([p()],Bo.prototype,"maxTotalNumberOfPrimitives",void 0),d([p()],Bo.prototype,"snapshotAvailable",void 0),d([p()],Bo.prototype,"polygonLodFactor",void 0),d([p()],Bo.prototype,"polylineLodFactor",void 0),d([p()],Bo.prototype,"skipHighSymbolLods",void 0),Bo=d([k("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Bo);let oc=class extends ge{constructor(){super(...arguments),this.lodFactor=1}};d([p()],oc.prototype,"lodFactor",void 0),oc=d([k("esri.views.3d.support.QualitySettings.LoDFactorSettings")],oc);let qb=class extends oc{constructor(){super(...arguments),this.lodCrossfadeinDuration=tt(0),this.lodCrossfadeoutDuration=tt(0),this.lodCrossfadeUncoveredDuration=tt(0)}};qb=d([k("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],qb);let Qc=class extends ge{constructor(){super(...arguments),this.object=new qb,this.point=new oc,this.integratedMesh=new oc,this.pointCloud=new oc,this.uncompressedTextureDownsamplingEnabled=!1}};d([p({type:qb})],Qc.prototype,"object",void 0),d([p({type:oc})],Qc.prototype,"point",void 0),d([p({type:oc})],Qc.prototype,"integratedMesh",void 0),d([p({type:oc})],Qc.prototype,"pointCloud",void 0),d([p()],Qc.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Qc=d([k("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Qc);let gd=class extends ge{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=tt(400)}};d([p()],gd.prototype,"lodBias",void 0),d([p()],gd.prototype,"angledSplitBias",void 0),d([p()],gd.prototype,"reduceTileLevelDifferences",void 0),d([p()],gd.prototype,"textureFadeDuration",void 0),gd=d([k("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],gd);let wf=class extends ge{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([p()],wf.prototype,"pixelRatio",void 0),d([p()],wf.prototype,"maxTotalNumberOfFeatures",void 0),wf=d([k("esri.views.3d.support.QualitySettings.HeatmapSettings")],wf);let gn=class extends ge{constructor(){super(...arguments),this.graphics3D=new Bo,this.sceneService=new Qc,this.tiledSurface=new gd,this.heatmap=new wf,this.fadeDuration=tt(400),this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([p({type:Bo})],gn.prototype,"graphics3D",void 0),d([p({type:Qc})],gn.prototype,"sceneService",void 0),d([p({type:gd})],gn.prototype,"tiledSurface",void 0),d([p({type:wf})],gn.prototype,"heatmap",void 0),d([p()],gn.prototype,"fadeDuration",void 0),d([p()],gn.prototype,"antialiasingEnabled",void 0),d([p()],gn.prototype,"physicallyBasedRenderingEnabled",void 0),d([p()],gn.prototype,"highQualityTransparency",void 0),d([p()],gn.prototype,"memoryLimit",void 0),d([p()],gn.prototype,"additionalCacheMemory",void 0),d([p()],gn.prototype,"frameRate",void 0),d([p()],gn.prototype,"maximumPixelRatio",void 0),gn=d([k("esri.views.3d.support.QualitySettings.QualitySettings")],gn);const wD=gn;function Cae(i){return E$(i)&&i.length>=3}function Eae(i){return(S$(i)||Array.isArray(i))&&i.length>=3}function Sae(i){return Cae(i)||Eae(i)}let Rae=class MS{constructor(e,t,r,s){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=TH(s)}set extent(e){e&&CH(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return IH(this._coordinateSystem,e)}setAltitude(e,t,r=e){return N5(this._coordinateSystem,r,t,e)}setAltitudeOfTransformation(e,t){DH(this._coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return AH(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,r){return PH(this._coordinateSystem,e,t,r)}basisMatrixAtPosition(e,t){const r=this.worldBasisAtPosition(e,Ed.X,We.get()),s=this.worldBasisAtPosition(e,Ed.Y,We.get()),n=this.worldBasisAtPosition(e,Ed.Z,We.get());return Y$(t,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),t}headingAtPosition(e,t){const r=this.worldUpAtPosition(e,We.get()),s=this.worldBasisAtPosition(e,Ed.Y,We.get()),n=q$(t,s,r);return ca(n)}intersectManifoldClosestSilhouette(e,t,r){return Cx(this._coordinateSystem,t,this._tmpCoordinateSystem),MH(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,t,r){Cx(this._coordinateSystem,t,this._tmpCoordinateSystem);const s=We.get();return OH(this._tmpCoordinateSystem,e,s)?X(r,s):null}intersectInfiniteManifold(e,t,r){if(this.viewingMode===Se.Global)return this.intersectManifold(e,t,r);Cx(this._coordinateSystem,t,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=We.get();return Ap(s.plane,e,n)?X(r,n):null}toRenderCoords(e,t,r){return Mb(e)?xs(e,t,this.spatialReference):vs(e,t,r,this.spatialReference)}fromRenderCoords(e,t,r=null){return Mb(t)?(_(r)&&(t.spatialReference=r),U$(e,this.spatialReference,t)):Sae(t)?vs(e,this.spatialReference,t,r)?t:null:Ud(e,this.spatialReference,t)}static create(e,t){switch(e){case Se.Local:return new MS(Se.Local,t,Yd(t),RH());case Se.Global:return new MS(Se.Global,t,1,SH(t))}}static renderUnitScaleFactor(e,t){return xD(e)/xD(t)}};function xD(i){if(Ib(i,Se.Global))return 1;const e=U5(!1,i);return Yd(e)}var Zl;(function(i){i[i.ELEVATION=0]="ELEVATION",i[i.BASEMAP=1]="BASEMAP",i[i.I3S_INDEX=2]="I3S_INDEX",i[i.I3S_DATA=3]="I3S_DATA",i[i.SYMBOLOGY=4]="SYMBOLOGY"})(Zl||(Zl={}));const Aae=(()=>{const i=new Array;return i[Zl.ELEVATION]=10,i[Zl.BASEMAP]=10,i[Zl.I3S_INDEX]=10,i[Zl.I3S_DATA]=10,i[Zl.SYMBOLOGY]=5,i})(),Pae=30;function yU(i){return typeof i.getUsedMemory=="function"}function Oae(i){return new _n({view:i})}const Nv=1,pC=1,Mae=.75,Iae=.6,TD=1.3;let _n=class extends ge{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new CG,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(Nv),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new EG(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Iae&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(Nv);else if(e)(this._memoryPredicted>1.1*pC||this._memoryUsed>pC)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/TD),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>pC)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/TD),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<Mae&&this._quality<Nv){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),Nv))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;_(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(yU(o)){const l=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*l,t+=o.getUnloadedMemory()*l}});const s=T(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&s){this._warnMemoryUsage=e;const o=c=>(c/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",l=Math.round(100*this._quality);pe.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${o(n)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${l}%`)}this._memoryUsed=e/n,this._memoryPredicted=(e+t)/n;const a=n-e;this._cacheStorage.maxSize=Math.max(0,a+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};d([p({constructOnly:!0})],_n.prototype,"view",void 0),d([p()],_n.prototype,"maxMemory",null),d([p()],_n.prototype,"additionalCacheMemory",null),d([p()],_n.prototype,"memoryFactor",null),d([p()],_n.prototype,"updating",null),d([p()],_n.prototype,"usedMemory",null),d([p()],_n.prototype,"_quality",void 0),d([p()],_n.prototype,"_memoryUsed",void 0),d([p()],_n.prototype,"_updating",void 0),d([p()],_n.prototype,"_stableQuality",void 0),d([p()],_n.prototype,"_maxMemory",void 0),d([p()],_n.prototype,"_additionalCacheMemory",void 0),_n=d([k("esri.views.3d.support.MemoryController")],_n);let Dae=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},Lae=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new $ae}},$ae=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Fae=class{constructor(e,t,r,s){this._workerFunc=e,this._callbackFunc=t,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Lae(n))}destroy(){this._clients.length=0}hasQuota(e){const t=this._clients[e];return!!t&&(this._totalNumWorkers<this._maxTotalNumWorkers||t.numWorkers+t.tasks.length<t.typeWorkerQuota)}push(e){const t=this._clients[e.client];t&&(this._totalNumWorkers<this._maxTotalNumWorkers?(t.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):t.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const t=this._clients[e.client];this._totalNumWorkers--,t.numWorkers--,t.statistics.requests++,t.statistics.size+=e.size||0,t.statistics.duration+=e.duration||0,t.statistics.speed=t.statistics.duration>0?t.statistics.size/t.statistics.duration:0,_t(t.numWorkers>=0),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(t,r)=>this._taskCallback(t,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,t){e._cancelled||(this._callbackFunc(e,t),this._taskFinished(e))}getStatsForType(e){const t=this._clients[e];return t?{quota:t.typeWorkerQuota,workers:t.numWorkers,queueSize:t.tasks.length,requestStats:t.statistics}:null}get test(){const e=this;return{set workerFunc(t){e._workerFunc=t}}}},D1=class extends ge{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,r){this._loadQueue=new Fae((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,t),r&&(this._frameTask=r.registerTask(rr.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Us(this._frameTask),this._tasks.forEach(e=>sl(e.abortController)),this._loadQueue=we(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,r,s={}){const n=hp();n.__signal=_(s)?s.signal:null;const a=this._createOrUpdateTask(e,t,r,s,n);return Pd(s,()=>this._cancelRequest(a,n)),n.promise}_createTask(e,t,r,s,n,a){const o=new Vae(e,t,r,s,n);return this._updateTask(o,a),this._tasks.set(n,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){var r;X1(e.resolvers,t),t.reject($s()),e.resolvers.length===0&&(e.status===Ja.DOWNLOADING&&(e.status=Ja.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=Ja.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,r,s,n){const a=Bae(_(s)&&s.uid||e,t,r),o=this._tasks.get(a);return o?(this._updateTask(o,n),o):this._createTask(e,s,t,r,a,n)}_doneLoadingCB(e,t){this._loadQueue&&(_t(e.status===Ja.DOWNLOADING),e.status=Ja.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Ti(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Ja.DOWNLOADED&&(t.err=t.err||$s()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!za(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(t)za(t)?s.reject(t):s.reject(new ue("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const n=r<=0?e.result:il(e.result);s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Ja.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=Ja.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=G_(e.url,{...e.options,responseType:s,timeout:r,signal:n});let a=()=>{};const o=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},l=c=>{e.status===Ja.DOWNLOADING&&t(e,c),a()};return e.docType!=="image+type"?(e.request.then(c=>o(c.data),l),!0):(e.request.then(c=>{const h=c.data,u=Uae(h);if(s="image",e.size=h.byteLength,u==="unknown")return e.request=G_(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(y=>o(y.data),l);const m=new Blob([h],{type:u}),f=window.URL.createObjectURL(m);a=()=>window.URL.revokeObjectURL(f),e.request=G_(f,{responseType:s,timeout:r,signal:n}),e.request.then(y=>o(new qw(y.data,u,a)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};d([p({readOnly:!0})],D1.prototype,"updating",void 0),D1=d([k("esri.views.3d.support.StreamDataLoader")],D1);const Nae={numRetries:0};function Uae(i){if(i.byteLength<2)return"unknown";const e=new Uint8Array(i,0,i.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let qw=class{constructor(e,t,r){this.image=e,this.type=t,this.release=r}get isOpaque(){return this.type==="image/jpeg"}},Vae=class extends Dae{constructor(e,t,r,s,n){super(s),this.url=e,this.options=t,this.docType=r,this.key=n,this.result=null,this.status=Ja.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Nae.numRetries}};function Bae(i,e,t){return`${i}:${e}:${t}`}var Ja;(function(i){i[i.QUEUED=1]="QUEUED",i[i.DOWNLOADING=2]="DOWNLOADING",i[i.DOWNLOADED=3]="DOWNLOADED",i[i.CANCELLED=4]="CANCELLED"})(Ja||(Ja={}));let L1=class extends ge{constructor(){super(...arguments),this.updating=!1}};function zae(i){return new $l({view:i})}d([p({readOnly:!0})],L1.prototype,"updating",void 0),L1=d([k("esri.views.3d.support.ResourceControllerMain")],L1);let $l=class extends L1{constructor(){super(...arguments),this._immediateTask=tb,this._normalTask=tb,this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=B7(),this._memoryController=Oae(this.view),this._streamDataLoader=new D1,this._streamDataLoader.setup(Pae,Aae,this._scheduler),this.addHandles([z(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},ii),z(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Vf({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(rr.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(rr.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Us(this._frameTask),this._streamDataLoader=we(this._streamDataLoader),this._memoryController=we(this._memoryController),this._scheduler=we(this._scheduler)}get updating(){var e,t,r;return!!((e=this._memoryController)!=null&&e.updating||(t=this._streamDataLoader)!=null&&t.updating||(r=this._immediateTask)!=null&&r.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,s,n)=>t.request(r,s,e,n),get busy(){return!t.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(i2(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};d([p({constructOnly:!0})],$l.prototype,"view",void 0),d([p()],$l.prototype,"_scheduler",void 0),d([p()],$l.prototype,"_memoryController",void 0),d([p()],$l.prototype,"_streamDataLoader",void 0),d([p()],$l.prototype,"_immediateTask",void 0),d([p()],$l.prototype,"_normalTask",void 0),d([p({readOnly:!0})],$l.prototype,"updating",null),$l=d([k("esri.views.3d.support.ResourceControllerImpl")],$l);function kae(i){return"performanceInfo"in i}const Am=E(),Gae=E(),Dc=E(),Lc=E();function Hae(i,e,t=0){const r=i.extent;if(T(r))return!1;if(t===0)return B$(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return bB(r,e,t*s)}function Uv(i,e,t,r){X(Am,t),Am[r]=e[r];const s=ee(Am,Am,e),n=ee(Gae,i,e),a=oe(n,s),o=oe(s,s);let l;l=a<=0?e:o<=a?t:J(Am,e,W(s,s,a/o));const c=ee(Am,i,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function qae(i,e,t){const r=i.extent;if(T(r))return 0;Dc[0]=r[0],Dc[1]=r[1],Dc[2]=t,Lc[0]=r[2],Lc[1]=r[3],Lc[2]=t;let s=1/0,n=1/0;return e[0]<Dc[0]?s=Uv(e,Dc,Lc,0):e[0]>Lc[0]&&(s=Uv(e,Lc,Dc,0)),e[1]<Dc[1]?n=Uv(e,Dc,Lc,1):e[1]>Lc[1]&&(n=Uv(e,Lc,Dc,1)),Math.min(s,n)}function Wae(i,e,t){if(T(i))return gR();if(i.spatialReference.isGeographic&&!up(i.spatialReference))return new ue("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Jn.checkUnsupported(i);if(_(r))return r;if(T(t))return new ue("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=jae(i,t);if(s)return s;const n=i.spatialReference;return _(e)&&!(n.equals(e)||e.isWGS84&&n.isWebMercator)?new ue("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function jae(i,e){const t=i.lods,r=t[0].resolution*2**t[0].level,s=[r*i.size[0],r*i.size[1]],n=[i.origin.x,i.origin.y],a=k$(e),o=Ot();Jn.computeRowColExtent(a,s,n,o);const l=(o[2]-o[0])*(o[3]-o[1]);if(l>df){const c=t[0].scale*2**t[0].level;let h=Math.max((a[3]-a[1])/i.size[1],(a[2]-a[0])/i.size[0])*c/r;const u=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**u)*10**u,new ue("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:df})}return null}const Xae=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Wae,isInsideExtent:Hae,tiltToExtentEdge:qae},Symbol.toStringTag,{value:"Module"}));function Yae(){return!0}function Qae(){return 0}function Zae(i,e){if(T(i))return gR();const t=i.lods.length-1,r=i.spatialReference,s=up(r)||t0(r)||i0(r);if(r.isWebMercator){if(!Jn.makeWebMercatorAuxiliarySphere(t).compatibleWith(i))return new ue("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new ue("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Jn.makeGCSWithTileSize(i.spatialReference,i.size[0],t).compatibleWith(i))return i.spatialReference.isWGS84?new ue("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new ue("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(e)&&!i.spatialReference.equals(e)?new ue("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const Kae=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Zae,isInsideExtent:Yae,tiltToExtentEdge:Qae},Symbol.toStringTag,{value:"Module"})),Jae={[Se.Global]:Kae,[Se.Local]:Xae};function jl(i,e){i||console.warn("Terrain: "+e)}let Er=!1,Wb=!1;function eoe(i){Wb=i,Er=Er||i}function toe(i){Er=i}function se(i,e){var t;if(Er&&!i){const r=(t=new Error().stack)==null?void 0:t.slice(5);throw console.warn("Terrain internal: "+(e||"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function IS(i){return Ww(i)?{fullExtent:i.fullExtent,minScale:i.layer.minScale,maxScale:i.layer.maxScale,tilemapCache:null}:i.layer}function jb(i){return(i==null?void 0:i.type)==="imagery-tile"||(i==null?void 0:i.type)==="wcs"}function Ww(i){return(i==null?void 0:i.type)==="imagery-tile-3d"}function xA(i){return(i==null?void 0:i.type)==="tile-3d"}function Wy(i){return(i==null?void 0:i.type)==="vector-tile-3d"}function vU(i){return(i==null?void 0:i.type)==="wmts-3d"}function DS(i){return(i==null?void 0:i.type)==="elevation-3d"}function Zg(i){return(i==null?void 0:i.type)==="group"}function Xb(i){return i&&(xA(i)||vU(i)||Ww(i)||Wy(i))}function LS(i){return i&&(xA(i)||Ww(i)||Wy(i)||vU(i))}function jy(i){return LS(i)||DS(i)}function ioe(i){var t;const e=(t=i==null?void 0:i.sourceLayerInfo)==null?void 0:t.data;return _(e)&&"type"in e&&e.type==="raster-tile"}function roe(i){var t;const e=(t=i==null?void 0:i.sourceLayerInfo)==null?void 0:t.data;return _(e)&&"type"in e&&e.type==="vector-tile"}function soe(i){var t;const e=(t=i==null?void 0:i.sourceLayerInfo)==null?void 0:t.data;return _(e)&&"type"in e&&e.type==="tile-texture"}function noe(i){var t;const e=(t=i==null?void 0:i.sourceLayerInfo)==null?void 0:t.data;return e instanceof HTMLImageElement||e instanceof qw||e instanceof HTMLCanvasElement||e instanceof ImageData}function Ff(i){return _(i)&&"release"in i&&i.release(),null}function CD(i){return i.fetchTile&&i.hasOverriddenFetchTile!==!1}function TA(i,e,t,r){return Jae[r].checkIfTileInfoSupportedForViewSR(i,t,e)}function jw(i,e,t){let r=null,s=null;if((i==null?void 0:i.type)==="wmts"){const n=aoe(i,e,t);r=n.tileInfo,s=n.fullExtent}else{s=jb(i)?i.getCompatibleFullExtent(e):i.fullExtent;const n=t===Se.Local;if(jb(i))r=i.getCompatibleTileInfo(e,s,n);else if((i==null?void 0:i.type)==="vector-tile"){const a=n&&!ooe(e)||loe.force512VTL,o=i.tileInfo.spatialReference.isGeographic;r=a?i.tileInfo:i.tileInfo.getOrCreateCompatible(256,o?1:2)}else r=i.tileInfo}return _(r)&&_(s)&&TA(r,s,e,t)==null?{tileInfo:r,fullExtent:s}:null}function aoe(i,e,t){const r=QB(i);if(_(r)){if(!Oi.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>TA(n.tileInfo,n.fullExtent,e,t)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function ooe(i){return i.isWGS84||i.isWebMercator||k8(i)||!Y1(i)}const loe={force512VTL:!1};function ED(i){return"["+i[0]+","+i[1]+","+i[2]+"]"}function $c(i){return"("+i[0]+","+i[1]+","+i[2]+")"}function co(i,e,t=doe){return Math.abs(i-e)<t}function $S(i){return i===ke.NORTH_EAST?ke.SOUTH_WEST:i===ke.NORTH_WEST?ke.SOUTH_EAST:i===ke.SOUTH_WEST?ke.NORTH_EAST:ke.NORTH_WEST}function Yb(i){return i===ke.NORTH?ke.SOUTH:i===ke.EAST?ke.WEST:i===ke.SOUTH?ke.NORTH:ke.EAST}function coe(i){return i===ke.NORTH_WEST||i===ke.SOUTH_WEST}function hoe(i){return i===ke.NORTH_WEST||i===ke.NORTH_EAST}function SD(i){return i===ke.NORTH_WEST||i===ke.WEST||i===ke.SOUTH_WEST}function RD(i){return i===ke.NORTH_EAST||i===ke.EAST||i===ke.SOUTH_EAST}function AD(i){return i===ke.SOUTH_EAST||i===ke.SOUTH||i===ke.SOUTH_WEST}function PD(i){return i===ke.NORTH_EAST||i===ke.NORTH||i===ke.NORTH_WEST}const rc=[ke.NORTH,ke.EAST,ke.SOUTH,ke.WEST],Qb=[ke.NORTH_EAST,ke.SOUTH_EAST,ke.SOUTH_WEST,ke.NORTH_WEST],doe=1e-5;let uoe=class{constructor(e,t){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=jy(e)?t.basemapTerrain.getUsedMemoryForLayerView(e):e.getUsedMemory(),kae(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},poe=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,_(e.resourceController)){const s=e.resourceController.memoryController;this.totalMemory=(s.maxMemory??0)*nE.MEGABYTES,this.usedMemory=Math.round(s.usedMemory*this.totalMemory),this.quality=s.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.getUsedMemory())??0;const t=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=_(t)?t.usedMemory:0,e.allLayerViews.items.forEach(s=>{(yU(s)||jy(s))&&this.layerPerformanceInfos.push(new uoe(s,e))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}},moe=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,t,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return _(n)?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,a=>NG(new UG(a.streamDataRequester),e,a,r),t)}loadWOSR(e,t){const r=`wosr:${e}:${t.disableTextures}`,s=this._wosrMemCache.get(r);return _(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,n=>fk(e,n),t)}async _loadOnce(e,t,r,s,n){Ti(n);const a=Pd(n,()=>this._abortLoad(e,r));let o=e.get(r);if(o)o.refCount++;else{const l=new AbortController;o={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},e.set(r,o)}try{const l=await o.promise;return t.put(r,l,l.size),e.delete(r),Ti(n),l}finally{Us(a)}}_abortLoad(e,t){const r=e.get(t);_(r)&&--r.refCount>0||(e.delete(t),_(r)&&r.abortController.abort())}},foe=class extends uf{constructor(e,t,r,s){super(t,s),this._streamDataRequester=e,this._parameters=r}async fromUrl(e,t,r){Ti(r);const s=_(r)?r.signal:null,n=this.makeUid(e,t);let a=this._textureRequests.get(n);if(!a){const o=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:o.signal});a={referenceCount:0,texture:null,textureAsync:null,abortController:o};const c=a;this._textureRequests.set(n,a),a.textureAsync=l.then(async h=>{const u=this._createTexture(e,h,t);return c.texture=u,c.abortController=null,this._stage.add(u),await this._stage.load(u),{uid:n,texture:u,release:()=>this._release(n)}},h=>{throw c.abortController=null,h})}a.referenceCount++;try{return await I$(a.textureAsync,s)}catch(o){throw this._release(n),o}}_createTexture(e,t,r){var n;const s={...this._parameters,powerOfTwoResizeMode:j2.PAD};if(cF(e)){if(r||t.width===0&&t.height===0){const a=t.width?t.height/t.width:1;r=r||64,a>1?(t.width=Math.round(r/a),t.height=r):(t.width=r,t.height=Math.round(r*a))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return s.width=t.width,s.height=t.height,new yw(t,s)}},goe=class{constructor(e){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Zl.SYMBOLOGY),this.objectResourceCache=new moe((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new foe(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:Dt.CLAMP_TO_EDGE,t:Dt.CLAMP_TO_EDGE}},e.resourceController.scheduler);const t=qt(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=FF(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=Fz(e.viewingMode,t)}destroy(){we(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return hy();this._graphicsOwners.push(e);const t=z(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),hy(()=>{t.remove(),X1(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(t=>{var r;return((r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new mi;const t=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([z(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,t,ii),this._viewState.events.on("camera-projection-changed",t)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=we(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;Vv.distance=e.centerOnSurfaceInfrequent.distance,Vv.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Vv),this.screenSizePerspectiveSettingsLabels.update(Vv),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const Vv={distance:0,fovY:0};let ef=class{constructor(e,t,r=""){this.graphics=e,this._symbol=new b7({symbolLayers:[new w7({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new x7({text:r,halo:{color:"white",size:1/.75},material:{color:t},size:12})]})}show(e,t){if(T(t))return;this.hide();const r=new kt({x:e[0],y:e[1],z:e[2],spatialReference:t});this._graphic=new mc({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}},Td=class extends ge{constructor(e){super(e),this.handles=new mi}destroy(){this.handles.destroy()}};d([p({constructOnly:!0})],Td.prototype,"renderCoordsHelper",void 0),d([p({constructOnly:!0})],Td.prototype,"surface",void 0),d([p({constructOnly:!0})],Td.prototype,"state",void 0),Td=d([k("esri.views.3d.support.PointOfInterest")],Td);const _oe=Array;let No=class extends Td{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new ph({location:kt,renderLocation:_oe},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=E(),this._tmpPoint=new kt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Nr(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=we(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Ni(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return wp(r,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Mn.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const t=(this._tmpPoint.z??0)>yoe&&this.renderCoordsHelper.viewingMode===Se.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:t?voe:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{za(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,Mn.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(mC,this._estimatedSurfaceAltitude,this._camera.eye),po(this._get("renderLocation"),mC)||(this._set("renderLocation",X(this._propertiesPool.get("renderLocation"),mC)),this.notifyChange("renderLocation"))}};d([p({constructOnly:!0})],No.prototype,"scheduler",void 0),d([p({constructOnly:!0})],No.prototype,"cache",void 0),d([p({constructOnly:!0})],No.prototype,"task",void 0),d([p({readOnly:!0})],No.prototype,"location",null),d([p({constructOnly:!0})],No.prototype,"map",void 0),d([p({readOnly:!0})],No.prototype,"renderLocation",void 0),d([p({readOnly:!0})],No.prototype,"scale",null),d([p({readOnly:!0})],No.prototype,"updating",null),No=d([k("esri.views.3d.support.CameraOnSurface")],No);const mC=E(),yoe=1e5,voe=1e6,boe=Array;let eo=class extends Td{constructor(e){super(e),this._propertiesPool=new ph({location:kt,renderLocation:boe},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=E(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Us(this._frameWorker),this._propertiesPool=we(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Mn.YIELD}_updateRenderLocation(){const e=xoe;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=Toe;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(X(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Ni(this._camera.eye,e):(W(e,this._camera.viewForward,this._get("distance")),J(e,e,this._camera.eye)),po(this._get("renderLocation"),e)||this._set("renderLocation",X(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){var s,n;const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const a=qt(this.renderCoordsHelper.spatialReference).radius,o=a+e,l=Da(r.eye),c=l<o*o,h=Ni(r.eye,t);if(c&&h>a/4){const u=o-Math.sqrt(l);return W(t,r.viewForward,u),J(t,t,r.eye),!0}}else{const a=(s=this.surface)!=null&&s.ready?this.surface.extent:null;_(a)&&sw(a,(n=this.surface)==null?void 0:n.spatialReference,Kg,this.renderCoordsHelper.spatialReference)&&(t[0]=ie(t[0],Kg[0],Kg[2]),t[1]=ie(t[1],Kg[1],Kg[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(zt.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Ni(r,e),n=Ni(r,t);if(Math.abs(n-s)/s>woe)return!0}return!1}};d([p({constructOnly:!0})],eo.prototype,"scheduler",void 0),d([p({constructOnly:!0})],eo.prototype,"task",void 0),d([p()],eo.prototype,"distance",void 0),d([p({constructOnly:!0})],eo.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([p({readOnly:!0})],eo.prototype,"location",null),d([p({readOnly:!0})],eo.prototype,"renderLocation",void 0),d([p()],eo.prototype,"updating",void 0),eo=d([k("esri.views.3d.support.CenterOnSurface")],eo);const woe=.05,xoe=E(),Toe=E(),Kg=Ot();let Coe=class{constructor(e){this._handles=new mi,this.events=new Br,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",t=>this._layerViewsChanged(t))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=we(this._handles)}_layerViewsChanged(e){e.added.forEach(t=>{t.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(t.on("visible-geometry-changed",()=>this._contentChanged()),t.uid)}),e.removed.forEach(t=>this._handles.remove(t.uid))}_contentChanged(){this.events.emit("request-update",Eoe)}};const Eoe={},Soe=Array;let Fl=class extends Td{constructor(e){super(e),this._propertiesPool=new ph({location:kt,renderLocation:Soe},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([z(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),z(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(rr.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=we(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,OD);const n=Math.max(0,(Math.acos(oe(OD,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!dp(e,t)){const c=this._propertiesPool.get("renderLocation");X(c,t),this._set("renderLocation",c)}return Mn.YIELD}const a=1-ie(n/(.5*Math.PI),0,1),o=a*a*a;this._calculateScreenHorizontalEdgeOnSurface(MD);const l=this._propertiesPool.get("renderLocation");return ns(l,t,MD,o),e&&dp(e,l)||this._set("renderLocation",l),Mn.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(_s());if(r[1]=t.aboveGround?t.padding[ht.BOTTOM]:t.fullHeight-t.padding[ht.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,Jg)){ee(Jg,Jg,t.eye);const n=K(Jg,Jg);if(this.renderCoordsHelper.intersectManifold(al(t.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,t.eye)}updateRenderLocation(){this._dirty=!0}};d([p()],Fl.prototype,"_dirty",void 0),d([p({constructOnly:!0})],Fl.prototype,"scheduler",void 0),d([p({constructOnly:!0})],Fl.prototype,"centerOnSurface",void 0),d([p({constructOnly:!0})],Fl.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([p({readOnly:!0})],Fl.prototype,"updating",null),d([p({readOnly:!0})],Fl.prototype,"location",null),d([p({readOnly:!0})],Fl.prototype,"renderLocation",void 0),Fl=d([k("esri.views.3d.support.pointsOfInterest.Focus")],Fl);const OD=E(),Jg=E(),MD=E();let Hc=class extends ge{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=E();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new mi}initialize(){this.view.state.isLocal&&(this._handles.add([z(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),Nr(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||T(this.surfaceView.extent)||T(this.surfaceView.spatialReference))return void this._set("location",null);const e=m2(this.surfaceView.extent),t=new kt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{za(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",t)}};d([p({constructOnly:!0})],Hc.prototype,"view",void 0),d([p({constructOnly:!0})],Hc.prototype,"cache",void 0),d([p()],Hc.prototype,"surface",null),d([p()],Hc.prototype,"surfaceView",null),d([p({readOnly:!0})],Hc.prototype,"location",void 0),d([p({readOnly:!0})],Hc.prototype,"renderLocation",null),Hc=d([k("esri.views.3d.terrain.StableSurfaceCenter")],Hc);let qc=class extends ge{constructor(e){super(e),this._tileGeometryUpdateExtent=nl(),this._tileGeometryUpdateSpatialReference=null,this.events=new Br,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(rr.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating?(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Roe),nl(this._tileGeometryUpdateExtent),this._set("updating",!1),Mn.YIELD):Mn.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=Et(e.spatialReference),Od(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.contentCamera.eye,s=Aoe,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,xu,t),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Tu,t),xu[0]<Tu[0]?(s[0]=xu[0],s[2]=Tu[0]):(s[0]=Tu[0],s[2]=xu[0]),xu[1]<Tu[1]?(s[1]=xu[1],s[3]=Tu[1]):(s[1]=Tu[1],s[3]=xu[1]),nw(s,e)}};d([p({constructOnly:!0})],qc.prototype,"state",void 0),d([p({constructOnly:!0})],qc.prototype,"centerOnSurfaces",void 0),d([p({constructOnly:!0})],qc.prototype,"renderCoordsHelper",void 0),d([p({constructOnly:!0})],qc.prototype,"scheduler",void 0),d([p({constructOnly:!0})],qc.prototype,"surface",void 0),d([p({readOnly:!0})],qc.prototype,"updating",void 0),qc=d([k("esri.views.3d.support.SurfaceGeometryUpdates")],qc);const Roe={},xu=E(),Tu=E(),Aoe=nl();let wn=class extends ge{constructor(e){super(e),this._handles=new mi,this._tmpRay=ea(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new ph({renderPointOfView:Poe},this),this.renderPointOfView=E(),this._pois=new Array,this._debugCenters=new Map}initialize(){var h;const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=wo(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=rs.MIN,this._contentIntersector=wo(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),a=this.view.resourceController.scheduler,o=Et((h=this.view.basemapTerrain)==null?void 0:h.elevationQueryCache),l={state:e,scheduler:a,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new eo({...l,task:rr.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new eo({...l,task:rr.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new eo({...l,task:rr.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new No({...l,cache:o,task:rr.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new qc({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Coe({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Hc({cache:o,view:this.view})),this._set("focus",new Fl({state:e,scheduler:a,surface:t,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(u,m)=>this._estimateSurfaceIntersectionAtRenderPoint(u,this.view.state.contentCamera,m)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new ef(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new ef(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new ef(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new ef(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new ef(c,"green","Focus")),this._handles.add([z(()=>e.contentCamera,u=>this._cameraChanged(u),ii),z(()=>t.extent,()=>this._updateCenterPointsOfInterest()),ha(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),ii),Nr(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Nr(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),ha(()=>zt.SHOW_POI,u=>this._setDebug(u),Je)]),this._cameraChanged(this.view.state.contentCamera);for(const u of this._pois)u.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return T(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Pm,Moe)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Pm):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(T(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=J(Pm,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(Pm)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Pm)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const s=FR(t,e,Ooe);if(T(s))return null;const n=s.origin,a=J(Pm,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,a),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;po(this.renderPointOfView,t)||this._set("renderPointOfView",X(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(z(()=>t.renderLocation,r=>{var s;return(s=this._debugCenters.get(t))==null?void 0:s.show(r,t.renderCoordsHelper.spatialReference)},Je),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};d([p({readOnly:!0})],wn.prototype,"centerOnContent",void 0),d([p({readOnly:!0})],wn.prototype,"centerOnSurfaceFrequent",void 0),d([p({readOnly:!0})],wn.prototype,"centerOnSurfaceInfrequent",void 0),d([p({readOnly:!0})],wn.prototype,"cameraOnSurface",void 0),d([p({readOnly:!0})],wn.prototype,"focus",void 0),d([p({readOnly:!0})],wn.prototype,"renderPointOfView",void 0),d([p({readOnly:!0})],wn.prototype,"surfaceOrigin",void 0),d([p({readOnly:!0})],wn.prototype,"contentGeometryUpdates",void 0),d([p({readOnly:!0})],wn.prototype,"surfaceGeometryUpdates",void 0),d([p({constructOnly:!0})],wn.prototype,"view",void 0),d([p({readOnly:!0})],wn.prototype,"updating",null),wn=d([k("esri.views.3d.support.PointsOfInterest")],wn);const Poe=Array,Pm=E(),Ooe=ea(),Moe={exclude:new Set([vd])};let Ioe=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t,t.values.byteLength+256)}},Doe=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},rCe=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function nCe(i,e,t,r,s,n){const a=t-s;if(a>=0)return(e>>a)+(r-(n<<a))*(i>>a);const o=-a;return e-(n-(r<<o))*(i>>o)<<o}let aCe=class{constructor(e,t,r){this._rows=Math.ceil(t/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,t){const r=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,t,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Loe(i,e,t,r,s,n){const a=e[r++];for(let o=0;o<a;o++){const l=new Doe(n);l.xTile=e[r++],l.yTile=e[r++],l.hash=e[r++],l.priority=e[r++];const c=e[r++];for(let m=0;m<c;m++){const f=e[r++],y=e[r++],g=e[r++],v=e[r++],b=!!e[r++],x=e[r++],w=t[r++],S=t[r++],P=e[r++],A=e[r++];l.colliders.push({xTile:f,yTile:y,dxPixels:g,dyPixels:v,hard:b,partIndex:x,width:P,height:A,minLod:w,maxLod:S})}const h=i[r++];for(let m=0;m<h;m++)l.textVertexRanges.push([i[r++],i[r++]]);const u=i[r++];for(let m=0;m<u;m++)l.iconVertexRanges.push([i[r++],i[r++]]);s.push(l)}return r}function lCe(i,e,t){for(const[r,s]of i.symbols)$oe(i,e,t,s,r)}function $oe(i,e,t,r,s){const n=i.layerData.get(s);if(n.type===no.SYMBOL){for(const a of r){const o=a.unique;let l;if(a.selectedForRendering){const c=o.parts[0],h=c.startOpacity,u=c.targetOpacity;i.allSymbolsFadingOut=i.allSymbolsFadingOut&&u===0;const m=t?Math.floor(127*h)|u<<7:u?255:0;l=m<<24|m<<16|m<<8|m}else l=0;for(const[c,h]of a.iconVertexRanges)for(let u=c;u<c+h;u+=4)n.iconOpacity[u/4]=l;if(a.selectedForRendering){const c=o.parts[1],h=c.startOpacity,u=c.targetOpacity;i.allSymbolsFadingOut=i.allSymbolsFadingOut&&u===0;const m=t?Math.floor(127*h)|u<<7:u?255:0;l=m<<24|m<<16|m<<8|m}else l=0;for(const[c,h]of a.textVertexRanges)for(let u=c;u<c+h;u+=4)n.textOpacity[u/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}let Xw=class{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this._data=e,this.memoryUsed=e.byteLength;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let a=0;a<n;a++)this.layerUIDs[a]=s[r++];this.bufferDataOffset=r,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return T(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){T(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Foe=class extends Xw{constructor(e,t){super(e,t),this.type=no.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const a=new Map;for(let o=0;o<n;o++){const l=r[s++],c=r[s++],h=r[s++];a.set(l,[c,h])}this.patternMap=a}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const s=new Uint32Array(t),n=new Int32Array(s.buffer),a=s[r++];this.lineVertexBuffer=Yt.createVertex(e,ri.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const o=s[r++];this.lineIndexBuffer=Yt.createIndex(e,ri.STATIC_DRAW,new Uint32Array(s.buffer,4*r,o)),r+=o;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new cl(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}},Noe=class extends Xw{constructor(e,t){super(e,t),this.type=no.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const a=new Map;for(let o=0;o<n;o++){const l=r[s++],c=r[s++],h=r[s++];a.set(l,[c,h])}this.patternMap=a}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const s=new Uint32Array(t),n=new Int32Array(s.buffer),a=s[r++];this.fillVertexBuffer=Yt.createVertex(e,ri.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const o=s[r++];this.fillIndexBuffer=Yt.createIndex(e,ri.STATIC_DRAW,new Uint32Array(s.buffer,4*r,o)),r+=o;const l=s[r++];this.outlineVertexBuffer=Yt.createVertex(e,ri.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=Yt.createIndex(e,ri.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,u=h.fillMaterial,m=h.outlineMaterial;this.fillVertexArrayObject=new cl(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new cl(e,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}},Uoe=class extends Xw{constructor(e,t,r){super(e,t),this.type=no.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),a=new Float32Array(e);let o=this.bufferDataOffset;this.isIconSDF=!!s[o++];const l=s[o++];for(let m=0;m<l;m++){const f=s[o++],y=s[o++],g=s[o++];this.iconPerPageElementsMap.set(f,[y,g])}const c=s[o++];for(let m=0;m<c;m++){const f=s[o++],y=s[o++],g=s[o++];this.glyphPerPageElementsMap.set(f,[y,g])}const h=s[o++],u=s[o++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(u),o=Loe(s,n,a,o,this.symbols,r),this.bufferDataOffset=o}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[t,r]of this.iconPerPageElementsMap)e+=r[1];for(const[t,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=Et(this.iconOpacity),t=Et(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e,0,0,e.length);const r=Et(this.textOpacity),s=Et(this.textOpacityBuffer);r.length>0&&r.byteLength===s.size&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,t,r){const s=new Uint32Array(t),n=new Int32Array(s.buffer),a=s[r++];this.iconVertexBuffer=Yt.createVertex(e,ri.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const o=s[r++];this.iconIndexBuffer=Yt.createIndex(e,ri.STATIC_DRAW,new Uint32Array(s.buffer,4*r,o)),r+=o;const l=s[r++];this.textVertexBuffer=Yt.createVertex(e,ri.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=Yt.createIndex(e,ri.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=Yt.createVertex(e,ri.STATIC_DRAW,Et(this.iconOpacity).buffer),this.textOpacityBuffer=Yt.createVertex(e,ri.STATIC_DRAW,Et(this.textOpacity).buffer);const h=this.layer,u=h.iconMaterial,m=h.textMaterial;this.iconVertexArrayObject=new cl(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new cl(e,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}},Voe=class extends Xw{constructor(e,t){super(e,t),this.type=no.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){const s=new Uint32Array(t),n=new Int32Array(s.buffer),a=s[r++];this.circleVertexBuffer=Yt.createVertex(e,ri.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;const o=s[r++];this.circleIndexBuffer=Yt.createIndex(e,ri.STATIC_DRAW,new Uint32Array(s.buffer,4*r,o)),r+=o;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new cl(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}};const Boe=1/Vt("mapview-transitions-duration");let zoe=class extends Br{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const t=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t==null||t.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return T(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=hp(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=hp(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,t;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(t=this._fadeOutResolver)==null||t.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=e*Boe;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const a=r===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},koe=class extends zoe{constructor(e,t,r,s,n,a,o=n,l=a){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new qG(e),this.resolution=t,this.x=r,this.y=s,this.width=n,this.height=a,this.rangeX=o,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const t=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*t,o=this.height/this.rangeY*t;kF(r,a,0,0,0,o,0,s,n,1),GF(this.transforms.dvs,e.displayViewMat3,r)}},fC=class bU extends koe{constructor(e,t,r,s,n,a,o,l=null){super(e,t,r,s,n,a,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<XP}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<XP)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){let t=!1;for(const r of e)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===no.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),t=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(wU.delete(this),bU._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){let t=!1;if(e){const{bucketsWithData:r,emptyBuckets:s}=e,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const a=new Uint32Array(s);for(const o of a)this._deleteLayerData(o)}for(const[a,o]of n)this._deleteLayerData(a),o.type===no.SYMBOL&&(this.symbols.set(a,o.symbols),t=!0),this._memoryUsedByLayerData+=o.memoryUsed,this.layerData.set(a,o),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===no.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(t){t.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*t,s=this.height/this.rangeY*t,n=[0,0];e.toScreen(n,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;HF(a),hE(a,a,n),qF(a,a,Math.PI*e.rotation/180),WF(a,a,[r,s,1])}_createTransforms(){return{dvs:Md(),tileMat3:Md(),tileUnitsToPixels:Md()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;e.forEach(r=>{t.has(r)||(r.destroy(),t.add(r))}),e.clear()}_createRenderBuckets(e){const t=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const a of n.layerUIDs)t.set(a,n)}return t}_deserializeBucket(e,t){let r=t.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case no.FILL:r=new Noe(e,this.styleRepository);break;case no.LINE:r=new Foe(e,this.styleRepository);break;case no.SYMBOL:r=new Uoe(e,this.styleRepository,this);break;case no.CIRCLE:r=new Voe(e,this.styleRepository)}return t.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e),this.layerCount--}};const wU=new Map;function Goe(){wU.forEach((i,e)=>{console.log(`
${e.key}:`),i[0].forEach(t=>console.log(t)),console.log("========"),i[1].forEach(t=>console.log(t))})}const gCe={value:.5,readOnly:!0},Hoe={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let xf=class{constructor(e=0,t=0){this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},qoe=class{constructor(e,t,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t,this.samplerData=new k7(r,t)}computeMinMaxValue(e,t,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const a=2**n;if(!(Math.floor(t/a)===this.i&&Math.floor(r/a)===this.j))return s;let o=1/0,l=-1/0;const c=this.samplerData.data.width,h=this.samplerData.data.values,u=.5*Py;let m=(c-1)/a,f=(r-this.j*a)*m,y=(t-this.i*a)*m;if(m<1){const g=Math.floor(f),v=Math.floor(y),b=g+v*c,x=h[b],w=h[b+1],S=h[b+c],P=h[b+c+1];if(x+w+S+P<u){const A=f-g,M=y-v,O=P0(x,w,S,P,A,M),I=P0(x,w,S,P,A+m,M),N=P0(x,w,S,P,A,M+m),F=P0(x,w,S,P,A+m,M+m);return s.min=Math.min(O,I,N,F),s.max=Math.max(O,I,N,F),s}f=g,y=v,m=1}else f=Math.floor(f),y=Math.floor(y),m=Math.ceil(m);for(let g=f;g<=f+m;g++)for(let v=y;v<=y+m;v++){const b=h[g+v*c];b<u?(o=Math.min(o,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=o,s.max=l,s}};const Woe=.5*Py;function xi(i,e,t){if(T(t))return null;for(const r of t){if(!r)continue;const s=r.safeWidth;let n=ie(r.dy*(r.y1-e),0,s),a=ie(r.dx*(i-r.x0),0,s);const o=Math.floor(n),l=Math.floor(a),c=r.data.width,h=o*c+l,u=r.data.values,m=u[h],f=u[h+1],y=h+c,g=u[y],v=u[y+1];if(m+g+f+v<Woe){n-=o,a-=l;const b=m+(f-m)*a;return b+(g+(v-g)*a-b)*n}}return null}let Ka=class extends ge{constructor(e){super(e),this._handles=new mi}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles=we(this._handles)}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=xU(r.fullExtent,this.viewSpatialReference);_(s)&&e.push(k$(s))}}),e}};function joe(i,e){return i===Se.Global?new FS(e):new NS(e)}d([p({readOnly:!0})],Ka.prototype,"layerViewsExtent",null),d([p({readOnly:!0})],Ka.prototype,"tiledLayersExtent",null),d([p({readOnly:!0})],Ka.prototype,"stencilEnabledExtents",null),d([p()],Ka.prototype,"viewSpatialReference",void 0),d([p()],Ka.prototype,"tilingScheme",void 0),d([p()],Ka.prototype,"defaultTiledLayersExtent",void 0),d([p({constructOnly:!0})],Ka.prototype,"layers",void 0),d([p({constructOnly:!0})],Ka.prototype,"layerViews",void 0),Ka=d([k("esri.views.3d.terrain.ExtentHelper")],Ka);let FS=class extends Ka{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?u4:sj}};FS=d([k("esri.views.3d.terrain.ExtentHelperGlobal")],FS);let NS=class extends Ka{_computeLayerViewsExtent(){const e=nl(),t=this.viewSpatialReference;this.layerViews.forEach(n=>{const a=n.layer;if(n.isResolved()&&(a.type!=="graphics"||!a.internal)){const o=xU("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,t);Od(e,o,e)}});const r=eE(e)?e:null,s=this._get("layerViewsExtent");return np(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=nl();this.layers.forEach(a=>{if(a.loaded&&k_(a)){const o=jw(a,t,Se.Local);if(T(o))return;const{tileInfo:l,fullExtent:c}=o;_(l)&&_(c)&&(jb(a)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&Od(r,c,r)}}),Od(r,this.defaultTiledLayersExtent,r);const s=eE(r)?r:null,n=this._get("tiledLayersExtent");return np(s,n)?n:s}};function xU(i,e){return _(i)&&!i.spatialReference.equals(e)?fB(i,i.spatialReference,e):i}NS=d([k("esri.views.3d.terrain.ExtentHelperLocal")],NS);var mt;(function(i){i[i.ELEVATION=0]="ELEVATION",i[i.MAP=1]="MAP"})(mt||(mt={}));const Vu=[mt.ELEVATION,mt.MAP];function TU(){var e;const i=(e=globalThis.require)==null?void 0:e.modules;if(i){const t=Object.keys(i);for(const r of t)r.search(".glsl")!==-1&&delete i[r]}}const Xoe=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let qh,yn=class extends ge{get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||zt.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?qt(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new mi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Vt("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){var t;const e=this._view;this.renderer=new Fo({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=wo(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",r=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),z(()=>{var r,s,n;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),z(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),ii),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(rr.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(ta,r,dr.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,dr.BACKGROUND,r.pixelRatio)})]),(t=e._stage)==null||t.renderer.setParameters({renderOverlay:r=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(r),this._drawOverlayTextures(this.renderer.overlays,dr.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this._handles=we(this._handles),_(qh)&&(qh.hide(),qh=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this._view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new dy(-20037508342787e-6,20037508342787e-6):new dy(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Sa)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this._view.state.contentCamera,dr.UPDATE)}_updateOverlays(e,t,r){if(!this._spatialReference)return Mn.YIELD;const s=this._computeOverlayResolution(t);this._computeOverlayExtents(t,s,Fc);const n=Yl(Fc.inner)/Yl(Fc.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const a=this._updateOverlay(Li.INNER,Fc.inner,s,1*Fc.pixelRatioAdjustment,Fc.mapUnitsPerPixel),o=this._updateOverlay(Li.OUTER,Fc.outer,s,n*Fc.pixelRatioAdjustment,Fc.mapUnitsPerPixel);a!==Gl.EXTENT&&o!==Gl.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),a===Gl.NONE&&o===Gl.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const t=this._view.state.contentPixelRatio,r=e.fullWidth/e.pixelRatio*t,s=e.fullHeight/e.pixelRatio*t;return Math.min(s2(Math.max(r,s)+256),this._maxResolution)}_updateOverlay(e,t,r,s,n){if(this.renderer.overlays.length===0)return Gl.NONE;const a=this.renderer.overlays[e],o=a.mapUnitsPerPixel;if(a.mapUnitsPerPixel=n,a.pixelRatio=s,Yoe(t,a.extent)&&r===a.resolution)return o===n?Gl.NONE:Gl.RERENDER_ONLY;my(a.extent,t),a.resolution=r;const l=m2(a.extent);return a.renderLocalOrigin=ry(l[0],l[1],0,"OV_"+this._latestOriginId++),Gl.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Li.INNER],s=this.renderer.overlays[Li.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Li.INNER,t),this._setTileOverlayData(n,Li.OUTER,t)):(this._clearTileOverlayData(Li.INNER,t),this._clearTileOverlayData(Li.OUTER,t))}else this._clearTileOverlayData(Li.INNER,t),this._clearTileOverlayData(Li.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Li.INNER],r=this.renderer.overlays[Li.OUTER],s=this._pointIsInExtent(e,t.extent)?t:r;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,t,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[t].extent,n=Yl(s),a=Vd(s);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(s[0],o);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);o>l&&(o=l-(e[2]-e[0]))}r.setScale(t,Yl(e)/n,Vd(e)/a),r.setOffset(t,(o-s[0])/n,(e[1]-s[1])/a)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){TU(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(ta)}_dispatchAnimationUpdate(e){const t=tt(e-this._animationTimeLast);if(t>=this.surface.view._stage.renderer.animationTimestep||_(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=tt(t/this.surface.view._stage.renderer.animationTimeDilation),s=new NF(this._view.state.camera,r,this._view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,s){const n=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Koe,t,r);if(T(n))return!1;const a=n.origin,o=J(Bv,n.origin,n.direction);return this._groundIntersector.reset(a,o,e),this._groundIntersector.intersect([]),this._view.basemapTerrain.intersect(this._groundIntersector,null,a,o),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const s=.55,n=this._view.renderCoordsHelper.getAltitude(e.eye),a=this._view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,l=ie(a.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+o,e.aboveGround?n-o:1/0),c=e.aboveGround;if(this._view.viewingMode==="global"){const h=Bv;ow(g2(_2,qt(this._view.spatialReference).radius+l),al(e.eye,e.viewForward),h),ee(h,h,e.eye);const u=Nd.normalize(q$(e.viewForward,h,e.viewRight))/e.fovY+.5,m=u<=0||u>=1?.5:s;r=c?m*u:u+m*(1-u)}else{const h=.5*Math.PI-Math.acos(-e.viewForward[2]),u=Math.tan(h),m=Ai(0,u,1,0),f=Jc(m,m,e.projectionMatrix)[1],y=ie(.5+.5*f,0,1);r=y===1||y===0?.5:c?y*s:1-(1-y)*s}return!!this._intersectGroundFromView(e,.5,r,t)&&$$(t,e.eye)<a.distance*a.distance}_computeOverlayExtents(e,t,r){const s=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=E();this._findHorizonBasedPointOfInterest(e,n)||X(n,s);const a=Math.max(.1,Ni(e.eye,n)),o=Wd(this._view.renderCoordsHelper,s,e.eye),l=Math.PI/2-Math.abs(o-Math.PI/2);zt.OVERLAY_SHOW_CENTER?(T(qh)&&(qh=new ef(this._view.graphics,"red")),qh.show(n,this._renderSR)):_(qh)&&qh.hide(),this._overlaySREqualsRenderSR||vs(n,this._renderSR,n,this._spatialReference);const c=this.surface.extent,h=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,u=h&&_(this._spatialReference)?1/qt(this._spatialReference).metersPerDegree:1,m=this._view.state.contentPixelRatio,f=e.perScreenPixelRatio/m*a*u;r.mapUnitsPerPixel=f/this._worldToPCSRatio;let y=t*f/2,g=!1,v=h?90:1/0;this._isSpherical&&_(c)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(y/=Math.cos(YC(n[1])),v=c[3]):(g=!0,y/=qt(this._spatialReference).metersPerDegree,v=90),y>=v&&(y=v,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let b=1;g&&(b=1/Math.max(.2,Math.cos(Math.abs(vt(n[1])))),y*b>180&&(b=180/y),r.mapUnitsPerPixel*=b);const x=Math.log(2)/12;y=Math.exp(Math.round(Math.log(y)/x)*x);const w=y*b,S=32,P=.5*t/(S*w),A=.5*t/(S*y);n[0]=Math.round(n[0]*P)/P,n[1]=Math.round(n[1]*A)/A;const M=r.inner;M[0]=n[0]-w,M[1]=n[1]-y,M[2]=n[0]+w,M[3]=n[1]+y,this._isSpherical&&this._shiftExtentToFitBounds(M,1/0,v);const O=r.outer;if(6*w>Yl(c))my(O,Et(c));else if(l<=.25*Math.PI)O[0]=M[0]-w,O[1]=M[1]-y,O[2]=M[2]+w,O[3]=M[3]+y;else{vs(e.eye,this._renderSR,Bv,this._spatialReference),yd(Cu,n,Bv);let N=-Math.atan2(Cu[1],Cu[0])+.125*Math.PI;N<0&&(N+=2*Math.PI);const F=Math.floor(N/(.25*Math.PI));uw(Cu,Xoe[F],2*y),Cu[0]*=b,Cu[2]*=b,cz(O,M,Cu)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-v),O[3]=Math.min(O[3],v);else{const N=tE(M,c,Qoe),F=tE(O,c,Zoe);lP(N,F)&&(O[2]=O[0],O[3]=O[1])}const I=Math.abs(M[2]-M[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,I),r.pixelRatioAdjustment=r.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,r=this._view.state.contentPixelRatio){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const s=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[Li.INNER],r),a=this._drawOverlay(e[Li.OUTER],r);n!==db.CHANGED&&a!==db.CHANGED||this.surface.updateTileOverlayParams(dr.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),s?(this.surface.requestRender(t),t===dr.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(dr.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!T(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):nw(e,t))}_rectInsideRect(e,t){return!T(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:lP(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,s=e.y;return r>t[0]&&r<t[2]&&s>t[1]&&s<t[3]}_shiftExtentToFitBounds(e,t,r){let s=0,n=0;e[0]<-t?s=e[0]+t:e[2]>t&&(s=t-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),J1(e,s,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask(ta)}}};function Yoe(i,e){const r=zt.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(i[2]-i[0],i[3]-i[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-i[0])<=r&&Math.abs(e[1]-i[1])<=r&&Math.abs(e[2]-i[2])<=r&&Math.abs(e[3]-i[3])<=r}d([p()],yn.prototype,"_spatialReference",void 0),d([p({readOnly:!0})],yn.prototype,"running",null),d([p()],yn.prototype,"_placementDirty",void 0),d([p()],yn.prototype,"_contentUpdated",void 0),d([p()],yn.prototype,"_isSpherical",null),d([p()],yn.prototype,"_worldToPCSRatio",null),d([p({autoDestroy:!0})],yn.prototype,"renderer",void 0),d([p({constructOnly:!0})],yn.prototype,"surface",void 0),d([p()],yn.prototype,"suspended",null),d([p()],yn.prototype,"updating",null),d([p({type:Boolean})],yn.prototype,"hasHighlights",null),d([p({type:Boolean})],yn.prototype,"rendersOccluded",null),yn=d([k("esri.views.3d.terrain.OverlayManager")],yn);const Cu=Xt(),Bv=E(),Fc={inner:Ot(),outer:Ot(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Qoe=Ot(),Zoe=Ot(),Koe=ea();var Gl;(function(i){i[i.NONE=0]="NONE",i[i.EXTENT=1]="EXTENT",i[i.RERENDER_ONLY=2]="RERENDER_ONLY"})(Gl||(Gl={}));let CU=class US{constructor(e,t){this._factoryCallback=e,this._lengthCallback=t,this._pool=new Map}acquire(e){if(!US.test.disabled){const t=this._pool.get(e);if(t&&t.length!==0)return t.pop()}try{return this._factoryCallback(e)}catch(t){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+t+s),t}}release(e){if(US.test.disabled)return;const t=this._lengthCallback(e);let r=this._pool.get(t);r||(r=new Ht({shrink:!0}),this._pool.set(t,r)),r.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};CU.test={disabled:!1};let Joe=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Pi(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},ID=class{constructor(e,t,r,s,n){this.attributes=e,this.localOrigin=t,this.index0=r,this.stride=s,this.count=n}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return se(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,t){this.attributes.position.getVec(e,t)}_getNormalRaw(e,t){this.attributes.normalCompressed.getVec(e,t)}getVertexPos(e,t){this._getVertexRaw(this.getAttributeIndex(t),e),J(e,e,this.localOrigin)}getNormal(e,t){const r=Ne();this._getNormalRaw(this.getAttributeIndex(t),r),rle(e,r)}_setNormal(e,t,r,s){Xy(this.attributes.normalCompressed,e,t,r,s)}_setUV(e,t,r){la(this.attributes.uv0,e,t,r)}setNormalFromValues(e,t,r,s){this._setNormal(this.getAttributeIndex(e),t,r,s)}setVertexFromValuesRawPositionUV(e,t,r,s,n,a){const o=this.getAttributeIndex(e);this.attributes.position.setValues(o,t,r,s),this._setUV(o,n,a)}setVertexFromValuesRawPositionUVNormal(e,t,r,s,n,a,o,l,c){const h=this.getAttributeIndex(e);this.attributes.position.setValues(h,t,r,s),this._setUV(h,n,a),this._setNormal(h,o,l,c)}};const ele=Rr().vec3f(C.POSITION).vec2i16(C.UV0).vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}),CA=new CU(i=>ele.createBuffer(i),i=>i.count);function tle(){CA.clear()}function EU(i){return CA.acquire(i)}function ile(i){CA.release(i.vertexAttributes),i.vertexAttributes=null,i.indices=null}function Xy(i,e,t,r,s){const n=1/(Math.abs(t)+Math.abs(r)+Math.abs(s)),a=t*n,o=r*n,l=s<=0?(a>=0?1:-1)*(1-Math.abs(o)):a,c=s<=0?(o>=0?1:-1)*(1-Math.abs(a)):o;i.setValues(e,LD(l),LD(c))}function rle(i,e){const t=$D(e[0]),r=$D(e[1]),s=1-Math.abs(t)-Math.abs(r);i[2]=s,s<0?(i[0]=(t>=0?1:-1)*(1-Math.abs(r)),i[1]=(r>=0?1:-1)*(1-Math.abs(t))):(i[0]=t,i[1]=r),K(i,i)}const DD=16384;function la(i,e,t,r){i.setValues(e,t*DD,r*DD)}function LD(i){return ie(Math.round(32767*i),-32767,32767)}function $D(i){return ie(i/32767,-1,1)}function Ks(i,e,t,r){i<r[0]?r[0]=i:i>r[3]&&(r[3]=i),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),t<r[2]?r[2]=t:t>r[5]&&(r[5]=t)}let sle=class{constructor(){this.sinLonLUT=new Array(h_+1),this.cosLonLUT=new Array(h_+1),this.sinLatLUT=new Array(h_+1),this.cosLatLUT=new Array(h_+1)}update(e,t,r){const s=t[0],n=t[2];for(let a=0;a<=e;a++){const o=a/e,l=s*(1-o)+n*o;this.sinLonLUT[a]=Math.sin(l),this.cosLonLUT[a]=Math.cos(l);const c=r(o);this.sinLatLUT[a]=Math.sin(c),this.cosLatLUT[a]=Math.cos(c)}}},zv=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},nle=class{constructor(){this.cornerNeighborData=[new zv,new zv,new zv,new zv],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},ale=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new nle}},SU=class $1{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=we(this._current),this._next=we(this._next),this._waiting=we(this._waiting),this._delayed=we(this._delayed)}get current(){if(T(this._current))return null;if(!this._isFadingEnabled){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t)}let e=$1.test.fadeMoment;if(_(this._delayed)&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,nh.Immediate),this._delayed=null)),_(this._next)){e=e||performance.now();const t=this._fadeDuration,r=_(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==wr.FADING,n=e-this._fadeStart>=t;(r||s||n)&&(we(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(T(this._next))return 1;const e=$1.test.fadeMoment||performance.now(),t=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return t>r?0:1-t/r}get isFading(){return _(this._next)||_(this._delayed)}push(e,t=nh.Immediate){this._delayed=we(this._delayed),this._push(e,t)}_push(e,t){if(this._isFadingEnabled||this.clear(),T(this._current))return void(this._current=e);const r=$1.test.fadeMoment||performance.now();return t!==nh.Immediate?(this._delayed=e,void(this._delayedTime=r+t)):T(this._next)?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(T(e)||(we(this._waiting),this._waiting=e))}get _fadeDuration(){return T(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const t=this._getFadeDuration();return e+t-e%t}get _isFadingEnabled(){return this._getFadeDuration()>0}};var nh;SU.test={fadeMoment:0},function(i){i[i.Immediate=0]="Immediate",i[i.Delayed=5e3]="Delayed"}(nh||(nh={}));var sg;(function(i){i[i.BACK_TO_FRONT=-1]="BACK_TO_FRONT",i[i.NONE=0]="NONE",i[i.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(sg||(sg={}));let RU=class{constructor(){this._queue=new Ht,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),_(e)&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var t;const e=(t=this._last)==null?void 0:t.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},ole=class{constructor(){this._q=new Ht}get done(){return this._q.length===0}reset(e){if(this._q.clear(),!T(e)){this._q.pushArray(e);for(let t=0;t<this._q.length;++t){const r=this._q.data[t];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function oy(i,e,t){if(T(e)||T(e.fullExtent))return!1;const r=e.fullExtent,s=i.extent;if(t){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=i.surface.tilingScheme.levels[i.level].scale,a=e.minScale;if(a>0&&n>1.00000001*a)return!1;const o=e.maxScale;return!(o>0&&n<.99999999*o)}function ah(i,e){const t=i.lij,r=e.lij;return t[0]-r[0]||t[1]-r[1]||t[2]-r[2]}function AU(i,e,t=null){T(t)||t.length===0?i===sg.BACK_TO_FRONT?e.sort(lle):e.sort(cle):e.sort((r,s)=>hle(r,s,i,t))}function lle(i,e){const t=e.screenDepth-i.screenDepth;if(t!==0)return t;const r=i.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function cle(i,e){const t=i.screenDepth-e.screenDepth;if(t!==0)return t;const r=i.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function PU(i,e,t){const r=i.screenDepth,s=e.screenDepth;return r<s?-t:r>s?t:ah(i,e)}function hle(i,e,t,r){return FD(i,r)===FD(e,r)?PU(i,e,t):i?t:-t}function FD(i,e){for(const t of e)if(i.intersectsExtent(t))return!0;return!1}function dle(i,e){const t=i.distanceToPOI-e.distanceToPOI;if(t!==0)return t;const r=i.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function ule(i,e){const t=i.length;for(let r=0;r<t;++r)i.getItemAt(r).updateDistanceToPOI(e);i.sort(dle)}function ple(i,e,t){let r=1,s=0,n=0;for(;i!==e;)if(r*=.5,s*=.5,n*=.5,1&i.lij[2]&&(s+=.5),!(1&i.lij[1])&&(n+=.5),(i=i.parent)==null)throw new Error("tile was not a descendant of upsampleTile");t.init(e,s,n,r)}function mle(i){for(let e=0;e<i.length;e++){const t=i[e],r=t.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==t)return!0}}return!1}function MCe(i,e){if(!i||!e||i[0]===e[0])return!1;const t=i[0]<e[0],r=t?i:e,s=t?e:i,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let EA=class{get updating(){return!!this._tileRequested}init(e,t,r,s){this.tile=e,this._layerIdx=t,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(t,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e){this._setUpsampleTile(e),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,wr.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(e)?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,t=this._layerClass,r=this.tile.surface.layerViewByIndex(e,t),s=IS(r),{minLevel:n,maxLevel:a}=r.dataLevelRange,o=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+o,c=this._scaleRangeEnabled?oy:()=>!0;let h=this.tile;const u=h.level;let m;const f=this._tileLayerInfo.upsampleInfo,y=_(f)?f.tile.level:-1,g=!!_(f)&&y-u>=o,v=ts(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const b=h.level,x=u-b,w=h.layerInfo[t][e];if(w.data&&x>=o){(!g||b>y)&&this._setUpsampleTile(h),w.dataInvalidated&&(m=h);break}if((T(v)||v.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&b<=a&&!w.data&&!w.dataMissing&&((T(m)||h.level===n||b%d4==0||u-m.level<o)&&(m=h),x>=l))break;h=h.parent}return _(m)&&u-m.level<o&&this._tileLayerInfo.upsampleInfo&&(m=null),m}_findAncestorWithData(){const e=this.tile.vlevel,t=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=t)return s;r=s}return r}_setUpsampleTile(e){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,wr.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},fle=class extends EA{get _desiredMinLevelDelta(){throw ND}get _progressiveLevelModulo(){throw ND}dispose(){}};const ND=new Error("Abstract method called on TileAgent"),Bn=new fle;let OU=class extends EA{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return RE(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},MU=class extends EA{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return d4}};var cp,Tp;(function(i){i[i.Stretch=0]="Stretch",i[i.Lut=1]="Lut",i[i.Hillshade=2]="Hillshade",i[i.COUNT=3]="COUNT"})(cp||(cp={})),function(i){i[i.Noop=0]="Noop",i[i.PerBand=1]="PerBand",i[i.COUNT=2]="COUNT"}(Tp||(Tp={}));function gle(i,e){i.fragment.uniforms.add([new Bt("u_colormap",t=>t.u_colormap),new yt("u_colormapOffset",t=>t.colormap.u_colormapOffset),new yt("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new yt("u_opacity",t=>t.common.u_opacity)]),i.fragment.code.add(R`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${Na(e,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function _le(i,e){i.fragment.uniforms.add(TF("u_transformGrid",t=>t.u_transformGrid,e.hasWebGL2Context?Ba.None:Ba.InvSize)),i.fragment.uniforms.add(new en("u_transformSpacing",t=>t.common.u_transformSpacing)),i.fragment.uniforms.add(new en("u_targetImageSize",t=>t.common.u_targetImageSize)),i.fragment.code.add(R`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${Na(e,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${Na(e,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${Na(e,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${Na(e,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}let IU=class extends ur{constructor(){super(...arguments),this.scale=1,this.offset=uc}};function DU(i){i.attributes.add(C.POSITION,"vec2"),i.attributes.add(C.UV0,"vec2"),i.vertex.uniforms.add(new yt("scale",e=>e.scale)),i.vertex.uniforms.add(new en("offset",e=>e.offset)),i.varyings.add("uv","vec2"),i.varyings.add("vuv","vec2"),i.vertex.code.add(R`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let yle=class extends IU{constructor(e,t,r){super(),this.common=e,this.u_image=t,this.u_transformGrid=r}};function vle(i,e){i.include(_le,e),i.fragment.uniforms.add([new Bt("u_image",t=>t.u_image),new by("u_flipY",t=>t.common.u_flipY),new by("u_applyTransform",t=>t.common.u_applyTransform)]),i.fragment.code.add(R`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var fe;(function(i){i[i.Normal=0]="Normal",i[i.Average=1]="Average",i[i.Lighten=2]="Lighten",i[i.Lighter=3]="Lighter",i[i.Plus=4]="Plus",i[i.Screen=5]="Screen",i[i.ColorDodge=6]="ColorDodge",i[i.Darken=7]="Darken",i[i.Multiply=8]="Multiply",i[i.ColorBurn=9]="ColorBurn",i[i.Overlay=10]="Overlay",i[i.SoftLight=11]="SoftLight",i[i.HardLight=12]="HardLight",i[i.VividLight=13]="VividLight",i[i.Hue=14]="Hue",i[i.Saturation=15]="Saturation",i[i.Luminosity=16]="Luminosity",i[i.Color=17]="Color",i[i.DestinationOver=18]="DestinationOver",i[i.DestinationAtop=19]="DestinationAtop",i[i.DestinationIn=20]="DestinationIn",i[i.DestinationOut=21]="DestinationOut",i[i.SourceAtop=22]="SourceAtop",i[i.SourceIn=23]="SourceIn",i[i.SourceOut=24]="SourceOut",i[i.Xor=25]="Xor",i[i.Difference=26]="Difference",i[i.Exclusion=27]="Exclusion",i[i.Minus=28]="Minus",i[i.Invert=29]="Invert",i[i.Reflect=30]="Reflect",i[i.COUNT=31]="COUNT"})(fe||(fe={}));const VS={normal:fe.Normal,average:fe.Average,lighten:fe.Lighten,lighter:fe.Lighter,screen:fe.Screen,plus:fe.Plus,"color-dodge":fe.ColorDodge,darken:fe.Darken,multiply:fe.Multiply,"color-burn":fe.ColorBurn,overlay:fe.Overlay,"soft-light":fe.SoftLight,"hard-light":fe.HardLight,"vivid-light":fe.VividLight,hue:fe.Hue,saturation:fe.Saturation,luminosity:fe.Luminosity,color:fe.Color,difference:fe.Difference,exclusion:fe.Exclusion,minus:fe.Minus,invert:fe.Invert,reflect:fe.Reflect,"destination-over":fe.DestinationOver,"destination-atop":fe.DestinationAtop,"destination-in":fe.DestinationIn,"destination-out":fe.DestinationOut,"source-atop":fe.SourceAtop,"source-in":fe.SourceIn,"source-out":fe.SourceOut,xor:fe.Xor};function ble(i){return i===fe.DestinationOver||i===fe.DestinationAtop||i===fe.DestinationIn||i===fe.DestinationOut||i===fe.SourceAtop||i===fe.SourceIn||i===fe.SourceOut||i===fe.Xor}function SA(i){i.code.add(R`
    float lineFactorAtPosition(float value) {
      float pos = value * ${R.float(257)};
      if(pos < 0.5 || pos > ${R.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function wle(i,e){const t=e.blendMode;t!==fe.Normal&&(t===fe.Reflect&&i.code.add(R`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),t!==fe.ColorDodge&&t!==fe.VividLight||i.code.add(R`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),t!==fe.ColorBurn&&t!==fe.VividLight||i.code.add(R`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),t===fe.Overlay&&i.code.add(R`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),t===fe.HardLight&&i.code.add(R`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),t===fe.SoftLight&&i.code.add(R`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),t===fe.VividLight&&i.code.add(R`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),t!==fe.Hue&&t!==fe.Saturation&&t!==fe.Color&&t!==fe.Luminosity||(i.code.add(R`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),t!==fe.Hue&&t!==fe.Saturation||i.code.add(R`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),i.code.add(R`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${t===fe.Multiply?R`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Average?R`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Lighten?R`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Darken?R`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Lighter?R`return vec4(cl * ol + cb * ob, ol + ob);`:t===fe.Plus?R`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:t===fe.Minus?R`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:t===fe.Screen?R`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Difference?R`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Invert?R`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:t===fe.DestinationOver?R`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:t===fe.DestinationAtop?R`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:t===fe.DestinationOut?R`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:t===fe.SourceAtop?R`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:t===fe.SourceOut?R`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:t===fe.Xor?R`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:t===fe.DestinationIn?R`return vec4(cb * ob * ol, ol * ob);`:t===fe.SourceIn?R`return vec4(cl * ol * ob, ol * ob);`:t===fe.Hue?R`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Saturation?R`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Color?R`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Luminosity?R`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Exclusion?R`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Reflect?R`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.ColorDodge?R`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.ColorBurn?R`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.Overlay?R`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.SoftLight?R`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.HardLight?R`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===fe.VividLight?R`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:R``}
    }
  `))}var Dr,tl,Go;(function(i){i[i.Composite=0]="Composite",i[i.ColorComposite=1]="ColorComposite",i[i.GridComposite=2]="GridComposite",i[i.GroupBackgroundComposite=3]="GroupBackgroundComposite",i[i.COUNT=4]="COUNT"})(Dr||(Dr={})),function(i){i[i.NotRequired=0]="NotRequired",i[i.Required=1]="Required",i[i.COUNT=2]="COUNT"}(tl||(tl={})),function(i){i[i.Off=0]="Off",i[i.On=1]="On",i[i.COUNT=2]="COUNT"}(Go||(Go={}));function LU(i,e){const t=e.output===Dr.GridComposite,r=e.output===Dr.ColorComposite,s=e.output===Dr.GroupBackgroundComposite,n=e.output===Dr.Composite;t&&(i.extensions.add("GL_OES_standard_derivatives"),i.fragment.include(SA)),r&&i.fragment.uniforms.add(new Fs("backgroundColor",c=>c.backgroundColor));const a=e.baseOpacityMode===tl.Required;if(a&&i.fragment.uniforms.add(new yt("baseOpacity",c=>c.baseOpacity)),n){const c=e.hasWebGL2Context?Ba.None:Ba.InvSize;i.fragment.uniforms.add(TF("fboColor",h=>h.fboTexture,c))}const o=e.blendMode!==fe.Normal,l=e.premultipliedSource===Go.On;i.fragment.include(wle,e),i.fragment.code.add(R`
    vec4 getBackground(vec2 uv) {
      return ${a?R`baseOpacity *`:""} ${s?R`vec4(0.0, 0.0, 0.0, 0.0)`:r?R`vec4(backgroundColor, 1.0)`:t?R`vec4(gridColor(uv), 1.0)`:R`${Na(e,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${o?R`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:R`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(n&&!a||s)?R`colorLayer * opacity;`:R`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let Yw=class extends yle{constructor(e,t,r,s,n,a){super(e,s,n),this.colormap=t,this.symbolizer=r,this.u_colormap=a,this.backgroundColor=Va,this.fboTexture=null,this.baseOpacity=1}},xle=class extends Yw{},Tle=class extends Yw{};function Cle(i){const e=new Hi;return e.include(DU),e.include(vle,i),e.include(gle,i),e.include(LU,i),e.fragment.code.add(R`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),i.colorizerType===cp.Stretch?Sle(e,i):i.colorizerType===cp.Lut?Ele(e):i.colorizerType===cp.Hillshade&&Rle(e,i),e}function Ele(i){i.fragment.code.add(R`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Sle(i,e){i.fragment.uniforms.add([new A2("u_bandCount",r=>r.symbolizer.u_bandCount),new Kc("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Kc("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Kc("u_factor",r=>r.symbolizer.u_factor,3),new yt("u_minOutput",r=>r.symbolizer.u_minOutput),new yt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new by("u_useGamma",r=>r.symbolizer.u_useGamma),new Kc("u_gamma",r=>r.symbolizer.u_gamma,3),new Kc("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new yt("u_opacity",r=>r.common.u_opacity)]),i.fragment.code.add(R`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const t=e.applyColormap?R`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:R`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;i.fragment.code.add(R`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Tp.Noop?R`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:R`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${t}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Rle(i,e){const t=i.fragment;t.uniforms.add([new Bt("u_image",s=>s.u_image),new A2("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Kc("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Kc("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Kc("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Kc("u_weights",s=>s.symbolizer.u_weights,6),new en("u_factor",s=>s.symbolizer.u_factor),new yt("u_minValue",s=>s.symbolizer.u_minValue),new yt("u_maxValue",s=>s.symbolizer.u_maxValue),new en("u_srcImageSize",s=>s.common.u_srcImageSize)]),t.include(zF),t.code.add(R`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),t.code.add(R`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?R`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:R`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;t.code.add(R`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Ale=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Tle,ColorizerStretchUniforms:xle,ColorizerUniforms:Yw,build:Cle},Symbol.toStringTag,{value:"Module"}));function Ple(i,e,t="nearest",r=!1){var c;const s=!(r&&e.pixelType==="u8"),n=s?wt.FLOAT:wt.UNSIGNED_BYTE,a=e.pixels==null||e.pixels.length===0?null:s?e.getAsRGBAFloat():e.getAsRGBA(),o=(c=i.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:e.width,height:e.height,target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,internalFormat:i.type===wi.WEBGL2&&s?Ef.RGBA32F:Ke.RGBA,samplingMode:!o||t!=="bilinear"&&t!=="cubic"?Rt.NEAREST:Rt.LINEAR,dataType:n,wrapMode:Dt.CLAMP_TO_EDGE,flipped:!1};return new ui(i,l,a)}function Ole(i,e){const{spacing:t,offsets:r,coefficients:s,size:[n,a]}=e,o=t[0]>1,l={width:o?4*n:n,height:a,target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,internalFormat:i.type===wi.WEBGL2?Ef.RGBA32F:Ke.RGBA,dataType:wt.FLOAT,samplingMode:Rt.NEAREST,wrapMode:Dt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(o?n*a*16:2*r.length);if(o&&s!=null)for(let h=0,u=0;h<s.length;h++)c[u++]=s[h],h%3==2&&(c[u++]=1);else for(let h=0;h<a;h++)for(let u=0;u<n;u++){const m=4*(h*n+u),f=2*(u*a+h);c[m]=r[f],c[m+1]=r[f+1],c[m+3]=r[f]===-1?0:1}return new ui(i,l,c)}function UD(i,e){const t={width:e.length/4,height:1,target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,internalFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,wrapMode:Dt.CLAMP_TO_EDGE,flipped:!1};return new ui(i,t,e)}function Mle(i,e,t,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!i,u_opacity:r,u_transformSpacing:i?i.spacing:uc,u_transformGridSize:i?i.size:uc,u_targetImageSize:e,u_srcImageSize:t}}function Ile(i,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:i?i.length/4-1:0}}function Dle(i){return{u_bandCount:i.bandCount,u_minOutput:i.outMin,u_maxOutput:i.outMax,u_minCutOff:i.minCutOff,u_maxCutOff:i.maxCutOff,u_factor:i.factor,u_useGamma:i.useGamma,u_gamma:i.gamma,u_gammaCorrection:i.gammaCorrection}}function Lle(i){return{u_hillshadeType:i.hillshadeType,u_sinZcosAs:i.sinZcosAs,u_sinZsinAs:i.sinZsinAs,u_cosZs:i.cosZs,u_weights:i.weights,u_factor:i.factor,u_minValue:i.minValue,u_maxValue:i.maxValue}}const VD={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let $le=class{constructor(e,t,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=t,this.width=r||t.width,this.height=s||t.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Le(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...VD,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||VD}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){_(e)&&e.length>0?this._bandIds&&e.every((t,r)=>{var s;return!!((s=this._bandIds)!=null&&s[r])&&t===this._bandIds[r]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,_(this._rasterTexture)){const t=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(t==="bilinear"?Rt.LINEAR:Rt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Le(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((T(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&T(this._transformGridTexture)&&(this._transformGridTexture=Ole(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:t,width:r,height:s,opacity:n}=this,a=Mle(t,[r,s],[this.source.width,this.source.height],n),o=Ile(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Dle(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Lle(this.symbolizerParameters):null;return new Yw(a,o,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(T(this._memoryUsed)){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(t=>_(t)?t.descriptor.width*t.descriptor.height*4:0).reduce((t,r)=>t+r,0)}return this._memoryUsed}release(){return this._rasterTexture=Le(this._rasterTexture),this._transformGridTexture=Le(this._transformGridTexture),this._colormapTexture=Le(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,t){const r=this.source?this.source.extractBands(t):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=Le(this._rasterTexture));const s=T(t)&&T(this.bandIds)||_(t)&&_(this.bandIds)&&t.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&s)return;this._rasterTexture=Le(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Ple(e,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"?"nearest":"bilinear"}_updateColormapTexture(e){const t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((s,n)=>s!==t[n])?(this._colormapTexture=Le(this._colormapTexture),this._colormapTexture=UD(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=UD(e,r),void(this._colormap=r)):(this._colormapTexture=Le(this._colormapTexture),void(this._colormap=null))}},F1=class{constructor(){this.waitingAgents=new Ht,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const t=gC.acquire();return t._init(e),t}release(){this.dispose(),N1.delete(this),gC.release(this)}dispose(){this.loadingAgent=Le(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=Ff(this._data)}static prune(){gC.prune(0)}_init(e){this.waitingAgents.clear(),this._data=Ff(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=sl(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){_(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,t){if(e===t||T(t))this._unsetUpsampleInfo();else{if(T(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData(),ple(e,t,this._upsampleInfo)}}get data(){return this._data}set data(e){Ff(this._data),this._data=e}};const gC=new Qo(F1,null,()=>{}),N1=new Map;function Fle(){N1.size>0&&(console.log(`${N1.size} live TilePerLayerInfo allocations:`),N1.forEach(i=>console.log(i,`
`)))}let tf=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}};var Ve;(function(i){i[i.NONE=0]="NONE",i[i.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",i[i.SPLIT=2]="SPLIT",i[i.VSPLITMERGE=4]="VSPLITMERGE",i[i.MERGE=8]="MERGE",i[i.RENDERDATA=16]="RENDERDATA",i[i.GEOMETRY=32]="GEOMETRY",i[i.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",i[i.TEXTURE_FADING=128]="TEXTURE_FADING"})(Ve||(Ve={}));const _C=E(),Om=E(),Yr=E(),Nle=.1;let RA=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Ot(),this._elevationBounds=Ne(),this.layerInfo=[[],[]],this.extentInRadians=Ot(),this.centerAtSeaLevel=E(),this._center=[E(),yo(),E()],this.up=lB(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=E()}static prune(){AA.prune(0),PA.prune(0),F1.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[cr.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var r;this._dirty=!1;const e=((r=this.parent)==null?void 0:r.frustumVisibility)??Is.INTERSECTS;this._frustumVisibility=e===Is.INSIDE?Is.INSIDE:e===Is.OUTSIDE?Is.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const t=this._frustumVisibility!==Is.OUTSIDE&&this._intersectsClippingArea;t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){const e=this._surface.snapLevel;if(_(e)){const t=this.level-e;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(e,t,r){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=qt(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[cr.MIDDLE][3]=0,this.vlevel=e?e[0]:0,t&&t.elevationBounds?as(this._elevationBounds,t.elevationBounds):pi(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=t,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of Vu){const n=r.numLayers(s),a=this.layerInfo[s];for(const o of a)o.release();a.length=n;for(let o=0;o<n;o++)a[o]=F1.acquire(this._surface.upsampleInfoPool),s===mt.ELEVATION&&this.findElevationBoundsForLayer(o,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,h_)}release(){jl(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Vu){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[mt.MAP].reduce((e,t)=>e+(t instanceof fC?t.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const t=this._surface.tilingScheme.pixelSize;return t*t*4}_ensureUsedMemory(){if(_(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:r}of this.layerInfo[mt.MAP])r instanceof fC?e+=this._getTerrainDataMemory(r):this._mapTileMemoryInternal+=this._getTerrainDataMemory(r);const t=this._cpuImageMemorySize;for(const r of this.layerInfo[mt.ELEVATION])this._usedMemory+=r.data?t:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=ab(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,t){const r=this.layerInfo[e][t];return r!=null&&r.data?e===mt.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===mt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof tf?ab(e.texture):e instanceof HTMLImageElement||e instanceof qw?this._cpuImageMemorySize:e instanceof fC||e instanceof $le?e.memoryUsage:0}updateScreenDepth(e){const t=this._center[cr.MIDDLE],r=e,s=t[0],n=t[1],a=t[2],o=r[2]*s+r[6]*n+r[10]*a+r[14];this.screenDepth=o<0?0:o/(r[3]*s+r[7]*n+r[11]*a+r[15])}shouldSplit(e,t,r){if(!this.visible||_(e.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Is.OUTSIDE))return Ve.NONE;const s=this.level;ee(_C,this._center[cr.MIDDLE],t);let n=Da(_C),a=cr.MIDDLE;ee(Om,this._center[cr.TOP],t);const o=Da(Om);o<n&&(n=o,a=cr.TOP),ee(Om,this._center[cr.BOTTOM],t);const l=Da(Om);if(l<n&&(n=l,a=cr.BOTTOM),this._edgeLen2>n&&s<e.maxLod)return Ve.SPLIT;const c=Math.sqrt(n),h=e.fovX*c*2,u=this._edgeLen/h,m=()=>{const v=s+Math.ceil(-Math.log2(e.relativeWidthLimit/u));return v!==this.vlevel?(this.vlevel=v,Ve.VSPLITMERGE):Ve.NONE_HIT_MAXLOD};if(_(r)&&r-s===1)return s>=e.maxLod?m():Ve.SPLIT;const f=oe(this.up,_C),y=this._elevationBounds[1]-this._elevationBounds[0],g=y/this.edgeLen;if(e.aboveGround&&f>0&&g<.001&&f/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-g>0)return Ve.NONE;if(u<e.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Ve.VSPLITMERGE):Ve.NONE;if(s>=e.maxLod)return m();if(s>6){ee(Om,this._center[a],t),W(Yr,this.up,f),ee(Yr,Yr,Om);const v=Da(Yr);if(v>this.radius*this.radius){W(Yr,Yr,this.radius/Math.sqrt(v)),J(Yr,Yr,this._center[a]),ee(Yr,t,Yr);const b=Math.min(1,(Math.abs(oe(Yr,this.up))+.5*y+this._curvatureHeight)/xe(Yr)),x=Nle/e.angledSplitBias,w=e.fovY*c*2;if(b*(this._edgeLen/w)<x*e.relativeHeightLimit)return Ve.NONE}}return Ve.SPLIT}setChildren(e,t,r,s){jl(!!(e&&t&&r&&s),"Null child passed"),this._children[0]=e,this._children[1]=t,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of Vu)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const t of Vu){const r=this.layerInfo[t];for(const s of r)s.loadingAgent&&s.loadingAgent!==Bn&&(kv(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Ve.GEOMETRY),this.resetPendingUpdate(Ve.TEXTURE_NOFADING),this.resetPendingUpdate(Ve.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[mt.MAP];for(const t of e)t.loadingAgent&&t.loadingAgent!==Bn&&(kv(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(np(e,this._clippingArea))return!1;const t=this._intersectsClippingArea,r=this._isWithinClippingArea;_(e)?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||t||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Ve.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const r=this.layerInfo[t][e];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Vu){const t=this.layerInfo[e];for(const r of t)if(r.loadingAgent&&r.loadingAgent!==Bn&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Ve.SPLIT)||e!==mt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===Ve.SPLIT||e===Ve.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,r){const s=this.layerInfo[t][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e),r.dataArrived(this),!0;if(s.requestPromise)return!0;sl(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,t,s.requestAbort);if(!n)return s.requestAbort=null,!1;const a=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(a,a),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const t=this._children;return t[0]?t[0].findByLij(e)||t[1].findByLij(e)||t[2].findByLij(e)||t[3].findByLij(e):null}distanceToSquared(e){return Da(ee(Yr,this._center[cr.MIDDLE],e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}containsPointXY(e,t){const r=this.extent;return e>=r[0]&&t>=r[1]&&e<=r[2]&&t<=r[3]}unrequestLayerData(e,t,r){const s=this.layerInfo[t][e],n=s.waitingAgents,a=n.removeUnordered(r)!=null;jl(a,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,t,r){const s=this.layerInfo[t][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,t,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${r}`);const s=this.layerInfo[t][e];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,t){switch(e){case mt.MAP:return this._updateTexture(t);case mt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===wr.FADING?Ve.TEXTURE_NOFADING:Ve.TEXTURE_FADING),this.setPendingUpdate(e===wr.FADING?Ve.TEXTURE_FADING:Ve.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Ve.GEOMETRY);for(const e of this.layerInfo[mt.ELEVATION])e.pendingUpdates|=Ve.GEOMETRY}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){const e=this._elevationBounds,t=e[0],r=e[1];pi(e,1/0,-1/0);const s=this.layerInfo[mt.ELEVATION];let n=!0;for(const a of s)_(a.elevationBounds)&&(e[0]=Math.min(e[0],a.elevationBounds.min),e[1]=Math.max(e[1],a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(n=!1));n&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),t===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,t=.5*(e[0]+e[1]),r=this._center;W(Yr,this.up,t),J(r[cr.MIDDLE],this.centerAtSeaLevel,Yr),W(Yr,this.up,e[0]),J(r[cr.TOP],this.centerAtSeaLevel,Yr),W(Yr,this.up,e[1]),J(r[cr.BOTTOM],this.centerAtSeaLevel,Yr)}findElevationBoundsForLayer(e,t){const r=this.layerInfo[mt.ELEVATION][e],s=RE(this.level),n=Math.max(this.vlevel-s,0),a=r.elevationBounds;if(_(a)&&a.level>=t&&a.level<=n)return;const o=this._surface.layerViewByIndex(e,mt.ELEVATION),l=IS(o);if(!oy(this,l,!1))return;const c=Vle;let h=!1;const u=r.data;if(u&&u.level<=n){const m=r.data;c.min=m.samplerData.data.minValue,c.max=m.samplerData.data.maxValue,c.hasNoDataValues=m.samplerData.data.hasNoDataValues,c.level=this.level,h=!0}else{let m,f,y=0;for(let g=this._parent;g&&(!f||y<s)&&(y=this.vlevel-g.level,m=f||m,f=g.layerInfo[mt.ELEVATION][e].data,!(!f&&m&&g.level<=n));g=g.parent);f=f||m,f&&(f.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=f.level,h=!0))}h&&(T(r.elevationBounds)&&(r.elevationBounds=new xf),r.elevationBounds.copyFrom(c))}modifyLayers(e,t,r){const s=this.layerInfo[r];for(const o of s)o.loadingAgent&&o.loadingAgent!==Bn&&(kv(o.loadingAgent),o.loadingAgent=null),o.waitingAgents.clear();for(let o=0;o<s.length;++o)e[o]===void 0&&s[o].release();const n=new Array(...s),a=t.length;s.length=a;for(let o=0;o<a;o++){const l=t[o];s[o]=l>-1?n[l]:F1.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,wr.FADING))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const r of t)r.loadingAgent===Bn&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Vu){const t=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Bn&&(r.loadingAgent.setSuspension(t),r.loadingAgent===Bn&&this.updateRenderData(e,wr.FADING))}}removeLayerAgent(e,t){const r=this.layerInfo[t][e];r.loadingAgent&&r.loadingAgent!==Bn&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,t){const r=this.layerInfo[t][e];r.loadingAgent=Bn,!r.data&&T(r.upsampleInfo)&&this._createOrUpdateAgents(e+1,t)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||qf(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,t,r){var s,n,a;for(let o=e;o<t;++o){const l=this._surface.layerViewByIndex(o,r);if(Xb(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||qf((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((a=l==null?void 0:l.layer)==null?void 0:a.parent))return!0}return!1}_createOrUpdateAgents(e,t){const r=this.layerInfo[t];if(r.length===0)return;const s=this._isSuspended(t);for(let n=e;n<r.length;++n){const a=r[n];let o=!1;const l=this._surface.layerViewByIndex(n,t),c=IS(l);if(a.loadingAgent?oy(this,c,!1)?(a.loadingAgent!==Bn&&a.loadingAgent.setSuspension(s),a.loadingAgent!==Bn&&(o=a.loadingAgent.update())):a.dispose():oy(this,c,!1)&&(a.loadingAgent=Ule(this,n,t,s),o=a.loadingAgent.startLoading(),o?a.loadingAgent===Bn&&this.setPendingUpdate(Ve.GEOMETRY):(kv(a.loadingAgent),a.loadingAgent=Bn)),a.loadingAgent===Bn&&this.updateRenderData(t,wr.FADING),!this._hasBlendModes(e,r.length,t)&&o&&l.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}getElevationVerticesPerSide(e){const t=this.vlevel-this.level,r=Math.max(this.level-e,RE(this.level)-t),s=ie(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,t){if(!e)return null;const r=this.surface.rootTiles;if(_(r)){for(const s of r)if(Ble(s,e)){let n=s,a=e[0]-n.level-1;for(;a>=0&&!n.isLeaf&&!t(n);){const o=e[1]>>a&1,l=e[2]>>a&1;n=n.children[2*o+l],a--}return t(n)?n:null}}return null}findNeighborTile(e,t){const r=this.lij,s=this.getNeighborLIJ(r,e);return s?zle(r,s)?t(this)?this:null:this._findLIJ(s,t):null}findCorner(e,t){const r=e===ke.NORTH_EAST?1:e===ke.NORTH_WEST?0:e===ke.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!t||!t(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,t){var r;return((r=this.findNeighborTile(e,s=>t(s)||s.level===this.level))==null?void 0:r.findCorner($S(e),t))||null}forAllSubtreeOnSide(e,t){const r=e===ke.NORTH?[0,1]:e===ke.NORTH_EAST?[1]:e===ke.EAST?[1,3]:e===ke.SOUTH_EAST?[3]:e===ke.SOUTH?[2,3]:e===ke.SOUTH_WEST?[2]:e===ke.WEST?[0,2]:[0],s=n=>{const a=n.children;!t(n)&&a[0]&&r.forEach(o=>s(a[o]))};s(this)}forallNeighbors(e){Qb.forEach(t=>this.findNeighborCornerTileExact(t,e)),rc.forEach(t=>{var r;return(r=this.findNeighborTile(t,s=>s.level===this.level||e(s)))==null?void 0:r.forAllSubtreeOnSide(Yb(t),e)})}getNeighborEdgeStartVertexIndex(e,t){if(!t)return 0;const r=this.level-t.level;if(se(!Er||r>=0),r===0)return 0;const s=2**r,n=(1&e)==1,a=n?0:1,o=t.lij[a+1]*s,l=this.lij[a+1],c=l-o,h=n?s-1-c:c;return Er&&(se(o<=l&&l<o+s),se(0<=h&&h<s)),h}forEachLoadedNeighbor(e){const t=this.level,r=s=>s.level===t||s.isLoaded;rc.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(Yb(s),a=>!!a.isLoaded&&(e(a,s),!0))}),Qb.forEach(s=>{var a;const n=(a=this.findNeighborTile(s,r))==null?void 0:a.findCorner($S(s),o=>o.isLoaded);se(!n||BS(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,t){const r=PD(t)?-1:AD(t)?1:0,s=SD(t)?-1:RD(t)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+X2()>=this.surface.extent[1]}checkGeometryWaterproofness(){var e;Wb&&(se(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const t=this.extent,r=this.surface.rootTilesExtent,s=.25*(t[2]-t[0]);if(PD(e)&&t[3]+s>=r[3]||AD(e)&&t[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&SD(e)&&t[0]-s<=r[0])&&!(!n&&RD(e)&&t[2]+s>=r[2])}updateDistanceToPOI(e){const t=this._lastPOI;if(this.distanceToPOI>=0&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return;X(this._lastPOI,e);const r=this._center[cr.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],a=e[2]-r[2];this.distanceToPOI=s*s+n*n+a*a}};function Ule(i,e,t,r){const s=t===mt.ELEVATION?PA.acquire():AA.acquire();return s.init(i,e,t,r),s}function kv(i){i.dispose(),i instanceof OU?PA.release(i):i instanceof MU&&AA.release(i)}const AA=new Qo(MU),PA=new Qo(OU),Vle=new xf;var cr;function Ble(i,e){const t=i.level,r=e[0];if(t>r)return!1;const s=r-t,n=Math.floor(e[1]/2**s),a=Math.floor(e[2]/2**s);return n===i.lij[1]&&a===i.lij[2]}function zle(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]}function kle(i,e,t){if(T(i)||T(e))return!1;if(i.level===0&&e.level===0&&(i.isEastEnd&&e.isWestEnd&&t===ke.EAST||i.isWestEnd&&e.isEastEnd&&t===ke.WEST))return!0;const r=Math.max(1e-6*(i.extent[2]-i.extent[0]),1);switch(t){case ke.NORTH:return co(i.extent[3],e.extent[1],r);case ke.SOUTH:return co(i.extent[1],e.extent[3],r);case ke.EAST:return co(i.extent[2],e.extent[0],r)||co(i.extent[2],-e.extent[0],r);case ke.WEST:return co(i.extent[0],e.extent[2],r)||co(i.extent[0],-e.extent[2],r)}}function BS(i,e,t){return!T(i)&&!T(e)&&e!==i&&(i.level>=e.level?BD(i,e,t):BD(e,i,$S(t)))}function BD(i,e,t){se(i.level>=e.level);const r=coe(t),s=hoe(t),n=i.extent,a=e.extent,o=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?a[2]:a[0],s?a[1]:a[3]],c=1e-5*(n[2]-n[0]),h=co(o[0],l[0],c)||i.surface.isGlobal&&co(o[0],-l[0],c),u=co(o[1],l[1],c);if(h&&u)return!0;if(i.level===e.level||!h&&!u)return se(!1),!1;const m=h?zD(a[1],a[3],n[1],n[3],c):zD(a[0],a[2],n[0],n[2],c);return se(m),m}function zD(i,e,t,r,s=X2()){return i-s<=t&&t<=r&&r<=e+s}(function(i){i[i.TOP=0]="TOP",i[i.MIDDLE=1]="MIDDLE",i[i.BOTTOM=2]="BOTTOM"})(cr||(cr={}));let Gle=class{constructor(){this._scales=Ai(-1,-1,-1,-1),this._offsets=Ai(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,t,r){this._scales[2*e]=t,this._scales[2*e+1]=r}setOffset(e,t,r){this._offsets[2*e]=t,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function Hle(i,e){i.varyings.add("tbnTangent","vec3"),i.varyings.add("tbnBiTangent","vec3"),e.spherical?i.vertex.code.add(R`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):i.vertex.code.add(R`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),i.fragment.code.add(R`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let OA=class extends _G{constructor(){super(...arguments),this.slicePlaneLocalOrigin=E(),this.origin=this.slicePlaneLocalOrigin}};var Fa;(function(i){i[i.Material=0]="Material",i[i.ShadowMap=1]="ShadowMap",i[i.Highlight=2]="Highlight"})(Fa||(Fa={}));let qle=class extends OA{constructor(){super(...arguments),this.identifier=Fa.Material,this.output=$.Color,this.transparent=!1,this.integratedMesh=!1}},Wle=class extends OA{constructor(){super(...arguments),this.identifier=Fa.ShadowMap}},jle=class extends OA{constructor(){super(...arguments),this.identifier=Fa.Highlight}},Zb=class extends Op{constructor(e,t){super(e,"vec4",D2.Draw,(r,s,n)=>r.setUniform4fv(e,t(s,n)))}};var oh;function Xle(i,e){const{vertex:t,fragment:r}=i;t.uniforms.add([new Zb("overlayTexOffset",(s,n)=>Yle(s,n)),new Zb("overlayTexScale",(s,n)=>Qle(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new Bt("ovColorTex",(s,n)=>zS(s,n))),$U(i,e)}function $U(i,e){i.extensions.add("GL_OES_standard_derivatives"),e.pbrMode!==di.Water&&e.pbrMode!==di.WaterOnIntegratedMesh&&e.pbrMode!==di.TerrainWithWater||i.include(xz,e);const{vertex:t,fragment:r}=i;i.varyings.add("vtcOverlay","vec4"),t.code.add(R`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(R`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(R`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),e.pbrMode!==di.Water&&e.pbrMode!==di.WaterOnIntegratedMesh&&e.pbrMode!==di.TerrainWithWater||(mw(r),P2(r),r.code.add(R`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function zS(i,e){return e.overlays.length===0?null:i.identifier===Fa.Material&&i.output===$.Color?e.overlays[Li.INNER].getColorTextureNoRasterImage():i.identifier===Fa.Highlight?e.overlays[Li.INNER].getValidTexture(ki.Highlight):null}function Yle(i,e){for(const t of e.overlays){const{index:r,extent:s}=t;G$(s)>0&&(Nf[2*r]=i.toMapSpace[0]/Yl(s)-s[0]/Yl(s),Nf[2*r+1]=i.toMapSpace[1]/Vd(s)-s[1]/Vd(s))}return Nf}function Qle(i,e){for(const t of e.overlays){const{index:r,extent:s}=t;G$(s)>0&&(Nf[2*r]=i.toMapSpace[2]/Yl(s),Nf[2*r+1]=i.toMapSpace[3]/Vd(s))}return Nf}(function(i){i[i.Disabled=0]="Disabled",i[i.Enabled=1]="Enabled",i[i.EnabledWithWater=2]="EnabledWithWater",i[i.COUNT=3]="COUNT"})(oh||(oh={}));const Nf=Xt();var sc;(function(i){i[i.LayerOnly=0]="LayerOnly",i[i.ColorComposite=1]="ColorComposite",i[i.GridComposite=2]="GridComposite",i[i.COUNT=3]="COUNT"})(sc||(sc={}));let Zle=class extends ur{constructor(){super(...arguments),this.overlayOpacity=1}};function e_(i,e){i.vertex.uniforms.add([new Kb("overlayTexOffset"),new Kb("overlayTexScale")]),i.fragment.uniforms.add([new yt("overlayOpacity",t=>t.overlayOpacity),new Bt("ovColorTex",(t,r)=>r.overlays.length===0?null:r.overlays[Li.INNER].getColorTexture(t.overlaySource))]),$U(i,e)}function Kle(i,e){const{vertex:t,fragment:r,varyings:s}=i;s.add("vtc","vec2"),t.uniforms.add(new Kb("texOffsetAndScale")),r.uniforms.add(new kD("tex")),r.uniforms.add(new yC("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(t.uniforms.add(new Kb("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new kD("texNext")),r.uniforms.add(new yC("nextTexOpacities")),r.uniforms.add(new Jle("fadeFactor")));const a=e.tileBlendInput===sc.ColorComposite,o=e.tileBlendInput===sc.GridComposite;o&&r.include(SA),a&&r.uniforms.add(new yC("backgroundColor")),t.code.add(R`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?R`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:R``}
  }`),r.code.add(R`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${o||a?R`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${a?R`backgroundColor`:R`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:R`return color;`}
    }`),n?r.code.add(R`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(R`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}let Jle=class extends Op{constructor(e){super(e,"float")}},yC=class extends Op{constructor(e){super(e,"vec3")}},Kb=class extends Op{constructor(e){super(e,"vec4")}},kD=class extends Op{constructor(e){super(e,"sampler2D")}},FU=class extends Zle{};function ece(i){const e=new Hi,{vertex:t,fragment:r,varyings:s}=e;e.include(Qz),e.include(yG,i),e.include(pw,i);const n=()=>{e.include(XG,i),t.code.add(R`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${i.shading?R`decodeNormalTerrain(normalCompressed)`:R`getLocalUp(position, localOrigin)`};
      }
  `)};Tz(t,i),e.include(i5,i);const a=i.overlayMode!==oh.Disabled;switch(i.output){case $.Color:{e.include(Kle,i),e.include(nb,i),a&&e.include(e_,{...i,pbrMode:i.pbrMode===di.Terrain?di.TerrainWithWater:di.Water});const o=i.overlayMode===oh.EnabledWithWater;o&&e.include(Hle,i),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),(i.atmosphere||i.screenSizePerspective)&&xP(t);const l=i.receiveShadows&&!i.renderOccluded;l&&e.include(jF,i),i.atmosphere&&s.add("wnormal","vec3"),i.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),t.code.add(R`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${o?R`forwardVertexTangent(vnormal);`:R``}

          ${i.atmosphere?R`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${a?R`setOverlayVTC(uv);`:""}
          ${i.tileBorders?R`forwardTextureCoordinates();`:""}

          ${i.screenSizePerspective?R`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?R`forwardLinearDepth();`:""}

        }
      `),e.extensions.add("GL_OES_standard_derivatives"),e.extensions.add("GL_EXT_shader_texture_lod"),e.include(v5,i),e.include(nb,i),e.include(Pz,i),e.include(bF,i),Cz(r,i),Oz(r),RF(r),r.uniforms.add([t.uniforms.get("localOrigin"),new Fs("viewDirection",(c,h)=>K(GD,Z(GD,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))]),o&&r.uniforms.add([new Bt("ovWaterTex",(c,h)=>h.overlays.length===0?null:h.overlays[Li.INNER].getNormalTexture(c.overlaySource)),new Ez("view",(c,h)=>dc(tce,h.camera.viewMatrix,c.origin))]),r.code.add(R`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),mw(r),P2(r),r.code.add(R`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${i.receiveShadows&&!i.renderOccluded?"readShadowMap(vpos, linearDepth)":i.spherical&&i.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${a?R`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${i.invisible?R`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${i.atmosphere?R`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${i.atmosphere?R`atm + tileColor.rgb;`:R`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${i.pbrMode===di.Terrain||i.pbrMode===di.TerrainWithWater?R`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:R`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${o?R`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${i.screenSizePerspective?R`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${i.visualizeNormals?i.spherical?R`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:R`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${i.tileBorders?R`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case $.Depth:a&&e.include(e_,i),e.include(_E,i),AP(e),PP(e),t.code.add(R`
              void main(void) {
                ${a?R`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(R`
              void main() {
                ${a&&i.invisible?R`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case $.Shadow:case $.ShadowHighlight:case $.ShadowExcludeHighlight:e.include(_E,i),AP(e),PP(e),t.code.add(R`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(R`void main() {
outputDepth(linearDepth);
}`);break;case $.Normal:a&&e.include(e_,i),s.add("vnormal","vec3"),xP(t),n(),t.code.add(R`
            void main(void) {
              ${a?R`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(R`
            void main() {
              ${a&&i.invisible?R`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case $.Highlight:a&&e.include(e_,i),t.code.add(R`
          void main() {
            ${a?R`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(b5,i),r.code.add(R`
          void main() {
            ${a?R`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return i.output===$.ObjectAndLayerIdColor&&(e.include(e_,{...i,pbrMode:di.Disabled}),t.code.add(R`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(R`
        void main() {
          vec2 texDim =  ${l0(i,"ovColorTex")};
          gl_FragColor =  ${Na(i,"ovColorTex","vec2(vtcOverlay.x * 0.5, vtcOverlay.y)*texDim")};
        }
    `)),e}const tce=ve(),GD=E(),ice=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:FU,build:ece},Symbol.toStringTag,{value:"Module"}));let NU=class UU extends Wt{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2,t.spherical=e.viewingMode===Se.Global}initializeProgram(e){return new Gt(e.rctx,UU.shader.get().build(this.configuration),VU)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const t=this.configuration,r=t.backfaceCullingEnabled&&!t.renderOccluded;return it({blending:t.renderOccluded?fc(he.ONE,he.ONE_MINUS_SRC_ALPHA):null,culling:r?CF:null,depthTest:t.renderOccluded?null:{func:Ts.LESS},depthWrite:t.renderOccluded?null:ka,colorWrite:ut,stencilTest:e?gk(H_.IntegratedMeshMaskExcluded):null})}getPipelineState(e,t){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,t)}};NU.shader=new jt(ice,()=>Y(()=>import("./Terrain.glsl-78230aba.js"),["./Terrain.glsl-78230aba.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./MixExternalColor.glsl-f5c601ed.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./compilerUtils-7bf6df9e.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./aaBoundingBox-fb003858.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./aaBoundingRect-2fb32e32.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./preload-helper-41c905a7.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const VU=new Map([[C.POSITION,0],[C.UV0,1],[C.NORMALCOMPRESSED,2]]);let rce=class{constructor(){this.geometryInfo=new Joe,this.intersectionData=null,this.geometryState=null,this._textureRef=new SU(()=>this.tile.surface.textureFadeDuration),this.overlay=new Gle,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const t=this.geometryInfo;t.indices=null,t.vertexAttributes=null,Pi(t.boundingBox),t.indexCount=0,t.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new ale,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Er&&this.tile.intersectsClippingArea)for(let t=0;t<4;++t)se(this.geometryInfo.outerEdges[t].count===this.geometryState.neighborData.edgeResolutions[t]+1)}_calculateEdgeResolution(e,t){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(_(c)&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const n=r.level,a=rc[e];if(!t)return se(T((l=r.surface)==null?void 0:l.rootTiles)||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(a)),s;if(t.isLoaded){const c=t,h=c.renderData.geometryState,u=n-c.level;if(se(u>=0),u===0){const y=h.numVerticesPerSide-1;return Math.max(y,s)}const m=2**u,f=h.neighborData.edgeResolutions[(e+2)%4]/m;return Math.max(1,f)}se(!t.isLeaf);let o=s;return t.forAllSubtreeOnSide(Yb(a),c=>c===r||(c.isLoaded?(o=Math.max(o,2**(c.level-n)),!0):(se(!c.isLeaf),!1))),o}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const t=e.renderData.geometryState.neighborData,r=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=t.edgePeerNeighbors,n=t.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(rc[l],r),h=Xu(e,c),u=((o=h==null?void 0:h.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,m=s[l],f=h!==Xu(e,m),y=n[l]!==u;s[l]=c,(f||y)&&(n[l]=u,this._markEdgeDirty(l));const g=t.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);se(uy(v)),se(v>=1),t.edgeResolutions[l]=v,g!==v&&this._markEdgeResolutionDirty(l)}const a=t.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(Qb[l],r);a[l]=c;const h=Xu(e,s[l]),u=Xu(e,s[(l+1)%4]),m=Xu(e,c);Oo[l]=m,Oo[(l+1)%4]=u,Oo[(l+2)%4]=e,Oo[(l+3)%4]=h,se(Oo.some(v=>(v==null?void 0:v.isLoaded)||v===e));const f=Oo.reduce((v,b)=>Math.min(v,(b==null?void 0:b.level)??1/0),1/0);Oo.forEach((v,b)=>{v&&(v==null?void 0:v.level)>f&&(Oo[b]=null)}),se(Oo.some(v=>(v==null?void 0:v.isLoaded)||v===e));const y=t.cornerNeighborData[l].cornerTiles,g=t.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const b=Oo[v],x=(b==null?void 0:b.renderData.geometryState.samplerDataVersion)??-1,w=y[v]!==b,S=!w&&g[v]!==x;(w||S)&&(y[v]=b,g[v]=x,this._markCornerDirty(l))}se(y.some(v=>(v==null?void 0:v.isLoaded)||v===e))}Er&&se(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)Oo[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Er&&se(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const t=this.tile,r=this._vao,s=this.geometryInfo.vertexAttributes,n=!r||!s||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,a=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),o=!a&&this._dirtyCorners!==0;n?(this.releaseGeometry(),this._createGeometry(e)):a||o?t.updateEdgeElevations():o?t.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,ile(this.geometryInfo),!0)}ensureTexture(e,t){return _(this._texture)&&this._texture.descriptor.width!==e&&this.releaseTexture(),T(this._texture)&&(this._texture=t(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const t=1<<e;this._dirtyCorners|=t}_markEdgeDirty(e){const t=1<<e;this._dirtyEdges|=t}_markEdgeResolutionDirty(e){const t=1<<e;this._dirtyEdgeResolutions|=t,this._dirtyEdges|=t}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),t=this.tile,r=e.samplerData?t.getElevationVerticesPerSide(e.maxTileLevel):t.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=t.clippingArea;t.intersectsClippingArea&&!t.isWithinClippingArea||(n=null);const a=this.geometryState;let o=!1;a.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,a.numVerticesPerSide=s,a.samplerDataVersion++,o=!0),e.changed&&(this._samplerDataChanged=!0,a.samplerData=e.samplerData,a.samplerDataVersion++,o=!0),n2(a.clippingArea,n)||(this._clippingAreaChanged=!0,a.clippingArea=n,o=!0);const l=t.surface,c=l.wireframe;a.wireframe!==c&&(this._wireframeChanged=!0,a.wireframe=c,o=!0);const h=l.shading;return a.shading!==h&&(this._shadingChanged=h,a.shading=h,o=h),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=o),o&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const t=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=e.gl;this._vao=new fh(e,VU,{geometry:ul(t.layout)},{geometry:Yt.createVertex(e,s.STATIC_DRAW,t.buffer)},Yt.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,t=nh.Immediate){_(e)&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[mt.ELEVATION],r=t.length,s=new Array(r);let n=0,a=0,o=!1;for(let h=0;h<r;h++){const u=t[h];if(_(u.upsampleInfo)){const m=u.upsampleInfo.tile,f=m.layerInfo[mt.ELEVATION][h].data,y=f&&f.samplerData;e&&e[n]===y||(o=!0),s[n++]=y,a=Math.max(a,m.lij[0])}else if(u.data){const m=this.tile.surface.layerViewByIndex(h,mt.ELEVATION);if(oy(this.tile,m.layer,!1)){const f=u.data;e&&e[n]===f.samplerData||(o=!0),s[n++]=f.samplerData,a=this.tile.level}}}_(e)&&e.length!==n&&(o=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:o,samplerData:c,maxTileLevel:a}}get estimatedGeometryMemoryUsage(){var t,r;const e=hd(this.intersectionData,0,s=>s.estimatedMemoryUsage);return(((t=this.geometryInfo.indices)==null?void 0:t.byteLength)??0)+(((r=this.geometryInfo.vertexAttributes)==null?void 0:r.byteLength)??0)+e}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Er)return;const e=this.tile;if(se(e==null?void 0:e.isLoaded),!e.isLoaded||!e.intersectsClippingArea)return;const t=e.renderData;if(e.level===0)return;const r=e.surface.extent;if(_(r)&&!e.intersectsExtent(r))return;const s=rc.map((l,c)=>!!_(r)&&(c<2?-1:1)*(e.extent[3-c]-r[3-c])<0),n=e.level;se(this._dirtyCorners===0),se(this._dirtyEdges===0),se(this._dirtyEdgeResolutions===0),se(!this._numVerticesPerSideChanged),se(!this._samplerDataChanged),se(!this._clippingAreaChanged),se(!this._wireframeChanged);const a=Qb.map(l=>e.findNeighborCornerTileExact(l,c=>!c.intersectsClippingArea||c.isLoaded||c.level===e.level)??null).map(l=>l!=null&&l.intersectsClippingArea?l:null),o=this.geometryState.neighborData;for(let l=0;l<4;++l){const c=o.cornerPeerNeighbors[l],h=a[l];se(h===c,`Tile[${e.lij}].corner[${l}] out of date: cur=[${c==null?void 0:c.lij}] exp=[${h==null?void 0:h.lij}]`)}rc.forEach((l,c)=>{if(s[c])return;const h=e.findNeighborTile(l,G=>(G.level===n||(G==null?void 0:G.isLoaded))&&(G==null?void 0:G.intersectsClippingArea));if(!h){const G=!e.surface.updatingRootTiles&&_(e.surface.rootTiles)&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(l);return void se(!G)}se(h.isLoaded||h.level===e.level),se(h===this.geometryState.neighborData.edgePeerNeighbors[c]);const u=n-h.level;if(!h.isLoaded)return se(!h.isLeaf),void se(u===0);const m=h.renderData;se(kle(e,h,l)),se(u>=0);const f=2**u;if(u<0)return void se(!1);const y=t.geometryInfo,g=y.outerEdges[c],v=y.numVerticesPerSide-1,b=m.geometryInfo;if(!b)return void se(!1);{const G=this.geometryState.neighborData.edgePeerNeighbors[c];if(G!=null&&G.isLoaded){const B=G.renderData;se(G==G),se(t.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===B.geometryState.samplerDataVersion),se(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[c]===B.geometryState.samplerDataVersion)}}const x=(c+2)%4,w=b.outerEdges[x],S=g.count-1,P=w.count-1;se(S*f===P,`Tile[${e.lij}]:e${c},res=${S} edgeRes mismatch with Neighbor[${h.lij}]:e${x},res=${P} (expected:${S*f})`);const A=e.extent,M=l===ke.NORTH||l===ke.SOUTH,O=w.count-1,I=O/2**u,N=g.count-1;if(I<1)return void se(N===1);se(I===N),se(uy(I));const F=b.numVerticesPerSide-1;se(u>0||I===Math.max(F,v));const V=e.getNeighborEdgeStartVertexIndex(c,h);se(0<=V&&V<f);const Q=V*I;se(0<=Q&&Q<=O-I);let ae=0,q=Q;g.getVertexPos(El,0),g.getVertexPos(Sl,g.count-1);const D=Ni(El,Sl),H=Math.max(sce,1e-4*D);for(let G=0;G<=I;++G){g.getVertexPos(El,ae),w.getVertexPos(Sl,q);const B=G/I,le=M?A[0]+B*(A[2]-A[0]):l===ke.WEST?A[0]:A[2],ce=M?l===ke.SOUTH?A[1]:A[3]:A[1]+B*(A[3]-A[1]),_e=e.surface.extent;if(T(_e)||wB(_e,le,ce)){const j=d2(El,Sl),de=ko(El)-ia.radius,te=ko(Sl)-ia.radius,me=j<H;if(!me){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${c}[${ae}/${g.count}] and [${h.lij}].edge${x}[${q}/${w.count}]`),_(_e)&&console.warn("  surface extent= ",_e," x,y=",le,",",ce);const ye=E();ee(ye,t.localOrigin,m.localOrigin),ko(ye)>0&&console.warn(`   localOrigins: ${t.localOrigin} vs ${m.localOrigin} d=${ko(ye)} [${ye}]`),(()=>{const Ue=Pn(El),De=Pn(Sl);e.updateEdgeElevations(),h.updateEdgeElevations(),g.getVertexPos(El,ae),w.getVertexPos(Sl,q);const Te=E();gs(Te,El,Ue),ko(Te)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ue} vs ${El} d=${ko(Te)} [${Te}]`),gs(Te,Sl,De),ko(Te)>0&&console.warn(`  XXX Neighbor[${h.lij}] edge out of date: ${De} vs ${Sl} d=${ko(Te)} [${Te}]`)})(),se(me,`Mismatch in tile [${e.lij}].edge[${c}][${ae}/${g.count}] vs neighbor [${h.lij}].edge[${x}][${q}/${w.count}] ${$c(El)} vs ${$c(Sl)}  dist=${j} h(t|n|d)=${de}|${te}|${te-de}`)}if(e.surface.shading){g.getNormal(Mm,ae),w.getNormal(Im,q),K(HD,Mm),K(qD,Im);const ye=oe(HD,qD),Ue=1-ye<.01||!1||e===h;if(!Ue){const De=E();gs(De,Mm,Im);const Te=()=>`Mismatch in tile edge normal ${ED(e.lij)} (${ae}/${g.count-1}) edge ${c} vs neighbor ${ED(h.lij)}  (${q}/${w.count-1}) nedge ${x} :${$c(Mm)} vs ${$c(Im)}  dot = ${ye} : ${$c(De)}`;console.warn("Mismatch in tile edge normal: ",Te());{e.updateEdgeElevations(),h.updateEdgeElevations();const et=E(),be=E();g.getNormal(et,ae),w.getNormal(be,q),dp(Mm,et)||console.warn("Missing update in tile normal: ",$c(Mm)," => ",$c(et)),dp(Im,be)||console.warn("Missing update in neighbor normal: ",$c(Im)," => ",$c(be))}se(Ue,Te())}}}ae+=1,q+=1}})}};const El=E(),Sl=E(),Mm=E(),Im=E(),HD=E(),qD=E(),sce=1,Oo=[null,null,null,null];function Xu(i,e){return e!=null&&e.isLoaded||e===i?e:null}const nce=65536;function ace(i,e){const t=i.tile,{extent:r,extentInRadians:s,surface:n}=t,a=i.localOrigin,o=i.geometryState,l=n.isWebMercator,c=n.shading||Cp,h=o.numVerticesPerSide,u=h-1,m=(h-2)**2,f=l&&(e===lo.HAS_SOUTH_POLE||e===lo.HAS_BOTH_POLES),y=l&&(e===lo.HAS_NORTH_POLE||e===lo.HAS_BOTH_POLES),g=6,v=((f?1:0)+(y?1:0))*g*(u+1),b=o.neighborData,x=b.edgeResolutions.reduce((O,I)=>O+I+1,0),w=EU(m+v+x),S=i.geometryInfo;S.numVerticesPerSide=o.numVerticesPerSide,S.vertexAttributes=w;const P=S.boundingBox;Pi(P);const A=MA(i);fr.update(u,s,A),oce(i),XU(i,m),BU(i);const M=[];if((()=>{let O=m+x;const I=a[0],N=a[1],F=a[2],V=t.ellipsoid.radius,Q=r[1],ae=r[3],q=(D,H)=>{const G=H*h;Ks(-I,-N,D*V-F,P),M.push({connectedRowOffset:G,connectedOuterEdgeOffset:D===1?0:2,rowOffset:O,latitudeResolution:g});const B=GU(D===-1?Q:ae,V),le=D*Math.PI/2-B,ce=.99*(D===1?1:-1),_e=V+0,j=w.position,de=w.uv0,te=w.normalCompressed;for(let me=1;me<=g;++me){const ye=B+le*(me/g),Ue=Math.cos(ye),De=Math.sin(ye);for(let Te=0;Te<=u;Te++){const et=Te/u,be=fr.sinLonLUT[Te],Be=fr.cosLonLUT[Te]*Ue,Re=be*Ue,Ye=De,nt=Be*_e-I,lt=Re*_e-N,at=Ye*_e-F;Ks(nt,lt,at,P),j.setValues(O,nt,lt,at),la(de,O,et,ce),c&&Xy(te,O,Be,Re,Ye),++O}}};f&&q(-1,0),y&&q(1,u)})(),jU(S,o.numVerticesPerSide,M,[0,h-1],[0,h-1],o.wireframe),i.intersectionData=null,Er)for(let O=0;O<4;++O)se(S.outerEdges[O].count===b.edgeResolutions[O]+1)}function oce(i){const e=i.tile;e.intersectsClippingArea&&(e.surface.shading||Cp?cce(i):lce(i))}function lce(i){const e=i.geometryState,t=e.numVerticesPerSide,r=t-2,s=t-1,n=i.geometryInfo,a=n.vertexAttributes,o=a.position,l=a.uv0,c=i.tile,h=c.extent,u=h[0],m=h[2],f=h[1],y=h[3],g=c.ellipsoid.radius,v=e.samplerData,b=i.localOrigin,x=b[0],w=b[1],S=b[2],P=n.boundingBox,A=o.typedBuffer,M=o.typedBufferStride;let O=0;for(let I=1;I<=r;I++){const N=I/s,F=f*(1-N)+y*N,V=fr.sinLatLUT[I],Q=fr.cosLatLUT[I];for(let ae=1;ae<=r;ae++){const q=ae/s,D=u*(1-q)+m*q,H=fr.sinLonLUT[ae],G=fr.cosLonLUT[ae],B=g+xi(D,F,v),le=G*Q*B-x,ce=H*Q*B-w,_e=V*B-S;Ks(le,ce,_e,P);const j=O*M;A[j]=le,A[j+1]=ce,A[j+2]=_e,la(l,O,q,N),++O}}}function cce(i){const e=i.geometryState,t=e.numVerticesPerSide,r=t-2,s=t-1,n=i.geometryInfo,a=n.vertexAttributes,o=a.position,l=a.uv0,c=a.normalCompressed,h=i.tile,u=h.extent,m=u[0],f=u[2],y=u[1],g=u[3],v=h.ellipsoid.radius,b=e.samplerData,x=i.localOrigin,w=x[0],S=x[1],P=x[2],A=o.typedBuffer,M=o.typedBufferStride,O=1/s,I=n.boundingBox;let N=0;if(1<=r){const F=O,V=y*(1-F)+g*F,Q=fr.sinLatLUT[1],ae=fr.cosLatLUT[1];for(let q=1;q<=r;q++){const D=q*O,H=m*(1-D)+f*D,G=fr.sinLonLUT[q],B=fr.cosLonLUT[q],le=v+xi(H,V,b),ce=le*B*ae-w,_e=le*G*ae-S,j=le*Q-P;Ks(ce,_e,j,I);const de=(q-1)*M;A[de]=ce,A[de+1]=_e,A[de+2]=j,la(l,q-1,D,F)}}for(let F=1;F<=r;F++){const V=F*O,Q=y*(1-V)+g*V,ae=fr.sinLatLUT[F],q=fr.cosLatLUT[F],D=F+1,H=D*O,G=y*(1-H)+g*H,B=fr.sinLatLUT[D],le=fr.cosLatLUT[D],ce=fr.sinLonLUT[0],_e=fr.cosLonLUT[0],j=v+xi(m,Q,b);let de=_e*q*j-w,te=ce*q*j-S,me=ae*j-P;const ye=N*M;let Ue=A[ye],De=A[ye+1],Te=A[ye+2];for(let et=1;et<=r;et++){const be=et*O,Be=m*(1-be)+f*be,Re=fr.sinLonLUT[et],Ye=fr.cosLonLUT[et];let nt=Ye*q,lt=Re*q,at=ae,xt=0,Kt=0,Mt=0;{let Me=0,Ee=0,$e=0;if(et<r){const Lt=(N+1)*M;Me=A[Lt],Ee=A[Lt+1],$e=A[Lt+2]}else{const Lt=fr.sinLonLUT[s],$t=fr.cosLonLUT[s],Ft=v+xi(f,Q,b);Me=$t*q*Ft-w,Ee=Lt*q*Ft-S,$e=ae*Ft-P}const Fe=de,Qe=te,rt=me;de=Ue,te=De,me=Te,Ue=Me,De=Ee,Te=$e,xt=Me-Fe,Kt=Ee-Qe,Mt=$e-rt}{let Me=0,Ee=0,$e=0;if(F>1){const Fe=(N-r)*M;Me=A[Fe],Ee=A[Fe+1],$e=A[Fe+2]}else{const Fe=fr.sinLatLUT[0],Qe=fr.cosLatLUT[0],rt=v+xi(Be,y,b);Me=Ye*Qe*rt-w,Ee=Re*Qe*rt-S,$e=Fe*rt-P}{const Fe=v+xi(Be,G,b),Qe=Ye*le*Fe-w,rt=Re*le*Fe-S,Lt=B*Fe-P;if(F<r){const fi=N+r,pt=fi*M;A[pt]=Qe,A[pt+1]=rt,A[pt+2]=Lt,Ks(Qe,rt,Lt,I),la(l,fi,be,H)}const $t=Me-Qe,Ft=Ee-rt,Nt=$e-Lt;at*at<.999&&(nt=Mt*Ft-Kt*Nt,lt=xt*Nt-Mt*$t,at=Kt*$t-xt*Ft)}}const At=1/Math.sqrt(nt*nt+lt*lt+at*at);Xy(c,N,nt*At,lt*At,at*At),++N}}}function hce(i){i.tile.intersectsClippingArea&&(BU(i),Qw(i))}function dce(i){i.tile.intersectsClippingArea&&(kU(i),zU(i,!0),Qw(i))}function BU(i){i.tile.intersectsClippingArea&&(kU(i),zU(i))}function zU(i,e=!1){const t=i.geometryState,r=i.geometryInfo,s=t.neighborData,n=i.tile,a=n.level,o=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,h=c[0],u=c[2],m=c[1],f=c[3],y=t.samplerData,g=o[0],v=o[2],b=o[1],x=o[3],w=MA(i),S=r.boundingBox,P=i.localOrigin,A=P[0],M=P[1],O=P[2],I=n.surface.shading||Cp,N=r.vertexAttributes,F=N.position,V=F.typedBuffer,Q=F.typedBufferStride,ae=N.uv0;for(let q=0;q<4;++q){const D=q===1||q===3,H=s.edgeResolutions[q];se(uy(H));const G=H+1,B=Xu(n,s.edgePeerNeighbors[q]);if(ZU(n,B,q)){YU(i,q,B);continue}const le=_(B);se(!le||B.level===n.level),se(!le||ah(n,B)<=0);const ce=B==null?void 0:B.renderData,_e=ce==null?void 0:ce.geometryState;if(Er){const Ee=n.surface;if(!B&&Ee&&!Ee.updatingRootTiles){const $e=rc[q],Fe=n.findNeighborTile($e,Qe=>Qe.isLoaded||Qe.isLeaf||Qe.level===n.level);Fe?Fe.intersectsClippingArea&&(se(!Fe.isLoaded),se(!Fe.isLeaf),se(Fe.level===a)):se(T(Ee==null?void 0:Ee.rootTiles)||!n.shouldHaveNeighbor($e))}}const j=q===1?o[2]:o[0],de=B==null?void 0:B.extent,te=de&&D?q===1?de[0]:de[2]:j,me=q===0?o[3]:o[1],ye=q===1?1:0,Ue=q===0?1:0,De=q===1?u:h,Te=q===0?f:m,et=Math.sin(De),be=Math.cos(De),Be=Math.sin(Te),Re=Math.cos(Te),Ye=_e==null?void 0:_e.samplerData,nt=le?(Ee,$e,Fe)=>.5*(xi(Ee,$e,y)+xi(Fe,$e,Ye)):(Ee,$e,Fe)=>xi(Ee,$e,y),lt=r.outerEdges[q],at=e&&G>3?G-3:1,xt=_(y)&&y.some(Ee=>Ee!=null),Kt=_(Ye)&&Ye.some(Ee=>Ee!=null),Mt=xt||Kt,At=1/H,Me=lt.index0;I?(se(!de||co(de[2]-de[0],o[2]-o[0])),(()=>{const Ee=q===1?-1:q===3?1:0,$e=q===0?-1:q===2?1:0,Fe=(o[2]-o[0])*At,Qe=Ee*Fe,rt=$e*Fe,Lt=D?Ee*((u-h)*At):0,$t=D?0:$e*At,Ft=Ue,Nt=D?De+Lt:De,fi=D?Math.sin(Nt):et,pt=D?Math.cos(Nt):be,St=D?De-Lt:De,Tt=D?Math.sin(St):et,nr=D?Math.cos(St):be,si=D?Te:w(Ft+$t),Ui=D?Be:Math.sin(si),gi=D?Re:Math.cos(si),Mi=D?Te:w(Ft-$t),Xi=D?Be:Math.sin(Mi),pr=D?Re:Math.cos(Mi);let Cs=0,cs=0,ar=0;{const ni=0*At,ks=D?j:g*(1-ni)+v*ni,ua=D?te:ks,Vp=D?b*(1-ni)+x*ni:me,wh=D?De:h*(1-ni)+u*ni,Bp=D?et:Math.sin(wh),zp=D?be:Math.cos(wh),bc=D?w(ni):Te,Zd=D?Math.sin(bc):Be,wc=D?Math.cos(bc):Re,xc=l+nt(ks,Vp,ua);Cs=zp*wc*xc,cs=Bp*wc*xc,ar=Zd*xc}let Vi=0,Bi=0,or=0;{const ni=1*At,ks=D?j:g*(1-ni)+v*ni,ua=D?te:ks,Vp=D?b*(1-ni)+x*ni:me,wh=D?De:h*(1-ni)+u*ni,Bp=D?et:Math.sin(wh),zp=D?be:Math.cos(wh),bc=D?w(ni):Te,Zd=D?Math.sin(bc):Be,wc=D?Math.cos(bc):Re,xc=l+nt(ks,Vp,ua);Vi=zp*wc*xc,Bi=Bp*wc*xc,or=Zd*xc}for(let ni=1;ni<G-1;ni+=at){let ks=0,ua=0,Vp=0;{const $n=(ni+1)*At,fl=D?j:g*(1-$n)+v*$n,xh=D?te:fl,Gs=D?b*(1-$n)+x*$n:me,Th=D?De:h*(1-$n)+u*$n,Wp=D?et:Math.sin(Th),w0=D?be:Math.cos(Th),gg=D?w($n):Te,x0=D?Math.sin(gg):Be,_g=D?Math.cos(gg):Re,jp=l+nt(fl,Gs,xh);ks=w0*_g*jp,ua=Wp*_g*jp,Vp=x0*jp}const wh=ks,Bp=ua,zp=Vp,bc=Vi,Zd=Bi,wc=or;Vi=wh,Bi=Bp,or=zp;{const $n=Me+ni,fl=$n*Q,xh=bc-A,Gs=Zd-M,Th=wc-O;V[fl]=xh,V[fl+1]=Gs,V[fl+2]=Th,Ks(xh,Gs,Th,S);const Wp=ni*At;la(ae,$n,D?ye:Wp,D?Wp:Ue)}const xc=Cs,g8=cs,_8=ar;Cs=bc,cs=Zd,ar=wc;const mg=bc,fg=Zd,kp=wc,b0=1/Math.sqrt(mg*mg+fg*fg+kp*kp),zA=kp*b0;let Gp=0,Hp=0,qp=0;if(Mt&&zA*zA<.999){let $n=0,fl=0,xh=0;{const Gs=q===0?-1:1;$n=Gs*(wh-xc),fl=Gs*(Bp-g8),xh=Gs*(zp-_8)}{const Gs=ni*At,Th=D?j:g*(1-Gs)+v*Gs,Wp=D?te:Th,w0=D?b*(1-Gs)+x*Gs:me,gg=D?De:h*(1-Gs)+u*Gs,x0=D?et:Math.sin(gg),_g=D?be:Math.cos(gg),jp=D?w(Gs):Te,kA=D?Math.sin(jp):Be,GA=D?Math.cos(jp):Re;let ix=mg,rx=fg,sx=kp;if(le){const Kd=l+xi(Wp-Qe,w0-rt,Ye),yg=D?GA:pr;ix=(D?nr:_g)*yg*Kd,rx=(D?Tt:x0)*yg*Kd,sx=(D?kA:Xi)*Kd}{const Kd=l+xi(Th+Qe,w0+rt,y),yg=D?GA:gi,HA=(D?pt:_g)*yg*Kd,qA=(D?fi:x0)*yg*Kd,WA=(D?kA:Ui)*Kd;le||(ix=2*mg-HA,rx=2*fg-qA,sx=2*kp-WA);const nx=q===3?-1:1,jA=nx*(ix-HA),XA=nx*(rx-qA),YA=nx*(sx-WA);Gp=xh*XA-fl*YA,Hp=$n*YA-xh*jA,qp=fl*jA-$n*XA;const ax=1/Math.sqrt(Gp*Gp+Hp*Hp+qp*qp);Gp*=ax,Hp*=ax,qp*=ax}}}else Gp=mg*b0,Hp=fg*b0,qp=kp*b0;lt.setNormalFromValues(ni,Gp,Hp,qp)}})()):(()=>{for(let Ee=1;Ee<G-1;Ee+=at){const $e=Ee*At,Fe=D?ye:$e,Qe=D?$e:Ue,rt=D?j:g*(1-$e)+v*$e,Lt=D?b*(1-$e)+x*$e:me,$t=D?te:rt,Ft=D?De:h*(1-$e)+u*$e,Nt=D?et:Math.sin(Ft),fi=D?be:Math.cos(Ft),pt=D?w($e):Te,St=D?Math.sin(pt):Be,Tt=D?Math.cos(pt):Re,nr=nt(rt,Lt,$t),si=l+nr,Ui=fi*Tt*si-A,gi=Nt*Tt*si-M,Mi=St*si-O;Ks(Ui,gi,Mi,S);const Xi=Me+Ee,pr=Xi*Q;V[pr]=Ui,V[pr+1]=gi,V[pr+2]=Mi,la(ae,Xi,Fe,Qe)}})()}}function kU(i){QU(i)}function GU(i,e){return Math.PI/2-2*Math.atan(Math.exp(-i/e))}function uce(i,e,t,r){return GU(i*(1-r)+e*r,t)}function pce(i,e,t){return i*(1-t)+e*t}function MA(i){const e=i.tile;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>uce(r[1],r[3],s,n)}const t=e.extentInRadians;return r=>pce(t[1],t[3],r)}function mce(i,e){const t=i.tile.extent,r=i.geometryState,s=t[0],n=t[1],a=t[2]-s,o=t[3]-n,l=r.clippingArea,c=_(l)?Math.max(0,(l[0]-s)/a):0,h=_(l)?Math.max(0,(l[1]-n)/o):0,u=_(l)?Math.min(1,(l[2]-s)/a):1,m=_(l)?Math.min(1,(l[3]-n)/o):1,f=r.numVerticesPerSide,y=(f-2)**2,g=r.neighborData.edgeResolutions.reduce((w,S)=>w+S+1,0),v=EU(y+g),b=i.geometryInfo,x=b.boundingBox;Pi(x),b.numVerticesPerSide=r.numVerticesPerSide,b.vertexAttributes=v,Vs(b.uvRange,c,h,u,m),fce(i),XU(i,y),HU(i),jU(b,r.numVerticesPerSide,[],[0,f-1],[0,f-1],r.wireframe),i.intersectionData=null}function fce(i){const e=i.tile;e.intersectsClippingArea&&(e.surface.shading?_ce(i):gce(i))}function gce(i){const e=i.geometryState,t=e.samplerData,r=i.tile,s=r.surface,n=i.localOrigin,a=s.isWebMercatorOnPlateeCarree,o=e.clippingArea,l=_(o)?o:Zw,c=r.extent,h=c[0],u=c[1],m=c[2],f=c[3],y=Math.max(h,l[0]),g=Math.min(m,l[2]),v=Math.max(u,l[1]),b=Math.min(f,l[3]),x=n[0],w=n[1],S=n[2],P=r.ellipsoid.radius,A=r.horizontalScale,M=IA(a,P,A),O=e.numVerticesPerSide,I=O-1,N=O-2,F=i.geometryInfo,V=F.uvRange,Q=V[0],ae=V[1],q=V[2],D=V[3],H=F.boundingBox,G=F.vertexAttributes,B=G.position,le=G.uv0;let ce=0;for(let _e=1;_e<=N;_e++){const j=_e/I,de=ie(u*(1-j)+f*j,v,b),te=ie(j,ae,D),me=M(de)-w;for(let ye=1;ye<=N;ye++){const Ue=ye/I,De=ie(h*(1-Ue)+m*Ue,y,g),Te=ie(Ue,Q,q),et=De*A-x,be=xi(De,de,t)-S;Ks(et,me,be,H),B.setValues(ce,et,me,be),la(le,ce,Te,te),++ce}}}function _ce(i){const e=i.tile,t=e.surface;if(!(t.shading||Cp))return;const r=i.geometryState,s=r.samplerData,n=i.localOrigin,a=t.isWebMercatorOnPlateeCarree,o=r.clippingArea,l=_(o)?o:Zw,c=e.extent,h=c[0],u=c[1],m=c[2],f=c[3],y=Math.max(h,l[0]),g=Math.min(m,l[2]),v=Math.max(u,l[1]),b=Math.min(f,l[3]),x=e.ellipsoid.radius,w=e.horizontalScale,S=r.numVerticesPerSide,P=S-1,A=S-2,M=i.geometryInfo,O=M.vertexAttributes,I=O.position,N=O.uv0,F=O.normalCompressed,V=M.uvRange,Q=V[0],ae=V[1],q=V[2],D=V[3],H=M.boundingBox,G=n[0],B=n[1],le=n[2],ce=I.typedBuffer,_e=I.typedBufferStride;let j=0;const de=ie(u,v,b),te=a?(Math.PI/2-2*Math.atan(Math.exp(-de/x)))*x:de*w,me=1/P,ye=ie(u*(1-me)+f*me,v,b);let Ue=te,De=a?(Math.PI/2-2*Math.atan(Math.exp(-ye/x)))*x:ye*w;for(let Te=1;Te<=A;Te++){const et=Te/P,be=ie(u*(1-et)+f*et,v,b),Be=ie(et,ae,D),Re=De,Ye=(Te-1)/P,nt=ie(u*(1-Ye)+f*Ye,v,b),lt=Ue,at=(Te+1)/P,xt=ie(u*(1-at)+f*at,v,b),Kt=a?(Math.PI/2-2*Math.atan(Math.exp(-xt/x)))*x:xt*w,Mt=ie(at,ae,D);Ue=De,De=Kt;const At=ie(h,y,g);let Me=At*w,Ee=xi(At,be,s);const $e=1/P,Fe=ie($e,Q,q),Qe=ie(h*(1-Fe)+m*Fe,y,g);let rt=Fe,Lt=Qe,$t=Qe*w,Ft=xi(Qe,be,s);if(Te===1){const Nt=$t-G,fi=Ue-B,pt=Ft-le,St=0*_e;ce[St]=Nt,ce[St+1]=fi,ce[St+2]=pt,Ks(Nt,fi,pt,H);const Tt=ie($e,Q,q);la(N,j,Tt,Be)}for(let Nt=1;Nt<=A;Nt++){const fi=$t,pt=Ft,St=(Nt+1)/P,Tt=ie(St,Q,q),nr=ie(h*(1-St)+m*St,y,g),si=Lt;Lt=nr;{const ar=j+1,Vi=ar*_e;if(Te===1||Nt===A){const Bi=nr*w,or=xi(nr,be,s);if(Te===1&&Nt<A){const ni=Bi-G,ks=Re-B,ua=or-le;ce[Vi]=ni,ce[Vi+1]=ks,ce[Vi+2]=ua,Ks(ni,ks,ua,H),la(N,ar,Tt,Be)}$t=Bi,Ft=or}else $t=ce[Vi]+G,Ft=ce[Vi+2]+le}const Ui=$t,gi=Ft,Mi=Me,Xi=Ee;Me=fi,Ee=pt;const pr=(j-A)*_e,Cs=Te===1?xi(si,nt,s):ce[pr+2]+le,cs=xi(si,xt,s);if(Te<A){const ar=j+A,Vi=ar*_e,Bi=fi-G,or=Kt-B,ni=cs-le;ce[Vi]=Bi,ce[Vi+1]=or,ce[Vi+2]=ni,Ks(Bi,or,ni,H);const ks=rt;rt=Tt,la(N,ar,ks,Mt)}{const ar=Ui-Mi,Vi=lt-Kt,Bi=Vi*(gi-Xi),or=ar*(Cs-cs),ni=-Vi*ar,ks=Bi*Bi+or*or+ni*ni;if(ks===0)Xy(F,j,0,0,1);else{const ua=1/Math.sqrt(ks);Xy(F,j,Bi*ua,or*ua,ni*ua)}}++j}}}function yce(i,e){i.tile.intersectsClippingArea&&(WU(i),qU(i,!0),Qw(i))}function vce(i,e){i.tile.intersectsClippingArea&&(HU(i),Qw(i))}function HU(i,e){i.tile.intersectsClippingArea&&(WU(i),qU(i,!1))}function qU(i,e){const t=i.geometryState,r=t.neighborData,s=i.tile,n=s.surface,a=n.shading||Cp,o=s.extent,l=t.clippingArea,c=_(l)?l:Zw,h=o[0],u=o[2],m=o[1],f=o[3],y=[f>c[3],u>c[2],m<c[1],h<c[0]],g=i.geometryInfo,v=s.horizontalScale,b=IA(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,v),x=g.boundingBox,w=g.uvRange[0],S=g.uvRange[1],P=g.uvRange[2],A=g.uvRange[3],M=Math.max(h,c[0]),O=Math.min(u,c[2]),I=Math.max(m,c[1]),N=Math.min(f,c[3]),F=i.localOrigin,V=F[0],Q=F[1],ae=F[2],q=t.samplerData;for(let D=0;D<4;++D){const H=D===1||D===3,G=r.edgeResolutions[D];se(uy(G));const B=G+1,le=y[D],ce=Xu(s,r.edgePeerNeighbors[D]);if(!le&&ZU(s,ce,D)){YU(i,D,ce);continue}const _e=_(ce)&&!le,j=ce==null?void 0:ce.renderData,de=j==null?void 0:j.geometryState;if(Er&&(se(!_e||ce.level===s.level),se(!_e||ah(s,ce)<=0),s&&!ce&&!n.updatingRootTiles)){const Be=rc[D],Re=s.findNeighborTile(Be,Ye=>Ye.isLoaded||Ye.isLeaf||Ye.level===s.level);n.updatingRootTiles||(Re?Re.intersectsClippingArea&&(se(!Re.isLoaded),se(!Re.isLeaf),se(Re.level===s.level)):se(T(n==null?void 0:n.rootTiles)||!s.shouldHaveNeighbor(Be)))}const te=ie(D===1?u:h,M,O),me=ie(D===0?f:m,I,N),ye=de==null?void 0:de.samplerData,Ue=g.outerEdges[D],De=e&&B>3?B-3:1,Te=ie(D===1?1:0,w,P),et=ie(D===0?1:0,S,A),be=_e?(Be,Re)=>.5*(xi(Be,Re,ye)+xi(Be,Re,q)):(Be,Re)=>xi(Be,Re,q);if(a){const Be=(u-h)/G,Re=H?D===1?Be:-Be:0,Ye=H?0:D===0?Be:-Be,nt=-Re,lt=-Ye;let at=0,xt=0,Kt=0;{const Ee=0/G,$e=H?te:ie(h*(1-Ee)+u*Ee,M,O),Fe=H?ie(m*(1-Ee)+f*Ee,I,N):me,Qe=be($e,Fe);at=$e*v,xt=b(Fe),Kt=Qe}let Mt=0,At=0,Me=0;{const Ee=1/G,$e=H?te:ie(h*(1-Ee)+u*Ee,M,O),Fe=H?ie(m*(1-Ee)+f*Ee,I,N):me,Qe=be($e,Fe);Mt=$e*v,At=b(Fe),Me=Qe}for(let Ee=1;Ee<B-1;Ee+=De){const $e=Ee/G,Fe=Mt,Qe=At,rt=Me;{const si=H?Te:ie($e,w,P),Ui=H?ie($e,S,A):et,gi=Fe-V,Mi=Qe-Q,Xi=rt-ae;Ks(Fe,Mi,Xi,x),Ue.setVertexFromValuesRawPositionUV(Ee,gi,Mi,Xi,si,Ui)}{const si=(Ee+1)/G,Ui=H?te:ie(h*(1-si)+u*si,M,O),gi=H?ie(m*(1-si)+f*si,I,N):me,Mi=be(Ui,gi);Mt=Ui*v,At=b(gi),Me=Mi}const Lt=Mt,$t=Me,Ft=at,Nt=xt,fi=Kt;at=Fe,xt=Qe,Kt=rt;let pt=0,St=0,Tt=0;if(H){const si=At-Qe,Ui=$t-rt,gi=Nt-Qe,Mi=fi-rt,Xi=ie(m*(1-$e)+f*$e,I,N),pr=te+nt,Cs=pr*v-Fe,cs=xi(pr,Xi,q)-rt,ar=D===3?-1:1;if(pt=ar*(-gi+si)*cs,St=ar*Cs*(-Mi+Ui),Tt=-ar*Cs*(-gi+si),_e){const Vi=te+Re,Bi=Vi*v-Fe;pt=(-gi+si)*(cs-(xi(Vi,Xi,ye)-rt)),St=(Cs-Bi)*(-Mi+Ui),Tt=-(Cs-Bi)*(-gi+si)}}else{const si=Lt-Fe,Ui=$t-rt,gi=Ft-Fe,Mi=fi-rt,Xi=ie(h*(1-$e)+u*$e,M,O),pr=me+lt,Cs=xi(Xi,pr,q)-rt,cs=b(pr)-Qe,ar=D===2?-1:1;if(pt=ar*cs*(-Mi+Ui),St=ar*(-gi+si)*Cs,Tt=-ar*cs*(-gi+si),_e){const Vi=Xi,Bi=me+Ye,or=b(Bi)-Qe;pt=(-cs+or)*(-Mi+Ui),St=(-gi+si)*(-Cs+(xi(Vi,Bi,ye)-rt)),Tt=-(-cs+or)*(-gi+si)}}const nr=1/Math.sqrt(pt*pt+St*St+Tt*Tt);Ue.setNormalFromValues(Ee,pt*nr,St*nr,Tt*nr)}}else for(let Be=1;Be<B-1;Be+=De){const Re=Be/G,Ye=H?te:ie(h*(1-Re)+u*Re,M,O),nt=H?ie(m*(1-Re)+f*Re,I,N):me,lt=H?Te:ie(Re,w,P),at=H?ie(Re,S,A):et,xt=be(Ye,nt),Kt=Ye*v-V,Mt=b(nt)-Q,At=xt-ae;Ks(Kt,Mt,At,x),Ue.setVertexFromValuesRawPositionUV(Be,Kt,Mt,At,lt,at)}}}function WU(i,e){QU(i)}function bce(i,e){return(Math.PI/2-2*Math.atan(Math.exp(-i/e)))*e}function wce(i,e){return i*e}function IA(i,e,t){return i?r=>bce(r,e):r=>wce(r,t)}function jU(i,e,t,r,s,n){const a=e-1,o=i.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=rc.map((w,S)=>S===0&&s[1]<e-2||S===1&&r[1]<e-2||S===2&&s[0]>1||S===3&&r[0]>1),h=i.outerEdges.reduce((w,S,P)=>w+(c[P]?0:a-2+S.count-1),0),u=t.reduce((w,S)=>w+a*(2*(S.latitudeResolution-1)+1),0),m=n?2:1,f=3*(l+h+u)*m,y=o>=nce?new Uint32Array(f):new Uint16Array(f);let g=0;const v=e-2,b=a-2;se(b>=0);const x=(w,S,P,A,M,O)=>{const I=w*M,N=O[I],F=O[I+1],V=O[I+2],Q=S*M,ae=O[Q],q=O[Q+1],D=O[Q+2],H=P*M,G=O[H],B=O[H+1],le=O[H+2],ce=A*M,_e=O[ce],j=O[ce+1],de=O[ce+2];return(ae-_e)*(ae-_e)+(q-j)*(q-j)+(D-de)*(D-de)>(N-G)*(N-G)+(F-B)*(F-B)+(V-le)*(V-le)};if(n){const w=(P,A,M)=>{y[g++]=P,y[g++]=A,y[g++]=A,y[g++]=M,y[g++]=M,y[g++]=P,Er&&(se(P<o),se(A<o),se(M<o),se(g<=f))};(()=>{for(let P=Math.max(s[0],1)-1;P<Math.min(s[1],e-2)-1;++P){const A=P*v;for(let M=Math.max(r[0],1)-1;M<Math.min(r[1],e-2)-1;++M){const O=P*v+M,I=O+1,N=I+v,F=N-1,V=A+M,Q=V+1,ae=Q+v,q=ae-1,D=i.vertexAttributes.position.typedBuffer,H=i.vertexAttributes.position.typedBufferStride;x(V,Q,ae,q,H,D)?(w(O,I,N),w(N,F,O)):(w(O,I,F),w(F,N,I))}}})(),se(g===3*l*m),(()=>{for(let P=0;P<4;++P){const A=g;if(c[P])continue;const M=i.outerEdges[P],O=i.innerEdges[P];let I=0,N=0;const F=M.count,V=O.count;se(V===a-1);let Q=0;const ae=P===1||P===2?(q,D,H)=>w(q,D,H):(q,D,H)=>w(q,H,D);for(;I<F-1||N<V-1;){const q=O.getVertexIndex(N),D=M.getVertexIndex(I),H=I<F-1,G=N<V-1;H&&(!G||(H?0+a*(I+.5)/(F-1):0)<=(G?1+b*(N+.5)/(V-1):0))?(++I,Er&&se(I<F),ae(q,D,M.getVertexIndex(I)),Q++):(++N,Er&&se(N<V),ae(q,D,O.getVertexIndex(N)),Q++)}Er&&(se(I===F-1),se(N===V-1),se(Q===F+V-2),se(Q===a-2+M.count-1),se(g===A+3*Q*m))}})(),se(g===3*(l+h)*m);const S=P=>{const A=i.outerEdges[P.connectedOuterEdgeOffset];let M=A.getVertexIndex(0),O=A.stride;for(let I=0;I<P.latitudeResolution;++I){const N=I===0?P.rowOffset:M+e;for(let F=0;F<a;F++)w(M,M+1,N+F),I<P.latitudeResolution-1&&w(M+1,N+F+1,N+F),M+=O;M=N,O=1}};t.forEach(S)}else{(()=>{const S=Math.max(s[0],1)-1,P=Math.min(s[1],e-2)-1,A=Math.max(r[0],1)-1,M=Math.min(r[1],e-2)-1;for(let O=S;O<P;++O){const I=O*v;for(let N=A;N<M;++N){const F=I+N,V=F+1,Q=V+v,ae=Q-1,q=i.vertexAttributes.position.typedBuffer,D=i.vertexAttributes.position.typedBufferStride;x(F,V,Q,ae,D,q)?(y[g]=F,y[g+1]=V,y[g+2]=Q,y[g+3]=Q,y[g+4]=ae,y[g+5]=F):(y[g]=F,y[g+1]=V,y[g+2]=ae,y[g+3]=ae,y[g+4]=V,y[g+5]=Q),g+=6}}})(),se(g===3*l*m),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const P=i.outerEdges[S],A=i.innerEdges[S];let M=0,O=0;const I=P.count,N=A.count;se(N===a-1);const F=S===1||S===2,V=F?1:2,Q=F?2:1,ae=P.index0,q=P.stride,D=A.index0,H=A.stride;for(;M<I-1||O<N-1;){const G=D+O*H,B=ae+M*q,le=M<I-1,ce=O<N-1,_e=le&&(!ce||(le?0+a*(M+.5)/(I-1):0)<=(ce?1+b*(O+.5)/(N-1):0));_e?++M:++O;const j=_e?B+q:G+H;y[g]=G,y[g+V]=B,y[g+Q]=j,g+=3}}})(),se(g===3*(l+h)*m);const w=S=>{const P=i.outerEdges[S.connectedOuterEdgeOffset];let A=P.getVertexIndex(0),M=P.stride;for(let O=0;O<S.latitudeResolution;++O){const I=O===0?S.rowOffset:A+e;for(let N=0;N<a;N++){const F=I+N;y[g]=A,y[g+1]=A+1,y[g+2]=F,O<S.latitudeResolution-1?(y[g+3]=A+1,y[g+4]=F+1,y[g+5]=F,g+=6):g+=3,A+=M}A=I,M=1}};t.forEach(w)}se(g===f),i.indices=y,i.indexCount=f}function XU(i,e){const t=i.localOrigin,r=i.geometryInfo,s=i.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,a=r.vertexAttributes;let o=e;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),u=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new ID(a,t,h,u,n)}{const c=o,h=s[l]+1;r.outerEdges[l]=new ID(a,t,c,1,h),o+=h}}}function YU(i,e,t){const r=(e+2)%4,s=i.geometryState,n=i.tile,a=s.neighborData,o=n.level-t.level,l=e===1||e===3,c=a.edgeResolutions[e];se(uy(c));const h=c+1,u=i.geometryInfo,m=u.boundingBox,f=u.outerEdges[e],y=u.uvRange[0],g=u.uvRange[1],v=u.uvRange[2],b=u.uvRange[3],x=ie(e===1?1:0,y,v),w=ie(e===0?1:0,g,b),S=t.renderData,P=S.geometryState,A=S.geometryInfo.outerEdges[r],M=n.getNeighborEdgeStartVertexIndex(e,t)*c,O=c*2**o;se(P.neighborData.edgeResolutions[r]===O),se(A.count-1===O);const I=S.localOrigin[0]-i.localOrigin[0],N=S.localOrigin[1]-i.localOrigin[1],F=S.localOrigin[2]-i.localOrigin[2],V=f.attributes,Q=f.index0,ae=f.stride,q=V.position.typedBuffer,D=V.position.typedBufferStride,H=V.normalCompressed.typedBuffer,G=V.normalCompressed.typedBufferStride,B=V.uv0,le=A.attributes,ce=A.index0,_e=A.stride,j=le.position.typedBuffer,de=le.position.typedBufferStride,te=le.normalCompressed.typedBuffer,me=le.normalCompressed.typedBufferStride;for(let ye=1;ye<h-1;++ye){const Ue=Q+ae*ye,De=ce+_e*(M+ye),Te=Ue*D,et=De*de,be=j[et]+I,Be=j[et+1]+N,Re=j[et+2]+F;q[Te]=be,q[Te+1]=Be,q[Te+2]=Re,Ks(be,Be,Re,m);const Ye=Ue*G,nt=De*me;H[Ye]=te[nt],H[Ye+1]=te[nt+1];const lt=ye/c,at=l?x:ie(lt,y,v),xt=l?ie(lt,g,b):w;la(B,Ue,at,xt)}}function QU(i){var et;const e=i.geometryState,t=e.neighborData,r=i.localOrigin,s=t.cornerNeighborData,n=i.geometryInfo,a=n.outerEdges,o=n.boundingBox,l=i.tile,c=((et=i.tile.surface.view)==null?void 0:et.viewingMode)==="local",h=l.ellipsoid.radius,u=l.extentInRadians,m=l.horizontalScale;let f=0,y=0,g=0;const v=(be,Be,Re)=>{const Ye=u[Be===0?1:3],nt=u[be===0?0:2],lt=Math.cos(Ye),at=Math.sin(Ye),xt=Math.sin(nt),Kt=Math.cos(nt),Mt=h+Re;f=Kt*lt*Mt,y=xt*lt*Mt,g=at*Mt},b=c?(()=>{const be=i.geometryState.clippingArea,Be=l.extent,Re=_(be)&&(Be[3]>be[3]||Be[2]>be[2]||Be[1]<be[1]||Be[0]<be[0]),Ye=IA(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,m);return(nt,lt,at)=>{const xt=nt===0?Q[0]:Q[2],Kt=lt===0?Q[1]:Q[3],Mt=Re?ie(xt,be[0],be[2]):xt,At=Re?ie(Kt,be[1],be[3]):Kt,Me=at;f=Mt*m,y=Ye(At),g=Me}})():v;let x=0,w=0,S=0,P=0,A=0,M=0,O=0,I=0,N=0;const F=c&&i.tile.surface.isWebMercatorOnPlateeCarree,V=(be,Be,Re,Ye,nt)=>{let lt=0,at=0,xt=0;if(c){const Kt=Be*m,Mt=F?(Math.PI/2-2*Math.atan(Math.exp(-Re/h)))*h:Re*m;lt=Kt-f,at=Mt-y,xt=Ye-g}else{const Kt=MA(be),Mt=be.tile,At=Mt.extent,Me=Mt.extentInRadians,Ee=(Be-At[0])/(At[2]-At[0]),$e=(Re-At[1])/(At[3]-At[1]),Fe=Me[0]*(1-Ee)+Me[2]*Ee,Qe=Kt($e),rt=Math.cos(Qe),Lt=Math.sin(Qe),$t=Math.sin(Fe),Ft=Math.cos(Fe),Nt=h+Ye;lt=Ft*rt*Nt-f,at=$t*rt*Nt-y,xt=Lt*Nt-g}switch(nt){case 0:O+=lt,I+=at,N+=xt;break;case 1:P-=lt,A-=at,M-=xt;break;case 2:O-=lt,I-=at,N-=xt;break;case 3:P+=lt,A+=at,M+=xt}},Q=l.extent,ae=e.clippingArea,q=_(ae)?ae:Zw,D=Q[0],H=Q[2],G=Q[1],B=Q[3],le=[B>q[3],H>q[2],G<q[1],D<q[0]],ce=Math.max(D,q[0]),_e=Math.min(H,q[2]),j=Math.max(G,q[1]),de=Math.min(B,q[3]),te=n.uvRange[0],me=n.uvRange[1],ye=n.uvRange[2],Ue=n.uvRange[3],De=l.surface.shading||Cp,Te=be=>{var At;const Be=s[be].cornerTiles;x=0,w=0,S=1;let Re=1/0;for(let Me=0;Me<4;++Me)Re=Math.min(Re,((At=Be[Me])==null?void 0:At.level)??1/0);for(let Me=0;Me<4;++Me){const Ee=Be[Me];t_[Me]=(Ee==null?void 0:Ee.level)===Re?Ee:null}let Ye=1,nt=0;for(let Me=0;Me<4;++Me){const Ee=t_[Me];Ee&&(Ye=Math.max(Ye,Ee==null?void 0:Ee.renderData.geometryState.numVerticesPerSide),nt=Ee.extent[2]-Ee.extent[0])}const lt=nt,at=Ye;se(at>1);const xt=lt/at;for(let Me=0;Me<4;++Me){const Ee=t_[(Me+3)%4],$e=t_[Me%4];if(!Ee&&!$e)continue;const Fe=Me===0?1:Me===1?2:Me===2?3:0,Qe=Me===0?2:Me===1?3:Me===2?0:1;if(Ee&&$e){const rt=vC[Me][0]*xt,Lt=vC[Me][1]*xt,$t=Ee.extent,Ft=$t[Fe===0||Fe===1?2:0]+rt,Nt=$t[Fe===0||Fe===3?3:1]+Lt,fi=$e.extent,pt=fi[Qe===0||Qe===1?2:0]+rt,St=fi[Qe===0||Qe===3?3:1]+Lt,Tt=Ee.renderData,nr=$e.renderData,si=xi(Ft,Nt,Tt.geometryState.samplerData),Ui=xi(pt,St,nr.geometryState.samplerData);V(Tt,Ft,Nt,.5*(si+Ui),Me)}else{const rt=Ee??$e,Lt=Ee?Fe:Qe,$t=rt.extent,Ft=vC[Me],Nt=$t[Lt===0||Lt===1?2:0]+Ft[0]*xt,fi=$t[Lt===0||Lt===3?3:1]+Ft[1]*xt,pt=rt.renderData,St=xi(Nt,fi,pt.geometryState.samplerData);V(pt,Nt,fi,St,Me)}}if(!c){const Me=Math.sqrt(f*f+y*y+g*g);x=f/Me,w=y/Me,S=g/Me}const Kt=Math.sqrt(P*P+A*A+M*M);P/=Kt,A/=Kt,M/=Kt;const Mt=Math.sqrt(O*O+I*I+N*N);if(O/=Mt,I/=Mt,N/=Mt,c||S*S<.999){x=M*I-A*N,w=P*N-M*O,S=A*O-P*I;const Me=1/Math.sqrt(x*x+w*w+S*S);x*=Me,w*=Me,S*=Me}};for(let be=0;be<4;++be){const Be=be,Re=(be+1)%4,Ye=be===0||be===1?1:0,nt=be===0||be===3?1:0,lt=ie(Ye,te,ye),at=ie(nt,me,Ue),xt=a[Be],Kt=be===0||be===3?xt.count-1:0,Mt=a[Re],At=be===0||be===1?Mt.count-1:0,Me=s[be].cornerTiles;let Ee=-1;for(let Qe=0;Qe<4;++Qe){const rt=Me[Qe];rt&&(Ee===-1||ah(Me[Ee],rt)>0)&&(Ee=Qe)}const $e=Ee,Fe=Me[$e];if(x=0,w=0,S=1,Fe!==l){const Qe=l.level-Fe.level,rt=2**Qe,Lt=[Fe.lij[0]+Qe,Fe.lij[1]*rt,Fe.lij[2]*rt],$t=[Lt[1]+rt===l.lij[1],be===0&&($e===1||$e===0&&Fe!==Me[3])||be===1&&($e===0||$e===1&&Fe!==Me[2]),Lt[1]===l.lij[1]+1,be===2&&($e===3||$e===2&&Fe!==Me[1])||be===3&&($e===2||$e===3&&Fe!==Me[0])],Ft=$t.reduce((Tt,nr)=>Tt+(nr?1:0),0);se(Ft===1||Ft===2);let Nt=-1,fi=-1;const pt=Fe.renderData;if(Ft===1){const Tt=$t.findIndex(si=>si);se(0<=Tt&&Tt<=3),Nt=(Tt+2)%4;const nr=i.geometryState.neighborData.edgeResolutions[Tt];fi=l.getNeighborEdgeStartVertexIndex(Tt,Fe)*nr+nr*(Tt===0&&be===0||Tt===1&&be===0||Tt===2&&be===1||Tt===3&&be===3?1:0)}else{se($t[1]||$t[3]),Nt=$t[1]?3:1;const Tt=pt.geometryState.neighborData.edgeResolutions[Nt];fi=be===0||be===3?0:Tt}const St=pt.geometryInfo.outerEdges[Nt];{const Tt=xt.index0+Kt*xt.stride,nr=Mt.index0+At*Mt.stride,si=St.index0+fi*St.stride;{const Ui=St.attributes.position,gi=Ui.typedBuffer,Mi=si*Ui.typedBufferStride,Xi=i.localOrigin,pr=St.localOrigin,Cs=gi[Mi]+pr[0]-Xi[0],cs=gi[Mi+1]+pr[1]-Xi[1],ar=gi[Mi+2]+pr[2]-Xi[2];Ks(Cs,cs,ar,o);{const Vi=xt.attributes.position,Bi=Vi.typedBuffer,or=Tt*Vi.typedBufferStride;Bi[or]=Cs,Bi[or+1]=cs,Bi[or+2]=ar}{const Vi=Mt.attributes.position,Bi=Vi.typedBuffer,or=nr*Vi.typedBufferStride;Bi[or]=Cs,Bi[or+1]=cs,Bi[or+2]=ar}}la(xt.attributes.uv0,Tt,lt,at),la(Mt.attributes.uv0,nr,lt,at);{const Ui=St.attributes.normalCompressed.typedBuffer,gi=si*St.attributes.normalCompressed.typedBufferStride;{const Mi=xt.attributes.normalCompressed,Xi=Mi.typedBuffer,pr=Tt*Mi.typedBufferStride;Xi[pr]=Ui[gi],Xi[pr+1]=Ui[gi+1]}{const Mi=Mt.attributes.normalCompressed,Xi=Mi.typedBuffer,pr=nr*Mi.typedBufferStride;Xi[pr]=Ui[gi],Xi[pr+1]=Ui[gi+1]}}}}else{const Qe=le[Be],rt=le[Re];let Lt;if(Qe||rt){const fi=ie(D*(1-Ye)+H*Ye,ce,_e),pt=ie(G*(1-nt)+B*nt,j,de),St=e.samplerData;Lt=xi(fi,pt,St)}else Lt=xce(Me);b(Ye,nt,Lt),(De||Cp)&&Te(be);const $t=f-r[0],Ft=y-r[1],Nt=g-r[2];Ks($t,Ft,Nt,o),xt.setVertexFromValuesRawPositionUVNormal(Kt,$t,Ft,Nt,lt,at,x,w,S),Mt.setVertexFromValuesRawPositionUVNormal(At,$t,Ft,Nt,lt,at,x,w,S)}}for(let be=0;be<4;++be)t_[be]=null}function xce(i){var n,a;const e=i.reduce((o,l)=>Math.min(o,(l==null?void 0:l.level)??1/0),1/0);Er&&(se(!i[0]||!i[2]||BS(i[0],i[2],ke.SOUTH_WEST)),se(!i[1]||!i[3]||BS(i[1],i[3],ke.NORTH_WEST)));let t=0,r=0;for(let o=0;o<4;++o){const l=i[o];if(l&&l.level===e){const c=o===0||o===1,h=o===0||o===3,u=l.extent,m=u[c?0:2],f=u[h?1:3],y=(a=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:a.samplerData;r+=xi(m,f,y),t++}}const s=t?r/t:0;return se(s!=null),s}function Qw(i){const e=i.vao,t=i.geometryInfo.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(t,0,0,t.length)}const vC=[[0,1],[1,0],[0,-1],[-1,0]],fr=new sle,Zw=z$(-1/0,-1/0,1/0,1/0),t_=[null,null,null,null];function ZU(i,e,t){if(!e)return!1;const r=ah(i,e);return r>0||r===0&&t>=2}const Cp=!0;let Tce=class extends RA{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,t,r){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Ot(),e!==void 0&&this.init(e,t,r)}init(e,t,r){super.init(e,t,r);const s=r.view.renderSpatialReference,n=r.spatialReference,a=_(s)&&A$(s)&&_(n)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=a;const o=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(o){const h=qe(c[0],c[1],0);vs(h,ci.WebMercator,h,ci.PlateCarree);const u=qe(c[2],c[3],0);vs(u,ci.WebMercator,u,ci.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=u[0],l[3]=u[1]}else for(let h=0;h<4;++h)l[h]=c[h]*a;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,t=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(t*t+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(s,n);this._center[cr.MIDDLE][3]=a}_calculateFrustumVisibilityStatus(e){const t=this._aabb(),r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5];let c=!0;for(let h=0;h<6;h++){const u=e[h],m=u[0],f=u[1],y=u[2],g=u[3];if(m*(m>0?r:a)+f*(f>0?s:o)+y*(y>0?n:l)+g>=0)return Is.OUTSIDE;c=c&&m*(m<0?r:a)+f*(f<0?s:o)+y*(y<0?n:l)+g<=0}return c?Is.INSIDE:Is.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return Wk(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,t,r,s){return Gv[0]=1/t[0],Gv[1]=1/t[1],Gv[2]=1/t[2],UF(this._aabb(),e,Gv,r,s)}createGeometry(){mce(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){yce(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){vce(this.renderData,this._horizontalScaleFactor)}};const Gv=E();let Cce=class{constructor(){this.extent=Xt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},U1=class extends ge{constructor(){super(...arguments),this._queries=new Ht({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Ht({initialSize:30}),this._queryPool=new Qo(Cce)}queryVisibleLevelRange(e,t,r,s){const n=this._queryPool.acquire();Sd(n.extent,e),n.minLevel=t??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const t=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;t>=s.minLevel&&t<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};d([p()],U1.prototype,"updating",null),U1=d([k("esri.views.3d.terrain.ScaleRangeQueries")],U1);let Ece=class extends RA{get convexHull(){return this._convexHull}constructor(e,t,r){super(),this._convexHull=new Array(24),this._boundingSphere=yo(),e!==void 0&&this.init(e,t,r)}init(e,t,r){super.init(e,t,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],a=this.extentInRadians[1],o=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],h=dt(a,l,.5),u=dt(n,o,.5),m=c===0?0:Math.min(Math.abs(a),Math.abs(l));this._edgeLen=(o-n)*Math.cos(m)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),gB(this.centerAtSeaLevel,u,h,this.ellipsoid.radius);const f=so(this.centerAtSeaLevel);K(f,f),this.up=f,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)Z(e[cr.MIDDLE],0,0,0),Z(e[cr.TOP],0,0,0),Z(e[cr.BOTTOM],0,0,0),e[cr.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=e[cr.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,Sce(t,r,3*n));e[cr.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!fw(e,this._boundingSphere))return Is.OUTSIDE;if(this.lij[0]<10)return Is.INTERSECTS;const t=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<ok.NUM;n++){const a=n===Ki.NEAR,o=e[n],l=o[0],c=o[1],h=o[2],u=o[3]-(a?r:0);let m=!1;for(let f=0;f<8;++f){const y=3*f;if(l*t[y+0]+c*t[y+1]+h*t[y+2]+u<0){if(m=!0,!s)break}else s=!1}if(!m)return Is.OUTSIDE}return s?Is.INSIDE:Is.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){ace(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Er&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,t=e,r=this.elevationBounds,s=this.ellipsoid.radius,n=r[1];if(this.level===0)Z(t,0,0,0),e[3]=s+n;else{const a=this.extentInRadians,o=.5*(a[0]+a[2]),l=a[1],c=a[3];Eu(XD,o,l,s),Eu(YD,o,c,s),J(t,XD,YD);const h=.5*(r[0]+r[1]);W(t,t,(s+h)/ko(t));const u=this.convexHull;let m=0;const f=(g,v)=>{const b=g[0]-u[3*v+0],x=g[1]-u[3*v+1],w=g[2]-u[3*v+2];return Math.sqrt(b*b+x*x+w*w)};for(let g=0;g<8;++g){const v=f(t,g);m=Math.max(m,v)}const y=m;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,t=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,s=this._getPatchType(),n=this.surface.isWebMercator,a=n&&s===lo.HAS_NORTH_POLE,o=n&&s===lo.HAS_SOUTH_POLE,l=o||a,c=Math.PI/2,h=e[0],u=e[2],m=o?-c:e[1],f=a?c:e[3],y=.5*(h+u),g=r[0],v=t+(l?Math.min(0,g-1):g),b=(D,H,G)=>Eu(D,H,G,v),x=E(),w=E(),S=E(),P=E();b(x,h,m),b(w,h,f),b(S,u,f),b(P,u,m);const A=(D,H)=>{for(let G=0;G<3;++G)this._convexHull[3*H+G]=D[G]};A(x,0),A(w,1),A(S,2),A(P,3);const M=r[1],O=t+(l?Math.max(0,M+1):M),I=E(),N=E(),F=E();Eu(N,y,f,v),Eu(F,y,m,v),J(I,N,F),K(I,I);const V=E(),Q=E(),ae=(D,H)=>{gs(Q,D,H),K(Q,Q);const G=-oe(D,V)/oe(Q,V);se(G>=0),W(Q,Q,G),J(D,D,Q)};if(2**this.lij[0]>2*this.lij[1]){const D=F,H=E();Xe(H,jD,D),K(H,H),Xe(V,D,H),K(V,V),se(co(oe(V,D)/ko(D),0)),ae(x,w),ae(P,S),A(x,0),A(P,3)}else if(2**this.lij[0]!==2*this.lij[1]){const D=N,H=E();Xe(H,jD,D),K(H,H),Xe(V,H,D),K(V,V),ae(w,x),ae(S,P),A(w,1),A(S,2)}const q=(D,H)=>{const G=O/oe(H,I);for(let B=0;B<3;++B)this._convexHull[3*D+B]=H[B]*G};q(4,x),q(5,w),q(6,S),q(7,P)}_getPatchType(){const e=this.lij[1],t=e===0,r=e===(1<<this.level)-1;return t?r?lo.HAS_BOTH_POLES:lo.HAS_NORTH_POLE:r?lo.HAS_SOUTH_POLE:lo.REGULAR}intersectsRay(e,t,r,s){const n=this._boundingSphere,a=n[3]+r,o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],l=n[0]-e[0],c=n[1]-e[1],h=n[2]-e[2],u=(l*t[0]+c*t[1]+h*t[2])/o,m=t[0]*u-l,f=t[1]*u-c,y=t[2]*u-h;return m*m+f*f+y*y<a*a}getDefaultVerticesPerSide(){return this.level<WD.length?WD[this.level]+1:2}updateCornerElevations(){dce(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){hce(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var de;if(!Er||this.level<=2)return;const e=this._boundingSphere,t=e[3],r=e,s=E(),n=this.ellipsoid.radius,a=this.elevationBounds;a[1],a[0];const o=n+a[0],l=1,c=0,h=this._center[cr.MIDDLE][3],u=this.convexHull,m=(te,me)=>{for(let ye=0;ye<3;++ye)te[ye]=u[3*me+ye]};{const te=E(),me=E(),ye=E(),Ue=E(),De=E(),Te=(et,be,Be,Re)=>{m(me,et),m(ye,be),m(Ue,Be),gs(me,me,ye),gs(Ue,Ue,ye),Xe(te,me,Ue),K(te,te);const Ye=oe(te,ye);m(De,Re);const nt=oe(te,De),lt=Math.abs(nt-Ye);se(co(lt,0),`Non coplanar ${et},${be},${Be},${Re} diff = ${lt}`)};Te(0,1,2,3),Te(4,5,6,7),Te(0,1,4,5),Te(1,2,5,6),Te(2,3,6,7),Te(3,0,7,4)}const f=vo(24),y=(te,me,ye)=>{const Ue=4*te;for(let De=0;De<3;++De)f[Ue+De]=me[De];f[Ue+3]=ye},g=E(),v=E(),b=E(),x=E(),w=(te,me,ye,Ue)=>{m(g,me),m(v,ye),m(b,Ue),gs(g,g,v),K(g,g),gs(b,b,v),K(b,b),Xe(x,g,b),K(x,x);const De=oe(x,v);y(te,x,De)};w(0,0,1,2),w(1,1,0,4),w(2,1,5,2),w(3,3,2,6),w(4,4,0,3),w(5,4,6,5);const S=1,P=(te,me,ye,Ue)=>{const De=4*te;return f[De+0]*me+f[De+1]*ye+f[De+2]*Ue-f[De+3]},A=(te,me,ye,Ue)=>P(te,me,ye,Ue)>=-S,M=(te,me)=>A(te,me[0],me[1],me[2]),O=2**this.lij[0]>2*this.lij[1],I=(te,me,ye)=>Math.sqrt(KU(te,me,ye,r[0],r[1],r[2]))<t,N=te=>I(te[0],te[1],te[2]),F=(te,me)=>I(te[me+0],te[me+1],te[me+2]),V=this.extentInRadians,Q=.5*(V[0]+V[2]),ae=V[1],q=V[3],D=E(),H=E();Eu(D,Q,q,o),Eu(H,Q,ae,o);const G=O?"Upper":"Lower";let B=!0;for(let te=0;te<6;++te){for(let me=0;me<8;++me){const ye=3*me,Ue=A(te,u[ye+0],u[ye+1],u[ye+2]);B&&(B=Ue),se(Ue,`Tile[${this.lij}] Convex hull point ${me} outside of plane ${te}`)}se(M(te,H),`Tile[${this.lij}] (${G}) bottom mid outside of plane ${te}`),se(M(te,D),`Tile[${this.lij}] (${G}) top mid outside of plane ${te}`)}se(B,"Not all convex hull points are inside  convex hull polyhedron"),se(N(H),`Tile[${this.lij}] (${G}) bottom mid outside of bounding sphere`),se(N(D),`Tile[${this.lij}] (${G}) top mid outside of bounding sphere`);for(let te=0;te<8;++te){const me=F(u,3*te);se(me,`Tile[${this.lij}] Convex hull point ${te} outside of bounding sphere`)}for(let te=0;te<6;++te)for(let me=0;me<8;++me){const ye=3*me;A(te,u[ye+0],u[ye+1],u[ye+2])||console.error(`Tile[${this.lij}] Convex hull point ${me} outside of plane ${te}`)}const le=this.extentInRadians,ce=Math.max(le[2]-le[0],le[3]-le[1]),_e=Math.round(ce*n),j=this.renderData;if(j){const te=j.geometryInfo,me=j.localOrigin,ye=(de=te.vertexAttributes)==null?void 0:de.position;if(!ye)return;const Ue=ye.count,De=E(),Te=te.numVerticesPerSide-2,et=Te*Te,be=j.geometryState.neighborData,Be=be.edgeResolutions.reduce((Re,Ye)=>Re+Ye+1,0);for(let Re=0;Re<Ue;++Re){const Ye=Re<et,nt=!Ye&&Re<et+Be;let lt=!1,at=-1;if(nt){let pt=et;for(let St=0;St<4;++St){const Tt=be.edgeResolutions[St];if(Re===pt||Re===pt+Tt-1){lt=!0;break}if(pt+=Tt,Re<pt){at=St;break}}}const xt=at,Kt=lt,Mt=nt&&!Kt,At=nt?be.edgePeerNeighbors[xt]:null,Me=nt&&At&&ah(this,At)>0,Ee=Ye?"internal":Mt?"edge":Kt?"corner":"pole";ye.getVec(Re,s),J(De,s,me);const $e=ko(De)-n;let Fe=0,Qe=!1;const rt=a[0]-$e,Lt=$e-a[1],$t=rt>l,Ft=Lt>l,Nt=$t||Ft,fi=`Tile[${this.lij}].vertex[${Re}]:${Ee}`+($t?"(below)":Ft?"(above)":"")+(Me?"(Neighbor)":"");{const pt=d2(De,r);if(pt>=t+c){const St=pt-t;Nt||(console.error(`${fi} is out of the bounding sphere by ${St.toFixed(0)} / ${t.toFixed(0)}[tol=${c}] h=${$e.toFixed(0)} / [${a[0].toFixed(0)}..${a[1].toFixed(0)}] (${(St/t).toFixed(0)})`),Qe=!0)}}for(let pt=0;pt<6;++pt)if(!A(pt,De[0],De[1],De[2])){const St=P(pt,De[0],De[1],De[2]),Tt=Re%Te,nr=(Re-Tt)/Te;pt===0&&rt||pt===5&&Lt||(console.error(`${fi} (${Tt},${nr})|${Te}] is out of the bounding trapezoid plane ${pt} h=${Math.round($e)} / [${Math.round(a[0])}..${Math.round(a[1])}] dist=${Math.round(St)} radii = ${Math.round(t)}/${Math.round(h)}} : maxL = ${_e}`),++Fe)}if(Qe||Fe>0)break}}}};const WD=[128,64,64,32,16,8,8,4];function Sce(i,e,t){return KU(i[0],i[1],i[2],e[t+0],e[t+1],e[t+2])}function KU(i,e,t,r,s,n){const a=r-i,o=s-e,l=n-t;return a*a+o*o+l*l}const Eu=(i,e,t,r)=>{const s=Math.cos(e),n=Math.sin(e),a=Math.cos(t),o=Math.sin(t);i[0]=r*a*s,i[1]=r*a*n,i[2]=r*o},jD=[0,0,1],XD=E(),YD=E();let Rce=class{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}},JU=class extends Ln{constructor(){super(...arguments),this.blendMode=fe.Normal}};d([L({count:fe.COUNT})],JU.prototype,"blendMode",void 0);let Tf=class extends JU{constructor(){super(...arguments),this.output=Dr.Composite,this.baseOpacityMode=tl.NotRequired,this.premultipliedSource=Go.Off,this.hasWebGL2Context=!1}};d([L({count:Dr.COUNT})],Tf.prototype,"output",void 0),d([L({count:tl.COUNT})],Tf.prototype,"baseOpacityMode",void 0),d([L()],Tf.prototype,"premultipliedSource",void 0),d([L()],Tf.prototype,"hasWebGL2Context",void 0);var Ep;function Ace(i){const e=new Hi;if(e.include(DU),i.background===Ep.Only){const t=i.output===Dr.ColorComposite;return t?e.fragment.uniforms.add(new Fs("backgroundColor",r=>r.backgroundColor)):(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(SA)),e.fragment.code.add(R`
    void main() {
      gl_FragColor = vec4(${t?R`backgroundColor`:R`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(LU,i),e.fragment.uniforms.add(new Bt("tex",t=>t.texture)),e.fragment.uniforms.add(new yt("opacity",t=>t.opacity)),e.fragment.code.add(R`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),e}(function(i){i[i.BelowLayer=0]="BelowLayer",i[i.Only=1]="Only",i[i.COUNT=2]="COUNT"})(Ep||(Ep={}));const Pce=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Ep},build:Ace},Symbol.toStringTag,{value:"Module"}));let Oce=class extends IU{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Va}},eV=class tV extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,tV.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:fc(he.ONE,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut})}};eV.shader=new jt(Pce,()=>Y(()=>import("./BlendLayers.glsl-09c3b4c9.js"),["./BlendLayers.glsl-09c3b4c9.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2f64-70cfd09e.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let iV=class extends Tf{constructor(){super(...arguments),this.background=Ep.BelowLayer}};d([L()],iV.prototype,"background",void 0);let bC=class{constructor(e,t,r,s,n,a){this.texture=e,this.type=t,e.retain(),this.offsetAndScale=Ai(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=qe(s,n,a)}destroy(){this.texture.release()}};function V1(){return[1,0,0,1,0,0]}function Mce(i){return[i[0],i[1],i[2],i[3],i[4],i[5]]}function Ice(i,e,t,r,s,n){return[i,e,t,r,s,n]}function Dce(i,e){return new Float64Array(i,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Mce,create:V1,createView:Dce,fromValues:Ice},Symbol.toStringTag,{value:"Module"}));function Lce(i){return i instanceof Float32Array&&i.length>=2}function $ce(i){return Array.isArray(i)&&i.length>=2}function wC(i){return Lce(i)||$ce(i)}const Fce=96,Nce=39.37;function DA(i,e){return e.type?pi(i,e.x,e.y):as(i,e)}function Uce(i){return Yd(i)}function Vce(i,e){const t=i.targetGeometry,r=e.targetGeometry;return t.x=r.x,t.y=r.y,t.spatialReference=r.spatialReference,i.scale=e.scale,i.rotation=e.rotation,i}const Bce=function(){const i=Ne();return function(e,t,r){const s=t.targetGeometry;DA(i,s);const n=.5*Kw(t);return e.xmin=i[0]-n*r[0],e.ymin=i[1]-n*r[1],e.xmax=i[0]+n*r[0],e.ymax=i[1]+n*r[1],e.spatialReference=s.spatialReference,e}}();function Kw(i){return i.scale*zce(i.targetGeometry)}function zce(i){return _(i)&&G8(i.spatialReference)?1/(Uce(i.spatialReference)*Nce*Fce):1}function kce(i){return Y2(i.rotation)||0}const LA=function(){const i=Ne(),e=Ne(),t=Ne();return function(r,s,n,a,o,l){return yF(i,s),La(e,n,.5*l),pi(t,1/a*l,-1/a*l),mF(r,e),o&&fF(r,r,o),$7(r,r,t),gF(r,r,i),r}}(),Gce=function(){const i=Ne();return function(e,t,r,s){const n=Kw(t),a=kce(t);return DA(i,t.targetGeometry),LA(e,i,r,n,a,s)}}(),Hce=function(){const i=Ne();return function(e,t,r,s){const n=Kw(t);return DA(i,t.targetGeometry),LA(e,i,r,n,0,s)}}();function qce(i){const e=H8(i);return e?e.valid[1]-e.valid[0]:0}function Wce(i,e){return Math.round(qce(i)/e)}var kS;const Nc=[0,0];let od=kS=class extends da{constructor(i){super(i),this._viewpoint2D={center:Ne(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new ms,this.id=0,this.inverseTransform=V1(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=V1(),this.transformNoRotation=V1(),this.displayMat3=Md(),this.displayViewMat3=Md(),this.viewMat3=Md(),this.viewMat2d=F7(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(i){this._set("pixelRatio",i),this._update()}set size(i){this._set("size",i),this._update()}set viewpoint(i){if(i){const e=this._viewpoint2D,t=i.targetGeometry;e.center[0]=t.x,e.center[1]=t.y,e.rotation=i.rotation,e.scale=i.scale,e.spatialReference=t.spatialReference}this._update()}copy(i){const e=this.size,t=this.viewpoint;return t&&e?(this.viewpoint=Vce(t,i.viewpoint),this._set("size",as(e,i.size))):(this.viewpoint=i.viewpoint.clone(),this._set("size",[i.size[0],i.size[1]])),this._set("pixelRatio",i.pixelRatio),this}clone(){return new kS({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(i,e,t){return wC(e)?Qp(i,e,this.inverseTransform):(Nc[0]=e,Nc[1]=t,Qp(i,Nc,this.inverseTransform))}toScreen(i,e,t){return wC(e)?Qp(i,e,this.transform):(Nc[0]=e,Nc[1]=t,Qp(i,Nc,this.transform))}toScreenNoRotation(i,e,t){return wC(e)?Qp(i,e,this.transformNoRotation):(Nc[0]=e,Nc[1]=t,Qp(i,Nc,this.transformNoRotation))}getScreenTransform(i,e){const{center:t}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return LA(i,t,s,e,0,r),i}_update(){const{center:i,spatialReference:e,scale:t,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),a=new hl({targetGeometry:new kt(i[0],i[1],e),scale:t,rotation:r});if(this._set("viewpoint",a),!n||!e||!t)return;this.resolution=Kw(a),this.rotation=r,this.scale=t,this.spatialReference=e,as(this.center,i);const o=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;kF(this.displayMat3,o,0,0,0,l,0,-1,1,1);const c=HF(this.viewMat3),h=ud(n[0]/2,n[1]/2),u=ud(-n[0]/2,-n[1]/2),m=Y2(r);hE(c,c,h),qF(c,c,m),hE(c,c,u),GF(this.displayViewMat3,this.displayMat3,c);const f=mF(this.viewMat2d,h);return fF(f,f,m),gF(f,f,u),Bce(this.extent,a,n),Gce(this.transform,a,n,s),N7(this.inverseTransform,this.transform),Hce(this.transformNoRotation,a,n,s),this.worldScreenWidth=Wce(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};d([p({readOnly:!0})],od.prototype,"id",void 0),d([p({value:1,json:{write:!0}})],od.prototype,"pixelRatio",null),d([p({json:{write:!0}})],od.prototype,"size",null),d([p()],od.prototype,"spatialReference",void 0),d([p({type:hl,json:{write:!0}})],od.prototype,"viewpoint",null),od=kS=d([k("esri.views.2d.ViewState")],od);const jce=od,Xce=.125;let Yce=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new jce({viewpoint:new hl({targetGeometry:new kt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,t,r,s,n,a,o,l,c,h){const u=a.adjustLevel(t[0]),m=this._renderParams;m.context=e,m.painter=s,m.glyphMosaic=s.glyphMosaic,m.spriteMosaic=s.spriteMosaic,m.pixelRatio=h,m.displayLevel=u,m.requiredLevel=u;const f=a.getScale(t[0]),[y,g]=a.getShift(t,o*f),v=Xce*o*f/c,b=r.transforms.dvs;b[0]=v,b[4]=-v,b[6]=-1-y-l[0]*o*2,b[7]=1+g+(1-l[1])*o*2-2,m.state.size[0]=c,m.state.size[1]=c,r.stage||r.attachWithContext(e),r.triangleCount=0,s.drawTile(m,r,n)}},rV=class sV extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,sV.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:fc(he.ONE,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut})}};rV.shader=new jt(Ale,()=>Y(()=>import("./RasterColorizer.glsl-44cd6d61.js"),["./RasterColorizer.glsl-44cd6d61.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let B1=class extends Tf{constructor(){super(...arguments),this.colorizerType=cp.Stretch,this.stretchType=Tp.Noop,this.applyColormap=!0}};d([L({count:cp.COUNT})],B1.prototype,"colorizerType",void 0),d([L({count:Tp.COUNT})],B1.prototype,"stretchType",void 0),d([L()],B1.prototype,"applyColormap",void 0);let QD=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const t=this._fbos.get(e);if(t)return t;const r=new Ur(this._rctx,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.DEPTH_RENDER_BUFFER,width:e,height:e});return this._fbos.set(e,r),r}};const Qce=pe.getLogger("esri.views.3d.terrain");let Zce=class{constructor(e,t){this._rctx=e,this._techniqueRepository=t,this._fbos=[],this._vectorTileHelper=new Yce,this._bindParameters=new Aw(null,null,null),this._blendLayersTechniqueConfig=new iV,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Dn(this._rctx,c0)}dispose(){this._fbos.forEach(Le),this._fbos=null,this._vtFBO=Le(this._vtFBO),this._vaoQuad=Le(this._vaoQuad),this._vectorTileHelper=Le(this._vectorTileHelper),this._backgroundTechnique=gr(this._backgroundTechnique),this._applyOpacityTechnique=gr(this._applyOpacityTechnique),this._blendLayersTechnique=gr(this._blendLayersTechnique)}_getBlendLayersTechnique(e,t,r,s=Go.Off,n=Ep.BelowLayer){return this._blendLayersTechniqueConfig.output=t,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(eV,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,t){const r=this._getBlendLayersTechnique(fe.Normal,t?Dr.ColorComposite:Dr.GridComposite,tl.NotRequired,Go.Off,Ep.Only),s=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(bt.TRIANGLE_STRIP,0,Qs(this._vaoQuad,"geometry"))}drawGroup(e,t,r,s,n,a=Go.On){t===Dr.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=this._getBlendLayersTechnique(s,t,n,a),l=this._rctx.bindTechnique(o,e,this._bindParameters);this._render(l)}drawRasterData(e,t,r,s,n,a=Go.Off){if(T(e.texture))return;e.fboTexture=t===Dr.GroupBackgroundComposite||s===fe.Normal&&n===tl.NotRequired&&a===Go.Off?null:this.switch(r).colorTexture;const o=this._getBlendLayersTechnique(s,t,n,a),l=this._rctx.bindTechnique(o,e,this._bindParameters);this._render(l)}drawImageryTileData(e,t,r,s,n,a){const o=a.sourceLayerInfo.data;if(!o.source||(a.tile.surface.layerViewByIndex(a.layerIndex,mt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;e.fboTexture=s===fe.Normal&&n===tl.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(o,t,s,n);o.opacity=e.opacity;const c=o.getUniforms();c.scale=a.scale,c.offset=a.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const h=this._rctx.bindTechnique(l,c,null);this._render(h)}_getRasterColorizerTechnique(e,t,r,s){const n=e.symbolizerParameters,a=["stretch","lut","hillshade"].indexOf(n.type);return T(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new B1,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=t,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=a,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Tp.Noop:Tp.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(rV,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,t,r,s,n,a,o,l,c){const h=this._rctx,u=a.sourceLayerInfo.data,m=a.tile.surface.layerViewByIndex(a.layerIndex,mt.MAP),f=n===tl.Required||e.opacity<1||s!==fe.Normal||t!==Dr.Composite,y=f?Go.On:Go.Off;this._getBlendLayersTechnique(s,t,n,y).bindPipelineState(h);let g=null,v=null;f?(v=this.currentFBO(r),T(this._vtFBO)&&(this._vtFBO=new QD(this._rctx)),g=this._vtFBO.get(r),h.bindFramebuffer(g),this._clearCurrentFBO()):c&&h.clearSafe(Si.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(h,a.sourceLod,u,m.painter,m.layer.styleRepository,m.schemaHelper,Math.round(1/a.scale),a.offset,l,o)}catch(b){Qce.warnOnce("A render call containing vector tiles did not resolve correctly.",b)}return!_(g)||(h.bindFramebuffer(v),e.texture=g.colorTexture,e.offset=uc,e.scale=1,this.drawRasterData(e,t,r,s,n,y),c)}copyFBOToTexture(e){const t=this._rctx,r=t.bindTexture(e.texture,ui.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;t.gl.copyTexImage2D(Qt.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),t.bindTexture(r,ui.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT)}_initFBO(e,t,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,t,t),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,t=0,r=!0){if(this._current=t,t>=this._fbos.length)for(let s=this._fbos.length;s<=t;s++)this._fbos.push(new QD(this._rctx));this._initFBO(this._fbos[t].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const t=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),t}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const t=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(t),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},Kce=class{constructor(e,t,r,s){this.start=e,this.end=t,this.blendMode=r,this.opacity=s}},Jce=class{constructor(e,t,r){this._rctx=e,this.tileSize=t,this._techniqueRepository=r,this._passParameters=new Oce,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Zce(this._rctx,this._techniqueRepository),this._blackTex=new tf(Nz(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Le(this._composition),this._backgroundTexture=gr(this._backgroundTexture),this._blackTex=gr(this._blackTex)}get backgroundIsGrid(){return T(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,t){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,a=0,o=this.tileSize,l=!1;const c=r.view.state.contentPixelRatio;let h=!1;Jb.clear(),Dm.length=0;const u=e.layerInfo[mt.MAP];let m=u.length,f=0;for(;f<u.length;f++){const v=r.layerViewByIndex(f,mt.MAP),b=v.layer.opacity;ZD[f]=b;const x=v.fullOpacity;if(KD[f]=x,rF(v.layer)&&m>=u.length&&(m=f),Xb(v)){JD[f]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(qf(v.layer.parent)){const P=GS(v.layer.parent);_(P)&&P!==""&&(S=nV(v.layer.parent)||S)}S&&(h=S,l=!1)}if(b===0&&!h){u[f].pendingUpdates&=~(Ve.TEXTURE_NOFADING&Ve.TEXTURE_FADING);continue}++a;const w=xC(e,f);if(w){if(u[f].pendingUpdates&=~(Ve.TEXTURE_NOFADING&Ve.TEXTURE_FADING),qf(v.layer.parent)){const S=GS(v.layer.parent);_(S)&&S!==""&&aV(v.layer.parent,f)}Wy(v)?o=Math.max(o,this.tileSize*c):s===1&&x===1&&(v.isOpaque||this._dataToTexture(w)&&w.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n}}this._rctx.type===wi.WEBGL1&&(o=ehe(o));const y=o/this.tileSize,g=f-1;this._ensureBackgroundTexture(this.tileSize),n!==0?n===1&&!h&&this._useLayerTexture(e,g,m,KD[g])||this._composeMapLayers(e,t,g,m,ZD,JD,o,y,!l||h,Jb,h):this._useBackgroundTexture(e,a)}_ensureBackgroundTexture(e){T(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=uc,this._passParameters.scale=1,this._passParameters.opacity=1,_(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,_(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,t){let r=nh.Immediate;(e.surface.view.layerViewManager.updating||t>0)&&(r=nh.Delayed);const s=e.renderData;this._backgroundTexture&&T(s.textureReference)&&(r=nh.Immediate),s.setTextureReference(_(this._backgroundTexture)?new bC(this._backgroundTexture,wr.FADING,eL,e.surface.baseOpacity,0,1):null,r)}_useLayerTexture(e,t,r,s){const n=t<r,a=n?1:e.surface.baseOpacity,o=n?e.surface.baseOpacity:1,l=xC(e,t);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new bC(l.sourceLayerInfo.data,wr.FADING,l,a,o,s)),!0)}_composeMapLayers(e,t,r,s,n,a,o,l,c,h,u){this._composition.ensureBuffer(o);const m=e.surface.baseOpacity;let f=!1,y=Rt.LINEAR_MIPMAP_LINEAR,g=!1,v=0;for(let w=r;w>=0;w--){const S=xC(e,w);if(!S||n[w]===0&&!u)continue;const P=w<s&&m<1&&!f;this._passParameters.baseOpacity=P?m:1;const A=this._passParameters.baseOpacity<1?tl.Required:tl.NotRequired;P&&(f=!0);let M=!1;h.forEach(F=>{F.start===w&&(Dm.push(F),this._composition.openGroup(o),M=!0)});const O=v===0,I=M?Dr.GroupBackgroundComposite:c&&O?this.backgroundIsGrid?Dr.GridComposite:Dr.ColorComposite:Dr.Composite,N=VS[a[w]];for(roe(S)?(this._passParameters.opacity=n[w],g=this._composition.drawVectorData(this._passParameters,I,o,N,A,S,l,this.tileSize,g)):ioe(S)?(this._passParameters.opacity=n[w],this._composition.drawImageryTileData(this._passParameters,I,o,N,A,S),this._hasNearestInterpolation(S)&&(y=Rt.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=n[w],this._composition.drawRasterData(this._passParameters,I,o,N,A));Dm.length>0&&Dm[Dm.length-1].end===w;){const F=Dm.pop();this._passParameters.opacity=F.opacity,this._passParameters.offset=uc,this._passParameters.scale=1;const V=c&&O?this.backgroundIsGrid?Dr.GridComposite:Dr.ColorComposite:Dr.Composite;this._composition.drawGroup(this._passParameters,V,o,VS[F.blendMode],A)}v++}const b=e.renderData,x=b.ensureTexture(o,()=>this._buildTexture(o,y));this._composition.copyFBOToTexture(x),this._composition.unbind(),b.setTextureReference(new bC(x,t,eL,f?1:m,0,1))}_hasNearestInterpolation(e){const t=e.sourceLayerInfo.data;return!!t.source&&t.interpolation==="nearest"}_dataToTexture(e){if(noe(e)){const t=e.sourceLayerInfo;t.data=this._buildTexture(t.data),e.tile.setMemoryDirty()}return soe(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,t=Rt.LINEAR_MIPMAP_LINEAR){if(T(e))return null;const r={target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:t,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof e=="number")r.width=r.height=e,n=new tf(new ui(s,r));else if(e instanceof qw)r.isOpaque=e.isOpaque,n=new tf(new ui(s,r,e.image)),e.release();else try{r.width=e.width,r.height=e.height,n=new tf(new ui(s,r,e))}catch{n=new tf(VF(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=s.bindTexture(n.texture,ui.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(a,ui.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function ehe(i){const e=s2(i),t=e*e,r=i*i;if(t===r)return i;const s=e/2;return t-r<r-s*s?e:s}function xC(i,e){ba.layerIndex=e;const t=i.layerInfo[mt.MAP][e];if(_(t.data))return pi(ba.offset,0,0),ba.tile=i,ba.scale=1,ba.sourceLod=i.lij,ba.sourceLayerInfo=t,ba;const r=t.upsampleInfo;if(_(r)){const s=r.tile.layerInfo[mt.MAP][e];return ba.tile=r.tile,as(ba.offset,r.offset),ba.scale=r.scale,ba.sourceLod=r.tile.lij,ba.sourceLayerInfo=s,ba}return null}function GS(i){return i.get("uid")}function nV(i){let e=i.blendMode!=="normal";return qf(i.parent)&&(e=nV(i.parent)||e),e}function aV(i,e){qf(i.parent)&&aV(i.parent,e);const t=GS(i);if(_(t)&&t!==""){const r=Jb.get(t);r?r.start=e:Jb.set(t,new Kce(e,e,i.blendMode,i.opacity))}}const ZD=new Array,KD=new Array,JD=new Array,Jb=new Map,Dm=new Array,ba={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},eL={offset:[0,0],scale:1},oV=200,TC=40,the=.8,ihe=10,I_=1e-6;function rhe(i,e,t){const r=e,s=t;let n=0,a=1/0;for(let o=0;o<3;++o){{const l=i[o];if(r[o]<l){if(s[o]<=I_)return!1;const c=(l-r[o])/s[o];n=Math.max(n,c)}else if(s[o]<=-I_){const c=(l-r[o])/s[o];a=Math.min(a,c)}if(n>a)return!1}{const l=i[o+3];if(r[o]>l){if(s[o]>=-I_)return!1;const c=(l-r[o])/s[o];n=Math.max(n,c)}else if(s[o]>=I_){const c=(l-r[o])/s[o];a=Math.min(a,c)}if(n>a)return!1}}return!0}let tL=class{constructor(e,t,r,s,n){this.aabb=e,this.axis=t,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},$A=class HS{constructor(e,t,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=t,this.positionAttribute=s,this._rayDirection=E(),this.bspNodeTree=new Array;const n=r-t,a=n<=lV?new Uint16Array(n):new Uint32Array(n);this.indices=a;for(let o=0;o<n;++o)a[o]=o;{const o=lhe(e,t,r,s.data,s.stride),l=ie(Math.log2(n/TC),2,ihe),c=(h,u,m)=>{const f=ahe(a,o,h,u),y=u-h;if(y<=TC){const S=new tL(f,void 0,0,h,u);return this.bspNodeTree.push(S),S}const{axis:g,midValue:v}=ohe(f),b=nhe(a,o,h,u,g,v),x=(S,P)=>{if(m>l)return;const A=P-S;return A<TC||A>=the*y?void 0:c(S,P,m+1)},w=new tL(f,g,v,b.next,b.mid);return this.bspNodeTree.push(w),w.leftNode=x(h,b.next),w.rightNode=x(b.mid,u),w};c(0,n,0),this.triangleVertexIndices=che(a,e,t,r)}}intersectRayTriangleRange(e,t){{if(e>=t)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,a=this._rayOrigin,o=a[0],l=a[1],c=a[2],h=this._rayDirection,u=h[0],m=h[1],f=h[2];for(let y=e,g=3*e;y<t;++y){let v=r[g++]*n;const b=s[v++],x=s[v++],w=s[v];v=r[g++]*n;const S=s[v++],P=s[v++],A=s[v];v=r[g++]*n;const M=S-b,O=P-x,I=A-w,N=s[v++]-b,F=s[v++]-x,V=s[v]-w,Q=m*V-F*f,ae=f*N-V*u,q=u*F-N*m,D=M*Q+O*ae+I*q;if(Math.abs(D)<=Number.EPSILON)continue;const H=o-b,G=l-x,B=c-w,le=H*Q+G*ae+B*q;if(D>0){if(le<0||le>D)continue}else if(le>0||le<D)continue;const ce=G*I-O*B,_e=B*M-I*H,j=H*O-M*G,de=u*ce+m*_e+f*j;if(D>0){if(de<0||le+de>D)continue}else if(de>0||le+de<D)continue;const te=(N*ce+F*_e+V*j)/D;if(te>=0){const me=this.indices[y]+this.firstTriangleIndex,ye=Uz(M,O,I,N,F,V,she);this._callback(te,ye,me,!1)}}}HS.numFacesTested+=t-e}intersectRay(e,t){HS.numFacesTested=0;const r=qe(e.r0[0],e.r0[1],e.r0[2]),s=qe(e.r1[0],e.r1[1],e.r1[2]),n=s[0]-r[0],a=s[1]-r[1],o=s[2]-r[2];if(n*n+a*a+o*o<I_)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=n,l[1]=a,l[2]=o;const c=this.triangleVertexIndices.length/3;this._callback=t;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(e,t,r){const s=this._rayOrigin,n=this._rayDirection;if(!rhe(e.aabb,s,n))return;const a=e.axis,o=e.d;if(s[a]<o||n[a]<0){const l=t,c=e.midStartIndex;if(l<c){const h=e.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[a]>o||n[a]>0){const l=e.rightStartIndex,c=r;if(l<c){const h=e.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};$A.numFacesTested=0;const she=E(),Lm=[1/0,1/0,1/0],$m=[-1/0,-1/0,-1/0];function nhe(i,e,t,r,s,n){let a=t,o=r;for(;a<o;){const c=i[a];e[6*c+s+3]<=n?++a:(--o,i[a]=i[o],i[o]=c)}let l=a;for(o=r;l<o;){const c=i[o-1];e[6*c+s]>=n?--o:(i[o-1]=i[l],i[l]=c,++l)}return{next:a,mid:l}}function ahe(i,e,t,r){if(r<=t)return gE(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*i[t];for(let n=0;n<3;++n)Lm[n]=e[s+0+n],$m[n]=e[s+3+n]}for(let s=t+1;s<r;++s){const n=6*i[s];for(let a=0;a<3;++a)Lm[a]=Math.min(Lm[a],e[n+0+a]),$m[a]=Math.max($m[a],e[n+3+a])}return gE(Lm[0],Lm[1],Lm[2],$m[0],$m[1],$m[2])}function ohe(i){const e=i[3]-i[0],t=i[4]-i[1],r=i[5]-i[2],s=e>t?e>r?0:t>r?1:2:t>r?1:r>e?2:0;return{axis:s,midValue:(i[s]+i[s+3])/2}}function lhe(i,e,t,r,s){const n=t-e,a=new Float32Array(6*n);for(let o=0;o<n;++o){const l=3*(o+e),c=i[l+0]*s,h=i[l+1]*s,u=i[l+2]*s;for(let m=0;m<3;++m){const f=r[c+m],y=r[h+m],g=r[u+m];a[6*o+m]=Math.min(f,y,g),a[6*o+3+m]=Math.max(f,y,g)}}return a}function che(i,e,t,r){const s=r-t;let n=0;for(let o=t;o<r;++o)for(let l=0;l<3;++l)n=Math.max(e[3*o+l],n);const a=n<=lV?new Uint16Array(3*s):new Uint32Array(3*s);for(let o=0;o<s;++o){const l=3*(i[o]+t);for(let c=0;c<3;++c){const h=e[l+c];a[3*o+c]=h}}return a}const lV=65535;let Ii=class extends gc{constructor(){super(...arguments),this.output=$.Color,this.overlayMode=oh.Disabled,this.tileBlendInput=sc.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!zt.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=zt.TERRAIN_USE_LEGACY_SHADING,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=di.Terrain}};d([L({count:$.COUNT})],Ii.prototype,"output",void 0),d([L({count:oh.COUNT})],Ii.prototype,"overlayMode",void 0),d([L({count:sc.COUNT})],Ii.prototype,"tileBlendInput",void 0),d([L()],Ii.prototype,"spherical",void 0),d([L()],Ii.prototype,"doublePrecisionRequiresObfuscation",void 0),d([L()],Ii.prototype,"atmosphere",void 0),d([L()],Ii.prototype,"receiveShadows",void 0),d([L()],Ii.prototype,"hasSlicePlane",void 0),d([L()],Ii.prototype,"backfaceCullingEnabled",void 0),d([L()],Ii.prototype,"stencilEnabled",void 0),d([L()],Ii.prototype,"textureFadingEnabled",void 0),d([L()],Ii.prototype,"renderOccluded",void 0),d([L()],Ii.prototype,"hasScreenSpaceReflections",void 0),d([L()],Ii.prototype,"hasCloudsReflections",void 0),d([L()],Ii.prototype,"shading",void 0),d([L()],Ii.prototype,"useLegacyTerrainShading",void 0),d([L()],Ii.prototype,"invisible",void 0),d([L()],Ii.prototype,"tileBorders",void 0),d([L()],Ii.prototype,"visualizeNormals",void 0),d([L()],Ii.prototype,"screenSizePerspective",void 0),d([L()],Ii.prototype,"receiveAmbientOcclusion",void 0),d([L({count:di.COUNT})],Ii.prototype,"pbrMode",void 0),d([L({constValue:ho.CompressedAttribute})],Ii.prototype,"normalType",void 0),d([L({constValue:zd.Compressed})],Ii.prototype,"textureCoordinateType",void 0),d([L({constValue:!1})],Ii.prototype,"highStepCount",void 0),d([L({constValue:!1})],Ii.prototype,"useCustomDTRExponentForWater",void 0),d([L({constValue:!1})],Ii.prototype,"useFillLights",void 0);const CC=7,hhe=10,EC=zs();var Mr;(function(i){i[i.Opaque=0]="Opaque",i[i.Semitransparent=1]="Semitransparent",i[i.TransparentWithDraped=2]="TransparentWithDraped",i[i.Empty=3]="Empty"})(Mr||(Mr={}));let qn=class extends ge{get _isGlobal(){return this._stage.viewingMode===Se.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}constructor(e){super(e),this.type=Ri.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ii,this._passParameters=new FU,this._rctx=null,this._renderDataPool=new Qo(rce),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new RU,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=Mr.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=hr.Occlude}initialize(){const e=[ne.OPAQUE_TERRAIN,ne.TRANSPARENT_TERRAIN,ne.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),tle()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===Mr.TransparentWithDraped||e===Mr.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return vd}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?kb:hr.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,_(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Ve.TEXTURE_FADING)}updateTileTexture(e,t){_(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,t===Ve.TEXTURE_FADING?wr.FADING:wr.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const r of e.layerInfo[mt.ELEVATION])r.pendingUpdates&=~Ve.GEOMETRY;e.resetPendingUpdate(Ve.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=hhe-CC,r=Math.max(0,Math.floor((e.level-t)/CC)*CC);if(this._isGlobal&&r===0)return Va;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=dr.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=dr.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=dr.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new Jce(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=VF(this._rctx)}uninitializeRenderContext(){this._emptyTex=Le(this._emptyTex),this._tileRenderer=Le(this._tileRenderer)}intersect(e,t,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==Mr.Opaque)return;const n=dhe,a=uhe;ee(n,s,r),Z(a,1/n[0],1/n[1],1/n[2]);const o=e.results.min,l=e.results.max,c=e.results.ground,h=e.options.store===rs.MIN,u=!!e.results.ground.target,m=_k(e.verticalOffset),f=e.tolerance;let y,g=h&&_(o.dist)?o.dist:1/0;const v=x=>{const w=x.renderData;if(!(w!=null&&w.vao))return;const S=w.geometryInfo;W2(EC,S.boundingBox);const P=w.localOrigin;_(m)&&(m.localOrigin=P,m.applyToAabb(EC));const A=EC;if(Fm[0]=r[0]-P[0],Fm[1]=r[1]-P[1],Fm[2]=r[2]-P[2],!UF(A,Fm,a,f,g))return;const M=(q,D,H)=>{q.set(this.type,x,D,H,Bd),g=h&&_(o.dist)?o.dist:1/0},O=(q,D)=>{if(_(D)&&q>=0&&(e.options.backfacesTerrain||oe(D,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(r,s,q))){if((c.dist==null||q<c.dist)&&M(c,q,D),e.options.isFiltered)return;e.options.store===rs.ALL&&(T(y)?(y=SR(e.ray),M(y,q,D),e.results.all.push(y)):q<y.dist&&M(y,q,D)),(o.dist==null||q<o.dist)&&M(o,q,D),e.options.store!==rs.MIN&&(l.dist==null||q>l.dist)&&M(l,q,D)}},I=phe;ee(I,s,P);const N=S.indices,F=S.vertexAttributes,V=F.getField(C.POSITION,Hd),Q=new Ae(V.typedBuffer,3,!1,F.stride/4),ae=S.indexCount/3;if(T(m)&&ae>oV){const q=x.renderData;T(q.intersectionData)&&(q.intersectionData=new $A(N,0,ae,Q)),q.intersectionData.intersectRay({r0:Fm,r1:I},O)}else $2(Fm,I,0,ae,N,Q,null,m,O)},b=this._rootTiles;_(b)&&(()=>{const x=this._tileIterator;x.reset(b);const w=e.options.invisibleTerrain;for(let S=x.next();S;S=x.next())!(S.visible||w&&S.intersectsClippingArea)||!_(m)&&!S.intersectsRay(r,n,f,g)||u&&this._useStencilForTile(S)?x.skipSubtree():v(S)})()}processScaleRangeQueries(e,t){var r;if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(const s of this._patchGroups.values())for(const n of s)_((r=n.renderData)==null?void 0:r.textureReference)&&e.queriesForTile(n);e.process(),t.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===ne.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&kb))return null}else{const t=this.transparency===Mr.Opaque?ne.OPAQUE_TERRAIN:ne.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.output){case $.Color:return this.transparency===Mr.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=_(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?oh.Disabled:this._overlayRenderer.hasWater?oh.EnabledWithWater:oh.Enabled,this._updateTechnique($.Color,e.bindParameters.slot===ne.OCCLUDED_TERRAIN));case $.Shadow:case $.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique($.Shadow,!1)):null;case $.Depth:return this.transparency===Mr.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique($.Depth,!1));case $.Normal:return this.transparency===Mr.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique($.Normal,!1));case $.ObjectAndLayerIdColor:return this.transparency===Mr.Empty?null:this._updateTechnique($.ObjectAndLayerIdColor,!1);case $.Highlight:return this.transparency!==Mr.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique($.Highlight,!1)):null}return null}render(e,t){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case $.Color:{const s=e.bindParameters.slot===ne.OCCLUDED_TERRAIN?Kn.Occluded:Kn.ColorAndWater;this.transparency===Mr.Opaque?this._renderMaterialPass(e,t,s):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,t,s),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case $.Depth:case $.Normal:this._renderAuxiliaryPass(e,t,Kn.None);break;case $.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,t,Kn.Highlight);break;case $.Shadow:case $.ShadowExcludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,Kn.None);break;case $.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,Kn.ObjectAndLayerIdColor)}}_renderMaterialPass(e,t,r){const{rctx:s}=e;this._passParameters.overlaySource=r,s.bindTechnique(t,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,t,r)}_renderAuxiliaryPass(e,t,r){const s=e.rctx;this._passParameters.overlaySource=r,s.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,r)}updateTileBackground(e=null){if(T(this._tileRenderer))return;const t=this._tileRenderer;let r=null;if(_(e)){const s=li.toUnitRGBA(e);r=qe(s[0]||0,s[1]||0,s[2]||0)}t.setBackground(r),this._allTiles.forAll(s=>t.updateTileTexture(s,wr.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?sc.GridComposite:_(t.backgroundColor)?sc.ColorComposite:sc.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==sg.NONE){const e=Array.from(this._patchGroups.values()),t=this._stencilEnabledLayerExtents;for(const r of e)AU(this.renderOrder,r,t);e.sort((r,s)=>PU(r[0],s[0],this.renderOrder)),this._patchGroups=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!T(e)){(t=e[0])==null||t.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const r=t.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}if(!r.visible){this._numTilesCulled++,t.skipSubtree();continue}const n=s.localOrigin;let a=this._patchGroups.get(n);a||(a=new Array,this._patchGroups.set(n,a)),a.push(r),(!this._highestVisibleLODTile||r.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=r),t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,r){const s=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const a=n[0].renderData.localOrigin;t.program.bindDraw(new bS(a),e.bindParameters,this._passParameters);for(let o=0;o<n.length;o++)this._renderPatch(e,t,n[o],bt.TRIANGLES,s,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,r){const s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const u=FF(this._stage.viewingMode,this._ellipsoidRadius),m=this.pointsOfInterest.centerOnSurfaceFrequent.distance;u.update({distance:m,fovY:s.fovY})}const a=this._stencilEnabledLayerExtents.length>0,o=r===Kn.Occluded;o&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",Va),n.setUniform4fv("texOffsetAndScale",Cf));const l=_(this._tileRenderer)&&_(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:Va;this._techniqueConfiguration.tileBlendInput===sc.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?bt.LINES:bt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const h=this._patchGroups;for(const u of h.values()){const m=u[0].renderData.localOrigin;t.program.bindDraw(new bS(m),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const f of u){const y=f.renderData,g=y.textureReference;if(!T(g)){if(!o){n.setUniform4fv("texOffsetAndScale",g.offsetAndScale),n.bindTexture("tex",g.texture.texture);const v=y.textureFadeFactor,b=v<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(b)&&v<1?(n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),n.setUniform3fv("nextTexOpacities",b.opacities),n.bindTexture("texNext",b.texture.texture)):n.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",g.opacities)}this._renderPatch(e,t,f,c,a,r),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,r,s,n,a){const o=r.renderData,l=o.vao,c=l.indexBuffer;if(T(c))return void(Er&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const h=t.program;a===Kn.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(h,o.overlay),n&&(t.useStencil=this._useStencilForTile(r),t.bindPipelineState(e.rctx,e.bindParameters.slot));const u=o.geometryInfo.indexCount;e.rctx.bindVAO(l),h.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,u,c.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===$.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(NU,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};d([p({constructOnly:!0})],qn.prototype,"_overlayRenderer",void 0),d([p({constructOnly:!0})],qn.prototype,"_stage",void 0),d([p({readOnly:!0})],qn.prototype,"_isGlobal",null),d([p({constructOnly:!0})],qn.prototype,"_allTiles",void 0),d([p({constructOnly:!0})],qn.prototype,"_ellipsoidRadius",void 0),d([p({value:!1})],qn.prototype,"renderingDisabled",null),d([p()],qn.prototype,"renderPatchBorders",null),d([p()],qn.prototype,"visualizeNormals",null),d([p()],qn.prototype,"cullBackFaces",null),d([p({value:sg.FRONT_TO_BACK})],qn.prototype,"renderOrder",null),d([p()],qn.prototype,"wireframe",null),qn=d([k("esri.views.3d.terrain.TerrainRenderer")],qn);const dhe=E(),uhe=E(),Fm=E(),phe=E();let mhe=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Nl=class extends ge{constructor(e){super(e),this._handles=new mi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(z(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=we(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!k_(t)||t.isRejected())&&!(t.isFulfilled()&&!fhe(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||jb(t)))),e)if(e.isResolved()){const t=jw(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const r=new Jn(t.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Se.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Jn.makeWebMercatorAuxiliarySphere(t):up(e.spatialReference)&&(e=Jn.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(z(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Se.Global){const e=this.extentHelper.viewSpatialReference,t=up(e)||t0(e)||i0(e);e.isWebMercator?this.tilingScheme=Jn.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Jn.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!np(e,this.extent)&&(this.tilingScheme=Jn.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function fhe(i,e,t){return _(jw(i,e,t))}d([p()],Nl.prototype,"tilingScheme",void 0),d([p({readOnly:!0})],Nl.prototype,"extent",void 0),d([p({value:!1})],Nl.prototype,"tilingSchemeLocked",void 0),d([p({constructOnly:!0})],Nl.prototype,"viewSpatialReference",void 0),d([p({constructOnly:!0})],Nl.prototype,"layers",void 0),d([p({constructOnly:!0})],Nl.prototype,"extentHelper",void 0),d([p({constructOnly:!0})],Nl.prototype,"viewingMode",void 0),Nl=d([k("esri.views.3d.terrain.TilingSchemeLogic")],Nl);let ghe=class{constructor(){this.offset=Ne(),this.scale=0,this.tile=null}init(e,t,r,s){this.tile=e,this.offset[0]=t,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},st=class extends Br.EventedMixin(ge){constructor(i){var e,t;super(i),this._scaleRangeQueries=new U1,this._iteratorPool=new Qo(RU,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new ole,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new mhe,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=E(),this._eyePosSurfaceSR=E(),this._splitLimits=new Rce,this._frustum=xy(),this._viewProjectionMatrix=ve(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new mi,this._watchUpdatingTracking=new og,this._frameTask=tb,this._allTiles=new Ht,this._upsampleInfoPool=new Qo(ghe),this._rootTilesExtent=Ot(),this.updatingProgress=0,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=ci.WebMercator,this.visibleElevationBounds=new xf(1/0,-1/0),this.rootTileElevationBounds=new xf(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((t=(e=i.view)==null?void 0:e.state)!=null&&t.isLocal)}initialize(){this._lercDecoder=BG(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Qo(Tce):new Qo(Ece);const i=this.view.resourceController.memoryController;this._upsampleMapCache=i.newCache("esri.views.3d.terrain.upsample",n=>n.unloadMapData()),this._elevationQueryCache=new Ioe(i.newCache("elevation-query")),this._set("overlayManager",new yn({surface:this})),this._handles.add([z(()=>this.overlayManager.hasHighlights,n=>this._renderer.setNeedsHighlight(n)),z(()=>this.overlayManager.rendersOccluded,n=>this._renderer.setRenderOccludedOverlay(n)),z(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new qn({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:qt(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([z(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?wr.UNFADED:wr.IMMEDIATE)},er),z(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?wr.UNFADED:wr.IMMEDIATE),er),z(()=>this.renderingDisabled,()=>{var n,a;return(a=(n=this.view)==null?void 0:n._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},ii),z(()=>this.backgroundColor,n=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(n)},er),z(()=>this.snapLevel,()=>this._viewChanged=!0,ii),z(()=>this.view.pointsOfInterest,n=>{this._renderer.pointsOfInterest=n,this._watchUpdatingTracking.removeAll(),n&&this._watchUpdatingTracking.add(()=>n.focus.renderLocation,()=>this._allTilesSorted=!1)}),z(()=>zt.TERRAIN_TILE_TREE_SHOW_TILES,n=>{n&&!this._treeDebugger?Y(()=>import("./TerrainTileTree3DDebugger-95969872.js"),["./TerrainTileTree3DDebugger-95969872.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./reactiveUtils-53e5756b.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./TileTreeDebugger-66028ce4.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js"],import.meta.url).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&zt.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):n||(this._treeDebugger=we(this._treeDebugger))},Je)]);const{spatialReference:e}=this.view;this._extentHelper=joe(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:e});const t=new ib({getCollections:()=>{var n,a,o;return(o=(a=(n=this.view)==null?void 0:n.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:o.map(({layers:l})=>l)},getChildrenFunction:n=>n&&"layers"in n?n.layers:null}),r=new Nl({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:e});this._set("tilingSchemeLogic",r),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Zl.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Zl.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(rr.TERRAIN_SURFACE,this),this._handles.add([z(()=>this._extentHelper.stencilEnabledExtents,n=>this._renderer.setStencilEnabledLayerExtents(n),Je),z(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),ii),z(()=>this.extent,()=>this._updateRootTiles(),Je),this.view.on("resize",()=>this._viewChangeUpdate()),z(()=>{var o,l;const n=this.view,a=n.state;return[this._lodBias,this.lodSnapping,(l=(o=n.resourceController)==null?void 0:o.memoryController)==null?void 0:l.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),er),z(()=>{var n,a;return(a=(n=this.view.qualitySettings)==null?void 0:n.tiledSurface)==null?void 0:a.textureFadeDuration},n=>this._renderer.textureFadingEnabled=n>0,Je),z(()=>{var n;return(n=this.view.qualitySettings)==null?void 0:n.physicallyBasedRenderingEnabled},n=>this._renderer.pbrMode=n?di.Terrain:di.Disabled,Je),z(()=>this._userClippingExtent,()=>this._updateClippingExtent(),ii)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([z(()=>{var n;return(n=this.view)==null?void 0:n.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=gr(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=we(this._upsampleMapCache),this._elevationQueryCache=we(this._elevationQueryCache);const i=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",we(this.tilingSchemeLogic)),i.destroy(),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",we(this.overlayManager)),this._tilePool=we(this._tilePool),RA.prune(),this._treeDebugger=we(this._treeDebugger),this._renderer=we(this._renderer),this._iteratorPool=we(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=we(this._upsampleInfoPool),Goe(),Fle()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var i,e;if(this.lodSnapping===iy.ON){const t=this.view,r=this.tilingScheme,s=(e=(i=t.pointsOfInterest)==null?void 0:i.cameraOnSurface)==null?void 0:e.scale;if(s&&r){const n=t.state.contentCamera;let a=Nw(t,n.eye,n.viewForward,n.up).tilt;a>90&&(a=180-a);const o=2*(a/90)**2,l=r.levelAtScale(s)-o;return Math.round(l)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?iy.ON:iy.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:i}=this,{clippingArea:e}=this.view;if(T(e)||T(i))return null;const t=Ot(),r=cU(e,t,i)?t:null,s=this._get("extent");return np(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const i=tE(this.groundExtent,this._userClippingExtent,Ot()),e=this._get("extent");return np(i,e)?e:i}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var i;return(i=this.tilingSchemeLogic)==null?void 0:i.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(i){this.view.map.ground.opacity=i}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this._rootTiles)}set renderOrder(i){this._renderer.renderOrder=i,this._set("renderOrder",i)}get rootTiles(){return this._rootTiles}get spatialReference(){var i;return((i=this.tilingScheme)==null?void 0:i.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(i){this.view.map.ground.surfaceColor=i}set slicePlaneEnabled(i){this._renderer.slicePlaneEnabled=i,this._set("slicePlaneEnabled",i),this._evaluateTransparency()}get tilingSchemeLocked(){var i;return((i=this.tilingSchemeLogic)==null?void 0:i.tilingSchemeLocked)??!1}set velvetOverground(i){this._renderer.velvetOverground=i,this._set("velvetOverground",i)}get wireframe(){return this._renderer.wireframe}set wireframe(i){i!==this._renderer.wireframe&&(this._renderer.wireframe=i,this._updateAllTileGeometries())}set _visible(i){i!==this._visibleCached&&(this._visibleCached=i,this._renderer.setVisibility(i),this.suspended=!i)}get opaque(){return this._renderer.transparency===Mr.Opaque}set suspended(i){this._set("suspended",i),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(i,e,t,r){this._renderer.intersect(i,e,t,r)}getElevation(i,e,t,r){const s=this._rootTiles;if(T(s)||!s.length||s[0].layerInfo[mt.ELEVATION].length===0)return null;const n=dn;return n[0]=i,n[1]=e,n[2]=t,vs(n,r,n,this._spatialReference)?rL(s,n[0],n[1]):(pe.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(i,e,t){const r=this._rootTiles,s=r?r[0].layerInfo[mt.ELEVATION].length:0;if(!T(r)&&r.length&&s!==0)for(let n=0;n<e;++n){const a=3*n;t(n,rL(r,i[a+0],i[a+1]))}else for(let n=0;n<e;++n)t(n,null)}getScale(i){if(!this.tilingScheme)return null;if(!xs(i,dn,this.spatialReference))return pe.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(_(e)){for(const t of e)if(t!=null&&t.containsPoint(dn)){let r=t;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;dn[0]>s[2]&&(n+=1),dn[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}getSphereElevationBounds(i,e,t,r,s){var c;if(dn[0]=i,dn[1]=e,dn[2]=t,dn[3]=r,!vs(dn,s,dn,(c=this.tilingScheme)==null?void 0:c.spatialReference))return pe.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,a=-1/0;const o=h=>{if(h&&cP(h.extent,dn))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),a=Math.max(a,h.elevationBounds[1]);else for(const u of h.children)o(u)},l=this._rootTiles;if(_(l))for(const h of l)o(h);return{min:n,max:a}}getSphereScale(i,e){if(!this.tilingScheme)return null;if(!xs(i,dn,this.spatialReference))return pe.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;dn[3]=e;let t=null;const r=n=>{if(n&&cP(n.extent,dn)){const a=n.children;if(a[0]&&!n.rendered)for(const o of a)r(o);else{const o=this._getLodBiasCorrectedScale(n.level);t=t==null?o:Math.min(t,o)}}},s=this._rootTiles;if(_(s))for(const n of s)r(n);return t}queryVisibleScaleRange(i,e,t,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=t?this.tilingScheme.levelAtScale(t):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(i,s+a,n+a,r)}_evaluateTransparency(){var n,a;const i=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,t=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?Mr.Empty:Mr.TransparentWithDraped:i>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Mr.Opaque:Mr.Semitransparent,s=t!==r;return s&&(this._renderer.transparency=r,(a=(n=this.view)==null?void 0:n._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var t,r,s;const i=this.tilingSchemeLogic.tilingScheme;if(i===this.tilingScheme)return;jl(!!i,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(t=this.view)==null?void 0:t.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(i==null?void 0:i.spatialReference)??ci.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&A$((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",i),this._updateClippingExtent(),i&&(this._updateTiledLayers(),this._renderer.setTileSize(i.pixelSize),this.overlayManager.setSpatialReference(i.spatialReference),this._updateRootTiles())}_acquireTile(i,e,t,r){const s=this._tilePool.acquire();return Hv[0]=i,Hv[1]=e,Hv[2]=t,s.init(Hv,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:i,tilingScheme:e}=this;if(!e)return;const t=vhe;let r=e.rootTilesInExtent(i,t,5*df);if(_(this._rootTiles)){if(r.length>df)return void pe.getLogger(this.declaredClass).warn(nj);const s=this._rootTiles.map(a=>a.lij),n=I8(s,r,iL);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const a=this._rootTiles.filter(o=>!(n.removed.findIndex(l=>iL(l,o.lij))>-1)||(this._purgeTile(o),!1));n.added.forEach(o=>a.push(this._newRootTile(o))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,r.length>df&&(pe.getLogger(this.declaredClass).warn(aj),r=e.rootTilesInExtent(i,t,df)),this._setRootTiles(r.map(s=>this._newRootTile(s)));np(t,this._rootTilesExtent)||(this._rootTilesExtent=Ot(t)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const i=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);i.forEach(e=>this._renderer.updateTileGeometryState(e)),i.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(i),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(i){if(i.length===0)return;i.sort(ah);const e=this.renderer;i.forEach(t=>e.updateGeometryIfNeeded(t)),i.forEach(t=>this._pendingTilesForElevationUpdateEvent.add(t))}_shouldSplit(i){return i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Ve.SPLIT}_newRootTile(i){const e=this._acquireTile(0,i[1],i[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(Ve.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(i){if(this._rootTiles=i,this._allTiles.clear(),_(i)){const e=this._iteratorPool.acquire();for(e.reset(i);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(i)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(i){i.updateClippingStatus(this.extent)&&i.resetPendingUpdate(Ve.GEOMETRY)&&this._updateTileGeometryState(i)}_updateTilesVisibility(i){if(T(i))return;const e=mle(i),t=this.visibleElevationBounds;let r=e?t.min:1/0,s=e?t.max:-1/0;const n=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const o=this._iteratorPool.acquire();for(o.reset(i);!o.done;){const l=o.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(Ve.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(Ve.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(a),l.renderData&&(r=Math.min(l.elevationBounds[0],r),s=Math.max(l.elevationBounds[1],s))}o.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(t.min!==r||t.max!==s)&&(this.visibleElevationBounds=new xf(r,s))}_updateRootTileElevationBounds(){let i=1/0,e=-1/0;const t=this._rootTiles;_(t)&&t.forEach(({elevationBounds:s})=>{i=Math.min(i,s[0]),e=Math.max(e,s[1])});const r=this.rootTileElevationBounds;r.min===i&&r.max===e||(this.rootTileElevationBounds=new xf(i,e))}_updateViewDependentParameters(){const{camera:i,contentCamera:e}=this.view.state,t=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*i.pixelRatio;this._splitLimits.aboveGround=i.aboveGround,this._splitLimits.fovX=t,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/i.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/i.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(T(this._splitLimits.frustum)&&(this._splitLimits.frustum=xy()),ob(this._splitLimits.frustum,e.frustum)):this._splitLimits.frustum=null,ob(this._frustum,i.frustum),Sr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),X(this._eyePosRenderSR,e.eye),vs(i.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(i){i.rendered&&!i.shouldLoad&&(cV(i)?this._loadChildren(i):yhe(i)&&this._loadParent(i))}_updateTileGeometryState(i){i.updateVisibility(),this._renderer.updateTileGeometryState(i)&&this._markTileToUpdate(i),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(i){const e=this._pendingTilesToUpdate;i.forEachLoadedNeighbor(t=>{e.add(t)})}_updateTileTexture(i,e){const t=i.resetPendingUpdate(Ve.TEXTURE_FADING)?Ve.TEXTURE_FADING:!!i.resetPendingUpdate(Ve.TEXTURE_NOFADING)&&Ve.TEXTURE_NOFADING;t&&(this._renderer.updateTileTexture(i,t),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){const i=RC.extent;nl(i),this._pendingTilesForElevationUpdateEvent.forEach(e=>Od(i,e.extent,i)),this._pendingTilesForElevationUpdateEvent.clear(),RC.spatialReference=this.spatialReference,this.emit("elevation-change",RC)}runTask(i){this._handleLayerViewChanges(i),this._frameTask.processQueue(i),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,i),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(i),this._sortTiles(i);const e=!this.view.state.fixedContentCamera;this._mergeAndSplit(i,e),this._updateElevation(i),this._updateTextures(i),e||this._mergeAndSplit(i,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),i.done&&i.hasProgressed?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(i){if(!this._viewChanged||!this._rootTiles||i.done)return;this._viewChanged=!1;const e=this._iteratorPool.acquire();e.reset(this._rootTiles);const t=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;for(;!e.done;){const n=e.next(),a=n.shouldSplit(r,s,t);if(a!==Ve.SPLIT){if(n.resetPendingUpdate(Ve.SPLIT)&&n.updateAgentSuspension(),a===Ve.VSPLITMERGE&&n.updateAgents(mt.ELEVATION),e.skipSubtree(),!n.isLeaf){n.setPendingUpdate(Ve.MERGE),n.resetPendingUpdate(Ve.SPLIT);const o=this._iteratorPool.acquire();o.resetOne(n);const l=this._viewProjectionMatrix;for(let c=o.next();!o.done;c=o.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);o.remove()}}else n.resetPendingUpdate(Ve.MERGE),n.isLeaf&&(n.setPendingUpdate(Ve.SPLIT),e.skipSubtree()),n.rendered&&n.setPendingUpdate(Ve.RENDERDATA)}e.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),i.madeProgress()}_sortTiles(i){i.done||this._allTilesSorted||(ule(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),i.madeProgress())}_markTileToUpdate(i){se(i.isLoaded),i.intersectsClippingArea&&(this._pendingTilesToUpdate.add(i),this._markAllTileNeighborsForGeometryUpdate(i))}_batchUpdatePendingTileGeometries(){const i=this._pendingTilesToUpdate;if(i.size===0)return;const e=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),t=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||i.has(n)||(i.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(ah);const r=e.length;for(let s=0;s<r;++s){const n=e[s];se(n.isLoaded),se(n.intersectsClippingArea);const a=n.renderData;a.updateNeighborData();const o=a._dirtyEdgeResolutions,l=a.geometryState.neighborData;for(let c=0;c<4;++c)if(o&1<<c){const h=a.geometryState.neighborData.edgePeerNeighbors[c];h&&(h==null?void 0:h.level)>=n.level&&h.forAllSubtreeOnSide(Yb(rc[c]),u=>!(!u.isLoaded||!u.intersectsClippingArea)&&(se(i.has(u)||ah(n,u)<0),t(n,u),!0)),t(n,l.cornerPeerNeighbors[c]),t(n,l.cornerPeerNeighbors[(c+1)%4])}}i.clear(),this._updateTilesGeometries(e),Er&&Wb&&this.checkAllTilesWaterproofness()}_mergeAndSplit(i,e){if(this.suspended||i.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let t=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!i.done;){s=!0;let n=!1;const a=!this._allTiles.some(o=>{var c;if(!t&&!r&&!o.visible)return i.done;let l=o;if(o.resetPendingUpdate(Ve.MERGE)){if(!e)return o.setPendingUpdate(Ve.MERGE),i.done;for(;(c=l.parent)!=null&&c.resetPendingUpdate(Ve.MERGE);)l=l.parent;this._mergeTile(l),n=!0,i.madeProgress()}else o.resetPendingUpdate(Ve.SPLIT)&&(this._splitTile(o),n=!0,i.madeProgress());return!i.done&&l===o&&o.resetPendingUpdate(Ve.RENDERDATA)&&(this._updateRenderData(o),i.madeProgress()),i.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!t){t=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?i.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(i)}_updateElevation(i){i.done||(this._allTiles.some(e=>(e.resetPendingUpdate(Ve.GEOMETRY)&&(this._updateTileGeometryState(e),this._updateTileTexture(e,i),this.shortBatches&&this._batchUpdatePendingTileGeometries(),i.madeProgress()),i.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(i){i.done||this._allTiles.some(e=>(this._updateTileTexture(e,i),i.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(dr.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const i=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-i)*rj}_getLodBiasCorrectedScale(i){const e=this.tilingScheme.levels,t=ie(i-this._lodBias,0,e.length-1),r=t-Math.floor(t);return e[Math.floor(t)].scale*(1-r)+e[Math.ceil(t)].scale*r}_removeAllTiles(){_(this._rootTiles)&&(this._rootTiles.forEach(i=>this._purgeTile(i)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(i){if(!i.children[0])return!1;let e=!1;for(let t=0;t<4;++t)e=this._purgeTile(i.children[t])||e;return i.unsetChildren(),e}_purgeTile(i){const e=this._purgeDescendantTiles(i)||i.rendered;return this._allTiles.removeUnordered(i),this._unloadTile(i),this._tilePool.release(i),e}_unloadTile(i){this._pendingTilesToUpdate.delete(i),this._pendingTilesForElevationUpdateEvent.delete(i),i.unload(this._renderer)}_splitTile(i){jl(i.isLeaf,"tile that is already split should not be split again!");const e=i.level+1,t=2*i.lij[1],r=2*i.lij[2];i.setChildren(this._createTile(e,t,r,i),this._createTile(e,t,r+1,i),this._createTile(e,t+1,r,i),this._createTile(e,t+1,r+1,i)),i.setPendingUpdate(Ve.RENDERDATA),i.updateAgentSuspension(),this._allTiles.pushArray(i.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(i,e=i.level){qv.spatialReference=this.spatialReference,qv.extent=i.extent,qv.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",qv)}_createTile(i,e,t,r){jl(!!r,"_createTile sanity check");const s=this._acquireTile(i,e,t,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Ve.SPLIT),s}get shortBatches(){return this.view.state.mode!==bi.IDLE}_mergeTile(i){jl(!i.hasPendingUpdate(Ve.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(i)&&(jl(!i.renderData,"_mergeTile sanity check"),this._loadTile(i),this._markTileToUpdate(i),this._emitTileScaleChange(i),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(i){jl(i.rendered,"parent should be rendered"),this._unloadTile(i);const e=i.children;e.forEach(t=>this._loadTile(t)),e.forEach(t=>this._pendingTilesToUpdate.add(t)),this._markAllTileNeighborsForGeometryUpdate(i),this._emitTileScaleChange(i,i.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(i){const e=i.parent;this._unloadChildren(e),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e,e.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(i){const e=i.children;if(e[0])for(let t=0;t<4;++t){const r=e[t];this._unloadChildren(r),this._unloadTile(r)}}_loadTile(i){i.load(),i.setPendingUpdate(Ve.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(i)}_elevationDataArrived(i,e,t){const r=new qoe(i.lij,i.extent,t);i.dataArrived(e,mt.ELEVATION,r);const s=[i],n=i.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const o=a.next();o.findElevationBoundsForLayer(e,n),o.computeElevationBounds()}n===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(i=ta){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const t=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(t.add(s.uid),jy(s)||Zg(s))if(this._basemapLayerViewHandles.has(s.uid)&&!Zg(s)){const n=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(n,s.uid);_(a)&&((a<r||T(r))&&(e=!0),r=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(e=!0);this._basemapLayerViewHandles.forEach((s,n)=>{t.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),i.madeProgress()}_allSurfaceLayersTransparent(){var e,t;let i=((t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.opacity)===0;for(const r of this.view.allLayerViews.items)if(LS(r)&&!rF(r.layer)&&r.fullOpacity!==0)return i=!1,i;return i}_hasCompositeBlendMode(){for(const i of this.view.allLayerViews.items)if((Xb(i)||Zg(i))&&ble(VS[i.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(i){return DS(i)?mt.ELEVATION:mt.MAP}_registerTiledLayerView(i){const e=[];if((Xb(i)||Zg(i))&&e.push(z(()=>i.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(wr.UNFADED)})),Zg(i))return;const t=this._layerClassFromLayerView(i);e.push(z(()=>i.suspended,()=>this._updateTiledLayers())),e.push(z(()=>i.fullOpacity,()=>this._updateTileTextures(wr.UNFADED))),e.push(z(()=>"effectiveScaleRange"in i.layer?i.layer.effectiveScaleRange:null,()=>this._restartAllAgents(t))),i.on("data-changed",()=>{const r=this._getLayerIdxByUID(t,i.uid);_(r)&&this._invalidateLayerData(r,t)}),this._basemapLayerViewHandles.set(i.uid,e)}_unregisterTiledLayerView(i){const e=this._basemapLayerViewHandles.get(i);if(e){for(let t=0;t<e.length;t++)e[t].remove();this._basemapLayerViewHandles.delete(i)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const i=this.view.allLayerViews,e=[[],[]];let t=null;i.forEach(r=>{if(!r.layer||r.suspended||!jy(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===mt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(t===null||n>t)&&(t=n)}e[s].push(r)});for(const r of Vu){const s=this._layerViews[r],n=e[r];n.reverse();const a=n.length;let o=s.length!==a;const l=new Array(a),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<a;h++){const u=n[h].uid;this._layerIndexByUid[r].set(u,h);const m=s.indexOf(n[h]);l[h]=m,h!==m&&(o=!0),m>-1&&(c[m]=h)}if(o){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(t)&&this._viewChangeUpdate()}_restartAllAgents(i){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const t=e.next();t.restartAgents(i),i===mt.ELEVATION&&t.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(i,e){return this._layerViews[e][i]}numLayers(i){return this._layerViews[i].length}_updateTileTextures(i){this._allTiles.forAll(e=>{e.updateAgents(mt.MAP),i===wr.IMMEDIATE?this.renderer.updateTileTexture(e,Ve.TEXTURE_NOFADING):e.updateRenderData(mt.MAP,i)}),this._evaluateTransparency()}_invalidateLayerData(i,e){this._allTiles.forAll(t=>t.removeLayerAgent(i,e)),this._allTiles.forAll(t=>t.invalidateLayerData(i,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(i=dr.UPDATE){this.renderer.setNeedsRender(i)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(i,e,t,r){const s=this.layerViewByIndex(e,t),n=s.layer;return!n.tilemapCache||Wy(s)?this._requestTileData(i,t,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(i.lij[0],i.lij[1],i.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Ti(r),za(a)||this._dataMissing(i,t,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(i,t,s,r),r.signal)))}_requestTileData(i,e,t,r){return e===mt.ELEVATION?DS(t)?this._requestElevationTileData(i,t,r):Promise.reject():LS(t)?this._requestMapTileData(i,t,r):Promise.reject()}_requestElevationTileData(i,e,t){++this._asyncWorkItems;const r=a=>{if(Xo(t))return;const o=this._layerIndexByUid[mt.ELEVATION].get(e.uid);o!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(i,o,a)):pe.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",mt.ELEVATION,i.lij.toString())},s=a=>{za(a)||(this._dataMissing(i,mt.ELEVATION,e,a),this.requestUpdate())};if(CD(e.layer))return e.layer.fetchTile(i.lij[0],i.lij[1],i.lij[2],{noDataValue:Py,signal:t.signal}).then(a=>{if(!Xo(t))return this._frameTask.schedule(()=>r(a),t.signal,s);pe.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=e.getTileUrl(i.lij[0],i.lij[1],i.lij[2]);return this._elevationDataRequester.request(n,"binary",t).then(a=>this._lercDecoder.decode(a,{noDataValue:Py},t.signal)).then(a=>{a?r(new zG(a)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(i,e,t){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,Ff(h),Xo(t)||(this._dataMissing(i,mt.MAP,e,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Xo(t)?Ff(c):this._mapTileDataArrived(i,e,c)},t.signal,s(c)).catch(s(c)),a=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(Wy(e)){const c=e.schemaHelper.getLevelRowColumn(i.lij);return e.fetchTile(c[0],c[1],c[2],t).then(n,a)}if(Ww(e))return e.fetchTile(i.lij[0],i.lij[1],i.lij[2],t).then(n,a);if(xA(e)&&CD(e.layer))return e.layer.fetchTile(i.lij[0],i.lij[1],i.lij[2],t).then(c=>{if(Xo(t))return pe.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a($s());n(c)},a);let o=e.getTileUrl(i.lij[0],i.lij[1],i.lij[2]);VG(e.layer)&&e.layer.refreshTimestamp&&(o+=`${o.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(o,l,t).then(n,a)}_mapTileDataArrived(i,e,t){const r=this._getLayerIdxByUID(mt.MAP,e.uid);_(r)?i.dataArrived(r,mt.MAP,t):(Ff(t),pe.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(i,e){return this._layerIndexByUid[i].get(e)}_dataMissing(i,e,t,r){const s=this._getLayerIdxByUID(e,t.uid);_(s)?i.dataMissing(s,e,r):pe.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(i){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(i))}get performanceInfo(){const i=this._performanceInfo;return i.numNodes=this._allTiles.length,i.numLeaves=i.numVisible=i.numRendered=i.numLoadedPerLevel.length=i.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&i.numLeaves++;const t=e.level;e.renderData&&(i.numLoadedPerLevel[t]=(i.numLoadedPerLevel[t]||0)+1),e.visible&&(i.numVisible++,e.rendered&&(i.numRenderedPerLevel[t]=(i.numRenderedPerLevel[t]||0)+1,i.numRendered++))}),i}getUsedMemory(){return this.tilingScheme?(T(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),_(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((i,e)=>i+e.usedMemory,0):null}getUsedMemoryForLayerView(i){let e=0;const t=this._layerClassFromLayerView(i),r=this._getLayerIdxByUID(t,i.uid);return _(r)&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(t,r)),e}getTile(i){if(T(i)||T(this._rootTiles))return null;const e=i.split("/").map(a=>+a);if(e[0]===0)return this._rootTiles.find(a=>a.lij[1]===e[1]&&a.lij[2]===e[2]);const t=2**e[0],r=Math.floor(e[1]/t),s=Math.floor(e[2]/t);let n;if(this._rootTiles.some(a=>a.lij[1]===r&&a.lij[2]===s&&(n=a,!0)),n){let a=1<<e[0]-1;for(;n.lij[0]<e[0];){let o=e[1]&a?2:0;if((e[2]&a)>0&&o++,!n.children[o])return null;n=n.children[o],a>>=1}return jl(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(i){this._renderer.renderPatchBorders=i}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(i){this._renderer.visualizeNormals=i}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(i){this._renderer.renderingDisabled=i}get test(){const i=this;return{renderer:i._renderer,lercDecoder:i._lercDecoder,forceReload:()=>{_(i._rootTiles)&&i._rootTiles.length>0&&(i._mergeTile(i._rootTiles[0]),i._viewChangeUpdate())},getTiles:()=>i._allTiles.toArray(),getRenderedTiles(){SC.clear(),i._allTiles.forAll(t=>{t.visible&&t.rendered&&SC.push(t)});const e=SC.toArray();return AU(i.renderOrder,e),e},lockTilingScheme(e,t){i._extentHelper.defaultTiledLayersExtent=t,i.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!Wb)return;const i=this._rootTiles;if(T(i))return;const e=n=>{var a,o,l;return((l=(o=(a=n==null?void 0:n.renderData)==null?void 0:a.geometryInfo)==null?void 0:o.indices)==null?void 0:l.length)>0},t=(n,a)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",a.lij,"] has geom")},r=n=>{var a,o;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometryInfo&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((a=n.renderData)!=null&&a.geometryInfo)||(((o=n.renderData.geometryInfo.indices)==null?void 0:o.length)??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometryInfo),e(n)){n.checkGeometryWaterproofness();for(const l of n.children)t(l,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const l of n.children)r(l)},s=n=>{var c;const a=((c=n.parent)==null?void 0:c.visible)??!0,o=n.visible;n.computeVisibility();const l=n.visible;if(o!==l&&a&&console.error(" Tile[",n.lij,"] has out of date visibility: ",o," instead of ",l),!n.isLeaf)for(const h of n.children)s(h)};for(const n of i)r(n),s(n)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var e,t,r;((r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.shading)!==this._shading&&this._updateShading()}_updateShading(){var e,t,r;const i=(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.shading;this._shading=i,this.renderer&&(this.renderer.shading=i,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(i){return this.isGlobal&&i[2]===this.lijEastEnd(i[0])-1}isWestEndWrap(i){return this.isGlobal&&i[2]===0}lijEastEnd(i){return 2**(i+(_(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(i){const e=this.lijEastEnd(i[0]),t=i[2];if(0<=t&&t<e)return i;if(!this.isGlobal)return null;const r=(t+(t<0?e:0))%e;return[i[0],i[1],r]}enableInternalChecks(i){toe(i)}enableWaterproofnessChecks(i){eoe(i)}};d([p()],st.prototype,"_renderer",void 0),d([p({constructOnly:!0})],st.prototype,"_scaleRangeQueries",void 0),d([p()],st.prototype,"_hasPendingUpdates",void 0),d([p()],st.prototype,"_asyncWorkItems",void 0),d([p()],st.prototype,"_allTilesDirty",void 0),d([p()],st.prototype,"_allTilesSorted",void 0),d([p()],st.prototype,"_viewChanged",void 0),d([p({readOnly:!0})],st.prototype,"_watchUpdatingTracking",void 0),d([p()],st.prototype,"_frameTask",void 0),d([p({readOnly:!0})],st.prototype,"snapLevel",null),d([p({readOnly:!0})],st.prototype,"lodSnapping",null),d([p({constructOnly:!0})],st.prototype,"view",void 0),d([p()],st.prototype,"_userClippingExtent",null),d([p()],st.prototype,"_rootTilesExtent",void 0),d([p({readOnly:!0})],st.prototype,"extent",null),d([p({readOnly:!0})],st.prototype,"groundExtent",null),d([p({readOnly:!0})],st.prototype,"_tilingSchemeExtent",null),d([p({readOnly:!0})],st.prototype,"updating",null),d([p({readOnly:!0})],st.prototype,"running",null),d([p(Hoe)],st.prototype,"updatingProgress",void 0),d([p({readOnly:!0})],st.prototype,"updatingProgressValue",null),d([p()],st.prototype,"_maxNumUpdating",void 0),d([p()],st.prototype,"baseOpacity",null),d([p()],st.prototype,"hasCompositeBlendMode",void 0),d([p({readOnly:!0})],st.prototype,"overlayManager",void 0),d([p({readOnly:!0})],st.prototype,"viewingMode",null),d([p()],st.prototype,"maxTextureScale",void 0),d([p({readOnly:!0})],st.prototype,"ready",null),d([p({value:sg.FRONT_TO_BACK})],st.prototype,"renderOrder",null),d([p({readOnly:!0})],st.prototype,"rootTiles",null),d([p()],st.prototype,"_rootTiles",void 0),d([p({readOnly:!0})],st.prototype,"spatialReference",null),d([p({type:li})],st.prototype,"backgroundColor",null),d([p({value:!1})],st.prototype,"slicePlaneEnabled",null),d([p({readOnly:!0})],st.prototype,"tilingScheme",void 0),d([p({readOnly:!0})],st.prototype,"tilingSchemeLocked",null),d([p({readOnly:!0})],st.prototype,"tilingSchemeLogic",void 0),d([p({value:!0})],st.prototype,"velvetOverground",null),d([p()],st.prototype,"wireframe",null),d([p({value:!1})],st.prototype,"suspended",null),d([p()],st.prototype,"textureFadeDuration",null),d([p()],st.prototype,"visibleElevationBounds",void 0),d([p()],st.prototype,"rootTileElevationBounds",void 0),d([p()],st.prototype,"_layerViewsDirty",void 0),d([p()],st.prototype,"renderPatchBorders",null),d([p()],st.prototype,"visualizeNormals",null),d([p()],st.prototype,"renderingDisabled",null),st=d([k("esri.views.3d.terrain.TerrainSurface")],st);const _he=st;function iL(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]}function cV(i){const e=i.children;if(!e[0])return!1;for(const t of e)if(t.shouldLoad)return!0;for(const t of e)if(cV(t))return!0;return!1}function yhe(i){var e;return i.isLeaf&&(((e=i.parent)==null?void 0:e.shouldLoad)??!1)}const dn=Xt(),vhe=Ot(),Hv=[0,0,0],SC=new Ht,RC={spatialReference:null,extent:Ot(),context:"ground"},qv={spatialReference:null,extent:null,scale:0};function rL(i,e,t){var r;for(const s of i){if(!s.containsPointXY(e,t))continue;let n=s;for(;n&&!n.renderData;){const o=(e>n.extentMidX?1:0)+(t<n.extentMidY?2:0);n=n.children[o]}const a=((r=n==null?void 0:n.renderData)==null?void 0:r.geometryState.samplerData)??null;return xi(e,t,a)}return null}let bhe=class{constructor(e,t,r){this.operation=e,this.geometry=t,this.states=r}},D_=class extends ge{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const a=this._ensureGeomRecord(e,n);s.forEach(({geometry:o,operation:l,states:c},h)=>{let u=!1;if(l===Di.UPDATE){const m=a.get(h);if(m){if(c&Ir.TRANSFORMATION){const f=this.model.getObject(n);this.model.updateRenderGeometryTransformation(f,o,m)&&(u=!0)}u||t.updates.push({renderGeometry:m,updateType:c})}else _t(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===Di.REMOVE||u){const m=a.get(h);m?(t.removes.push(m),a.delete(h)):l===Di.REMOVE&&_t(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===Di.ADD||u){const m=this.model.getObject(n);if(_(m)){const f=this.model.getRenderGeometry(m,o);t.adds.push(f),a.set(h,f)}}}),a.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>t.push(n)))}_objectStateChanged(e,t){for(const r of t.geometries)this._updateOrCreateDirtyRecord(t,r,null,Di.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Ir.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Ir.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Ir.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Di.UPDATE,Ir.GEOMETRY)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const s of t.geometries)this._objectGeometryAdded(t,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const s of t.geometries)this._objectGeometryRemoved(t,s,r)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((r,s)=>{const n=this.model.getObject(s);n&&n.hasVolativeTransformation()&&r.forEach(a=>a.shaderTransformationChanged())})}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,t,Di.UPDATE,Ir.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,Di.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,Di.REMOVE)}_updateOrCreateDirtyRecord(e,t,r,s,n=Ir.NONE){r=Ze(r,this._getParentLayerId(e));const a=e.id,o=t.id,l=this._ensureDirtyRecord(r,a),c=l.get(o);if(c){const h=c.operation;h===Di.REMOVE&&s===Di.ADD&&c.states!==Ir.NONE?c.operation=Di.UPDATE:h===Di.REMOVE&&s===Di.ADD||h===Di.ADD&&s===Di.REMOVE?l.delete(o):h!==Di.UPDATE||s!==Di.REMOVE&&s!==Di.UPDATE?(_t((h===Di.REMOVE||h===Di.ADD)&&s===Di.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=n):(c.operation=s,c.states|=n)}else l.set(o,new bhe(s,t,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(t);return s||(s=new Map,r.set(t,s)),s}get _hasDirtyGeometryRecords(){return fs(this._dirtyGeomRecords,e=>fs(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(t);return s||(s=new Map,r.set(t,s)),s}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:w8}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,a)=>{t.length>0&&(t+=`
`),t+=s+"."+a;const o=[];n.forEach(l=>{const c=l.operation;o[c]||(o[c]=[]),o[c].push(l.geometry.id)});for(let l=0;l<o.length;l++)if(o[l]){t+=" "+e[l-1]+": ";for(let c=0;c<o[l].length;c++)t+=o[l][c]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,r)=>t+r.size,0)},commit:t=>e._dirtyGeomRecords.forEach((r,s)=>e.commitLayer(s,t))}}};d([p({constructOnly:!0})],D_.prototype,"model",void 0),d([p()],D_.prototype,"dirty",void 0),D_=d([k("esri.views.3d.webgl-engine.lib.ModelDirtySet")],D_);const whe=D_;let z1=class extends ge{constructor(){super(...arguments),this.dirtySet=new whe({model:this}),this._content=new Map,this._originFactory=new rA(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;_t(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),Bb(e)&&this.dirtySet.layerAdded(e)}remove(e){_t(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),Bb(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(_t(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)_t(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(r=>{r.type===e&&t(r)})}getRenderGeometry(e,t){const{shaderTransformer:r,localOrigin:s}=t,n=new rg(t,{boundingInfo:t.boundingInfo,shaderTransformer:r,castShadow:e.castShadow});return n.updateTransformation(a=>e.getCombinedStaticTransformation(t,a)),n.localOrigin=_(s)?s:this._originFactory.getOrigin(n.boundingSphere),n}updateRenderGeometryTransformation(e,t,r){if(T(e))return!1;r.updateTransformation(n=>e.getCombinedStaticTransformation(t,n));const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<Ns.COUNT;++r)e[r]=t.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};d([p({constructOnly:!0})],z1.prototype,"dirtySet",void 0),z1=d([k("esri.views.3d.webgl-engine.parts.Model")],z1);let xhe=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let t=0;for(let r=0;r<e.length;r+=2)t+=e[r+1];return t}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=The(e)}forEachComponent(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const s=t[r],n=s+t[r+1];for(let a=s;a<n;a++)if(!e(a))return!1}return!0}forEachComponentRange(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const s=t[r];if(!e(s,s+t[r+1]))return!1}return!0}computeOffsetRanges(e){const t=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],a=n+r[s+1],o=e[n],l=e[a];t[s]=o,t[s+1]=l-o}return t}};function The(i){const e=new Array;if(i.length===0)return e;let t=i[0],r=1;for(let s=1;s<i.length;s++){const n=i[s];t+r===n?r+=1:(e.push(t),e.push(r),t=n,r=1)}return e.push(t),e.push(r),e}let Che=class{constructor(e,t){this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=t.slice();const r=this.count;this.visibility=new xhe(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return T(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return T(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return T(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((T(this.cachedHighlightRanges)||T(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:e,defaultRanges:t}=Ehe(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=t}}};function Ehe(i,e,t){const r=[],s=[];let n=t.length,a=t.length;return e.forEachComponent(o=>(i[o]>0?(n!==o-1&&(r.length&&r.push(t[n+1]-r[r.length-1]),r.push(t[o])),n=o):(a!==o-1&&(s.length&&s.push(t[a+1]-s[s.length-1]),s.push(t[o])),a=o),!0)),r.length&&r.push(t[n+1]-r[r.length-1]),s.length&&s.push(t[a+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let L_=class extends ge{constructor(){super(...arguments),this.visible=Uf.Hidden}};var Uf;d([p({autoDestroy:!0})],L_.prototype,"renderable",void 0),d([p({autoDestroy:!0})],L_.prototype,"components",void 0),L_=d([k("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],L_),function(i){i[i.Hidden=0]="Hidden",i[i.Visible=1]="Visible"}(Uf||(Uf={}));function She(i,e,t,r){if(t>=e)return i;i==null&&(i=Rhe());const s=i.isVisibleBit;let n=i.data;const a=dV(n),o=t/a|0,l=t-a*o,c=(e-1)/a|0,h=n,u=r===s;if(!(t<h.length*a)&&u){const f=o+1,y=Math.ceil(h.length*1.5),g=c+1;let v=Math.max(f,y);v=Math.min(v,g),n=new Uint32Array(v),n.set(h)}return o<n.length&&(n[o]=Phe(n[o],l,u)),i.data=n,i}function hV(i,e){if(i==null)return!0;const{isVisibleBit:t,data:r}=i,s=dV(r);return e<r.length*s?Ahe(t,r,e,s):!i.isVisibleBit}function Rhe(i=!0){return{isVisibleBit:!i,data:new Uint32Array(0)}}function Ahe(i,e,t,r){const s=t/r|0,n=t-s*r;return Ohe(e[s],n)===i}function dV(i){return i.BYTES_PER_ELEMENT*8}function Phe(i,e,t){return i&~(1<<e)|(t?1:0)<<e}function Ohe(i,e){return(i&1<<e)!=0}let Mhe=class{constructor(e,t){this._indices=_(e.indices)?e.indices:z2(e.positions.length/3),this._positions=new Hd(e.positions),this._components=t,this._componentIntersectionData=new Array(t.count)}getComponentAabb(e,t){if(_(this._perComponentAabbs)){for(let r=0;r<6;r++)t[r]=this._perComponentAabbs[6*e+r];return t}return this._computePerComponentAabbs(),this.getComponentAabb(e,t)}getComponentPositions(e,t){t.indices=this._indices,t.data=this._positions.typedBuffer,t.stride=this._positions.typedBufferStride,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]}intersect(e,t,r,s,n,a,o){const l=new Ae(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),c=this._indices,h=this._components.offsets,u=Vz(e,t,Ihe),m=e[2],f=t[2];this._components.visibility.forEachComponent(y=>{if(!hV(this._components.pickability,y))return!0;const g=this.getComponentAabb(y,Dhe);if(_(a)){const S=a[y];_(n)?n.componentOffset=S:(e[2]=m-S,t[2]=f-S)}if(_(n)&&n.applyToAabb(g),!$F(g,e,u,r))return!0;const v=h[y]/3,b=h[y+1]/3,x=b-v,w=(S,P,A)=>o(y,S,Jl(P,P,s),A);return T(n)&&x>oV?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new $A(this._indices,v,b,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:t},w)):$2(e,t,v,b,c,l,void 0,n,w),!0})}_computePerComponentAabbs(){const e=this._components.count;this._perComponentAabbs=new Float32Array(6*e);const t=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let a=0;for(let o=0;o<e;o++){const l=n[o],c=n[o+1];let h=1/0,u=1/0,m=1/0,f=-1/0,y=-1/0,g=-1/0;for(let v=l;v<c;v++){const b=t[v]*s,x=r[b],w=r[b+1],S=r[b+2];h=Math.min(h,x),u=Math.min(u,w),m=Math.min(m,S),f=Math.max(f,x),y=Math.max(y,w),g=Math.max(g,S)}this._perComponentAabbs[a++]=h,this._perComponentAabbs[a++]=u,this._perComponentAabbs[a++]=m,this._perComponentAabbs[a++]=f,this._perComponentAabbs[a++]=y,this._perComponentAabbs[a++]=g}}get positions(){return this._positions}get indices(){return this._indices}};const Ihe=E(),Dhe=zs();let Lhe=class{constructor(e,t,r){this.material=e,this.geometry=t,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},$he=class{constructor(e,t,r,s){this.vao=e,this.primitiveType=t,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},Fhe=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function Nhe(i,e){return{near:i,far:e}}function y0(i){return i?Yy(i,1/0,-1/0):Nhe(1/0,-1/0)}function Yy(i,e,t){return i.near=e,i.far=t,i}function ng(i,e,t=i){return e!=null&&(t.near=Math.min(i.near,e.near),t.far=Math.max(i.far,e.far)),t}function Wv(i,e){return i.near<=e&&e<=i.far}const qS={near:0,far:0};function Uhe(i,e){const t=y0(),{eye:r,frustum:s,viewForward:n}=i;e.forAll(a=>{const o=_(a.offsetObb)?a.offsetObb:a.obb,l=oe(gs(Ca,o.center,r),n),c=iG(o,n);if(Wv(t,l-c)&&Wv(t,l+c))return;const h=Ghe(o,s);if(h===-1)return;if(h===0)return Uc.far=l+c,Uc.near=l-c,void ng(t,Uc);const u=jv.pushNew();u.near=l-c,u.far=l+c,u.mask=h,u.object=a});for(let a=0;a<jv.length;a++){const o=jv.data[a];if(Wv(t,o.near)&&Wv(t,o.far))continue;Uc.far=o.far,Uc.near=1/0,khe(_(o.object.offsetObb)?o.object.offsetObb:o.object.obb,r,Vhe,c=>{let h=Bhe;for(let u=0;u<uV&&c.length>0;u++){if(!(o.mask&1<<u))continue;zhe(s[u],c,h);const m=c;c=h,h=m}for(let u=0;u<c.length;u+=3){Z(xn,c.data[u+0],c.data[u+1],c.data[u+2]);const m=oe(gs(xn,xn,r),n);Uc.near=Math.min(Uc.near,m)}})===0&&(Uc.near=0),ng(t,Uc)}return jv.length=0,t}const jv=new Ht({allocator:i=>i||{near:1/0,far:-1/0,mask:0,object:null},deallocator:i=>(i.object=jC(i.object),i)}),Uc=y0(),xn=E(),Su=E(),Vhe=new Ht({deallocator:null}),Bhe=new Ht({deallocator:null});function zhe(i,e,t){t.length=0;const r=e.length-3;AC(xn,e,r);const s=ji(i,xn);s<=0&&(t.push(xn[0]),t.push(xn[1]),t.push(xn[2]));let n=0,a=s;for(;n<r;n+=3){AC(Su,e,n);const o=ji(i,Su);a*o<0&&(ns(xn,Su,xn,o/(o-a)),Tn(t,xn)),o<=0&&Tn(t,Su),a=o,X(xn,Su)}a*s<0&&(AC(Su,e,r),ns(xn,Su,xn,s/(s-a)),Tn(t,xn))}function AC(i,e,t){return Z(i,e.data[t+0],e.data[t+1],e.data[t+2])}function Tn(i,e){i.push(e[0]),i.push(e[1]),i.push(e[2])}function khe(i,e,t,r){Vk(nL,i.quaternion),gs(Ca,e,i.center),cB(Ca,Ca,nL);const s=8*((Ca[0]<-i.halfSize[0]?-1:Ca[0]>i.halfSize[0]?1:0)+3*(Ca[1]<-i.halfSize[1]?-1:Ca[1]>i.halfSize[1]?1:0)+9*(Ca[2]<-i.halfSize[2]?-1:Ca[2]>i.halfSize[2]?1:0)+13),n=sL[s];if(n===0)return n;Xz(Xv,i.quaternion),WF(Xv,Xv,i.halfSize);const a=(o,l)=>{const c=sL[s+l+1];return Z(o,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Jl(o,o,Xv),J(o,i.center,o)};return t.length=0,Tn(t,a(PC,0)),Tn(t,a(aL,1)),Tn(t,a(Ca,2)),Tn(t,a(oL,3)),r(t),n===1||(t.length=0,Tn(t,PC),Tn(t,oL),Tn(t,a(Ca,4)),Tn(t,a(lL,5)),r(t),n===2||(t.length=0,Tn(t,PC),Tn(t,lL),Tn(t,a(Ca,6)),Tn(t,aL),r(t))),n}const sL=(()=>{const i=new Int8Array(216);let e=0;const t=r=>{for(let s=0;s<r.length;s++)i[e+s]=r[s];e+=8};return t([3,0,6,2,3,1,5,4]),t([2,0,2,3,1,5,4,0]),t([3,1,0,2,3,7,5,4]),t([2,0,1,3,2,6,4,0]),t([1,0,1,3,2,0,0,0]),t([2,1,5,7,3,2,0,0]),t([3,2,0,1,3,7,6,4]),t([2,2,0,1,3,7,6,0]),t([3,3,0,1,5,7,6,2]),t([2,0,1,5,4,6,2,0]),t([1,0,1,5,4,0,0,0]),t([2,1,3,7,5,4,0,0]),t([1,0,2,6,4,0,0,0]),t([0,0,0,0,0,0,0,0]),t([1,1,3,7,5,0,0,0]),t([2,2,3,7,6,4,0,0]),t([1,2,3,7,6,0,0,0]),t([2,3,1,5,7,6,2,0]),t([3,4,0,1,5,7,6,2]),t([2,5,7,6,4,0,1,0]),t([3,5,0,1,3,7,6,4]),t([2,4,5,7,6,2,0,0]),t([1,4,5,7,6,0,0,0]),t([2,5,1,3,7,6,4,0]),t([3,6,0,2,3,7,5,4]),t([2,6,2,3,7,5,4,0]),t([3,7,6,2,3,1,5,4]),i})(),uV=4;function Ghe(i,e){let t=0;for(let r=0;r<uV;r++){const s=rG(i,e[r]);if(s>0)return-1;s===0&&(t|=1<<r)}return t}const Xv=Bs(),nL=Bk(),Ca=E(),PC=E(),aL=E(),oL=E(),lL=E();let Hhe=class{constructor(e){this._objects=e}submit(e,t){this._objects.preSubmit(t),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,t,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?Uhe(e,this._objects.visibleObjects):null}};function qhe(i){const e=Rr().vec3f(C.POSITION);return i.normals&&e.vec2i16(C.NORMALCOMPRESSED,{glNormalized:!0}),i.textureCoordinates===zd.Default?e.vec2f(C.UV0):i.textureCoordinates===zd.Atlas&&(e.vec2f(C.UV0),e.vec4u16(C.UVREGION,{glNormalized:!0})),i.colors&&e.vec4u8(C.COLOR,{glNormalized:!0}),e.alignTo(4)}let Whe=class{constructor(){this.externalColor=Xt(),this.externalColorMixMode=pb.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},jhe=class extends Op{constructor(e,t){super(e,"int",D2.Draw,(r,s,n)=>r.setUniform1i(e,t(s,n)))}};var lc;(function(i){i[i.Uniform=0]="Uniform",i[i.Varying=1]="Varying",i[i.COUNT=2]="COUNT"})(lc||(lc={}));const FA=429496.7296;function pV(i,e){yE(i/FA*.5+.5,e)}function Xhe(i,e){switch(e.componentData){case lc.Varying:return Yhe(i,e);case lc.Uniform:return Qhe(i);case lc.COUNT:return;default:ll(e.componentData)}}function Yhe(i,e){const{vertex:t,fragment:r}=i;t.include(Ip),t.uniforms.add(vw("componentColorTex",n=>n.componentParameters.texture.texture,e.hasWebGL2Context?Ba.None:Ba.Size)),i.attributes.add(C.COMPONENTINDEX,"float"),i.varyings.add("vExternalColorMixMode","mediump float"),i.varyings.add("vExternalColor","vec4");const s=e.output===$.ObjectAndLayerIdColor;s&&i.varyings.add("vObjectAndLayerIdColor","vec4"),i.include(vG),t.constants.add("elevationScale","float",2*FA),t.constants.add("stride","float",Vt("enable-feature:objectAndLayerId-rendering")?3:2),t.code.add(R`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${l0(e,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),t.code.add(R`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${Na(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${Na(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?R`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${Na(e,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:R`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(R`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?R`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Qhe(i){const{vertex:e,fragment:t}=i;e.uniforms.add(new Zb("externalColor",r=>r.componentParameters.externalColor)),t.uniforms.add(new jhe("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),i.varyings.add("vExternalColor","vec4"),e.code.add(R`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),t.code.add(R`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var uo;function Zhe(i,e){const t=i.vertex;switch(t.code.add(R`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case uo.None:t.code.add(R`#define vertexDiscardByOpacity(_opacity_) {}`);break;case uo.Opaque:t.code.add(R`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case uo.Transparent:t.code.add(R`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(i){i[i.None=0]="None",i[i.Transparent=1]="Transparent",i[i.Opaque=2]="Opaque",i[i.COUNT=3]="COUNT"})(uo||(uo={}));var cc;function VEe(i){return i&&t0(i)?cc.Mars:i&&i0(i)?cc.Moon:cc.Earth}(function(i){i[i.Earth=1]="Earth",i[i.Mars=2]="Mars",i[i.Moon=3]="Moon",i[i.COUNT=4]="COUNT"})(cc||(cc={}));var Ia;(function(i){i[i.None=0]="None",i[i.NoOverlay=1]="NoOverlay",i[i.ColorOverlay=2]="ColorOverlay",i[i.ColorOverlayWithWater=3]="ColorOverlayWithWater",i[i.COUNT=4]="COUNT"})(Ia||(Ia={}));let ft=class extends Ln{constructor(){super(...arguments),this.output=$.Color,this.textureCoordinateType=zd.None,this.componentData=lc.Uniform,this.cullFace=Fr.Back,this.vertexDiscardMode=uo.None,this.doubleSidedMode=na.WindingOrder,this.alphaDiscardMode=Oa.Opaque,this.integratedMeshMode=Ia.None,this.transparencyPassType=It.NONE,this.ellipsoidMode=cc.Earth,this.pbrMode=di.Disabled,this.normalType=ho.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}};d([L({count:$.COUNT})],ft.prototype,"output",void 0),d([L({count:zd.COUNT})],ft.prototype,"textureCoordinateType",void 0),d([L({count:lc.COUNT})],ft.prototype,"componentData",void 0),d([L({count:Fr.COUNT})],ft.prototype,"cullFace",void 0),d([L({count:uo.COUNT})],ft.prototype,"vertexDiscardMode",void 0),d([L({count:na.COUNT})],ft.prototype,"doubleSidedMode",void 0),d([L({count:Oa.COUNT})],ft.prototype,"alphaDiscardMode",void 0),d([L({count:Ia.COUNT})],ft.prototype,"integratedMeshMode",void 0),d([L({count:It.COUNT})],ft.prototype,"transparencyPassType",void 0),d([L({count:cc.COUNT})],ft.prototype,"ellipsoidMode",void 0),d([L({count:di.COUNT})],ft.prototype,"pbrMode",void 0),d([L({count:ho.COUNT})],ft.prototype,"normalType",void 0),d([L()],ft.prototype,"spherical",void 0),d([L()],ft.prototype,"doublePrecisionRequiresObfuscation",void 0),d([L()],ft.prototype,"hasVertexColors",void 0),d([L()],ft.prototype,"hasNormals",void 0),d([L()],ft.prototype,"hasSlicePlane",void 0),d([L()],ft.prototype,"hasBaseColorTexture",void 0),d([L()],ft.prototype,"receiveAmbientOcclusion",void 0),d([L()],ft.prototype,"receiveShadows",void 0),d([L()],ft.prototype,"blendingEnabled",void 0),d([L()],ft.prototype,"hasScreenSpaceReflections",void 0),d([L()],ft.prototype,"hasPolygonOffset",void 0),d([L()],ft.prototype,"hasMetallicRoughnessTexture",void 0),d([L()],ft.prototype,"hasEmissionTexture",void 0),d([L()],ft.prototype,"hasOcclusionTexture",void 0),d([L()],ft.prototype,"hasNormalTexture",void 0),d([L()],ft.prototype,"hasOccludees",void 0),d([L()],ft.prototype,"hasMultipassTerrain",void 0),d([L()],ft.prototype,"cullAboveGround",void 0),d([L()],ft.prototype,"useLegacyTerrainShading",void 0),d([L()],ft.prototype,"hasCloudsReflections",void 0),d([L()],ft.prototype,"snowCover",void 0),d([L()],ft.prototype,"objectAndLayerIdColor",void 0),d([L()],ft.prototype,"hasWebGL2Context",void 0),d([L({constValue:D2.Draw})],ft.prototype,"pbrTextureBindType",void 0),d([L({constValue:!0})],ft.prototype,"hasSliceHighlight",void 0),d([L({constValue:!1})],ft.prototype,"hasSliceInVertexProgram",void 0),d([L({constValue:!1})],ft.prototype,"useCustomDTRExponentForWater",void 0),d([L({constValue:!1})],ft.prototype,"hasVertexTangents",void 0),d([L({constValue:!0})],ft.prototype,"supportsTextureAtlas",void 0),d([L({constValue:!1})],ft.prototype,"highStepCount",void 0),d([L({constValue:!1})],ft.prototype,"instancedDoublePrecision",void 0),d([L({constValue:!0})],ft.prototype,"useFillLights",void 0),d([L({constValue:!1})],ft.prototype,"objectAndLayerIdColorInstanced",void 0);function cL(i,e){i.include(T5,e),i.fragment.include(bG);const t=i.fragment;t.uniforms.add(new Zb("baseColor",r=>r.baseColor)),t.uniforms.add(new Af("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?t.code.add(R`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):t.code.add(R`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),t.code.add(R`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function hL(i,e){const t=i.fragment;switch(e.doubleSidedMode){case na.None:t.code.add(R`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case na.View:i.include(n1,e),t.code.add(R`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case na.WindingOrder:t.code.add(R`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:ll(e.doubleSidedMode);case na.COUNT:}switch(e.normalType){case ho.Attribute:case ho.CompressedAttribute:i.include(g5,e),t.code.add(R`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case ho.ScreenDerivative:i.extensions.add("GL_OES_standard_derivatives"),i.include(n1,e),t.code.add(R`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case ho.Ground:e.spherical?(i.include(n1,e),t.code.add(R`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):t.code.add(R`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.extensions.add("GL_OES_standard_derivatives"),t.code.add(R`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:ll(e.normalType);case ho.COUNT:}}function Khe(i,e){const t=i.fragment;if(e.hasBaseColorTexture&&(e.output===$.Color||e.alphaDiscardMode!==Oa.Opaque)){i.include(mz,e);const r=e.textureCoordinateType===zd.Atlas;t.uniforms.add(vw("baseColorTexture",s=>s.texture,r?e.hasWebGL2Context?Ba.None:Ba.Size:Ba.None)),r?(i.include(fz),t.code.add(R`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${l0(e,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):t.code.add(R`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else t.code.add(R`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Jhe(i){const e=new Hi;e.include(n1,i),e.include(g5,i),e.include(T5,i),e.include(pw,i),e.include(jF,i),e.include(Xhe,i),e.include(wG,i),e.include(WG,i),e.include(Khe,i),e.include(Zhe,i);const{vertex:t,fragment:r}=e;i.pbrMode!==di.Normal&&i.pbrMode!==di.Schematic||(e.include(gz,i),i.hasNormalTexture&&e.include(GG,i));const s=i.output===$.Shadow||i.output===$.ShadowHighlight||i.output===$.ShadowExcludeHighlight;s&&i.componentData===lc.Varying?t.code.add(R`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):t.code.add(R`#define discardShadows(castShadows) {}`);const n=i.integratedMeshMode===Ia.ColorOverlay||i.integratedMeshMode===Ia.ColorOverlayWithWater,a=n&&i.output===$.Color&&i.pbrMode===di.WaterOnIntegratedMesh;return n&&(e.include(nb,i),e.include(Xle,i),i.spherical?t.code.add(R`
      const float invEllipsoidRadius = ${R.float(1/(i.ellipsoidMode===cc.Earth?ia.radius:i.ellipsoidMode===cc.Mars?tz.radius:iz.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):t.code.add(R`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),a&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),t.code.add(R`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${i.output===$.ObjectAndLayerIdColor?R`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${R.float(YG)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${i.output===$.ObjectAndLayerIdColor?R`forwardObjectAndLayerIdColor();`:""}
      ${a?i.spherical?R`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:R`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?R`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),i.output===$.Alpha&&(r.include(mp),e.include(uE,i),e.include(cL,i),n&&r.uniforms.add(new Bt("ovColorTex",(o,l)=>zS(o,l))),r.code.add(R`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${i.hasMultipassTerrain?R`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?R`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),i.output===$.Color&&(r.include(mp),e.include(uE,i),e.include(cL,i),e.include(hL,i),e.include(nb,i),i.receiveShadows?(e.include(wF,i),r.code.add(R`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(R`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new Bt("ovColorTex",(o,l)=>zS(o,l))),r.code.add(R`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${i.hasMultipassTerrain?R`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?R`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),i.pbrMode===di.Normal||i.pbrMode===di.Schematic?(P2(r),r.code.add(R`
        ${i.pbrMode===di.Normal?R`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),i.hasNormalTexture?r.code.add(R`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(R`vec3 shadingNormal = normalVertex;`),r.code.add(R`${i.spherical?R`vec3 normalGround = normalize(positionWorld());`:R`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(R`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${i.snowCover?R`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?R` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(i.receiveShadows?r.code.add(R`float shadow = evaluateShadow();`):i.spherical?(RF(r),r.code.add(R`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(R`float shadow = 0.0;`),a&&r.uniforms.add(new Bt("ovNormalTex",(o,l)=>NA(l))),i.snowCover&&(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(R`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(R`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?R` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${a?R`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(R`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${i.transparencyPassType===It.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(i.output===$.Depth||s)&&(e.include(_E,i),r.code.add(R`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),i.output===$.Normal&&(e.include(hL,i),r.code.add(R`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${i.normalType===ho.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),i.output===$.ObjectAndLayerIdColor&&e.fragment.code.add(R`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputObjectAndLayerIdColor();
}`),i.output===$.Highlight&&(e.include(b5,i),r.code.add(R`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?R`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function NA(i){return i.overlays.length===0?null:i.overlays[Li.INNER].getValidTexture(ki.Water)}const ede=Object.freeze(Object.defineProperty({__proto__:null,build:Jhe,getOverlayNormalTexture:NA},Symbol.toStringTag,{value:"Module"}));let mV=class fV extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2,t.spherical=e.viewingMode===Se.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gt(e.rctx,fV.shader.get().build(this.configuration),gV)}_setPipelineState(e){const t=this.configuration,r=t.integratedMeshMode!==Ia.None,s=e===It.NONE,n=e===It.FrontFace;return it({blending:t.output!==$.Color&&t.output!==$.Alpha||!t.blendingEnabled?null:s?go:Qd(e),culling:L2(t.cullFace),depthTest:{func:Lp(e)},depthWrite:s||n?ka:null,colorWrite:ut,stencilWrite:r||t.hasOccludees?dh:null,stencilTest:r?yk(H_.IntegratedMeshMaskExcluded):t.hasOccludees?$p:null,polygonOffset:s||n?t.hasPolygonOffset?{factor:2,units:2}:null:N2})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};mV.shader=new jt(ede,()=>Y(()=>import("./ComponentShader.glsl-340665d9.js"),["./ComponentShader.glsl-340665d9.js","./Ellipsoid-89682c5e.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./vec3f32-01c06d8d.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./VertexAttribute-15d1866a.js","./mat4-f0dc8788.js","./MixExternalColor.glsl-f5c601ed.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./vec4f64-6d0e93be.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./compilerUtils-7bf6df9e.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./aaBoundingBox-fb003858.js","./Extent-22afa84a.js","./aaBoundingRect-2fb32e32.js","./ViewingMode-5d7d590b.js","./Util-513876a8.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./preload-helper-41c905a7.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./VertexColor.glsl-2f905a78.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const gV=new Map([[C.POSITION,0],[C.NORMAL,1],[C.NORMALCOMPRESSED,1],[C.COLOR,2],[C.UV0,3],[C.UVREGION,4],[C.COMPONENTINDEX,5]]);let tde=class extends ur{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},UA=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function zi(i={}){return(e,t)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,i.vectorOps){const s=i.vectorOps;Object.defineProperty(e,t,{get(){return this[r]},set(n){const a=this[r];if(a==null)this[r]=n;else{if(s.equals(a,n))return;s.copy(a,n)}this._setDirty()}})}else Object.defineProperty(e,t,{get(){return this[r]},set(s){this[r]!==s&&(i.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function dL(){return(i,e)=>{const t=i._parameterCount??0;i._parameterCount=t+1,i._parameterBlocks=i._parameterBlocks||[],i._parameterBlocks.push(t),Object.defineProperty(i,e,{get(){return this[t]},set(r){this[t]!==r&&(this[t]=r,this._setDirty())}})}}let Jw=class{constructor(e){this._low=Zi(),this._high=Zi(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){const t=this._low,r=this._high;X(t,e),gs(r,e,t)}setElements(e,t,r){Z(uL,e,t,r),this.set(uL)}get(e){return J(e,this._low,this._high)}getLowScaled(e){return W(e,this._low,1)}};const uL=E();let Hr=class extends tde{constructor(e,t){super(),this.toMapSpace=t,this.baseColor=dl(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=oi(1,1,.5),this.emissiveFactor=oi(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new k1,this.componentParameters=new ly,this.textureAlphaCutoff=QG,this.alphaDiscardMode=Oa.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=cc.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ft;const r=new Jw(e.position),s=HG(e.rotationScale);lg(s,s),this.transformNormalGlobalFromModel=gh(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=gr(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(e,t,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=_(this.metallicRoughnessTexture),n.hasEmissionTexture=_(this.emissionTexture),n.hasOcclusionTexture=_(this.occlusionTexture),n.hasNormalTexture=_(this.normalTexture),n.transparencyPassType=t.identifier===Fa.Material&&r.transparencyPassType!=null?r.transparencyPassType:It.NONE,n.hasMultipassTerrain=t.identifier===Fa.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=t.identifier===Fa.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?na.View:na.None,n.hasBaseColorTexture=_(this.baseColorTexture);const a=this._computeWhichMaterialPass();n.blendingEnabled=a===Ys.Transparent||a===Ys.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?rde(r)?NA(r)?Ia.ColorOverlayWithWater:Ia.ColorOverlay:Ia.NoOverlay:Ia.None,n.useLegacyTerrainShading=this.isIntegratedMesh&&zt.TERRAIN_USE_LEGACY_SHADING,n.hasPolygonOffset=this.polygonOffsetEnabled;const o=this.hasParametersFromSource&&T(this.baseColorTexture);if(n.pbrMode=n.integratedMeshMode===Ia.ColorOverlayWithWater?di.WaterOnIntegratedMesh:this.usePBR?o?di.Schematic:di.Normal:di.Disabled,n.normalType=n.integratedMeshMode===Ia.None?n.hasNormals?ho.CompressedAttribute:ho.ScreenDerivative:ho.Ground,n.hasSlicePlane=_(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,t.identifier===Fa.ShadowMap)n.output=$.Shadow,n.vertexDiscardMode=uo.None;else if(t.identifier===Fa.Highlight)n.output=$.Highlight,n.vertexDiscardMode=uo.None;else{switch(this._computeWhichMaterialPass()===Ys.OpaqueAndTransparent?n.vertexDiscardMode=t.transparent?uo.Opaque:uo.Transparent:n.vertexDiscardMode=uo.None,n.output=t.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,t.output){case $.Color:n.receiveAmbientOcclusion=r.ssaoHelper.active,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=_(r.cloudsFade.data);break;case $.Alpha:n.hasOccludees=r.hasOccludees;break;case $.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(mV,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return _(e.weather)&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,t,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,a=r.renderable.meta.cameraDepthSquared,o=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ys.Opaque:e.materialOpaque.submitDraw(this,s,o,a);break;case Ys.Transparent:e.materialTransparent.submitDraw(this,s,o,a);break;case Ys.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,o,a),e.materialTransparent.submitDraw(this,s,o,a);break;case Ys.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,o,a),ide(t)&&e.highlightIntegratedMesh.submitDraw(this,s,o,a)}const h=this.componentParameters.castShadows!==Lr.None;h&&e.shadowMap.submitDraw(this,s,o,a),_(l)&&(e.highlight.submitDraw(this,s,l,a),h&&e.highlightShadowMap.submitDraw(this,s,l,a)),h&&_(c)&&e.defaultShadowMap.submitDraw(this,s,c,a)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ys.IntegratedMesh:this.objectOpacity<1?Ys.Transparent:this.componentParameters.opaqueOverride===Lr.All?Ys.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Oa.Blend||this.alphaDiscardMode===Oa.MaskBlend?Ys.Transparent:this.componentParameters.transparent===Lr.None?Ys.Opaque:this.componentParameters.transparent===Lr.All?Ys.Transparent:Ys.OpaqueAndTransparent}};var Ys,Lr;d([zi({vectorOps:vF})],Hr.prototype,"baseColor",void 0),d([zi()],Hr.prototype,"usePBR",void 0),d([zi()],Hr.prototype,"hasParametersFromSource",void 0),d([zi({vectorOps:oP})],Hr.prototype,"mrrFactors",void 0),d([zi({vectorOps:oP})],Hr.prototype,"emissiveFactor",void 0),d([zi({dispose:!0})],Hr.prototype,"baseColorTexture",void 0),d([zi({dispose:!0})],Hr.prototype,"metallicRoughnessTexture",void 0),d([zi({dispose:!0})],Hr.prototype,"emissionTexture",void 0),d([zi({dispose:!0})],Hr.prototype,"occlusionTexture",void 0),d([zi({dispose:!0})],Hr.prototype,"normalTexture",void 0),d([zi()],Hr.prototype,"objectOpacity",void 0),d([dL()],Hr.prototype,"commonMaterialParameters",void 0),d([dL()],Hr.prototype,"componentParameters",void 0),d([zi()],Hr.prototype,"textureAlphaCutoff",void 0),d([zi()],Hr.prototype,"alphaDiscardMode",void 0),d([zi()],Hr.prototype,"isIntegratedMesh",void 0),d([zi()],Hr.prototype,"polygonOffsetEnabled",void 0),d([zi()],Hr.prototype,"ellipsoidMode",void 0),d([zi()],Hr.prototype,"hasOccludees",void 0),function(i){i[i.Opaque=0]="Opaque",i[i.Transparent=1]="Transparent",i[i.OpaqueAndTransparent=2]="OpaqueAndTransparent",i[i.IntegratedMesh=3]="IntegratedMesh"}(Ys||(Ys={}));let k1=class extends UA{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Fr.Back,this.hasSlicePlane=!0}};d([zi()],k1.prototype,"doubleSided",void 0),d([zi()],k1.prototype,"cullFace",void 0),d([zi()],k1.prototype,"hasSlicePlane",void 0);let ly=class extends UA{constructor(){super(...arguments),this.externalColor=Ai(1,1,1,1),this.externalColorMixMode=pb.Multiply,this.castShadows=Lr.All}get transparent(){return this.externalColor[3]<1?Lr.All:Lr.None}get opaqueOverride(){return this.externalColorMixMode===pb.Replace&&this.externalColor[3]===1?Lr.All:Lr.None}get visible(){return this.externalColor[3]>0?Lr.All:Lr.None}get type(){return lc.Uniform}};d([zi({vectorOps:vF})],ly.prototype,"externalColor",void 0),d([zi()],ly.prototype,"externalColorMixMode",void 0),d([zi()],ly.prototype,"castShadows",void 0),function(i){i[i.All=0]="All",i[i.Some=1]="Some",i[i.None=2]="None"}(Lr||(Lr={}));let $_=class extends UA{constructor(){super(...arguments),this.texture=null,this.transparent=Lr.None,this.opaqueOverride=Lr.None,this.castShadows=Lr.None}get type(){return lc.Varying}};function ide(i){return i.overlays.length!==0&&_(i.overlays[Li.INNER].getValidTexture(ki.Highlight))}function rde(i){return i.overlays.length!==0&&_(i.overlays[Li.INNER].getColorTextureNoRasterImage())}d([zi()],$_.prototype,"texture",void 0),d([zi()],$_.prototype,"transparent",void 0),d([zi()],$_.prototype,"opaqueOverride",void 0),d([zi()],$_.prototype,"castShadows",void 0);let sde=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},nde=class{constructor(e,t=1){this._rctx=e,this._fieldCount=t,this.textureWidth=4096,this._dirty=!0,this._texture=new ui(this._rctx,{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,wrapMode:Dt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new Gd(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,t,r,s,n,a){const o=e*this._fieldCount+t;this._dirty=!0,this._data.set(o,0,r),this._data.set(o,1,s),this._data.set(o,2,n),this._data.set(o,3,a)}setDataElement(e,t,r,s){const n=e*this._fieldCount+t;this._dirty=!0,this._data.set(n,r,s)}resizeToFit(e){const t=e*this._fieldCount;if(t>=this._data.count){const r=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,s=new Gd(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,t=this._texture.descriptor.height;this._data.count>e*t&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const _V=65536;let ade=class{constructor(e,t=1){this.textureBuffer=new nde(e,t),this._indexManager=new sde(_V)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},yV=class{constructor(e,t=1){this._rctx=e,this._fieldCount=t,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>_V)return null;const t=new ade(this._rctx,this._fieldCount);return this._buffers.push(t),t}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const pL=pe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class ode{constructor(e,t){this._renderManager=e,this._viewingMode=t,this._objects=[new Ht,new Ht],this._renderSubmit=new Hhe(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=Vt("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new yV(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){_t(this._objects[Uf.Hidden].length===0&&this._objects[Uf.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(e){const t=new L_;return t.toMapSpace=e.toMapSpace,t.transform=e.transform,t.obb=GP(e.obb),t.components=new Che(this._componentBufferManager,e.geometry.componentOffsets),t.renderable=this._createRenderable(e,t.components),t.intersectionGeometry=new Mhe(e.geometry.positionData,t.components),this._objects[t.visible].push(t),t}destroyObject(e){const t=e;this._objects[t.visible].removeUnordered(t),t.destroy(),this._notifyDirty()}setObjectVisibility(e,t){const r=e;t!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[t].push(r),r.visible=t,this._notifyDirty())}preSubmit(e){const t=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=nc(t,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const r=e.renderable.material;t(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,t){const r=e;r.components.visibility.reset(t),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,t){return e.components.visibility.forEachComponent(t)}getComponentCount(e){const t=e,r=t.components.visibility.componentCount();return{visible:r,invisible:t.components.count-r}}setComponentData(e,t){const r=e,s=r.renderable.material,n=r.components,a=n.materialDataBuffer,o=n.materialDataIndices,l=new Whe,c=a.textureBuffer,h=new Uint8Array(4),u=new Uint32Array(h.buffer);let m=0,f=0,y=0,g=n.verticalOffsets,v=1/0,b=-1/0,x=!1,w=!1,S=0;for(let P=0;P<n.count;P++){t(P,l),m+=+(l.externalColor[3]<1),f+=+(l.externalColorMixMode===pb.Replace&&l.externalColor[3]===1),y+=+l.castShadows,y5(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(o[P],0,h[0],h[1],h[2],h[3]),x||(x=P>0&&S!==u[0]),S=u[0],w||(w=l.elevationOffset!==0),w&&T(g)&&(g=new Array(P).fill(0)),_(g)&&(g[P]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),pV(l.elevationOffset,h),c.setData(o[P],1,h[0],h[1],h[2],h[3]);const A=l.objectAndLayerIdColor;_(A)&&c.setData(o[P],2,A[0],A[1],A[2],A[3]),l.pickable!==hV(n.pickability,P)&&(n.pickability=She(n.pickability,n.count,P,l.pickable))}n.verticalOffsets=w?g:null,r.offsetObb=w?sG(r.obb,v,b,this._viewingMode,_(r.offsetObb)?r.offsetObb:GP(r.obb)):null,x||w||this._hasObjectAndLayerId?(s.componentParameters=new $_,s.componentParameters.castShadows=OC(y,n.count),s.componentParameters.transparent=OC(m,n.count),s.componentParameters.opaqueOverride=OC(f,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new ly,s.componentParameters.castShadows=l.castShadows?Lr.All:Lr.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,t,r,s=!1){e.intersectionGeometry.getComponentAabb(t,r);const n=e,a=n.components.verticalOffsets;if(s||T(a))return r;const o=a[t];if(this._viewingMode===Se.Local||o===0)return r[2]+=o,r[5]+=o,r;const l=Et(vk(o));return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,r){return e.intersectionGeometry.getComponentPositions(t,r)}intersect(e,t,r,s,n,a){const o=e;_(n)&&(n.localOrigin=o.transform.position);const l=lg(mL,o.transform.rotationScale);gs(Yv,t,o.transform.position),gs(Qv,r,o.transform.position),Jl(Yv,Yv,l),Jl(Qv,Qv,l);const c=gh(mL,l);return o.intersectionGeometry.intersect(Yv,Qv,s,c,n,o.components.verticalOffsets,a)}addEdges(e,t,r,s){const n=e,{indices:a,positions:o}=n.intersectionGeometry,l=n.components.offsets;return t.addComponentObject(e,n.transform,{center:n.obb.center,radius:nG(n.obb)},o,a,l,r,s)}async extractEdgeInformation(e,t,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:xk.createBuffer(0),origin:[0,0,0]};const{indices:a,positions:o}=s.intersectionGeometry,l=s.components.offsets,c=mE.createBuffer(o.count);p5(c.position,o),ub(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,a,l);const h=c.count,u=this._computeVisibilityIndices(a,n,l,h);return{origin:Pn(s.transform.position),buffer:await t.extractComponentsEdgeLocations({indices:u,indicesLength:u.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,t,r){let s=0;for(let n=0;n<r.length-1;n++){const a=r[n],o=r[n+1];for(let l=a;l<o;l++){const c=t?t[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,t,r,s){if(e&&t.allVisible())return e;let n=0;t.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const a=Array.isArray(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let o=0;return t.forEachComponentRange((l,c)=>{const h=r[l],u=r[c];for(let m=h;m<u;m++)a[o++]=e?e[m]:m;return!0}),a}addComponentHighlight(e,t){const r=e.components;T(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[t]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,t){const r=e.components;if(T(r.highlightCounts))return void pL.warn("Removing non-existing highlight.");const s=r.highlightCounts[t],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[t]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[t]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else pL.warn("Removing non-existing highlight.")}clearHighlights(e){const t=e.components;_(t.highlightCounts)&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[Uf.Visible]}_createRenderable(e,t){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,a=Yt.createVertex(r,ri.STATIC_DRAW,s.vertices.data),o=sa(s.indices,g=>Yt.createIndex(r,ri.STATIC_DRAW,g)),l=ul(qhe(n)),c=new Uint16Array(s.vertices.count);for(let g=0;g<t.count;g++){const v=t.offsets[g],b=t.offsets[g+1],x=t.materialDataIndices[g];if(_(s.indices))for(let w=v;w<b;w++)c[s.indices[w]]=x;else for(let w=v;w<b;w++)c[w]=x}const h=Yt.createVertex(r,ri.STATIC_DRAW,c.buffer),u=new Hr(e.transform,e.toMapSpace),m=new cl(r,gV,{data:l,componentIndices:lde},{data:a,componentIndices:h},Et(o)),f=new $he(m,bt.TRIANGLES,n,_(o)),y={cameraDepthSquared:.5,gpuMemoryEstimate:a.byteSize+h.byteSize+(_(o)?o.byteSize:0)};return new Lhe(u,f,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const lde=ul(Rr().u16(C.COMPONENTINDEX));function OC(i,e){return i===e?Lr.All:i===0?Lr.None:Lr.Some}const mL=Md(),Yv=E(),Qv=E();let vV=class extends ur{constructor(){super(...arguments),this.opacity=1}};function cde(i){const e=new Hi;return e.include(_h),e.fragment.uniforms.add(new Bt("tex",t=>t.texture)),i.hasOpacityFactor&&e.fragment.uniforms.add(new yt("opacity",t=>t.opacity)),e.fragment.code.add(R`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${i.hasOpacityFactor?"* opacity":""};
    }`),e}const hde=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:vV,build:cde},Symbol.toStringTag,{value:"Module"}));var Ls;(function(i){i[i.None=0]="None",i[i.Alpha=1]="Alpha",i[i.PremultipliedAlpha=2]="PremultipliedAlpha",i[i.COUNT=3]="COUNT"})(Ls||(Ls={}));let WS=class extends Ln{constructor(){super(...arguments),this.alphaMode=Ls.None,this.hasOpacityFactor=!1}};d([L({count:Ls.COUNT})],WS.prototype,"alphaMode",void 0),d([L()],WS.prototype,"hasOpacityFactor",void 0);let bV=class wV extends Wt{initializeProgram(e){return new Gt(e.rctx,wV.shader.get().build(this.configuration),Zt)}initializePipeline(){switch(this.configuration.alphaMode){case Ls.None:return it({colorWrite:ut});case Ls.Alpha:return it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut});case Ls.PremultipliedAlpha:case Ls.COUNT:return it({blending:fc(he.ONE,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut})}}};bV.shader=new jt(hde,()=>Y(()=>import("./Compositing.glsl-ff7b4304.js"),["./Compositing.glsl-ff7b4304.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let xV=class extends ur{};function dde(){const i=new Hi;return i.include(_h),i.fragment.uniforms.add(new Bt("tex",e=>e.texture)),i.fragment.code.add(R`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),i}const ude=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:xV,build:dde},Symbol.toStringTag,{value:"Module"}));let TV=class CV extends Wt{initializeProgram(e){return new Gt(e.rctx,CV.shader.get().build(),Zt)}initializePipeline(){return it({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};TV.shader=new jt(ude,()=>Y(()=>import("./HUDCompositing.glsl-7d4566aa.js"),["./HUDCompositing.glsl-7d4566aa.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let EV=class extends ur{};function pde(){const i=new Hi;return i.include(_h),i.fragment.uniforms.add([new Bt("colorTexture",e=>e.colorTexture),new Bt("alphaTexture",e=>e.alphaTexture),new Bt("frontFaceTexture",e=>e.frontFaceTexture)]),i.fragment.code.add(R`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),i}const mde=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:EV,build:pde},Symbol.toStringTag,{value:"Module"}));let SV=class RV extends Wt{initializeProgram(e){return new Gt(e.rctx,RV.shader.get().build(),Zt)}initializePipeline(){return it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut})}};SV.shader=new jt(mde,()=>Y(()=>import("./OITCompositing.glsl-98e2767a.js"),["./OITCompositing.glsl-98e2767a.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let AV=class extends ur{constructor(){super(...arguments),this.overlayIndex=Li.INNER,this.opacity=1}};function fde(){const i=new Hi;return i.include(_h),i.fragment.uniforms.add(new Bt("tex",e=>e.texture)),i.fragment.uniforms.add(new A2("overlayIdx",e=>e.overlayIndex)),i.fragment.uniforms.add(new yt("opacity",e=>e.opacity)),i.fragment.code.add(R`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),i}const gde=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:AV,build:fde},Symbol.toStringTag,{value:"Module"}));let PV=class OV extends Wt{initializeProgram(e){return new Gt(e.rctx,OV.shader.get().build(),Zt)}initializePipeline(){return it({blending:fc(he.ONE,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut})}};PV.shader=new jt(gde,()=>Y(()=>import("./OverlayCompositing.glsl-7bcc5ede.js"),["./OverlayCompositing.glsl-7bcc5ede.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let _de=class{constructor(e,t){this._rctx=e,this._techniqueRepository=t,this._configuration=new WS,this._passParameters=new vV,this._oitParameters=new EV,this._hudParameters=new xV,this._overlayParameters=new AV}destroy(){this._vao=Le(this._vao)}compositeOIT(e,t,r,s){this._oitParameters.colorTexture=t,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._rctx,a=this._techniqueRepository.acquire(SV);n.bindTechnique(a,this._oitParameters,e);const o=this._ensureVAO();n.bindVAO(o),n.drawArrays(bt.TRIANGLE_STRIP,0,Qs(o,"geometry")),a.release()}compositeHUD(e,t){this._hudParameters.texture=t;const r=this._rctx,s=this._techniqueRepository.acquire(TV);r.bindTechnique(s,this._hudParameters,e);const n=this._ensureVAO();r.bindVAO(n),r.drawArrays(bt.TRIANGLE_STRIP,0,Qs(n,"geometry")),s.release()}compositeOverlay(e,t,r,s){this._overlayParameters.texture=t,this._overlayParameters.opacity=r,this._overlayParameters.overlayIndex=s;const n=this._rctx,a=this._techniqueRepository.acquire(PV);n.bindTechnique(a,this._overlayParameters,e);const o=this._ensureVAO();n.bindVAO(o),n.drawArrays(bt.TRIANGLE_STRIP,0,Qs(o,"geometry")),a.release()}composite(e,t,r=Ls.None,s=1){const n=this._rctx;this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=t,this._passParameters.opacity=s;const a=this._techniqueRepository.acquire(bV,this._configuration);n.bindTechnique(a,this._passParameters,e);const o=this._ensureVAO();n.bindVAO(o),n.drawArrays(bt.TRIANGLE_STRIP,0,Qs(o,"geometry")),a.release()}_ensureVAO(){return T(this._vao)&&(this._vao=Dn(this._rctx)),this._vao}};const yde=1e4,jS=100,vde=500,bde=500,wde=.1;function xde(i,e,t){return w5(e,i)*(t[1]-t[0])+t[0]}function Tde(i,e,t){let r=0;if(!e.some(n=>(r+=n.numGeometries,r>=yde)))return Mde.compute(i,e);const s=y0();return t.forAll(n=>{n.visible&&ng(s,Cde(i,n))}),s}function Cde(i,e){if(!e.visible)return;const t=y0(),r=e.getSpatialQueryAccelerator();return _(r)?Ede(t,i,r):Sde(t,i,e.objects),t}function Ede(i,e,t){const r=e.eye,s=e.viewForward,n=e.frustum,a=l=>l.visible,o=t.objectCount;if(o<vde)Yy(ro,e.near,Math.min(i.near,e.far)),t.forEachInDepthRange(r,s,Zo.DepthOrder.FRONT_TO_BACK,ro,(l,c)=>{XS(i,e,l),ro.far=i.near,c.setRange(ro)},n,a),Yy(ro,Math.max(i.far,e.near),e.far),t.forEachInDepthRange(r,s,Zo.DepthOrder.BACK_TO_FRONT,ro,(l,c)=>{XS(i,e,l),ro.near=i.far,c.setRange(ro)},n,a);else{const l=Math.max(Math.min(o,bde),Math.ceil(o*wde)),c=t.findClosest(s,Zo.DepthOrder.FRONT_TO_BACK,n,a,l),h=t.findClosest(s,Zo.DepthOrder.BACK_TO_FRONT,n,a,l);c&&h&&(fL(i,e,c.boundingVolumeWorldSpace.bounds),fL(i,e,h.boundingVolumeWorldSpace.bounds))}}function Sde(i,e,t){Nm.clear(),t.forAll(r=>{r.visible&&r.geometries.length!==0&&Nm.add(r)}),Nm.empty||(Nm.sort(e),Yy(ro,e.near,Math.min(i.near,e.far)),Nm.forEachInDepthRange(ro,Zo.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<i.near&&XS(i,e,r)}),Yy(ro,Math.max(i.far,e.near),e.far),Nm.forEachInDepthRange(ro,Zo.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{i.far=Math.max(i.far,n)}))}function XS(i,e,t){if(!t.visible||!fw(e.frustum,t.boundingVolumeWorldSpace.bounds))return;const r=t.transformation,s=Ode;t.geometries.forEach(n=>{Sr(s,r,n.shaderTransformation);const a=yp(s);MV(i,e,n.boundingInfo,s,a)})}function MV(i,e,t,r,s){if(T(t))return;Pe(us,t.center,r);const{eye:n,viewForward:a}=e,o=a[0]*(us[0]-n[0])+a[1]*(us[1]-n[1])+a[2]*(us[2]-n[2]);if(us[3]=t.radius*s,!(o-us[3]>i.near&&o+us[3]<i.far)&&fw(e.frustum,us))if(t.radius>jS&&t.getChildren())for(const l of t.getChildren())MV(i,e,l,r,s);else YS.unionDepthRangeWithAABB(i,e.viewProjectionMatrix,r,t.bbMin,t.bbMax)}function fL(i,e,t){const r=e.eye,s=e.viewForward,n=(t[0]-r[0])*s[0]+(t[1]-r[1])*s[1]+(t[2]-r[2])*s[2];i.near=Math.min(i.near,n-t[3]),i.far=Math.max(i.far,n+t[3])}let Rde=class{constructor(){this._items=new Ht({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const t=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,a=(n[0]-t[0])*r[0]+(n[1]-t[1])*r[1]+(n[2]-t[2])*r[2];s.distance=a,s.near=a-n[3],s.far=a+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,t,r){if(t===Zo.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}}},Ade=class{constructor(){this._view=ve(),this._viewProj=ve(),this._frustum=xy(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,t){this._reset(),bs(this._view,e.viewMatrix),Sr(this._viewProj,e.projectionMatrix,this._view),ob(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],a=r[10],o=r[14];t.forAll(m=>m.forEachGeometry(f=>{if(!f.visible||!f.castShadow)return;let y;f.hasShaderTransformation?(f.computeBoundingSphere(f.shaderTransformation,us,1),y=us):y=f.boundingSphere;const g=s*y[0]+n*y[1]+a*y[2]+o,v=g-y[3],b=g+y[3];this._geometries.push(f),this._near.push(-b),this._far.push(-v)}));const l=new Fhe;if(this._geometries.length===0)return l;for(let m=0;m<this._geometries.length;++m)this._near[m]>l.far&&(l.far=this._near[m]),this._near[m]>2&&this._far[m]<l.near&&(l.near=this._far[m]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let h=0,u=0;for(let m=0;m<this._geometries.length;++m)this._near[m]<l.near&&(this._near[m]>=c.near?l.near=this._near[m]:this._nearCandidates[h++]=m),this._far[m]>l.far&&(this._far[m]<=c.far?l.far=this._far[m]:this._farCandidates[u++]=m);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((m,f)=>this._near[m]<this._near[f]?-1:this._near[m]>this._near[f]?1:0),this._farCandidates.sort((m,f)=>this._far[m]<this._far[f]?1:this._far[m]>this._far[f]?-1:0);for(let m=0;m<this._nearCandidates.length;++m){const f=this._nearCandidates[m];if(this._near[f]<l.near){const y=this._geometries[f],g=y.boundingInfo;this._includeNearBoundingInfoRec(g,y.shaderTransformation,l)}}for(let m=0;m<this._farCandidates.length;++m){const f=this._farCandidates[m];if(this._far[f]>l.far){const y=this._geometries[f],g=y.boundingInfo;this._includeFarBoundingInfoRec(g,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,t,r){if(T(e))return;const s=e.center;Pe(us,s,t);const n=yp(t),a=us[0],o=us[1],l=us[2],c=e.radius*n,h=this._frustum;if(h[0][0]*a+h[0][1]*o+h[0][2]*l+h[0][3]>c||h[1][0]*a+h[1][1]*o+h[1][2]*l+h[1][3]>c||h[2][0]*a+h[2][1]*o+h[2][2]*l+h[2][3]>c||h[3][0]*a+h[3][1]*o+h[3][2]*l+h[3][3]>c)return;const u=this._view[2]*a+this._view[6]*o+this._view[10]*l+this._view[14],m=u+c;if(!(-(u-c)<2||-m>=r.near))if(-m>this._looseRange.near)r.near=-m;else{if(c>jS){const f=e.getChildren();if(f!==void 0){for(const y of f)this._includeNearBoundingInfoRec(y,t,r);return}}YS.unionDepthRangeWithAABB(r,this._viewProj,t,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,t,r){if(T(e))return;let s=e.radius;const n=e.center;Pe(us,n,t);const a=yp(t),o=us[0],l=us[1],c=us[2];s*=a;const h=this._frustum;if(h[0][0]*o+h[0][1]*l+h[0][2]*c+h[0][3]>s||h[1][0]*o+h[1][1]*l+h[1][2]*c+h[1][3]>s||h[2][0]*o+h[2][1]*l+h[2][2]*c+h[2][3]>s||h[3][0]*o+h[3][1]*l+h[3][2]*c+h[3][3]>s)return;const u=this._view[2]*o+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-u<=r.far))if(-u<this._looseRange.far)r.far=-u;else{if(s>jS){const m=e.getChildren();if(m!==void 0){for(const f of m)this._includeFarBoundingInfoRec(f,t,r);return}}YS.unionDepthRangeWithAABB(r,this._viewProj,t,e.bbMin,e.bbMax)}}},Pde=class{constructor(){this._modelViewProj=ve(),this._clipPosition=[Xt(),Xt(),Xt(),Xt(),Xt(),Xt(),Xt(),Xt()]}unionDepthRangeWithAABB(e,t,r,s,n){const a=this._modelViewProj;Sr(a,t,r);let o=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],u=l===0||l===1||l===4||l===5?s[1]:n[1],m=l<4?s[2]:n[2];c[0]=a[0]*h+a[4]*u+a[8]*m+a[12],c[1]=a[1]*h+a[5]*u+a[9]*m+a[13],c[2]=a[2]*h+a[6]*u+a[10]*m+a[14],c[3]=a[3]*h+a[7]*u+a[11]*m+a[15]}for(let l=0;l<12;++l){const c=this._clipPosition[MC[l][0]],h=this._clipPosition[MC[l][1]],u=this._clipPosition[MC[l][2]],m=this._clipTriangle(c,h,u);let f=!0;for(let y=0;y<m.length;++y)if(m[y][3]>=2){f=!1;break}if(!f){o=!0;for(let y=0;y<m.length;++y){const g=m[y][3];Number.isFinite(g)&&(e.near=Math.min(g,e.near),e.far=Math.max(g,e.far))}}}return o}_inside(e,t){return t===0?e[0]>=-e[3]:t===1?e[1]>=-e[3]:t===2?e[0]<=e[3]:t===3?e[1]<=e[3]:void _t(!1)}_intersect(e,t,r){let s=0;return r===0?s=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):r===1?s=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):r===2?s=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):r===3&&(s=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),hz(Xt(),e,t,s)}_clipTriangle(e,t,r){let s=[e,t,r];for(let n=0;n<4;++n){const a=s;s=[];for(let o=0;o<a.length;++o){const l=a[o],c=a[(o+1)%a.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}};const MC=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],us=yo(),Ode=ve(),ro=y0(),Nm=new Rde,Mde=new Ade,YS=new Pde;let Ide=class{},Dde=class extends ur{constructor(){super(...arguments),this.textures=new Ide}};function Lde(){const i=new Hi;return i.attributes.add(C.POSITION,"vec2"),i.vertex.uniforms.add(new ac("drawPosition",(e,t)=>$de(e,t))),i.varyings.add("vUV","vec2"),i.vertex.code.add(R`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),i.fragment.uniforms.add(new Bt("textureInput",e=>e.textures.input)),i.fragment.uniforms.add(new Bt("textureMask",e=>e.textures.mask)),i.fragment.uniforms.add(new Bt("textureOverlay",e=>e.textures.overlay)),i.fragment.uniforms.add(new by("maskEnabled",e=>e.magnifier.maskEnabled)),i.fragment.uniforms.add(new by("overlayEnabled",e=>e.magnifier.overlayEnabled)),i.fragment.code.add(R`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),i}function $de(i,e){const t=e.camera.pixelRatio,r=i.magnifier.offset.x*t,s=i.magnifier.offset.y*t;Xl(i.magnifier.position,gL);const n=e.camera.screenToRender(gL,Fde),a=Math.ceil(t*i.magnifier.size),o=e.camera.fullWidth,l=e.camera.fullHeight;return Vs(Nde,(n[0]+r)/o*2-1,(n[1]-s)/l*2-1,a/o*2,a/l*2)}const gL=Fi(),Fde=L$(),Nde=Xt();async function Ude(i){const e=Y(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),t=Y(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),r=gp((await e).default,{signal:i}),s=gp((await t).default,{signal:i}),n={mask:await r,overlay:await s};return Ti(i),n}let rf=class extends ge{constructor(){super(...arguments),this._handles=new mi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Dde,this.events=new Br,this.attributeLocations=new Map([[C.POSITION,0]]),this._tmpScreenPoint=Fi(),this._tmpRenderPoint=L$()}get updating(){return T(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(z(()=>sa(this._magnifier,r=>r.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return _(this._magnifier)&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const r=this._validMagnifier;if(T(r))return;const s=t.camera.pixelRatio,n=Math.ceil(s*r.size);if(this._updateResources(e,n),T(this._resources))return;const a=this._passParameters.textures,o=Math.ceil(1/this._factor*n);a.input.resize(o,o),Xl(r.position,this._tmpScreenPoint);const l=t.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=t.camera.fullWidth,h=t.camera.fullHeight,u=.5*o,m=.5*o;l[0]=ie(l[0],u,c-u-1),l[1]=ie(l[1],m,h-m-1);const f=Math.floor(l[0]-u),y=Math.floor(l[1]-m),g=this._resources.program;g.bindTexture("textureInput",a.input),e.gl.copyTexImage2D(a.input.descriptor.target,0,a.input.descriptor.pixelFormat,f,y,o,o,0),this._passParameters.magnifier=r,e.useProgram(g),g.bindPass(this._passParameters,t),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(bt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(T(e))return;const t=e.maskUrl,r=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:r,task:o0(async s=>{const n=T(t)||T(r)?Ude(s):null,a=_(t)?gp(t,{signal:s}):n.then(l=>l.mask),o=_(r)?gp(r,{signal:s}):n.then(l=>l.overlay);this._imageSources={mask:await a,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._passParameters.textures.size!==t){const s=this._createTextureResources(e,t);if(T(s))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const r=this._createTextureResources(e,t);T(r)||(this._resources={program:this._createProgram(e),vao:Dn(e,Bz,this.attributeLocations,0,1),pipelineState:it({blending:fc(he.ONE,he.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ut})},this._passParameters.textures=r)}_disposeResources(){T(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(T(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new ui(e,{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,internalFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR,flipped:!0,preMultiplyAlpha:!cF(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result},this._imageSources.overlay),s=new ui(e,{target:Qt.TEXTURE_2D,pixelFormat:Ke.ALPHA,internalFormat:Ke.ALPHA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new ui(e,{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,internalFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR,flipped:!1}),mask:s,overlay:r,size:t}}_createProgram(e){return new Gt(e,Lde(),this.attributeLocations)}};d([p()],rf.prototype,"_imageSources",void 0),d([p()],rf.prototype,"_imageLoadTask",void 0),d([p({readOnly:!0})],rf.prototype,"updating",null),rf=d([k("esri/views/3d/webgl-engine/lib/MagnifierHelper")],rf);let Vde=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Gd(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,t,r,s,n,a=null,o=null,l=null){if(!(e&&t&&r&&s)||(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(t,{objectId:e,attributeNodeId:a,attributeIndex:o,subLayerId:l})}getObjectAndLayerIdColor(e){const t=this.getObjectAndLayerIdColorArray(e);return Ai(t.get(0,1),t.get(0,2),t.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const t=this._layerUidToPopupEnabled.get(e.layerUid);if(t===void 0)return pe.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(t===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let s=r.get(e.graphicUid);if(!s){for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Gd(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[t,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let n=null;s?(n=s.get(r.graphicUid),n||pe.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):pe.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const a=this._layerUidToId.get(r.layerUid);a||pe.getLogger(this.declaredClass).warn("no layerId found for uid "+r.layerUid),n&&a&&e.set(t,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:a,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:a})}return e}};var Qy;(function(i){i[i.FrontToBack=0]="FrontToBack",i[i.BackToFront=1]="BackToFront"})(Qy||(Qy={}));let Wh=class{constructor(e,t,r=Qy.FrontToBack){this._rctx=e,this._techniqueRepository=t,this._sorting=r,this._draws=new Ht({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,t,r,s){const n=this._draws.pushNew();n.geometry=t,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(t.indexed?Et(t.vao.indexBuffer).indexType:null)??0}dispatch(e,t){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(o=>o.material.prepareTechnique(this._techniqueRepository,e,t,o.geometry.parameters)),a=this._draws.length;for(let o=0;o<a;o++){const l=n[o];l===s&&l.configuration.transparencyPassType===It.NONE||(r.bindTechnique(l,e,t),s=l);const c=this._draws.data[o],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,t,e),this._previouslyBoundDraw.set(l,c.material));const u=c.geometryRanges,m=u.length;if(c.indexType!==0){const f=G1.get(c.indexType);for(let y=0;y<m;y+=2){const g=u[y],v=u[y+1];r.drawElements(h.primitiveType,v,c.indexType,g*f)}}else for(let f=0;f<m;f+=2){const y=u[f],g=u[f+1];r.drawArrays(h.primitiveType,y,g)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===Qy.FrontToBack?1:-1;this._draws.sort((t,r)=>{const s=e*(t.depthSquaredHint-r.depthSquaredHint);return s!==0?s:t.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}};const G1=new Map;G1.set(oa.UNSIGNED_BYTE,1),G1.set(oa.UNSIGNED_SHORT,2),G1.set(oa.UNSIGNED_INT,4);let Bde=class{constructor(e,t){this.rctx=e,this.shaderTechniqueRepository=t,this.canRender=!0,this._materialPassParameters=new qle,this._shadowPassParameters=new Wle,this._highlightPassParameters=new jle,this._systems=new Set,this._passes={materialOpaque:new Wh(e,t),materialTransparent:new Wh(e,t,Qy.BackToFront),materialIntegratedMesh:new Wh(e,t),shadowMap:new Wh(e,t),highlight:new Wh(e,t),highlightIntegratedMesh:new Wh(e,t),highlightShadowMap:new Wh(e,t),defaultShadowMap:new Wh(e,t)}}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const t of Object.values(this._passes))t.prepareSubmit();this._systems.forEach(t=>t.submit(this._passes,e.bindParameters));for(const t of Object.values(this._passes))t.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(e){if(this._systems.size!==0)switch(this._configure(e),this._materialPassParameters.output=e.output,e.bindParameters.slot){case ne.OPAQUE_MATERIAL:switch(e.output){case $.Color:case $.Depth:case $.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters);case $.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,e.bindParameters);case $.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case $.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case $.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,e.bindParameters);case $.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,e.bindParameters)}return;case ne.TRANSPARENT_MATERIAL:switch(e.output){case $.Color:case $.Alpha:case $.Depth:case $.Normal:case $.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,e.bindParameters)}return;case ne.INTEGRATED_MESH:switch(e.output){case $.Color:case $.Depth:case $.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters);case $.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,e.bindParameters);case $.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,e.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[ne.OPAQUE_MATERIAL,ne.TRANSPARENT_MATERIAL,ne.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const t={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(e);_(s)&&ng(t,s,t)}),t}_configure(e){const t=e.output===$.Shadow||e.output===$.ShadowHighlight||e.output===$.ShadowExcludeHighlight?this._shadowPassParameters:e.output===$.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,t)}_updateParameters(e,t){const r=e.bindParameters.camera,s=r.viewInverseTransposeMatrix;Z(IC,s[3],s[7],s[11]),DC.set(IC),X(t.transformWorldFromViewTH,DC.high),X(t.transformWorldFromViewTL,DC.low),X(t.slicePlaneLocalOrigin,IC),hh(t.transformViewFromCameraRelativeRS,r.viewMatrix),bs(t.transformProjFromView,r.projectionMatrix),t.identifier===Fa.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===ne.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===ne.INTEGRATED_MESH,gh(_L,t.transformViewFromCameraRelativeRS),lg(t.transformNormalViewFromGlobal,_L))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const IC=E(),_L=Bs(),DC=new Jw;let zde=class{constructor(){this._step=bL,this._dilation=1,this._firstIdleTime=tt(0)}frame(e,t){if(t?this._firstIdleTime===0&&(this._firstIdleTime=tt(performance.now())):this._firstIdleTime=tt(0),Vt("enable-feature:high-quality-idle")){const s=t?performance.now()-this._firstIdleTime:0;if(s>=yL+Gde)return this._step=tt(1/0),void(this._dilation=1);this._dilation=s>=yL?Hde:1}else this._dilation=1;const r=ie(e/kde,bL,Wde);this._step===1/0?this._step=tt(r):this._step=tt(this._step*vL+r*(1-vL))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=tt(0)}};const kde=.5,yL=tt(6e4),Gde=tt(5e3),Hde=10,vL=.9,qde=30,bL=tt(1e3/1),Wde=tt(1e3/qde),jde=8.6,Xde=.4;function Yde(){const i=new Hi,{vertex:e,fragment:t}=i,r=e.code,s=t.code;return i.attributes.add(C.POSITION,"vec2"),i.varyings.add("uv","vec2"),i.attributes.add(C.UV0,"vec2"),e.uniforms.add(new Bt("coverageTex",n=>n.coverageTexture)),r.add(R`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),t.uniforms.add(new Bt("tex",n=>n.blurColorTexture)),t.uniforms.add(new Bt("origin",n=>n.highlightColorTexture)),t.uniforms.add(new ac("uColor",n=>n.color)),t.uniforms.add(new ac("haloColor",n=>n.haloColor)),t.uniforms.add(new ac("opacities",n=>Vs(Qde,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),t.constants.add("outlineSize","float",jde),t.constants.add("blurSize","float",Xde),s.add(R`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),i}const Qde=Xt(),Zde=Object.freeze(Object.defineProperty({__proto__:null,build:Yde},Symbol.toStringTag,{value:"Module"}));let IV=class DV extends Wt{initializeProgram(e){return new Gt(e.rctx,DV.shader.get().build(),Zt)}initializePipeline(){return it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut})}};IV.shader=new jt(Zde,()=>Y(()=>import("./HighlightApply.glsl-e0f4db55.js"),["./HighlightApply.glsl-e0f4db55.js","./vec4-c7a19f0d.js","./common-d0b63c2d.js","./vec4f64-6d0e93be.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let LV=class extends ur{constructor(){super(...arguments),this.blurSize=Ne()}};function Kde(){const i=new Hi,{vertex:e,fragment:t}=i,r=e.code,s=t.code;return i.attributes.add(C.POSITION,"vec2"),i.attributes.add(C.UV0,"vec2"),i.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Bt("coverageTex",n=>n.coverageTexture)),t.uniforms.add(new x5("blurSize",n=>n.blurSize)),r.add(R`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),t.uniforms.add(new Q2("tex",n=>n.blurInputTexture)),s.add(R`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),i}const Jde=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:LV,build:Kde},Symbol.toStringTag,{value:"Module"}));let $V=class FV extends Wt{initializeProgram(e){return new Gt(e.rctx,FV.shader.get().build(),Zt)}initializePipeline(){return it({colorWrite:ut})}};$V.shader=new jt(Jde,()=>Y(()=>import("./HighlightBlur.glsl-10f6e206.js"),["./HighlightBlur.glsl-10f6e206.js","./vec2f64-70cfd09e.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let NV=class extends ur{constructor(){super(...arguments),this.invFramebufferDim=Ne()}};function eue(){const i=new Hi,{vertex:e,fragment:t}=i,r=e.code,s=t.code;return i.attributes.add(C.POSITION,"vec2"),r.add(R`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),t.uniforms.add(new Q2("tex",n=>n.inputTexture)),t.uniforms.add(new x5("invFramebufferDim",n=>n.invFramebufferDim)),s.add(R`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),i}const tue=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:NV,build:eue},Symbol.toStringTag,{value:"Module"}));let UV=class VV extends Wt{initializeProgram(e){return new Gt(e.rctx,VV.shader.get().build(),Zt)}initializePipeline(){return it({colorWrite:ut})}};UV.shader=new jt(tue,()=>Y(()=>import("./HighlightDownsample.glsl-6b16495c.js"),["./HighlightDownsample.glsl-6b16495c.js","./vec2f64-70cfd09e.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let wL=class extends ur{constructor(){super(...arguments),this.color=dl(1,0,1,1),this.haloColor=dl(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Ai(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const iue=32;let rue=class{constructor(e,t){this._techniqueRep=e,this._rctx=t,this._viewportToRestore=Xt(),this._passParameters=new wL,this._downsampleDrawParameters=new NV,this._blurDrawParameters=new LV,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Dn(this._rctx);const e={colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE,width:0,height:0},t={target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.LINEAR,wrapMode:Dt.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new Ur(this._rctx,e,t),this._blur1Fbo=new Ur(this._rctx,e,t),this._blurTechnique=this._techniqueRep.acquire($V),this._downsampleTechnique=this._techniqueRep.acquire(UV),this._applyTechnique=this._techniqueRep.acquire(IV)}dispose(){if(this._blurTechnique=gr(this._blurTechnique),this._downsampleTechnique=gr(this._downsampleTechnique),this._applyTechnique=gr(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=Le(this._blur0Fbo),this._blur1Fbo=Le(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new wL,...e}}render(e,t,r){this._passParameters.highlightColorTexture=t.colorTexture,this._assertResources();const s=e.camera;Sd(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,a=s.fullHeight,o=s.pixelRatio,l=Math.ceil(n/o),c=Math.ceil(a/o);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this._quadVAO);let u=null;this._gridUpdateResources(t,iue),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,u=this._grid.vao;const m=h.bindTechnique(this._blurTechnique,this._passParameters,e);h.bindVAO(u),h.bindFramebuffer(this._blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Si.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=t.colorTexture,pi(this._blurDrawParameters.blurSize,1/l,0),m.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Qs(u,"geometry")),h.bindFramebuffer(this._blur1Fbo),h.clear(Si.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,pi(this._blurDrawParameters.blurSize,0,1/c),m.bindDraw(this._blurDrawParameters,e,this._passParameters),h.drawArrays(this._blurTechnique.primitiveType,0,Qs(u,"geometry")),h.bindFramebuffer(r),h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,e),h.drawArrays(this._applyTechnique.primitiveType,0,Qs(u,"geometry")),h.bindVAO(null)}_gridUpdateResources(e,t){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[e],n=!0),s.viewportWidth===e.width&&s.viewportHeight===e.height||(n=!0,s.viewportWidth=e.width,s.viewportHeight=e.height),s.coverageMipmap[0]=e,s.cellPixelSize!==t&&(s.cellPixelSize=t,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:Qt.TEXTURE_2D,pixelFormat:Ke.RGB,dataType:wt.UNSIGNED_SHORT_5_6_5,samplingMode:Rt.LINEAR,wrapMode:Dt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},u={colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Ur(r,u,h)}}const a=Math.ceil(e.height/s.cellPixelSize),o=Math.ceil(e.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==a||s.horizontalCellCount!==o){s.verticalCellCount=a,s.horizontalCellCount=o;const l=a+1,c=o+1,h=1/a,u=1/o,m=6,f=4,y=new Float32Array(m*f*l*c);let g=0;for(let v=0;v<l;v++)for(let b=0;b<c;b++)y[g+0]=(b-.5)*u*2-1,y[g+1]=(v-.5)*h*2-1,y[g+2]=b*u,y[g+3]=v*h,y[g+4]=(b+.5)*u*2-1,y[g+5]=(v-.5)*h*2-1,y[g+6]=b*u,y[g+7]=v*h,y[g+8]=(b-.5)*u*2-1,y[g+9]=(v+.5)*h*2-1,y[g+10]=b*u,y[g+11]=v*h,y[g+12]=(b-.5)*u*2-1,y[g+13]=(v+.5)*h*2-1,y[g+14]=b*u,y[g+15]=v*h,y[g+16]=(b+.5)*u*2-1,y[g+17]=(v-.5)*h*2-1,y[g+18]=b*u,y[g+19]=v*h,y[g+20]=(b+.5)*u*2-1,y[g+21]=(v+.5)*h*2-1,y[g+22]=b*u,y[g+23]=v*h,g+=m*f;s.vao&&s.vao.dispose(!0),s.vao=new fh(r,Zt,{geometry:c0},{geometry:Yt.createVertex(r,ri.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const t=this._rctx,r=this._grid,s=t.bindTechnique(this._downsampleTechnique,this._passParameters,e);t.bindVAO(this._quadVAO);for(let n=0;n<r.mipmapLevels;n++){t.bindFramebuffer(r.coverageMipmap[n+1]);const a=r.coverageMipmap[n+1].width,o=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,pi(this._downsampleDrawParameters.invFramebufferDim,1/a,1/o),s.bindDraw(this._downsampleDrawParameters,e,this._passParameters),t.setViewport(0,0,a,o),t.drawArrays(bt.TRIANGLE_STRIP,0,Qs(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(_(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(_(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const t of this._grid.coverageMipmap)e+=t.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const sue={dataType:wt.UNSIGNED_BYTE,internalFormat:Ke.RGBA},nue={};let aue=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=e.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(e=>e.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(e=>e.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(e){const t=e.id;this._activeTargets.has(t)&&(this._activeTargets.delete(t),this._disposeWithFramebuffers(this._depthTextures,t),this._disposeWithFramebuffers(this._depthBuffers,t),this._disposeWithFramebuffers(this._colorTextures,t))}_disposeWithFramebuffers(e,t){const r=e.get(t);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),e.delete(t))}getDepthTexture(e,t){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(e.id);return!r||r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=jC()),r||(r=new ui(this._rctx,{target:Qt.TEXTURE_2D,pixelFormat:Ke.DEPTH_STENCIL,dataType:wt.UNSIGNED_INT_24_8,samplingMode:Rt.NEAREST,wrapMode:Dt.CLAMP_TO_EDGE,width:t.width,height:t.height}),this._depthTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getDepthBuffer(e,t){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(e.id);return r?r.descriptor.width===t.width&&r.descriptor.height===t.height||r.resize(t.width,t.height):(r=new zz(this._rctx,{internalFormat:Gz.DEPTH_STENCIL,...t}),this._depthBuffers.set(e.id,r),this._activeTargets.add(e.id)),r}getColorTexture(e,t){let r=this._colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=jC())),r||(r=new ui(this._rctx,{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,internalFormat:e.internalFormat,dataType:e.dataType,samplingMode:e.samplingMode!=null?e.samplingMode:Rt.LINEAR,wrapMode:Dt.CLAMP_TO_EDGE,width:t.width,height:t.height}),this._colorTextures.set(e.id,r),this._activeTargets.add(e.id)),r}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:Bf(),...nue,...e}}registerColorTarget(e={}){return{id:Bf(),...sue,...e}}getFramebuffer(e,t,r){const s=this._getKey(t,r);let n=this._framebuffers.get(s);const a=this.getColorTexture(t,e);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==a||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(a),n.attachDepthStencilTexture(l)),n):(n=_(r)?new Ur(this._rctx,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.DEPTH_STENCIL_TEXTURE},a,l):new Ur(this._rctx,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},a),this._framebuffers.set(s,n),n)}const o=r?this.getDepthBuffer(r,e):void 0;return n?((n.width!==e.width||n.height!==e.height||n.colorTexture!==a)&&(n.detachAll(),n.resize(e.width,e.height),n.attachColorTexture(a),n.attachDepthStencilBuffer(o)),n):(n=new Ur(this._rctx,{colorTarget:Wr.TEXTURE,depthStencilTarget:r?is.DEPTH_STENCIL_RENDER_BUFFER:is.NONE},a,o),this._framebuffers.set(s,n),n)}_getKey(e,t){return`${e.id}_${t?t.id:"X"}_${e.name}${t?"_"+t.name:""}`}get gpuMemoryUsage(){let e=0;const t=new Set,r=s=>{t.has(s)||(t.add(s),e+=ab(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),e}},oue=class{constructor(e,t){this._rctx=e,this._compositingHelper=t,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const r=e.type===wi.WEBGL2;this._renderTargetHelper=new aue(e);const s=this._renderTargetHelper;this._mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=a=>s.registerColorTarget({name:a,dataType:wt.FLOAT,internalFormat:r?Ef.RGBA32F:Ke.RGBA,samplingMode:Rt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:Rt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?Ef.RGBA4:Ke.RGBA,dataType:wt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?Ef.RGBA4:Ke.RGBA,dataType:wt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,t){return this._renderTargetHelper.getFramebuffer(this._dimensions,e,t)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&e?1:0}initializeFrame(e){const t=this._rctx;this._dimensions.width=e.fullWidth,this._dimensions.height=e.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),t.setClearStencil(0);const r=this._background.color;t.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),t.clearSafe(Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT|Si.STENCIL_BUFFER_BIT)}composite(e){_(this.colorTexture)&&this._compositingHelper.composite(e,this.colorTexture,Ls.None)}renderTmpAndCompositeToMain(e,t,r,s=!1){this.renderToTargets(e,this.tmpColor,s?this.tmpDepth:this.mainDepth,lue),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(e,t=!1){this.renderToTargets(e,this.hudVisibility,t?this.tmpDepth:this.mainDepth,cue)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,t,r){let s,n;switch(t){case It.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case It.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case It.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(e,s,this.tmpDepth,n,!0,!0):this.renderToTargets(e,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Ls.PremultipliedAlpha)}compositeOccludedOntoMain(e,t){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Ls.PremultipliedAlpha,t)}compositeTransparentOntoOpaque(e,t){t?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,t,r=!1,s=!1){const n=this._rctx;let a=0;if(t){const l=Math.max(1e-13,t[3]);n.setClearColor(t[0],t[1],t[2],l),a|=Si.COLOR_BUFFER_BIT}r&&(a|=Si.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),a|=Si.STENCIL_BUFFER_BIT),a&&n.clearSafe(a,s),e(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,t,r,s,n=!1,a=!1){const o=this.bindTarget(t,r);return this.renderToFBO(e,s,n,a),o}bindTarget(e,t){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,e,t);return this._rctx.bindFramebuffer(r),r}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this._dimensions)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const lue=[0,0,0,0],cue=[0,1,0,1];let hue=class{constructor(e){this._context=e,this._renderPlugins=new Ht,this._slots=[];for(let t=0;t<ne.MAX_SLOTS;++t)this._slots[t]=[]}add(e,t,r){const s=()=>{if(r!=null&&r.aborted)throw t.uninitializeRenderContext(),$s();this._renderPlugins.push(t);for(const a of e)this._slots[a].push(t);this._context.requestRender()},n=t.initializeRenderContext(this._context,r);if(r0(n))return n.then(s);s()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let t=0;t<this._slots.length;++t)this._slots[t]=this._slots[t].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let t=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(t=r.updateAnimation(e)||t)}),t}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],t=new Array;e.filter(r=>{if(!r.canRender)return!1;if(due(r)){const s=r.prepareTechnique(this._context.renderContext);return!!s&&(t.push(s),!0)}return t.push(null),!0}).forEach((r,s)=>r.render(this._context.renderContext,t[s]))}queryDepthRange(e){const t=uue;return t.near=1/0,t.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(e);s&&ng(t,s,t)}}),t}get needsTransparentPass(){return this._renderPlugins.some(e=>!!e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>!!e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>!!e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[ne.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,t)=>e|t.renderOccludedFlags,0)}};function due(i){return"prepareTechnique"in i}const uue={near:0,far:0};let BV=class extends xF{};const ex=255,pue=1/ex;function mue(i){const e=new Hi,t=e.fragment;return t.include(Ip),t.include(mp),e.include(Z2),e.include(_h),e.include(wF,i),t.uniforms.add([new Bt("depthMap",r=>r.linearDepthTexture),new tn("inverseViewMatrix",(r,s)=>aa(xL,dc(xL,s.camera.viewMatrix,s.camera.center))),new en("nearFar",(r,s)=>s.camera.nearFar)]),t.constants.add("sampleValue","float",pue),t.code.add(R`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const xL=ve(),fue=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:BV,ShadowCastMaxSamples:ex,build:mue},Symbol.toStringTag,{value:"Module"}));var Sp;(function(i){i[i.Gradient=0]="Gradient",i[i.Threshold=1]="Threshold",i[i.COUNT=2]="COUNT"})(Sp||(Sp={}));let QS=class extends Ln{constructor(){super(...arguments),this.visualization=Sp.Gradient,this.bandsEnabled=!1}};d([L({count:Sp.COUNT})],QS.prototype,"visualization",void 0),d([L()],QS.prototype,"bandsEnabled",void 0);let zV=class extends ur{constructor(e){super(),this.shadowCastMap=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=dw(gue),this.bandSize=.1,this.threshold=.5}};const gue=Ai(.01,0,.25,1);function _ue(i){const e=new Hi,t=e.fragment;t.include(Ip),t.include(mp),e.include(Z2),e.include(_h);const{visualization:r,bandsEnabled:s}=i;t.constants.add("inverseSampleValue","float",ex),t.uniforms.add([new Bt("shadowCastMap",o=>o.shadowCastMap),new yt("sampleScale",o=>o.sampleScale),new yt("opacityFromElevation",o=>o.opacityFromElevation),new ac("uColor",o=>o.color)]);const n=r===Sp.Gradient,a=r===Sp.Threshold;return n&&s?t.uniforms.add(new yt("bandSize",o=>o.bandSize)):a&&t.uniforms.add(new yt("threshold",o=>o.threshold)),t.code.add(R`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${a?R`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?R`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?R`* strength`:""});
      }
    `),e}const yue=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:zV,build:_ue},Symbol.toStringTag,{value:"Module"}));let kV=class GV extends Wt{constructor(e,t){super(e,t,()=>this.destroy())}initializeProgram(e){return new Gt(e.rctx,GV.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:go,colorWrite:ut,depthTest:null,depthWrite:null})}get primitiveType(){return bt.TRIANGLE_STRIP}};kV.shader=new jt(yue,()=>Y(()=>import("./ShadowCastVisualize.glsl-9c5202ad.js"),["./ShadowCastVisualize.glsl-9c5202ad.js","./vec4f64-6d0e93be.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./vec4-c7a19f0d.js","./Texture2DPassUniform-268e8d2d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const vue=4e4,bue=5e4,HV=1/512;let H1=class extends ge{constructor(e,t,r,s){super({}),this._techniqueRepository=e,this._rctx=t,this._data=r,this._requestRender=s,this._passParameters=new zV(this._data.shadowCastTexture),this._techniqueConfig=new QS,this._enabled=!1,this._vao=Dn(t),this._techniqueConfig.visualization=Sp.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Le(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(kV,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,Qs(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>HV}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;s1(e,t)||(Sd(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([p()],H1.prototype,"opacityFromElevation",null),H1=d([k("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],H1);let ew=class extends Ln{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}};d([L()],ew.prototype,"receiveShadows",void 0),d([L()],ew.prototype,"hasWebGL2Context",void 0);let qV=class WV extends Wt{constructor(e){super(e,new ew,()=>this.destroy())}initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,WV.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:os(he.ONE,he.ONE,he.ONE,he.ONE),colorWrite:ut,depthTest:null,depthWrite:null})}get primitiveType(){return bt.TRIANGLE_STRIP}};qV.shader=new jt(fue,()=>Y(()=>import("./ShadowCastAccumulate.glsl-6d4398aa.js"),["./ShadowCastAccumulate.glsl-6d4398aa.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./vec4-c7a19f0d.js","./vec4f64-6d0e93be.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let vn=class extends ge{constructor(e,t,r,s,n,a){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=a,this._progress=0,this._sampleCount=0,this._passParameters=new BV,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=qS,this._previewing=!1,this._handles=new mi,this._cameraForcedForScreenshot=!1,this._bindParameters=new Aw(new sA(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Dn(e);const o={colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE,width:0,height:0},l={target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.LINEAR,wrapMode:Dt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Ur(e,o,l),this._accumulationRenderer=new H1(t,e,this,a);const c=this._stage.view.resourceController.scheduler;this._handles.add([c.registerTask(rr.SHADOW_ACCUMULATOR,this),z(()=>r.renderView,h=>{this._handles.remove(TL),_(h)&&this._handles.add(h.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),TL)},er),z(()=>this._previewing,()=>this._requestRenderIfEnabled(),ii)])}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(T(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new qV(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==qS&&this._opacityFromElevation>HV}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(n2(t,e,dp))return;const r=Math.min(ex,e.length);t.length=r,this._sampleCount=r;for(let s=0;s<r;++s)t[s]=X(t[s]??E(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,r,s){if(this._depthRange=t,this._updateCamera(r),this._bindParameters.contentCamera=s,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(wue,this._sampleCount-this._progress);for(let a=0;a<n;++a)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Le(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Le(this._fbo),this._vao=Le(this._vao),this._accumulationTechniqueCached=gr(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,t){return!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height?0:(this._fbo.readPixels(e,t,1,1,Ke.RGBA,wt.UNSIGNED_BYTE,CL),CL[0]/this._progress)}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Si.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Qs(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*xue%this._lightDirections.length]}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-zf(vue,bue,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};d([p()],vn.prototype,"_progress",void 0),d([p()],vn.prototype,"_sampleCount",void 0),d([p()],vn.prototype,"_enabledInternal",void 0),d([p()],vn.prototype,"_depthRange",void 0),d([p()],vn.prototype,"_previewing",void 0),d([p()],vn.prototype,"_accumulationRenderer",void 0),d([p()],vn.prototype,"_isRefining",null),d([p()],vn.prototype,"_isActive",null),d([p()],vn.prototype,"canAccumulate",null),d([p()],vn.prototype,"_isDoneAccumulating",null),d([p()],vn.prototype,"_opacityFromElevation",null),d([p()],vn.prototype,"running",null),vn=d([k("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],vn);const wue=6,TL="renderView",xue=104729,CL=new Uint8Array(4),EL={highlightedThreshold:.99999,selfShadowThreshold:.025};function Tue(i){const e=new Hi;e.include(bF,i);const t=e.fragment;return t.include(Ip),t.include(mp),e.include(Z2),e.include(_h),t.uniforms.add([new Bt("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(ig.Default)),new Bt("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(ig.Highlight)),new Bt("depthMap",(r,s)=>s.linearDepthTexture),new Bt("highlightMap",(r,s)=>s.highlightColorTexture),new ac("uColor",r=>r.shadowColor),new en("nearFar",(r,s)=>s.camera.nearFar),new yt("opacity",r=>r.shadowOpacity),new yt("occludedOpacity",r=>r.occludedShadowOpacity),new yt("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Fs("lightingMainDirectionView",(r,s)=>K(RL,Pe(RL,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new en("texelSize",(r,s)=>_(s.linearDepthTexture)?pi(Cue,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):uc),new tn("inverseViewMatrix",(r,s)=>aa(SL,dc(SL,s.camera.viewMatrix,s.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",jG).add("highlightedThreshold","float",EL.highlightedThreshold).add("selfShadowThreshold","float",EL.selfShadowThreshold),t.code.add(R`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(R`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const SL=ve(),RL=E(),Cue=Ne(),Eue=Object.freeze(Object.defineProperty({__proto__:null,build:Tue},Symbol.toStringTag,{value:"Module"}));let Sue=class extends ur{constructor(){super(...arguments),this.shadowColor=Ai(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},jV=class XV extends Wt{constructor(e){super(e,new ew,()=>this.destroy())}initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,XV.shader.get().build(this.configuration),Zt)}initializePipeline(){return it({blending:os(he.SRC_ALPHA,he.ONE,he.ONE_MINUS_SRC_ALPHA,he.ONE_MINUS_SRC_ALPHA),colorWrite:ut,depthTest:null,depthWrite:null})}get primitiveType(){return bt.TRIANGLE_STRIP}};jV.shader=new jt(Eue,()=>Y(()=>import("./ShadowHighlight.glsl-81921606.js"),["./ShadowHighlight.glsl-81921606.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./mat4f64-abdda1bb.js","./vec2-848c6cf0.js","./vec2f64-70cfd09e.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./VertexAttribute-15d1866a.js","./vec4f64-6d0e93be.js","./Texture2DPassUniform-268e8d2d.js","./vec4-c7a19f0d.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const Rue=.001953125,Aue=4e4,Pue=5e4;let Oue=class{constructor(e,t){this._rctx=e,this._viewingMode=t,this._maxOpacity=1,this._passParameters=new Sue,this._drawParameters=new xF,this._vao=Dn(this._rctx)}get _technique(){return T(this._techniqueCached)&&(this._techniqueCached=new jV({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,t){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const r=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(t),this._rctx.bindTechnique(r,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,Qs(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.size)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,t){this._passParameters.opacityElevation=1-zf(Aue,Pue,e.relativeElevation);const r=this._viewingMode===Se.Global?K(AL,e.center):Z(AL,0,0,1),s=oe(r,t);this._passParameters.dayNightTerminator=zf(0,1,ie(30*s,0,1))}dispose(){this._vao=Le(this._vao),this._techniqueCached=gr(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:t}=this._passParameters;return this._maxOpacity*e*t>=Rue}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const AL=E(),PL=vh();let Mue=class{constructor(){this._plane=vh()}get isEnabled(){return!M5(this.plane,PL)}get plane(){return this._plane}set plane(e){Fp(e||PL,this._plane)}},Iue=class extends ur{};function Zy(i){i.uniforms.add(new ac("resolution",e=>{const{descriptor:t}=e.colorTexture,r=t.width,s=t.height;return Vs(Due,1/r,1/s,r,s)}))}const Due=Xt(),Um={maxSearchSteps:8,maxDistanceAreaTex:16};function Lue(){const i=new Hi,{attributes:e,varyings:t,vertex:r,fragment:s}=i;return e.add(C.POSITION,"vec2"),t.add("uv","vec2"),t.add("offsets[2]","vec4"),t.add("maxOffset","vec4"),t.add("pixelCoord","vec2"),Zy(r),r.code.add(R`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${R.int(Um.maxSearchSteps)} );
      }
    `),s.uniforms.add(new Bt("edgesTexture",n=>n.edges.colorTexture)),s.uniforms.add(new Bt("areaTexture",n=>n.areaTexture)),s.uniforms.add(new Bt("searchTexture",n=>n.searchTexture)),Zy(s),s.code.add(R`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${R.int(Um.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${R.int(Um.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${R.int(Um.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${R.int(Um.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${R.int(Um.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `),i}const $ue=Object.freeze(Object.defineProperty({__proto__:null,build:Lue},Symbol.toStringTag,{value:"Module"}));let YV=class QV extends Wt{initializeProgram(e){return new Gt(e.rctx,QV.shader.get().build(),Zt)}initializePipeline(){return it({colorWrite:ut})}};YV.shader=new jt($ue,()=>Y(()=>import("./BlendWeights.glsl-64a5832e.js"),["./BlendWeights.glsl-64a5832e.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./vec4-c7a19f0d.js","./vec4f64-6d0e93be.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));function Fue(){const i=new Hi,{attributes:e,varyings:t,vertex:r,fragment:s}=i;return e.add(C.POSITION,"vec2"),t.add("uv","vec2"),t.add("offsets[2]","vec4"),Zy(r),r.code.add(R`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),s.uniforms.add(new Bt("blendWeightsTexture",n=>n.blend.colorTexture)),s.uniforms.add(new Bt("colorTexture",n=>n.colorTexture)),Zy(s),s.code.add(R`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`),i}const Nue=Object.freeze(Object.defineProperty({__proto__:null,build:Fue},Symbol.toStringTag,{value:"Module"}));let ZV=class KV extends Wt{initializeProgram(e){return new Gt(e.rctx,KV.shader.get().build(),Zt)}initializePipeline(){return it({colorWrite:ut})}};ZV.shader=new jt(Nue,()=>Y(()=>import("./Blur.glsl-188244c5.js"),["./Blur.glsl-188244c5.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./vec4-c7a19f0d.js","./vec4f64-6d0e93be.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));const OL={threshold:.05,localConstrastAdaption:2};function Uue(){const i=new Hi,{attributes:e,varyings:t,vertex:r,fragment:s}=i;return e.add(C.POSITION,"vec2"),Zy(r),t.add("uv","vec2"),t.add("offsets[3]","vec4"),r.code.add(R`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),s.uniforms.add(new Bt("colorTexture",n=>n.colorTexture)),s.code.add(R`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${R.float(OL.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${R.float(OL.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `),i}const Vue=Object.freeze(Object.defineProperty({__proto__:null,build:Uue},Symbol.toStringTag,{value:"Module"}));let JV=class e8 extends Wt{initializeProgram(e){return new Gt(e.rctx,e8.shader.get().build(),Zt)}initializePipeline(){return it({colorWrite:ut})}};JV.shader=new jt(Vue,()=>Y(()=>import("./EdgeDetect.glsl-da7a164f.js"),["./EdgeDetect.glsl-da7a164f.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./vec4-c7a19f0d.js","./vec4f64-6d0e93be.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./mat4-f0dc8788.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let F_=class extends ge{constructor(e,t){super({}),this._rctx=e,this._techniqueRep=t,this._passParameters=new Iue,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=sl(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return Y(()=>import("./SmaaRenderPassData-660b7d34.js"),[],import.meta.url).then(r=>this._loadTextures(r,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Ti(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,Rt.LINEAR,Ke.RGB),this._loadTextureFromBase64(e.searchTexure,Rt.NEAREST,Ke.LUMINANCE)]).then(([r,s])=>{Xo(t)?(r.dispose(),s.dispose(),Ti(t)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=s)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new Ln;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(JV,t,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(YV,t,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(ZV,t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=kz(this._rctx),this._passParameters.edges=new Ur(this._rctx,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGB,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.LINEAR,wrapMode:Dt.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new Ur(this._rctx,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.LINEAR,wrapMode:Dt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Le(this._vao),this._passParameters.areaTexture=Le(this._passParameters.areaTexture),this._passParameters.searchTexture=Le(this._passParameters.searchTexture),this._passParameters.blend=Le(this._passParameters.blend),this._passParameters.edges=Le(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const t=this._validPassParameters;if(T(t))return;t.colorTexture=e;const r=this._rctx,s=r.getBoundFramebufferObject(),n=e.descriptor.width,a=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,n,a),t.edges.resize(n,a),r.bindFramebuffer(t.edges),r.setClearColor(0,0,0,1),r.clear(Si.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,t,null),r.drawArrays(bt.TRIANGLES,0,3),t.blend.resize(n,a),r.bindFramebuffer(t.blend),r.setClearColor(0,0,1,1),r.clear(Si.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,t,null),r.drawArrays(bt.TRIANGLES,0,3),r.bindFramebuffer(s),r.setClearColor(0,1,0,1),r.clear(Si.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,t,null),r.drawArrays(bt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,r){return gp(e).then(s=>new ui(this._rctx,{pixelFormat:r,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.CLAMP_TO_EDGE,width:s.width,height:s.height,samplingMode:t},s))}};d([p()],F_.prototype,"_abortController",void 0),d([p({readOnly:!0})],F_.prototype,"updating",null),F_=d([k("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],F_);function Bue(i,e){const t=-i[0],r=-i[1],s=-i[2],n=e[3],a=e[7],o=e[11],l=e[15];e[0]+=n*t,e[1]+=n*r,e[2]+=n*s,e[4]+=a*t,e[5]+=a*r,e[6]+=a*s,e[8]+=o*t,e[9]+=o*r,e[10]+=o*s,e[12]+=l*t,e[13]+=l*r,e[14]+=l*s}function zue(i,e){const t=i[0],r=i[1],s=i[2];e[12]+=t*e[0]+r*e[4]+s*e[8],e[13]+=t*e[1]+r*e[5]+s*e[9],e[14]+=t*e[2]+r*e[6]+s*e[10],e[14]+=t*e[3]+r*e[7]+s*e[11]}let kue=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const t=this._originData.get(e.id)||new Gue(e);return t.refCount++,this._originData.has(t.origin.id)||this._originData.set(t.origin.id,t),t}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(t=>{bs(t.viewMatrix,e),zue(t.origin.vec3,t.viewMatrix)})}},Gue=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=ve()}},Hue=class extends Zz{constructor(e,t){super(),this.distanceFalloffFactor=e,this.transparency=t,this.transformNormalViewFromGlobal=Bs()}},que=class extends Kz{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Bs(),this.slicePlaneLocalOrigin=E(),this.transformNormalGlobalFromModel=Bs()}};function Wue(i){const e=R`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;i.code.add(e)}const jue=ti(.5,-4e-4);function Xue(i,e){const t=i.vertex;t.include(Wue),t.constants.add("depthBias","vec2",jue),t.uniforms.add(new en("inverseViewport",(r,s)=>s.inverseViewport)),e.legacy?(t.uniforms.add(new tn("proj",(r,s)=>s.camera.projectionMatrix)),t.code.add(R`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(t.uniforms.add(new n5("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.uniforms.add(new tn("transformProjFromView",r=>r.transformProjFromView)),t.code.add(R`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),t.code.add(R`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Yue(i,e){const t=i.fragment;t.constants.add("coverageTestThreshold","float",.01),e.antialiasing?t.code.add(R`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):t.code.add(R`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Que(i,e){const t=i.vertex;e.silhouette?(t.code.add(R`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?t.code.add(R`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):t.code.add(R`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):t.code.add(R`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Zue(i,e){const t=i.vertex;t.include(Ip),t.uniforms.add(new yt("distanceFalloffFactor",r=>r.distanceFalloffFactor)),t.code.add(R`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),t.uniforms.add(vw("componentDataTex",r=>r.componentDataTexture,e.hasWebGL2Context?Ba.None:Ba.InvSize)),i.attributes.add(C.COMPONENTINDEX,"float"),t.constants.add("componentColorFieldOffset","float",0),t.constants.add("componentOtherFieldOffset","float",1),t.constants.add("componentVerticalOffsetFieldOffset","float",2),t.constants.add("componentFieldCount","float",3),t.constants.add("lineWidthFractionFactor","float",8),t.constants.add("extensionLengthOffset","float",128),t.constants.add("verticalOffsetScale","float",2*FA),t.code.add(R`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${l0(e,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${Na(e,"componentDataTex","colorIndex")};
      vec4 otherValue = ${Na(e,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${Na(e,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?t.code.add(R`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(t.uniforms.add(new dE("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),t.code.add(R`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(i.attributes.add(C.NORMALA,"vec3"),i.attributes.add(C.NORMALB,"vec3"),t.code.add(R`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(i.attributes.add(C.NORMAL,"vec3"),t.code.add(R`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?t.code.add(R`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(t.include(OP,e),t.include(OP,e),t.uniforms.add([new n5("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new dE("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new TP("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new TP("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Fs("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Fs("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),t.code.add(R`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?R`normalize(transformWorldFromModelTL + rotatedModelPosition);`:R`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),t.uniforms.add(new tn("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),t.code.add(R`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),t.code.add(R`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Kue(i){return i.mode===Tr.SKETCH||i.mode===Tr.MIXED}var Tr,Yu;(function(i){i[i.SOLID=0]="SOLID",i[i.SKETCH=1]="SKETCH",i[i.MIXED=2]="MIXED",i[i.COUNT=3]="COUNT"})(Tr||(Tr={})),function(i){i[i.REGULAR=0]="REGULAR",i[i.SILHOUETTE=1]="SILHOUETTE"}(Yu||(Yu={}));function VA(i,e){const t=i.vertex;switch(i.attributes.add(C.SIDENESS,"vec2"),e.mode===Tr.MIXED?t.code.add(R`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):t.code.add(R`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Tr.MIXED:t.code.add(R`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Tr.SKETCH:t.code.add(R`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Tr.SOLID:t.code.add(R`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Tr.COUNT:break;default:ll(e.mode)}}function Jue(i,e){const t=i.vertex;switch(i.include(VA,e),e.mode){case Tr.SOLID:t.code.add(R`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Tr.SKETCH:t.uniforms.add(new Af("strokesAmplitude",r=>r.strokesTexture.amplitude)),t.code.add(R`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Tr.MIXED:t.uniforms.add(new Af("strokesAmplitude",r=>r.strokesTexture.amplitude)),t.code.add(R`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function epe(i,e){i.include(VA,e);const{vertex:t,fragment:r}=i;switch(Kue(e)&&(t.uniforms.add(vw("strokesTexture",s=>s.strokesTexture.texture,e.hasWebGL2Context?Ba.None:Ba.InvSize)),t.uniforms.add([new Af("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new Af("strokeVariants",s=>s.strokesTexture.variants)]),i.varyings.add("vStrokeUV","vec2"),r.uniforms.add([new Q2("strokesTexture",s=>s.strokesTexture.texture),new Af("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)]),t.code.add(R`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${l0(e,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),i.fragment.include(Ip),r.code.add(R`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Tr.SOLID:t.code.add(R`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(R`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Tr.SKETCH:t.code.add(R`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(R`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Tr.MIXED:i.varyings.add("vType","float"),t.code.add(R`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(R`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function tpe(i){const e=new Hi,{vertex:t,fragment:r}=e;return i.legacy&&t.uniforms.add([new ML("model"),new ML("localView")]),e.include(Xue,i),e.include(Zue,i),e.include(Jue,i),e.include(VA,i),e.include(epe,i),e.include(v5,i),e.include(Que,i),e.include(Yue,i),e.include(uE,i),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),t.uniforms.add([new en("pixelToNDC",(s,n)=>pi(ipe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new ac("viewport",(s,n)=>n.camera.fullViewport),new yt("pixelRatio",(s,n)=>n.camera.pixelRatio)]),e.attributes.add(C.POSITION0,"vec3"),e.attributes.add(C.POSITION1,"vec3"),e.attributes.add(C.VARIANTOFFSET,"float"),e.attributes.add(C.VARIANTSTROKE,"float"),e.attributes.add(C.VARIANTEXTENSION,"float"),t.code.add(R`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${i.antialiasing?R`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:R`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${i.mode===Tr.SKETCH?R`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:i.mode===Tr.MIXED?R`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(R`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const ipe=Ne();let ML=class extends Op{constructor(e){super(e,"mat4")}};const rpe=Object.freeze(Object.defineProperty({__proto__:null,build:tpe},Symbol.toStringTag,{value:"Module"}));let t8=class i8 extends Wt{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===wi.WEBGL2}initializeProgram(e){return new Gt(e.rctx,i8.shader.get().build(this.configuration),r5)}initializePipeline(e){return e.blendMinMax?it({blending:os(he.ONE,he.ONE,he.ZERO,he.ONE,wy.ADD,e.blendMinMax.MAX),depthTest:{func:Ts.LEQUAL},colorWrite:ut}):it({depthTest:{func:Ts.LEQUAL},depthWrite:ka,colorWrite:ut})}};t8.shader=new jt(rpe,()=>Y(()=>import("./EdgeShader.glsl-aa54b39d.js"),["./EdgeShader.glsl-aa54b39d.js","./vec2-848c6cf0.js","./common-d0b63c2d.js","./vec2f64-70cfd09e.js","./mat4-f0dc8788.js","./vec3-8818fe1c.js","./mat4f64-abdda1bb.js","./ShaderBuilder-be7ca791.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./string-53224faa.js","./Texture2DPassUniform-268e8d2d.js","./VertexAttribute-15d1866a.js","./preload-helper-41c905a7.js","./jsonMap-ffa742d3.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Clonable-7fa7ad97.js","./Cyclical-47bda305.js","./mathUtils-ae09f98b.js","./vec4-c7a19f0d.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./geometry-7d866d3f.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./assets-94d592bf.js","./reactiveUtils-53e5756b.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./sphere-a48b65b1.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./quatf64-f8f1c132.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./asyncUtils-24bd37b2.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./vec3f32-01c06d8d.js","./Texture2DDrawUniform-e4341b84.js","./basicInterfaces-7449a8bf.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url));let Ul=class extends gc{constructor(){super(...arguments),this.mode=Tr.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};d([L({count:Tr.COUNT})],Ul.prototype,"mode",void 0),d([L()],Ul.prototype,"hasSlicePlane",void 0),d([L()],Ul.prototype,"silhouette",void 0),d([L()],Ul.prototype,"legacy",void 0),d([L()],Ul.prototype,"antialiasing",void 0),d([L()],Ul.prototype,"doublePrecisionRequiresObfuscation",void 0),d([L()],Ul.prototype,"hasMultipassTerrain",void 0),d([L()],Ul.prototype,"cullAboveGround",void 0),d([L()],Ul.prototype,"spherical",void 0);const spe=8,LC=128,npe={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},ape={solid:Tr.SOLID,sketch:Tr.SKETCH,uber:Tr.MIXED};let $C=class r8{constructor(e,t,r){this._rctx=e,this._shaderTechniqueRepository=t,this._configuration=new Ul,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[gt.TRANSPARENT]:{[gt.TRANSPARENT]:new Ht,[gt.OPAQUE]:new Ht},[gt.OPAQUE]:{[gt.TRANSPARENT]:new Ht,[gt.OPAQUE]:new Ht}},this._renderablesDirty=!1,this._drawParameters=new que,this._settings={...npe,...r},this.key=r8.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:zt.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=ape[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=gr(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,t){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[t][gt.TRANSPARENT].forAll(e),this._sortedRenderables[t][gt.OPAQUE].forAll(e)}updateTechnique(e,t){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=t,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(t8,this._configuration,this._technique),this._technique}bindRegularEdges(e,t){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(t,!1),e,t)}bindSilhouetteEdges(e,t){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(t,!0),e,t)}renderRegularEdges(e,t,r,s,n){this._render(e,t,t.regular.vao,r,s,n)}renderSilhouetteEdges(e,t,r,s,n){this._render(e,t,t.silhouette.vao,r,s,n)}_render(e,t,r,s,n,a){a>0&&(this._bindDraw(e,t,s,n),this._rctx.bindVAO(r),this._rctx.capabilities.instancing.drawArraysInstanced(bt.TRIANGLE_FAN,0,4,a))}_bindDraw(e,t,r,s){if(this._drawParameters.componentDataTexture=t.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in t.transform)this._lastOriginId!==t.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",t.transform.origin.viewMatrix),this._lastOriginId=t.transform.origin.origin.id),e.setUniformMatrix4fv("model",t.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=t.transform.origin.origin.vec3;else{const n=new Jw(t.transform.position),a=gh(IL,lg(IL,t.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=t.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=a;const o=s.camera.viewInverseTransposeMatrix;Z(this._drawParameters.slicePlaneLocalOrigin,o[3],o[7],o[11])}e.bindDraw(this._drawParameters,s,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[gt.TRANSPARENT][gt.TRANSPARENT].clear(),this._sortedRenderables[gt.TRANSPARENT][gt.OPAQUE].clear(),this._sortedRenderables[gt.OPAQUE][gt.TRANSPARENT].clear(),this._sortedRenderables[gt.OPAQUE][gt.OPAQUE].clear(),this._renderables.forEach(t=>{t.objectTransparency!==gt.INVISIBLE&&t.edgeTransparency!==gt.INVISIBLE&&this._sortedRenderables[t.objectTransparency][t.edgeTransparency].push(t)});const e=(t,r)=>"origin"in t.transform?"origin"in r.transform?t.transform.origin.origin.id<r.transform.origin.origin.id?-1:t.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[gt.TRANSPARENT][gt.TRANSPARENT].sort(e),this._sortedRenderables[gt.TRANSPARENT][gt.OPAQUE].sort(e),this._sortedRenderables[gt.OPAQUE][gt.TRANSPARENT].sort(e),this._sortedRenderables[gt.OPAQUE][gt.OPAQUE].sort(e)}static getKey(e,t,r){return`edges-t:${e}:${t}:${r}`}};const IL=Md();let ope=class extends kG{constructor(e){super("EdgeProcessingWorker","extract",{extract:t=>[t.dataBuffer],extractComponentsEdgeLocations:t=>[t.dataBuffer],extractEdgeLocations:t=>[t.dataBuffer]},e)}async process(e,t,r){if(r)return Tk(e);const s=await this.invoke(new FC(e),t);return this._unpackOutput(s)}async extractEdgeLocations(e,t){const r=await this.invokeMethod("extractEdgeLocations",new FC(e),t);return A0(r)}async extractComponentsEdgeLocations(e,t){const r=await this.invokeMethod("extractComponentsEdgeLocations",new FC(e),t);return A0(r)}_unpackOutput(e){return{regular:{instancesData:A0(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:A0(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},FC=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=Array.isArray(e.indices)?e.indices:e.indices.buffer,this.indicesType=Array.isArray(e.indices)?"Array":D8(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function lpe(i){const t=i_.resolution,r=t/2,s=new Uint8Array(4*t*t),n=4*t*r,a=i_.amplitude,o=2*a,l=4*t,c=Math.log2(t)+1,h=i_.strokes.length;let u=(c-1)*h*l;for(const{distance:f,pressure:y}of i_.strokes){let g=f,v=y,b=u;for(let x=0;x<c;x++){x!==0&&(g=DL(g,Ky.DISTANCE),v=DL(v,Ky.PRESSURE));for(let w=0;w<i_.resolution;w++){const S=.5+(g?g[w%g.length]/o:0),P=v?v[w%v.length]:1;yE(S,s,b),yE(P,s,b+n),b+=4}b-=l*(h+1)}u+=l}const m=new ui(i,{pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Rt.LINEAR,width:t,height:t,wrapMode:Dt.REPEAT},s);return new hpe(t,o,a,h,m)}function DL(i,e){if(!i)return null;const t=i.length/2,r=cpe*t,s=new Array(t);let n=0;const a=e===Ky.PRESSURE;for(let o=0;o<i.length;o+=2){const l=(i[o]+i[o+1])/2;s[n++]=a?Math.min(r,1-(1-l)*LL):Math.min(r,l*LL)}return s}var Ky;(function(i){i[i.DISTANCE=0]="DISTANCE",i[i.PRESSURE=1]="PRESSURE"})(Ky||(Ky={}));const cpe=.1,LL=.5;let hpe=class{constructor(e,t,r,s,n){this.resolution=e,this.normalizationScale=t,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=Le(this.texture)}};const i_={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function $L(i){let e=null;for(const t of i){const r=t.type;if(dpe(t)){if(T(e))e=r;else if(e!==r)return"uber"}}return _(e)?e:"uber"}function FL(i){let e=gt.INVISIBLE;for(const{material:t}of i)if(s8(t)){if(t.color[3]*t.opacity<1)return gt.TRANSPARENT;e=gt.OPAQUE}return e}function NL(i){let e=gt.INVISIBLE;for(const{material:t}of i)if(s8(t)){switch(t.objectTransparency){case gt.TRANSPARENT:case gt.INVISIBLE:return gt.TRANSPARENT;case gt.OPAQUE:if(t.opacity<1)return gt.TRANSPARENT}e=gt.OPAQUE}return e}function s8(i){return i.size*i.color[3]*i.opacity>0}function dpe(i){return i.size*i.color[3]>0}function UL(i,e,t,r){for(let s=0;s<i.length;s++){const n=i[s].index,a=e[s],o=e[s+1];if(r)for(let l=a;l<o;l++){const c=r[l];t.set(c,n)}else for(let l=a;l<o;l++)t.set(l,n)}}let Uo=class extends ge{constructor(i){super(i),this._updatingHandles=new og,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=E(),this._localOrigins=new kue(new rA(i.renderSR))}initialize(){this._worker=new ope(this.schedule),this._componentColorManager=new yV(this.rctx,3);const i=Ck.createBuffer(4);for(let e=0;e<4;e++)i.sideness.set(e,0,e===0||e===3?0:1),i.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Yt.createVertex(this.rctx,ri.STATIC_DRAW,i.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(i=>this._discardObjectEntry(i)),this._perObjectData.clear(),this._strokesTexture=Le(this._strokesTexture),this._componentColorManager=we(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Le(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(i,e,t,r,s,n,a,o){if(this.hasObject(i))return this.getObjectMemoryUsage(i);let l;const c=new BL(new Promise(u=>l=u),t.center,t.radius);this._perObjectData.set(i,c);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,r,s,n,a,o));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(i,e,t,r){if(this.destroyed)return void pe.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(i);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const a=i.boundingVolumeWorldSpace.bounds,o=new BL(new Promise(c=>n=c),y2(a),W$(a));this._perObjectData.set(i,o);const l=new Array;if(t.mergeGeometries&&i.geometries.length>1&&upe(i))l.push(this._addObjectMergedGeometries(i,o,e,t,r));else for(let c=0;c<i.geometries.length;c++){const h=i.geometries[c];h.material.supportsEdges&&l.push(this._addGeometry(i,o,h,e[0],t,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(o),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(i){i&&(i.renderables.length&&(i.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),i.loaded=null)}hasObject(i){return this._perObjectData.has(i)}async updateAllComponentOpacities(i,e){const t=await this._updatingHandles.addPromise(this._getObjectEntry(i));if(T(t))return;const r=e instanceof Array?s=>e[s]:()=>e;t.renderables.forEach(s=>{const n=s.components.meta.length;for(let a=0;a<n;a++){const o=r(a),l=s.components.meta[a],c=l.index;l.material.opacity=o,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*o)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(i){const e=await this._getObjectEntry(i);return _(e)?e.renderables.reduce((t,r)=>t+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(i,e,t,r){const s=i instanceof bh,n=!!t.hasSlicePlane,a=$L(e),o=$C.getKey(a,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(i));T(l)||(l.renderables.forEach(c=>{if(o!==c.rendererKey){const h=this._renderers.get(c.rendererKey),u=this._acquireRenderer(a,n,s);h.removeRenderable(c),--h.refCount,c.rendererKey=o,u.addRenderable(c)}for(let h=0;h<e.length;h++)c.components.meta[h].material=e[h];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(i,e){const t=await this._updatingHandles.addPromise(this._getObjectEntry(i));T(t)||(t.renderables.forEach(r=>{const s=r.components.meta;for(let n=0;n<s.length;n++)r.components.meta[n].verticalOffset=(e==null?void 0:e[n])??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(i,e){const t=await this._updatingHandles.addPromise(this._getObjectEntry(i));_(t)&&(t.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(i){const e=this._perObjectData.get(i);e&&(this._perObjectData.delete(i),this._discardObjectEntry(e))}async _getObjectEntry(i){const e=this._perObjectData.get(i);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(i,e){if(T(this._componentColorManager))return;this._localOrigins.updateViewMatrices(i.camera.viewMatrix);const t=i.camera.viewInverseTransposeMatrix,r=E(),s=new Jw;let n=0,a=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,h=!0;l.forEachRenderable(u=>{u.visible&&(n+=u.statistics.averageEdgeLength,a++,c&&u.regular&&(l.updateTechnique(i,!1),c=!1),h&&u.silhouette&&(l.updateTechnique(i,!0),h=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const o=new Hue(40*n/a,e);Z(r,t[3],t[7],t[11]),s.set(r),X(o.transformWorldFromViewTH,s.high),X(o.transformWorldFromViewTL,s.low),hh(o.transformViewFromCameraRelativeRS,i.camera.viewMatrix),gh(HL,o.transformViewFromCameraRelativeRS),lg(o.transformNormalViewFromGlobal,HL),o.transformProjFromView=i.camera.projectionMatrix,this._updateObjectCameraDistances(i),this._renderers.forEach(l=>{this._renderRegularEdges(l,i,o),this._renderSilhouetteEdges(l,i,o)})}_updateTransparency(i){const e=FL(i.components.meta),t=NL(i.components.meta);e===i.edgeTransparency&&t===i.objectTransparency||(i.edgeTransparency=e,i.objectTransparency=t,this._renderers.get(i.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(i,e,t){i.getCombinedStaticTransformation(e,t);const r=_(e.localOrigin)?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(Z(this._tmpModelPosition,t[12],t[13],t[14]));return e.localOrigin=r.origin,Bue(r.origin.vec3,t),r}_updateComponentBuffer(i){const{meta:e,buffer:t}=i,r=new Uint8Array(4);for(let s=0;s<e.length;s++){const n=e[s].material,a=e[s].index,o=ie(Math.round(n.size*spe),0,255),l=ie(n.extensionLength,-LC,255-LC)+LC,c=n.type==="solid"?FP.SOLID:FP.SKETCH,h=255*n.opacity,u=n.color,m=255*u[0],f=255*u[1],y=255*u[2],g=255*u[3];t.textureBuffer.setData(a,0,m,f,y,g),t.textureBuffer.setData(a,1,o,l,c,h),pV(e[s].verticalOffset,r),t.textureBuffer.setData(a,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(i){if(T(this._componentColorManager))return null;const e=new Array,t=this._componentColorManager.getBuffer(i.length);for(let s=0;s<i.length;s++){const n=i[s],a=t.acquireIndex();e.push({index:a,verticalOffset:0,material:n})}const r=new ppe(t,e);return this._updateComponentBuffer(r),r}_extractEdges(i,e,t,r,s,n=s.length){return this._worker.process({data:e,indices:s,indicesLength:n,writerSettings:i,skipDeduplicate:t},this._workerAbort.signal,r)}_createRenderable(i,e,t,r,s){const n=c=>_(this._verticesBufferObject)?new mpe(new fh(this.rctx,r5,{vertices:Ek,instances:c===Yu.REGULAR?Sk.glLayout:Rk.glLayout},{vertices:this._verticesBufferObject,instances:Yt.createVertex(this.rctx,ri.STATIC_DRAW,c===Yu.REGULAR?i.regular.instancesData.buffer:i.silhouette.instancesData.buffer)}),c===Yu.REGULAR?i.regular.lodInfo:i.silhouette.lodInfo):null,a=i.regular.lodInfo.lengths.length>0?n(Yu.REGULAR):null,o=i.silhouette.lodInfo.lengths.length>0?n(Yu.SILHOUETTE):null,l=(_(a)?a.vao.size:0)+(_(o)?o.vao.size:0);return new gpe(a,o,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:i.averageEdgeLength},t,FL(e.meta),NL(e.meta),e,r)}async _addGeometry(i,e,t,r,s,n){const a=t.vertexAttributes.get(C.POSITION),o=t.indices.get(C.POSITION),l=ve(),c=this._computeModelTransformWithLocalOrigin(i,t,l),h=new GL(a,o,l,c);return this._addPositionData(e,h,t.edgeIndicesLength,r,s,n)}async _addPositionData(i,e,t,r,s,n=!1){if(i.loaded==null)return;const a=this._createComponentBuffers([r]);if(T(a)||t<=0)return;const o=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,h=e.indices,u=e.position,m=u.data.length/u.size,f=mE.createBuffer(m);for(let v=0;v<m;v++)f.position.set(v,0,u.data[v*u.size+0]),f.position.set(v,1,u.data[v*u.size+1]),f.position.set(v,2,u.data[v*u.size+2]);UL(a.meta,[0,f.componentIndex.count],f.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(o.writerSettings,f,!1,n,h,t));if(i.loaded==null)return;const g=this._createRenderable(y,a,new fpe(l,c),o.key,!1);i.renderables.push(g),o.addRenderable(g),this._gpuMemoryUsage+=g.statistics.gpuMemoryUsage}async _addComponentGeometry(i,e,t,r,s,n,a){if(e.loaded==null)return 0;const o=this._createComponentBuffers(n);if(T(o))return 0;const l=$L(n),c=this._acquireRenderer(l,a.hasSlicePlane||!1,!1),h=mE.createBuffer(t.count);p5(h.position,t),UL(o.meta,s,h.componentIndex,r);const u=!0,m=c.writerSettings,f=await this._updatingHandles.addPromise(this._extractEdges(m,h,u,!1,r));if(e.loaded==null)return 0;const y=this._createRenderable(f,o,i,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(i,e,t,r,s){const n=new Map;let a=0,o=null,l=0;for(let b=0;b<i.geometries.length;b++){const x=i.geometries[b];if(!x.material.supportsEdges)continue;!o&&x.localOrigin&&(o=x);const w=x.vertexAttributes.get(C.POSITION);l+=w.data.length/w.size,a+=x.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=a?new c(a):null,u=[];let m=0;for(let b=0;b<i.geometries.length;b++){const x=i.geometries[b];if(!x.material.supportsEdges)continue;const w=x.vertexAttributes.get(C.POSITION),S=x.indices.get(C.POSITION);let P=n.get(w.data);if(P==null){P=u.length/3;for(let A=0;A<w.data.length;A+=w.size)u.push(w.data[A+0]),u.push(w.data[A+1]),u.push(w.data[A+2]);n.set(w.data,P)}if(S)for(let A=0;A<x.edgeIndicesLength;A++)h[m++]=P+S[A]}const f=o||i.geometries[0],y=ve(),g=this._computeModelTransformWithLocalOrigin(i,f,y);for(let b=0;b<i.geometries.length;b++)i.geometries[b].localOrigin=g.origin;const v=new GL({data:u,size:3},h,y,g);await this._updatingHandles.addPromise(this._addPositionData(e,v,h.length,t[0],r,s))}_acquireRenderer(i,e,t){const r=$C.getKey(i,e,t);let s=this._renderers.get(r);return T(this._strokesTexture)&&(this._strokesTexture=lpe(this.rctx)),s||(s=new $C(this.rctx,this.techniqueRepository,{type:i,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:t,spherical:this.viewingMode===Se.Global}),this._renderers.set(r,s)),++s.refCount,s}_removeRenderable(i){VL(i.regular),VL(i.silhouette);const e=this._renderers.get(i.rendererKey);if(e){e.removeRenderable(i),--e.refCount,"origin"in i.transform&&this._localOrigins.release(i.transform.origin),this._gpuMemoryUsage-=i.statistics.externalMemoryUsage?0:i.statistics.gpuMemoryUsage;for(const t of i.components.meta)i.components.buffer.releaseIndex(t.index)}}_updateObjectCameraDistances(i){const e=i.camera.eye,t=i.camera.viewForward,r=E(),s=n=>{gs(r,n.center,e);const a=oe(r,t),o=n.radius,l=a<-o?1/0:a<o?0:a-o;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(i,e,t){const r=i.bindRegularEdges(t,e),s=t.transparency,n=e.camera.perScreenPixelRatio;i.forEachRenderable(a=>{if(!zL(a)||!a.visible)return;const o=Zv(a.regular.lod.lengths,a.distanceToCamera,n);i.renderRegularEdges(r,a,t,e,o)},s)}_renderSilhouetteEdges(i,e,t){const r=i.bindSilhouetteEdges(t,e),s=t.transparency,n=e.camera.perScreenPixelRatio;i.forEachRenderable(a=>{if(!kL(a)||!a.visible)return;const o=Zv(a.silhouette.lod.lengths,a.distanceToCamera,n);i.renderSilhouetteEdges(r,a,t,e,o)},s)}get test(){return{hasRenderedPrimitives:i=>{let e=!1;const t=i.perScreenPixelRatio,r=(s,n)=>s.forEachRenderable(a=>{a.visible&&!e&&(zL(a)&&(e=Zv(a.regular.lod.lengths,a.distanceToCamera,t)>0),!e&&kL(a)&&(e=Zv(a.silhouette.lod.lengths,a.distanceToCamera,t)>0))},n);return this._renderers.forEach(s=>{e||(r(s,gt.OPAQUE),r(s,gt.TRANSPARENT))}),e}}}};function VL(i){_(i)&&(i.vao.vertexBuffers.instances.dispose(),i.vao.dispose(!1),i.vao=null)}function upe(i){let e=null,t=null;for(let r=0;r<i.geometries.length;r++){const s=i.geometries[r];if(s.material.supportsEdges){if(e){if(!n2(e,s.transformation))return!1}else e=s.transformation;if(!t&&_(s.localOrigin))t=s;else if(t&&_(t.localOrigin)&&_(s.localOrigin)&&t.localOrigin.id!==s.localOrigin.id)return!1}}return!0}d([p({constructOnly:!0})],Uo.prototype,"rctx",void 0),d([p({constructOnly:!0})],Uo.prototype,"renderSR",void 0),d([p({constructOnly:!0})],Uo.prototype,"viewingMode",void 0),d([p({constructOnly:!0})],Uo.prototype,"techniqueRepository",void 0),d([p({constructOnly:!0})],Uo.prototype,"setNeedsRender",void 0),d([p({constructOnly:!0})],Uo.prototype,"schedule",void 0),d([p({readOnly:!0})],Uo.prototype,"_updatingHandles",void 0),d([p({readOnly:!0})],Uo.prototype,"updating",null),Uo=d([k("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Uo);class BL{constructor(e,t,r){this.center=t,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class ppe{constructor(e,t){this.buffer=e,this.meta=t}}let mpe=class{constructor(e,t){this.vao=e,this.lod=t}};class fpe{constructor(e,t){this.modelMatrix=e,this.origin=t}}class gpe{constructor(e,t,r,s,n,a,o,l){this.regular=e,this.silhouette=t,this.statistics=r,this.transform=s,this.edgeTransparency=n,this.objectTransparency=a,this.components=o,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function zL(i){return _(i.regular)}function kL(i){return _(i.silhouette)}function Zv(i,e,t){const r=e*t,s=L8(i,r,!0);return s===-1?r<i[0]?i.length:0:i.length-s}let GL=class{constructor(e,t,r,s){this.position=e,this.indices=t,this.modelTransform=r,this.origin=s}};const HL=Bs();function vc(i){return window.WebGL2RenderingContext&&i instanceof window.WebGL2RenderingContext}let qL=class{constructor(e,t,r,s,n,a,o,l,c){this.createQuery=e,this.deleteQuery=t,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=a,this.endTimeElapsed=o,this.createTimestamp=l,this.timestampBits=c}},Wc=!1;function _pe(i,e){if(e.disjointTimerQuery)return null;let t=i.getExtension("EXT_disjoint_timer_query_webgl2");return t&&vc(i)?new qL(()=>i.createQuery(),r=>{i.deleteQuery(r),Wc=!1},r=>i.getQueryParameter(r,i.QUERY_RESULT_AVAILABLE),r=>i.getQueryParameter(r,i.QUERY_RESULT),()=>i.getParameter(t.GPU_DISJOINT_EXT),r=>{Wc||(Wc=!0,i.beginQuery(t.TIME_ELAPSED_EXT,r))},()=>{i.endQuery(t.TIME_ELAPSED_EXT),Wc=!1},r=>t.queryCounterEXT(r,t.TIMESTAMP_EXT),()=>i.getQuery(t.TIMESTAMP_EXT,t.QUERY_COUNTER_BITS_EXT)):(t=i.getExtension("EXT_disjoint_timer_query"),t?new qL(()=>t.createQueryEXT(),r=>{t.deleteQueryEXT(r),Wc=!1},r=>t.getQueryObjectEXT(r,t.QUERY_RESULT_AVAILABLE_EXT),r=>t.getQueryObjectEXT(r,t.QUERY_RESULT_EXT),()=>i.getParameter(t.GPU_DISJOINT_EXT),r=>{Wc||(Wc=!0,t.beginQueryEXT(t.TIME_ELAPSED_EXT,r))},()=>{t.endQueryEXT(t.TIME_ELAPSED_EXT),Wc=!1},r=>t.queryCounterEXT(r,t.TIMESTAMP_EXT),()=>t.getQueryEXT(t.TIMESTAMP_EXT,t.QUERY_COUNTER_BITS_EXT)):null)}function ype(i,e){const t=i.capabilities.disjointTimerQuery;return T(t)?null:new vpe(t,e)}let vpe=class{constructor(e,t){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,t.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){Wc||(this._currentQuery=this._queryPool.pop(),T(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||T(this._currentQuery)||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const t=this._queryResults.get(e);if(T(t))return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(t))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(t)/1e6;return this._queryPool.unshift(t),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){_(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){_(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{T(e)||this._timer.deleteQuery(e)})}};var ai;(function(i){i.OVERLAY="overlay",i.PREPARE="prepare",i.SHADOW_MAP="shadow map",i.LINEAR_DEPTH="linear depth",i.ACCUMULATED_SHADOWS="accumulated shadows",i.NORMALS="normals",i.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",i.SSAO="SSAO",i.OPAQUE="opaque",i.OPAQUE_EDGES="opaque edges",i.VOXEL="voxel",i.TRANSPARENT="transparent",i.TRANSPARENT_EDGES="transparent edges",i.HUD_VISIBILITY="HUD visibility",i.TRANSPARENT_TERRAIN="transparent terrain",i.ENVIRONMENT="environment",i.LASER_LINE="laser line",i.OCCLUDED="occluded",i.ANTIALIASING="antialiasing",i.HIGHLIGHTS="highlights",i.HUD="HUD",i.HUD_OCCLUDED="HUD occluded",i.FINISH="finish"})(ai||(ai={}));const WL="Total";let bpe=class{constructor(e){this._rctx=e,this._startTimeStampCPU=tt(0),this._lastTimeStampCPU=tt(0),this._totalCPUTime=new T0(WL),this._cpuTimeSamplers=new Map(Object.values(ai).map(t=>[t,new T0(t)])),this._enableGPUTimer=0,this._totalGPUTime=new T0("GPU"),this._gpuTimeSamplers=new Map(Object.values(ai).map(t=>[t,new T0(t)])),this._totalTime=tt(0),this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return _(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return tt(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(T(this._gpuTimerPool)){const e=[...Object.values(ai),WL];this._gpuTimerPool=ype(this._rctx,e)}return T(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:x8(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Le(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=tt(performance.now()),_(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(e){const t=tt(performance.now());if(this._cpuTimeSamplers.get(e).record(t-this._lastTimeStampCPU),this._lastTimeStampCPU=t,_(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(_(this._gpuTimerPool)){const t=this._gpuTimerPool.stop(ai.FINISH);this._gpuTimeSamplers.get(ai.FINISH).record(t)}const e=tt(performance.now()-this._startTimeStampCPU);this._totalTime=tt(this._totalTime+e),this._totalCPUTime.record(e),_(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((t,r)=>t+(r.last||0),0)),++this._totalFrameCount}},Ea=class extends ge{get _bindParameters(){return this._renderContext.bindParameters}isFeatureEnabled(i,e=this._state){return Ze(this._renderStateFeatures.get(e,i),!1)}setFeatureEnabled(i,e,t){this._renderStateFeatures.set(e,i,t),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Qi.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Qi.HighQualityTransparency)}get hasWaterReflection(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(Qi.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(i,e,t,r,s,n,a,o){super({}),this._stage=i,this._materialRepository=e,this._shaderTechniqueRepository=r,this._rctx=s,this._compositingHelper=n,this._magnifierHelper=a,this._requestRender=o,this._materialRenderers=new Ht,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Mue,this._state=bi.IDLE,this._renderStateFeatures=xM(),this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=Mr.Opaque,this._waterReflectionEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new zde,this._handles=new mi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new F_(this._rctx,r),o(),this._offscreen=new oue(this._rctx,this._compositingHelper),this.performanceInfo=new bpe(this._rctx),this._shadowMap=new sA(this._rctx,i.viewingMode),this._ssaoHelper=new SF(i.view,r,this._rctx,o),this._highlight=new rue(r,this._rctx),this._shadowHighlight=new Oue(this._rctx,i.viewingMode),this._shadowAccumulator=new vn(this._rctx,r,i,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,h)=>{l.shadowMap.start(l.camera,c,h),this._renderShadowCascades($.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},o),this._renderContext=new Ute(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new hue({renderContext:this._renderContext,techniqueRepository:r,textureRepository:t,materialRepository:this._materialRepository,requestRender:o,controller:i}),this.renderPassManager=new Bde(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([z(()=>this._stage.view.state.camera,()=>o(),er),z(()=>zt.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(gt.TRANSPARENT):()=>{},o()},Je),z(()=>this._ssaoEnabled||this.isFeatureEnabled(Qi.SSAO),l=>this._ssaoHelper.enabled=l,er)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Us(this._gpuTimerHandle),this._materialRenderers.forAll(i=>i.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Le(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),bk.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return T(this._edgeView)&&(this._edgeView=new Uo({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:i=>this._stage.view.resourceController.immediate.schedule(i)}),this._handles.add(z(()=>sa(this._edgeView,i=>i.updating),()=>this._requestRender(),ii)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return j$(this._bindParameters.ssr.reprojectionMatrix,Bd)}set _reprojectionMatrix(i){R$(this._bindParameters.ssr.reprojectionMatrix,i)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var i;return!!((i=this._shadowMap)!=null&&i.enabled)}setParameters(i){const{_shadowMap:e,_bindParameters:t}=this;if(i.screenSpaceReflectionsEnabled!==void 0&&t.ssr.enabled!==i.screenSpaceReflectionsEnabled&&(t.ssr.enabled=i.screenSpaceReflectionsEnabled,this._requestRender()),i.shadowMap!==void 0&&this._shadowMap.enabled!==i.shadowMap&&(this._shadowMap.enabled=i.shadowMap,this._requestRender()),i.shadowMapMaxCascades!==void 0&&e.maxCascades!==i.shadowMapMaxCascades&&(e.maxCascades=i.shadowMapMaxCascades,this._requestRender()),_(i.environment)){_(i.environment.weather)&&(this._bindParameters.weather=i.environment.weather,this._bindParameters.weatherVisible=!!i.weatherVisible),i.environment.lighting.ambientOcclusionEnabled!==void 0&&this._ssaoEnabled!==i.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=i.environment.lighting.ambientOcclusionEnabled,this._requestRender()),i.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==i.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=i.environment.lighting.waterReflectionEnabled,this._requestRender());const r=i.environment.lighting.type!=="virtual";t.enableFillLights!==r&&(t.enableFillLights=r,this._requestRender())}i.background&&this._offscreen.background!==i.background&&(this._offscreen.background=i.background,this._requestRender()),i.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==i.antialiasingEnabled&&(this._antialiasingEnabled=i.antialiasingEnabled,this._requestRender()),i.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==i.highQualityTransparency&&(this._highQualityTransparencyEnabled=i.highQualityTransparency,this._requestRender()),i.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(i.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(i.defaultHighlightOptions),this._requestRender()),i.overlays!==void 0&&this._bindParameters.overlays!==i.overlays&&(this._bindParameters.overlays=i.overlays,this._requestRender()),i.hasOverlayWater!==void 0&&this._hasOverlayWater!==i.hasOverlayWater&&(this._hasOverlayWater=i.hasOverlayWater,this._requestRender()),i.renderOverlay!==void 0&&this._renderOverlay!==i.renderOverlay&&(this._renderOverlay=i.renderOverlay,this._requestRender()),i.slicePlane!==void 0&&this._sliceHelper.plane!==i.slicePlane&&(this._sliceHelper.plane=Et(i.slicePlane),this._requestRender()),i.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==i.terrainRenderingEnabled&&(this._terrainRenderingEnabled=i.terrainRenderingEnabled,this._requestRender()),i.terrainTransparency!==void 0&&this._terrainTransparency!==i.terrainTransparency&&(this._terrainTransparency=i.terrainTransparency,this._requestRender()),i.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(i.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(i,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:r,updates:s}=i;if(t.length===0&&r.length===0&&s.length===0)return;const n=l6(i);let a=!1;n.forEach((o,l)=>{if(e.done)return;let c=this._materialRenderers.find(h=>h.material===l);T(c)&&o.adds.length>0&&(c=new f6(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(o),c.isEmpty&&(a=!0)),o.removes.forEach(h=>i.removes.removeUnordered(h)),o.adds.forEach(h=>i.adds.removeUnordered(h)),o.updates.forEach(h=>i.updates.removeUnordered(h)),e.madeProgress()}),a&&this._materialRenderers.filterInPlace(o=>!o.isEmpty||(o.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(o=>o.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(o=>o.hasOccludees),this._hasWater=this._materialRenderers.some(o=>o.hasWater),this._hasHUDElements=this._materialRenderers.some(o=>o.requiresSlot(ne.LINE_CALLOUTS_HUD_DEPTH,$.Color)||o.requiresSlot(ne.HUD_MATERIAL,$.Color)||o.requiresSlot(ne.LABEL_MATERIAL,$.Color)),this._requestRender()}updateAnimation(i){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(t=>this._hasAnimations=t.updateAnimation(i)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(i)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Us(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(i,e,t,r,s){this._isRendering=!0,this.performanceInfo.startFrame();const{camera:n,contentCamera:a,mode:o}=t;this._state=o,this._renderOverlay(s),this.performanceInfo.advance(ai.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=It.NONE;const l=this._offscreen;l.setupRenderTarget(this.hasWaterReflection);const c=vh(this._sliceHelper.plane);r===Sy.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(i),n.setGLViewport(this._rctx),this._prepare(n,a),this._renderPlugins.prepareRender(),this.performanceInfo.advance(ai.PREPARE);const h=this._computeDepthRange(n);this._renderShadowMap(i,n,this._bindParameters.lighting.mainLight.direction,h),this.performanceInfo.advance(ai.SHADOW_MAP),l.initializeFrame(n),this._ensureBindParameters(n,a),this._renderLinearDepth(),this.performanceInfo.advance(ai.LINEAR_DEPTH),this._accumulateShadows(h,n,a),this.performanceInfo.advance(ai.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(ai.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(ai.SSAO),this._renderContext.output=$.Color,l.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(ai.OPAQUE);const u=this._terrainRenderingEnabled&&(this._terrainTransparency===Mr.Semitransparent||this._terrainTransparency===Mr.TransparentWithDraped),m=this._highQualityTransparency&&u;this._renderTerrainLinearDepth(m),this._setMultipassEnabled(m),this._setTerrainCulling(m),this._renderEdges(gt.OPAQUE),this.performanceInfo.advance(ai.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(ne.VOXEL),this.performanceInfo.advance(ai.VOXEL),this._renderHiddenTransparentEdges();const f=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;f&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(ai.TRANSPARENT),this._renderGeometryLinearDepth(m);const y=this._renderHUDVisibility(m);m||this._renderInternalSlot(ne.LINE_CALLOUTS),this.performanceInfo.advance(ai.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(ai.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(gt.TRANSPARENT,m),this.performanceInfo.advance(ai.TRANSPARENT_EDGES),this._renderTransparentTerrain(),u&&y&&(m?this._renderLineCallouts(Tc.Occluded):l.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Tc.Occluded,l.framebuffer),this.performanceInfo.advance(ai.HUD_OCCLUDED)),this.performanceInfo.advance(ai.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),u&&(l.compositeTransparentTerrainOntoMain(this._bindParameters),m&&(this._renderEdges(gt.OPAQUE),this.performanceInfo.advance(ai.OPAQUE_EDGES),f&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(ai.TRANSPARENT),this._renderEdges(gt.TRANSPARENT),this.performanceInfo.advance(ai.TRANSPARENT_EDGES))),m&&this._renderLineCallouts(Tc.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),l.renderToTargets(()=>{this._renderInternalSlot(ne.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(ne.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(ne.LASERLINES)},l.currentColorTarget,l.mainDepth),this.performanceInfo.advance(ai.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&l.renderTmpAndCompositeToMain(()=>this._renderSlot(ne.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Ls.PremultipliedAlpha),this.performanceInfo.advance(ai.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(ai.OCCLUDED);const g=r===Sy.ON&&this._magnifierHelper.enabled,v=g&&T(i)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):i;this._rctx.bindFramebuffer(v);const b=this._offscreen.colorTexture;!this._renderAntiAliasing(b)&&_(b)&&this._compositingHelper.composite(this._bindParameters,b,Ls.None),this.performanceInfo.advance(ai.ANTIALIASING),this._renderHUD(Tc.NotOccluded,v),this.performanceInfo.advance(ai.HUD),this._renderHighlights(v,this._bindParameters),this.performanceInfo.advance(ai.HIGHLIGHTS),g&&this._magnifierHelper.render(this._rctx,this._bindParameters),v!==i&&(this._rctx.bindFramebuffer(i),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,Ls.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=c,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(i){if(_(i)&&Vt("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(i),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass($.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(i),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Tc.NotOccluded,this._renderInternalSlot(ne.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(i){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,t=i===dr.BACKGROUND;if(t||e){const r=t?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),n=Math.max(r,s);this._animationTimestep.frame(n,t)}}readDepthPixels(i,e,t){const r=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(i,i),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Si.COLOR_BUFFER_BIT|Si.DEPTH_BUFFER_BIT|Si.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass($.Depth)}r.readPixels(e[0],e[1],e[2],e[3],Ke.RGBA,wt.UNSIGNED_BYTE,t)}readHUDVisibility(i,e,t,r,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(i,e,t,r,Ke.RGBA,wt.UNSIGNED_BYTE,s)}readAccumulatedShadow(i){return this._shadowAccumulator.readAccumulatedShadow(i[0],i[1])}_setMultipassEnabled(i){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=i}_setTerrainCulling(i){this._bindParameters.multipassTerrain.cullAboveGround=i}_renderSlot(i){this._bindParameters.slot=i,this._renderPlugins.render()}_renderEdges(i,e=!1){const t=this._edgeView;_(t)&&t.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>t.render(this._bindParameters,i),this._bindParameters,Ls.Alpha,e)}_renderShadowMap(i,e,t,r){const s=this._shadowMap;s.enabled&&this.isFeatureEnabled(Qi.ShadowMapUpdate)&&(s.start(e,t,r),this._shadowHighlight.updateParameters(e,t),this._needsShadowHighlight?(this._renderShadowCascades($.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,ig.Highlight)),s.clear(),this._renderShadowCascades($.ShadowExcludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,ig.Default),this._renderGeometryAndTransparentTerrainPass($.ShadowHighlight)})):this._renderShadowCascades($.Shadow),s.finish(i),e.setGLViewport(this._rctx))}_renderShadowCascades(i,e=this._shadowMap,t=r=>{}){for(const r of e.cascades)r.camera.setGLViewport(this._rctx),this._prepare(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(i),t(r)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass($.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(i){if(i){const e=this._renderContext.output;this._renderContext.output=$.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(i){if(i){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass($.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass($.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(i){if(!this._needsDepthRange)return qS;const e=Tde(i,this._materialRenderers,this._stage.layers);return ng(e,this.renderPlugins.queryDepthRange(i)),e.near=Math.max(i.near,e.near),e.far=Math.min(i.far,e.far),e}_renderGeometryAndTransparentTerrainPass(i){this._renderContext.output=i,this._renderGeometryPass(i),this._renderTransparentTerrain()}_renderGeometryPass(i){this._renderContext.output=i,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(i){this._ssaoHelper.render(this._bindParameters,i,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(ne.INTEGRATED_MESH),this._renderSlot(ne.OPAQUE_TERRAIN),this._renderInternalSlot(ne.OPAQUE_MATERIAL),this._renderSlot(ne.OPAQUE_MATERIAL),this._renderSlot(ne.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(ne.TRANSPARENT_MATERIAL),this._renderSlot(ne.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(ne.TRANSPARENT_TERRAIN)}_renderHUDVisibility(i){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(ne.OCCLUSION_PIXELS)},i),e}_renderLineCallouts(i){this._bindParameters.renderTransparentlyOccludedHUD=i,i===Tc.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(ne.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(ne.LINE_CALLOUTS)}_renderHUD(i,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(i),!0),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,Ls.PremultipliedAlpha)):i===Tc.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Tc.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(i))}_renderHUDElements(i){this._bindParameters.renderTransparentlyOccludedHUD=i,this._renderInternalSlot(ne.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(ne.HUD_MATERIAL),this._renderInternalSlot(ne.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(i,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const t=this._highlight,r=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass($.Highlight),this._rctx.clearSafe(Si.DEPTH_BUFFER_BIT),this._renderHUDElements(Tc.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,i),t.render(this._bindParameters,r,i)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(i,e,t){this._needsShadowCast&&_(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,i,e,t)}_renderOrderIndependentTransparency(i,e){const t=s=>{this._bindParameters.transparencyPassType=s,this._offscreen.renderOITPass(()=>i(),s,e)},r=this._renderContext.output;this._renderContext.output=$.Alpha,t(It.Alpha),this._renderContext.output=$.Color,t(It.Color),t(It.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,e),this._bindParameters.transparencyPassType=It.NONE,this._renderContext.output=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let i=0;Mo.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&n.material.renderOccluded===hr.OccludeAndTransparentStencil&&(i|=n.material.renderOccluded,Mo.push(n))});const e=this._offscreen,t=(n,a,o,l,c)=>{i&a&&(e.renderToTargets(o,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,n))};Mo.length!==0&&(this._renderInternalSlot(ne.OCCLUDER_MATERIAL,Mo),t(.5,hr.OccludeAndTransparentStencil,()=>this._renderInternalSlot(ne.TRANSPARENT_OCCLUDER_MATERIAL,Mo),!1,!1)),Mo.clear(),this._materialRenderers.forAll(n=>{n.material&&n.material.isVisible()&&(n.material.renderOccluded===hr.OccludeAndTransparent||n.material.renderOccluded===hr.Transparent||n.material.renderOccluded===hr.Opaque)&&(i|=n.material.renderOccluded,Mo.push(n))});const r=this._renderPlugins.renderOccludedFlags;if(i|=r,!i)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>hr.Occlude&&this._renderSlot(ne.OCCLUDED_TERRAIN),this._renderInternalSlot(ne.OPAQUE_MATERIAL,Mo),this._renderInternalSlot(ne.TRANSPARENT_MATERIAL,Mo),this._renderInternalSlot(ne.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Mo),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=$.Color,t(.5,hr.OccludeAndTransparent,()=>s(hr.OccludeAndTransparent),!0,H_.OutlineVisualElementMask),t(.5,hr.Transparent,()=>s(hr.Transparent),!0,H_.OutlineVisualElementMask),t(1,hr.Opaque,()=>s(hr.Opaque),!0,H_.OutlineVisualElementMask),Mo.clear()}_renderAntiAliasing(i){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&_(i))return this._smaaPass.render(i),!0}else this._smaaPass.disable();return!1}_prepare(i,e){this._needsTransparentPass=this._materialRenderers.some(t=>t.requiresSlot(ne.TRANSPARENT_MATERIAL,$.Color)),this._bindParameters.camera=i,this._bindParameters.contentCamera=e}_ensureBindParameters(i,e){this._bindParameters.camera=i,this._bindParameters.contentCamera=e;const t=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=t.hudVisibilityTexture,this._bindParameters.mainColorTexture=t.mainColorTexture,this._bindParameters.highlightDepthTexture=t.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(i){if(this._bindParameters.ssr.enabled=this.hasWaterReflection,this._bindParameters.ssr.enabled){T(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=i),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Bd:(aa(XL,this._bindParameters.camera.viewMatrix),aa(jL,this._bindParameters.camera.projectionMatrix),Sr(Vm,XL,jL),Sr(Vm,this._renderContext.lastFrameCamera.viewMatrix,Vm),Sr(Vm,this._renderContext.lastFrameCamera.projectionMatrix,Vm),this._reprojectionMatrix=Vm),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,i-this._waterReflectionEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._bindParameters.ssr.lastFrameColorTexture=null,this._waterReflectionEnableTime=null}_renderInternalSlot(i,e=this._materialRenderers){let t=!1;return this._bindParameters.slot=i,e.forAll(r=>{r.material.shouldRender(this._renderContext)&&r.render(this._renderContext.output,this._bindParameters)&&(t=!0)}),t}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=LF(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var i,e,t,r,s;return{offscreen:((i=this._offscreen)==null?void 0:i.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((t=this._shadowHighlight)==null?void 0:t.gpuMemoryUsage)??0),shadows:((r=this._shadowMap)==null?void 0:r.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const i=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{i._renderStateFeatures=xM()},getFramebufferTexture:e=>{switch(e){case _d.Color:return i._offscreen.colorTexture;case _d.LinearDepth:return i._offscreen.linearDepthTexture;case _d.Normals:return i._offscreen.normalTexture;case _d.ShadowMap:return i._shadowMap.depthTexture;case _d.HudVisibility:return i._offscreen.hudVisibilityTexture;case _d.Highlight:return i._offscreen.highlightTexture}}}}};var _d;d([p()],Ea.prototype,"_shadowAccumulator",void 0),d([p()],Ea.prototype,"_state",void 0),d([p()],Ea.prototype,"_renderStateFeatures",void 0),d([p()],Ea.prototype,"_antialiasingEnabled",void 0),d([p({readOnly:!0})],Ea.prototype,"_antialiasing",null),d([p()],Ea.prototype,"_ssaoEnabled",void 0),d([p()],Ea.prototype,"_smaaPass",void 0),d([p({autoDestroy:!0})],Ea.prototype,"_edgeView",void 0),d([p()],Ea.prototype,"updating",null),d([p()],Ea.prototype,"isCameraFinal",null),Ea=d([k("esri.views.3d.webgl-engine.lib.Renderer")],Ea),function(i){i[i.Color=0]="Color",i[i.LinearDepth=1]="LinearDepth",i[i.Normals=2]="Normals",i[i.ShadowMap=3]="ShadowMap",i[i.HudVisibility=4]="HudVisibility",i[i.Highlight=5]="Highlight"}(_d||(_d={}));const Mo=new Ht,jL=ve(),XL=ve(),Vm=ve();let YL=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:he.ONE,dstRGB:he.ZERO,srcAlpha:he.ONE,dstAlpha:he.ZERO},this.blendEquation={mode:wy.ADD,modeAlpha:wy.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Qu.BACK,this.frontFace=BF.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Ts.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Qu.FRONT_AND_BACK,func:Ts.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Qu.FRONT_AND_BACK,fail:Sf.KEEP,zFail:Sf.KEEP,zPass:Sf.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},wpe=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const t=new Map;this._allocations.forEach(r=>{t.set(r,(t.get(r)??0)+1)}),t.forEach((r,s)=>{const n=s.split(`
`);n.shift(),n.shift(),e+=`${r}: ${n.shift()}
`,n.forEach(a=>e+=`   ${a}
`)})}return e}};const xpe={RECORD_ALLOCATIONS:!1};let Tpe=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new wpe(xpe.RECORD_ALLOCATIONS);this._current.length<eh.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,t){const r=++this._current[e];this._max[e]=Math.max(r,this._max[e]),this._allocations.add(t)}decrement(e,t){--this._current[e],this._allocations.remove(t)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,t)=>e+t,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let t=0;t<eh.COUNT;++t){const r=this._current[t];r>0&&(e+=`${eh[t]}: ${r}
`)}}return e+=this._allocations.information,e}};const Cpe=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var QL,ZS={},Epe={get exports(){return ZS},set exports(i){ZS=i}};(QL=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Epe.exports=QL);const Spe=ZS;var ZL,KS={},Rpe={get exports(){return KS},set exports(i){KS=i}};ZL=Rpe,function(i){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(ZL.exports=e)}();const KL=KS;var JS={},Ape={get exports(){return JS},set exports(i){JS=i}};(function(i){(function(e){var t=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();t!==void 0&&(i.exports=t)})()})(Ape);const Ppe=JS;var Io=999,JL=9999,NC=0,UC=1,e$=2,t$=3,i$=4,Kv=5,Ope=6,Mpe=7,Ipe=8,r$=9,Dpe=10,s$=11,Lpe=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function $pe(){var i,e,t,r=0,s=0,n=Io,a=[],o=[],l=1,c=0,h=0,u=!1,m=!1,f="";return function(V){return o=[],V!==null?g(V.replace?V.replace(/\r\n/g,`
`):V):v()};function y(V){V.length&&o.push({type:Lpe[n],data:V,position:h,line:l,column:c})}function g(V){var Q;for(r=0,t=(f+=V).length;i=f[r],r<t;){switch(Q=r,n){case NC:r=P();break;case UC:r=S();break;case e$:r=w();break;case t$:r=A();break;case i$:r=I();break;case s$:r=O();break;case Kv:r=N();break;case JL:r=F();break;case r$:r=x();break;case Io:r=b()}Q!==r&&(f[Q]===`
`?(c=0,++l):++c)}return s+=r,f=f.slice(r),o}function v(V){return a.length&&y(a.join("")),n=Dpe,y("(eof)"),o}function b(){return a=a.length?[]:a,e==="/"&&i==="*"?(h=s+r-1,n=NC,e=i,r+1):e==="/"&&i==="/"?(h=s+r-1,n=UC,e=i,r+1):i==="#"?(n=e$,h=s+r,r):/\s/.test(i)?(n=r$,h=s+r,r):(u=/\d/.test(i),m=/[^\w_]/.test(i),h=s+r,n=u?i$:m?t$:JL,r)}function x(){return/[^\s]/g.test(i)?(y(a.join("")),n=Io,r):(a.push(i),e=i,r+1)}function w(){return i!=="\r"&&i!==`
`||e==="\\"?(a.push(i),e=i,r+1):(y(a.join("")),n=Io,r)}function S(){return w()}function P(){return i==="/"&&e==="*"?(a.push(i),y(a.join("")),n=Io,r+1):(a.push(i),e=i,r+1)}function A(){if(e==="."&&/\d/.test(i))return n=Kv,r;if(e==="/"&&i==="*")return n=NC,r;if(e==="/"&&i==="/")return n=UC,r;if(i==="."&&a.length){for(;M(a););return n=Kv,r}if(i===";"||i===")"||i==="("){if(a.length)for(;M(a););return y(i),n=Io,r+1}var V=a.length===2&&i!=="=";if(/[\w_\d\s]/.test(i)||V){for(;M(a););return n=Io,r}return a.push(i),e=i,r+1}function M(V){for(var Q,ae,q=0;;){if(Q=KL.indexOf(V.slice(0,V.length+q).join("")),ae=KL[Q],Q===-1){if(q--+V.length>0)continue;ae=V.slice(0,1).join("")}return y(ae),h+=ae.length,(a=a.slice(ae.length)).length}}function O(){return/[^a-fA-F0-9]/.test(i)?(y(a.join("")),n=Io,r):(a.push(i),e=i,r+1)}function I(){return i==="."||/[eE]/.test(i)?(a.push(i),n=Kv,e=i,r+1):i==="x"&&a.length===1&&a[0]==="0"?(n=s$,a.push(i),e=i,r+1):/[^\d]/.test(i)?(y(a.join("")),n=Io,r):(a.push(i),e=i,r+1)}function N(){return i==="f"&&(a.push(i),e=i,r+=1),/[eE]/.test(i)||i==="-"&&/[eE]/.test(e)?(a.push(i),e=i,r+1):/[^\d]/.test(i)?(y(a.join("")),n=Io,r):(a.push(i),e=i,r+1)}function F(){if(/[^\d\w_]/.test(i)){var V=a.join("");return n=Spe.indexOf(V)>-1?Ipe:Ppe.indexOf(V)>-1?Mpe:Ope,y(a.join("")),n=Io,r}return a.push(i),e=i,r+1}}function Fpe(i){var e=$pe(),t=[];return t=(t=t.concat(e(i))).concat(e(null))}function Npe(i){return Fpe(i)}function Upe(i){return i.map(e=>e.type!=="eof"?e.data:"").join("")}const VC=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Vpe(i,e="100",t="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of i)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const a=n[1].replace(/\s\s+/g," ");if(a===t)return a;if(a===e)return s.data="#version "+t,e;throw new Error("unknown glsl version: "+a)}}return i.splice(0,0,{type:"preprocessor",data:"#version "+t},{type:"whitespace",data:`
`}),null}function Bpe(i,e){for(let t=e-1;t>=0;t--){const r=i[t];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function N_(i,e,t,r){r=r||t;for(const s of i)if(s.type==="ident"&&s.data===t)return r in e?e[r]++:e[r]=0,N_(i,e,r+"_"+e[r],r);return t}function n8(i,e,t="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const u=l[h];if(u.type==="operator"&&u.data===";")return h}return null}function s(l){let c=-1,h=0,u=-1;for(let m=0;m<l.length;m++){const f=l[m];if(f.type==="preprocessor"&&(f.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:f.data.match(/\#endif\s*.*/)&&--h),t!=="afterVersion"&&t!=="afterPrecision"||f.type==="preprocessor"&&/^#version/.test(f.data)&&(u=Math.max(u,m)),t==="afterPrecision"&&f.type==="keyword"&&f.data==="precision"){const y=r(l,m);if(y===null)throw new Error("precision statement not followed by any semicolons!");u=Math.max(u,y)}c<u&&h===0&&(c=m)}return c+1}const n={data:`
`,type:"whitespace"},a=l=>l<i.length&&/[^\r\n]$/.test(i[l].data);let o=s(i);a(o-1)&&i.splice(o++,0,n);for(const l of e)i.splice(o++,0,l);a(o-1)&&a(o)&&i.splice(o,0,n)}function zpe(i,e,t,r="lowp"){n8(i,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function kpe(i,e,t,r,s="lowp"){n8(i,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Gpe(i,e){let t,r,s=-1;for(let n=e;n<i.length;n++){const a=i[n];if(a.type==="operator"&&(a.data==="["&&(t=n),a.data==="]")){r=n;break}a.type==="integer"&&(s=parseInt(a.data,10))}return t&&r&&i.splice(t,r-t+1),s}function n$(i,e){const t=Hpe();if(_(t))return t;const r=Npe(i);if(Vpe(r,"100","300 es")==="300 es")return i;let s=null,n=null;const a={},o={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":e===Ho.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=e===Ho.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),e===Ho.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=N_(r,a,"fragColor"),zpe(r,s,"vec4")),c.data=s),e===Ho.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=Gpe(r,l+1),u=N_(r,a,"fragData");kpe(r,u,"vec4",h,"mediump"),c.data=u}else e===Ho.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=N_(r,a,"gl_FragDepth")),c.data=n);break;case"ident":if(Cpe.includes(c.data)){if(e===Ho.VERTEX_SHADER&&Bpe(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in o||(o[c.data]=N_(r,a,c.data)),c.data=o[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&VC.includes(h[1].trim())){const f=r[l+1];r.splice(l,f&&f.type==="whitespace"?2:1)}const u=c.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&VC.includes(u[1].trim())&&(c.data="#if 1");const m=c.data.match(/\#ifndef\s+(.*)/);m&&m[1]&&VC.includes(m[1].trim())&&(c.data="#if 0")}}return qpe(i,Upe(r))}function Hpe(i){return null}function qpe(i,e){return e}const Wpe=4294967295;let jpe=class{constructor(e,t,r,s,n=new Map){this._context=e,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),t.length===0&&console.error("Shaders source should not be empty!"),this._context.type===wi.WEBGL2&&(t=n$(t,Ho.VERTEX_SHADER),r=n$(r,Ho.FRAGMENT_SHADER)),this._vShader=a$(this._context,Ho.VERTEX_SHADER,t),this._fShader=a$(this._context,Ho.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(eh.Shader,this),fE()&&(this.vertexShader=t,this.fragmentShader=r);const a=this._context.gl,o=a.createProgram();if(a.attachShader(o,this._vShader),a.attachShader(o,this._fShader),this._locations.forEach((l,c)=>a.bindAttribLocation(o,l,c)),a.linkProgram(o),fE()&&!a.getProgramParameter(o,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(o,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(o)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===wi.WEBGL2){const l=a;for(const[c,h]of this._uniformBlockBindings){const u=l.getUniformBlockIndex(o,c);u<Wpe&&l.uniformBlockBinding(o,u,h)}}this._glName=o,this._context.instanceCounter.increment(eh.Program,this)}get glName(){return this._glName}get hasGLName(){return _(this._glName)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||T(this.glName)?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(eh.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(eh.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&_(this.glName)&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,t){const r=this._nameToUniform1[e];r!==void 0&&t===r||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1iv(e,t){Rl(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t){Rl(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t){Rl(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t){Rl(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t){const r=this._nameToUniform1[e];r!==void 0&&t===r||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1fv(e,t){Rl(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),this._nameToUniform2.set(e,[t,r])):t===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),s[0]=t,s[1]=r)}setUniform2fv(e,t){Rl(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,s),this._nameToUniform3[e]=[t,r,s]):t===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,s),n[0]=t,n[1]=r,n[2]=s)}setUniform3fv(e,t){Rl(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(this._getUniformLocation(e),t)}setUniform4f(e,t,r,s,n){const a=this._nameToUniform4.get(e);a===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,s,n),this._nameToUniform4.set(e,[t,r,s,n])):a!==void 0&&t===a[0]&&r===a[1]&&s===a[2]&&n===a[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,s,n),a[0]=t,a[1]=r,a[2]=s,a[3]=n)}setUniform4fv(e,t){Rl(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(this._getUniformLocation(e),t)}setUniformMatrix3fv(e,t,r=!1){Rl(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,t)}setUniformMatrix4fv(e,t,r=!1){Rl(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,t)}stop(){}};function a$(i,e,t){const r=i.gl,s=r.createShader(e);return r.shaderSource(s,t),r.compileShader(s),fE()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Ho.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(Xpe(t))),s}function Xpe(i){let e=2;return i.replace(/\n/g,()=>`
`+Ype(e++)+":")}function Ype(i){return i>=1e3?i.toString():("  "+i).slice(-3)}function Rl(i,e,t){const r=i.get(e);return r?R$(r,t):(i.set(e,Array.from(t)),!0)}let Qpe=class{constructor(e){this._rctx=e,this._store=new d0}dispose(){this._store.forEach(e=>e.forEach(t=>t.dispose())),this._store.clear()}acquire(e,t,r,s){const n=this._store.get(e,t);if(_(n))return n.ref(),n;const a=new jpe(this._rctx,e,t,r,s);return a.ref(),this._store.set(e,t,a),a}get test(){let e=0;return this._store.forEach(t=>t.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLObjects:e}}},v0=class{constructor(){this._result=!1}dispose(){this._program=Le(this._program)}get result(){return _(this._program)&&(this._result=this._test(this._program),this.dispose()),this._result}},Zpe=class extends v0{constructor(e){super(),this._rctx=e,this._dummyProgram=null,this._rctx.type===wi.WEBGL2&&Vt("mac")&&Vt("chrome")&&(this._program=this._prepareProgram(),this._dummyProgram=this._prepareDummyProgram())}dispose(){var e;super.dispose(),(e=this._dummyProgram)==null||e.dispose(),this._dummyProgram=null}_test(e){const t=this._rctx;t.resetState();const r=new Ur(t,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,wrapMode:Dt.CLAMP_TO_EDGE,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,width:1,height:1}),s=Yt.createIndex(this._rctx,ri.STATIC_DRAW,new Uint8Array([0]));t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.useProgram(this._dummyProgram),t.bindBuffer(s,Ct.ELEMENT_ARRAY_BUFFER),t.drawElements(bt.POINTS,1,oa.UNSIGNED_BYTE,0),t.useProgram(e),t.bindVAO(null),t.drawArrays(bt.TRIANGLES,0,258);const n=new Uint8Array(4);return r.readPixels(0,0,1,1,Ke.RGBA,wt.UNSIGNED_BYTE,n),r.dispose(),s.dispose(),n[0]===255}_prepareProgram(){const t=`
    precision highp float;

    varying float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${R.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`
    precision highp float;

    varying float triangleId;

    void main(void) {
      gl_FragColor = triangleId == ${R.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(t,r,new Map([]))}_prepareDummyProgram(){const e=`
    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,t=`
    void main(void) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`;return this._rctx.programCache.acquire(e,t,new Map([]))}},Kpe=class extends v0{constructor(e){super(),this._rctx=e,this._program=o$(this._rctx,!1),this._obfuscated=o$(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Le(this._obfuscated)}_test(e){if(Vt("force-double-precision-obfuscation"))return!0;if(T(this._obfuscated))return!1;const t=this._runProgram(e),r=this._runProgram(this._obfuscated);return t!==0&&(r===0||t/r>5)}_runProgram(e){const t=this._rctx;t.resetState();const r=new Ur(t,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,wrapMode:Dt.CLAMP_TO_EDGE,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,width:1,height:1}),s=Yt.createVertex(t,ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new cl(t,new Map([["position",0]]),{geometry:[new _p("position",2,oa.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=qe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),o=qe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=new Float32Array(6);qP(a,l,3);const c=new Float32Array(6);qP(o,c,3),t.useProgram(e),e.setUniform3f("u_highA",l[0],l[2],l[4]),e.setUniform3f("u_lowA",l[1],l[3],l[5]),e.setUniform3f("u_highB",c[0],c[2],c[4]),e.setUniform3f("u_lowB",c[1],c[3],c[5]),t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.bindVAO(n),t.drawArrays(bt.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);r.readPixels(0,0,1,1,Ke.RGBA,wt.UNSIGNED_BYTE,h),n.dispose(!1),s.dispose(),r.dispose();const u=(a[2]-o[2])/25,m=w5(h);return Math.abs(u-m)}};function o$(i,e){const t=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return i.programCache.acquire(t,r,new Map([["position",0]]))}var l$,c$,e2={},Jpe={get exports(){return e2},set exports(i){e2=i}};l$=Jpe,(c$=function(){var i=function(g){window.console&&window.console.log&&window.console.log(g)},e=function(g){window.console&&window.console.error?window.console.error(g):i(g)},t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(g){if(r==null)for(var v in r={},s={},g)typeof g[v]=="number"&&(r[g[v]]=v,s[v]=g[v])}function a(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function o(g){return a(),r[g]!==void 0}function l(g){a();var v=r[g];return v!==void 0?"gl."+v:"/*UNKNOWN WebGL ENUM*/ 0x"+g.toString(16)}function c(g,v,b,x){var w;if((w=t[g])!==void 0&&(w=w[v])!==void 0&&w[b]){if(typeof w[b]=="object"&&w[b].enumBitwiseOr!==void 0){for(var S=w[b].enumBitwiseOr,P=0,A=[],M=0;M<S.length;++M){var O=s[S[M]];x&O&&(P|=O,A.push(l(O)))}return P===x?A.join(" | "):l(x)}return l(x)}return x===null?"null":x===void 0?"undefined":x.toString()}function h(g,v){for(var b="",x=v.length,w=0;w<x;++w)b+=(w==0?"":", ")+c(g,x,w,v[w]);return b}function u(g,v,b){g.__defineGetter__(b,function(){return v[b]}),g.__defineSetter__(b,function(x){v[b]=x})}function m(g,v,b,x){x=x||g,n(g),v=v||function(O,I,N){for(var F="",V=N.length,Q=0;Q<V;++Q)F+=(Q==0?"":", ")+c(I,V,Q,N[Q]);e("WebGL error "+l(O)+" in "+I+"("+F+")")};var w={};function S(O,I){return function(){b&&b(I,arguments);var N=O[I].apply(O,arguments),F=x.getError();return F!=0&&(w[F]=!0,v(F,I,arguments)),N}}var P={};for(var A in g)if(typeof g[A]=="function")if(A!="getExtension")P[A]=S(g,A);else{var M=S(g,A);P[A]=function(){return m(M.apply(g,arguments),v,b,x)}}else u(P,g,A);return P.getError=function(){for(var O in w)if(w.hasOwnProperty(O)&&w[O])return w[O]=!1,O;return g.NO_ERROR},P}function f(g){var v=g.getParameter(g.MAX_VERTEX_ATTRIBS),b=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,b);for(var x=0;x<v;++x)g.disableVertexAttribArray(x),g.vertexAttribPointer(x,4,g.FLOAT,!1,0,0),g.vertexAttrib1f(x,0);g.deleteBuffer(b);var w=g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS);for(x=0;x<w;++x)g.activeTexture(g.TEXTURE0+x),g.bindTexture(g.TEXTURE_CUBE_MAP,null),g.bindTexture(g.TEXTURE_2D,null);for(g.activeTexture(g.TEXTURE0),g.useProgram(null),g.bindBuffer(g.ARRAY_BUFFER,null),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null),g.bindFramebuffer(g.FRAMEBUFFER,null),g.bindRenderbuffer(g.RENDERBUFFER,null),g.disable(g.BLEND),g.disable(g.CULL_FACE),g.disable(g.DEPTH_TEST),g.disable(g.DITHER),g.disable(g.SCISSOR_TEST),g.blendColor(0,0,0,0),g.blendEquation(g.FUNC_ADD),g.blendFunc(g.ONE,g.ZERO),g.clearColor(0,0,0,0),g.clearDepth(1),g.clearStencil(-1),g.colorMask(!0,!0,!0,!0),g.cullFace(g.BACK),g.depthFunc(g.LESS),g.depthMask(!0),g.depthRange(0,1),g.frontFace(g.CCW),g.hint(g.GENERATE_MIPMAP_HINT,g.DONT_CARE),g.lineWidth(1),g.pixelStorei(g.PACK_ALIGNMENT,4),g.pixelStorei(g.UNPACK_ALIGNMENT,4),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),g.UNPACK_COLORSPACE_CONVERSION_WEBGL&&g.pixelStorei(g.UNPACK_COLORSPACE_CONVERSION_WEBGL,g.BROWSER_DEFAULT_WEBGL),g.polygonOffset(0,0),g.sampleCoverage(1,!1),g.scissor(0,0,g.canvas.width,g.canvas.height),g.stencilFunc(g.ALWAYS,0,4294967295),g.stencilMask(4294967295),g.stencilOp(g.KEEP,g.KEEP,g.KEEP),g.viewport(0,0,g.canvas.width,g.canvas.height),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT);g.getError(););}function y(g){var v,b,x=[],w=[],S={},P=1,A=!1,M=[],O=0,I=0,N=!1,F=0,V={};function Q(j){return typeof j=="function"?j:function(de){j.handleEvent(de)}}g.getContext=(b=g.getContext,function(){var j=b.apply(g,arguments);if(j instanceof WebGLRenderingContext){if(j!=v){if(v)throw"got different context";S=_e(v=j)}return S}return j});var ae=function(j){x.push(Q(j))},q=function(j){w.push(Q(j))};function D(j){var de=j.addEventListener;j.addEventListener=function(te,me,ye){switch(te){case"webglcontextlost":ae(me);break;case"webglcontextrestored":q(me);break;default:de.apply(j,arguments)}}}function H(){for(var j=Object.keys(V),de=0;de<j.length;++de)delete V[j]}function G(){++I,A||O==I&&g.loseContext()}function B(j,de){var te=j[de];return function(){if(G(),!A)return te.apply(j,arguments)}}function le(){for(var j=0;j<M.length;++j){var de=M[j];de instanceof WebGLBuffer?v.deleteBuffer(de):de instanceof WebGLFramebuffer?v.deleteFramebuffer(de):de instanceof WebGLProgram?v.deleteProgram(de):de instanceof WebGLRenderbuffer?v.deleteRenderbuffer(de):de instanceof WebGLShader?v.deleteShader(de):de instanceof WebGLTexture&&v.deleteTexture(de)}}function ce(j){return{statusMessage:j,preventDefault:function(){N=!0}}}return D(g),g.loseContext=function(){if(!A){for(A=!0,O=0,++P;v.getError(););H(),V[v.CONTEXT_LOST_WEBGL]=!0;var j=ce("context lost"),de=x.slice();setTimeout(function(){for(var te=0;te<de.length;++te)de[te](j);F>=0&&setTimeout(function(){g.restoreContext()},F)},0)}},g.restoreContext=function(){A&&w.length&&setTimeout(function(){if(!N)throw"can not restore. webglcontestlost listener did not call event.preventDefault";le(),f(v),A=!1,I=0,N=!1;for(var j=w.slice(),de=ce("context restored"),te=0;te<j.length;++te)j[te](de)},0)},g.loseContextInNCalls=function(j){if(A)throw"You can not ask a lost contet to be lost";O=I+j},g.getNumCalls=function(){return I},g.setRestoreTimeout=function(j){F=j},g;function _e(j){for(var de in j)typeof j[de]=="function"?S[de]=B(j,de):u(S,j,de);S.getError=function(){if(G(),!A)for(;Te=v.getError();)V[Te]=!0;for(var Te in V)if(V[Te])return delete V[Te],Te;return S.NO_ERROR};for(var te=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],me=0;me<te.length;++me){var ye=te[me];S[ye]=function(Te){return function(){if(G(),A)return null;var et=Te.apply(j,arguments);return et.__webglDebugContextLostId__=P,M.push(et),et}}(j[ye])}var Ue=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(me=0;me<Ue.length;++me)ye=Ue[me],S[ye]=function(Te){return function(){return G(),A?null:Te.apply(j,arguments)}}(S[ye]);var De=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(me=0;me<De.length;++me)ye=De[me],S[ye]=function(Te){return function(){return G(),!A&&Te.apply(j,arguments)}}(S[ye]);return S.checkFramebufferStatus=function(Te){return function(){return G(),A?S.FRAMEBUFFER_UNSUPPORTED:Te.apply(j,arguments)}}(S.checkFramebufferStatus),S.getAttribLocation=function(Te){return function(){return G(),A?-1:Te.apply(j,arguments)}}(S.getAttribLocation),S.getVertexAttribOffset=function(Te){return function(){return G(),A?0:Te.apply(j,arguments)}}(S.getVertexAttribOffset),S.isContextLost=function(){return A},S}}return{init:n,mightBeEnum:o,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:m,makeLostContextSimulatingCanvas:y,resetToInitialState:f}}())!==void 0&&(l$.exports=c$);let eme=class extends v0{constructor(e){var s,n,a,o,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===wi.WEBGL1)return void(this._result=!(!((s=e.capabilities.textureFloat)!=null&&s.textureFloat)||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat)));if(!((a=e.capabilities.textureFloat)!=null&&a.textureFloat&&((o=e.capabilities.colorBufferFloat)!=null&&o.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const t=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(t,r,new Map([["a_pos",0]]))}_test(e){const t=this._rctx,r=new Ur(t,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,wrapMode:Dt.CLAMP_TO_EDGE,pixelFormat:Ke.RGBA,dataType:wt.FLOAT,internalFormat:Ef.RGBA32F,samplingMode:Rt.NEAREST,width:1,height:1}),s=Yt.createVertex(t,ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new cl(t,new Map([["a_pos",0]]),{geometry:[new _p("a_pos",2,oa.UNSIGNED_SHORT,0,4)]},{geometry:s});t.useProgram(e);const a=t.getBoundFramebufferObject(),{x:o,y:l,width:c,height:h}=t.getViewport();t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.bindVAO(n),t.drawArrays(bt.TRIANGLE_STRIP,0,4);const u=it({blending:wk});t.setPipelineState(u),t.drawArrays(bt.TRIANGLE_STRIP,0,4),e2.init(t);const m=t.gl.getError();return t.setViewport(o,l,c,h),t.bindFramebuffer(a),n.dispose(!1),s.dispose(),r.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},tme=class extends v0{constructor(e){super(),this._rctx=e;const t=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(t,r,new Map([["a_pos",0]]))}_test(e){const t=this._rctx,r=new Ur(t,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,wrapMode:Dt.CLAMP_TO_EDGE,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,width:1,height:1}),s=new Uint8Array(4),n=Yt.createVertex(t,ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new cl(t,new Map([["a_position",0]]),{geometry:[new _p("a_position",2,oa.SHORT,0,4)]},{geometry:n});t.useProgram(e);const o=new ui(t,{target:Qt.TEXTURE_2D,wrapMode:Dt.CLAMP_TO_EDGE,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),t.bindTexture(o,0);const l=t.getBoundFramebufferObject();t.bindFramebuffer(r),t.useProgram(e);const{x:c,y:h,width:u,height:m}=t.getViewport();t.setViewport(0,0,1,1),t.bindVAO(a),t.drawArrays(bt.TRIANGLE_STRIP,0,4),t.setViewport(c,h,u,m),r.readPixels(0,0,1,1,Ke.RGBA,wt.UNSIGNED_BYTE,s),a.dispose(!1),n.dispose(),r.dispose();const f=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return f&&pe.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),t.bindFramebuffer(l),f}};new _p("a_pos",2,oa.BYTE,0,2);new _p("a_pos",2,oa.BYTE,0,4),new _p("a_tex",2,oa.BYTE,2,4);const ime={geometry:[new _p("a_pos",2,oa.UNSIGNED_SHORT,0,4)]};let rme=class extends v0{constructor(e){super(),this._rctx=e,this._image=new Image,this._image.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",this._image.width=5,this._image.height=5,this._image.decode();const t=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(t,r,new Map([["a_pos",0]]))}dispose(){super.dispose(),this._image.src=""}_test(e){const t=this._rctx;if(!t.gl)return e.dispose(),!0;const r=new Ur(t,{colorTarget:Wr.TEXTURE,depthStencilTarget:is.NONE},{target:Qt.TEXTURE_2D,wrapMode:Dt.CLAMP_TO_EDGE,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,samplingMode:Rt.NEAREST,width:1,height:1}),s=Yt.createVertex(t,ri.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new cl(t,new Map([["a_pos",0]]),ime,{geometry:s}),a=new ui(t,{dataType:wt.UNSIGNED_BYTE,pixelFormat:Ke.RGBA,preMultiplyAlpha:!1,wrapMode:Dt.CLAMP_TO_EDGE,samplingMode:Rt.LINEAR},this._image);t.useProgram(e),t.bindTexture(a,0),e.setUniform1i("u_texture",0);const o=t.getBoundFramebufferObject(),{x:l,y:c,width:h,height:u}=t.getViewport();t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.setClearColor(0,0,0,0),t.setBlendingEnabled(!1),t.clearSafe(Si.COLOR_BUFFER_BIT),t.bindVAO(n),t.drawArrays(bt.TRIANGLE_STRIP,0,4);const m=new Uint8Array(4);return r.readPixels(0,0,1,1,Ke.RGBA,wt.UNSIGNED_BYTE,m),n.dispose(!1),s.dispose(),r.dispose(),a.dispose(),t.setViewport(l,c,h,u),t.bindFramebuffer(o),m[0]!==255}},sme=class{constructor(e){this.rctx=e,this.floatBufferBlend=new eme(e),this.svgPremultipliesAlpha=new rme(e),this.doublePrecisionRequiresObfuscation=new Kpe(e),this.ignoresSamplerPrecision=new tme(e),this.drawArraysRequiresIndicesTypeReset=new Zpe(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function nme(i,e){if(e.disjointTimerQuery)return null;if(vc(i))return{drawBuffers:i.drawBuffers.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const t=i.getExtension("WEBGL_draw_buffers");return t?{drawBuffers:t.drawBuffersWEBGL.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function ame(i){if(vc(i))return i;const e=i.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function ome(i,e){if(e.compressedTextureETC)return null;const t=i.getExtension("WEBGL_compressed_texture_etc");return t?{COMPRESSED_R11_EAC:t.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:t.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:t.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:t.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:t.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:t.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:t.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function lme(i,e){if(e.compressedTextureS3TC)return null;const t=i.getExtension("WEBGL_compressed_texture_s3tc");return t?{COMPRESSED_RGB_S3TC_DXT1:t.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:t.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:t.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:t.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function cme(i,e){if(vc(i))return{MIN:i.MIN,MAX:i.MAX};if(e.blendMinMax)return null;{const t=i.getExtension("EXT_blend_minmax");return t?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null}}function hme(i,e){if(e.textureFilterAnisotropic)return null;const t=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return t?{MAX_TEXTURE_MAX_ANISOTROPY:t.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:t.TEXTURE_MAX_ANISOTROPY_EXT}:null}function dme(i,e){if(vc(i))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!i.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:i.HALF_FLOAT,R16F:i.R16F,RG16F:i.RG16F,RGBA16F:i.RGBA16F,R32F:i.R32F,RG32F:i.RG32F,RGBA32F:i.RGBA32F,R11F_G11F_B10F:i.R11F_G11F_B10F,RGB16F:i.RGB16F};if(i instanceof WebGLRenderingContext){const t=!e.textureHalfFloat&&i.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!i.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!i.getExtension("OES_texture_float_linear"),textureHalfFloat:!!t,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!i.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:t?t.HALF_FLOAT_OES:void 0}}return null}function ume(i,e){if(vc(i)){const t=!e.colorBufferHalfFloat&&i.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&i.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&i.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&i.getExtension("EXT_float_blend");return t||r||s?{textureFloat:!!r,textureHalfFloat:!!t,floatBlend:!!s,R16F:i.R16F,RG16F:i.RG16F,RGBA16F:i.RGBA16F,R32F:i.R32F,RG32F:i.RG32F,RGBA32F:i.RGBA32F,R11F_G11F_B10F:i.R11F_G11F_B10F,RGB16F:i.RGB16F}:null}if(i instanceof WebGLRenderingContext){const t=!e.colorBufferHalfFloat&&i.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&i.getExtension("WEBGL_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&i.getExtension("EXT_float_blend");return t||r||s?{textureFloat:!!r,textureHalfFloat:!!t,floatBlend:!!s,RGBA16F:t?t.RGBA16F_EXT:void 0,RGB16F:t?t.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function r_(i,e,t,r,s){if(r&&vc(i))return!0;if(e[t])return!1;for(const n of s)if(i.getExtension(n))return!0;return!1}function pme(i,e){if(!vc(i)||e.textureNorm16)return null;const t=i.getExtension("EXT_texture_norm16");return t?{R16:t.R16_EXT,RG16:t.RG16_EXT,RGB16:t.RGB16_EXT,RGBA16:t.RGBA16_EXT,R16_SNORM:t.R16_SNORM_EXT,RG16_SNORM:t.RG16_SNORM_EXT,RGB16_SNORM:t.RGB16_SNORM_EXT,RGBA16_SNORM:t.RGBA16_SNORM_EXT}:null}function mme(i,e){const t=e.loseContext&&i.getExtension("WEBGL_lose_context");return t?{loseRenderingContext:()=>t.loseContext()}:null}function fme(i,e){if(vc(i))return{createVertexArray:i.createVertexArray.bind(i),deleteVertexArray:i.deleteVertexArray.bind(i),bindVertexArray:i.bindVertexArray.bind(i)};if(e.vao)return null;const t=i.getExtension("OES_vertex_array_object")||i.getExtension("MOZ_OES_vertex_array_object")||i.getExtension("WEBKIT_OES_vertex_array_object");return t?{createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),bindVertexArray:t.bindVertexArrayOES.bind(t)}:null}let gme=class{constructor(e,t){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=t.disabledExtensions||{},this._debugWebGLExtensions=t.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=nme(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=ame(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=fme(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=ome(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=lme(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=hme(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=_pe(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=dme(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=ume(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=cme(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=r_(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=r_(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=r_(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=r_(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=mme(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=pme(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=r_(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},_me=class{constructor(e,t){this.gl=e,this.instanceCounter=new Tpe,this.programCache=new Qpe(this),this._state=new YL,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=vc(e)?wi.WEBGL2:wi.WEBGL1,this._loadExtensions(),this.configure(t)}get gl2(){return this.type===wi.WEBGL1?null:this.gl}configure(e){this._capabilities=new gme(this.gl,e),this._parameters=this._loadParameters(e);const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new YL,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new Mz({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Le(this._driverTest),this._driverTest=new sme(this)}dispose(){Le(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Ct.ARRAY_BUFFER),this.unbindBuffer(Ct.ELEMENT_ARRAY_BUFFER),this.type===wi.WEBGL2&&(this.unbindBuffer(Ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ct.PIXEL_PACK_BUFFER),this.unbindBuffer(Ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ct.COPY_READ_BUFFER),this.unbindBuffer(Ct.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Ch()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,r,s){e===this._state.blendColor.r&&t===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,t,r,s),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,t,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,t,r,s),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,t,r,s),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,t,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._state.stencilFunction.face=Qu.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,t,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,r){this._state.stencilOperation.face===Qu.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._state.stencilOperation.face=Qu.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,t,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const r=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(fx+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(e&Si.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Si.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Si.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,r){if(Ch()&&(this._numOfDrawCalls++,this._numOfTriangles+=h$(e,r)),this.gl.drawArrays(e,t,r),Ch()){const s=EP(this);s&&console.error("drawArrays:",s)}}drawElements(e,t,r,s){if(Ch()&&(this._numOfDrawCalls++,this._numOfTriangles+=h$(e,t)),this.gl.drawElements(e,t,r,s),Ch()){const n=EP(this);if(n){const a=this.getBoundVAO(),o=a==null?void 0:a.indexBuffer,l=a==null?void 0:a.vertexBuffers,c={indexBuffer:o,vertexBuffers:l},h={mode:e,count:t,type:r,offset:s},u=sa(o,y=>y.size)??0,m=s+t,f=u<m?`. Buffer is too small. Attempted to draw index ${m} of ${u}`:"";console.error(`drawElements: ${n}${f}`,{args:h,vao:c})}}}logInfo(){Ch()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Ch()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===t&&n.width===r&&n.height===s||(n.x=e,n.y=t,n.width=r,n.height=s,this.gl.viewport(e,t,r,s))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var t;this._state.program!==e&&((t=this._state.program)==null||t.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,t,r=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[t];return T(e)||e.glName==null?(_(s)&&(this.setActiveTexture(t,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[t]=null,s):r||s!==e?(this.setActiveTexture(t,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,s):(e.isDirty&&(this.setActiveTexture(t,r),e.applyChanges()),s)}unbindTexture(e){if(!T(e))for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(T(e))return this.gl.bindFramebuffer(Eo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Eo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t,r=!1){const s=t===Eo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(T(e)?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),s?this._state.readFramebuffer=Ze(e,null):this._state.drawFramebuffer=Ze(e,null))}blitFramebuffer(e,t,r=0,s=0,n=e.width,a=e.height,o=0,l=0,c=t.width,h=t.height,u=Si.COLOR_BUFFER_BIT,m=Rt.NEAREST){this.bindFramebufferSeparate(e,Eo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,Eo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,a,o,l,c,h,u,m)}bindBuffer(e,t){if(e)switch(t??(t=e.bufferType),t){case Ct.ARRAY_BUFFER:this._state.vertexBuffer=zn(this.gl,e,t,this._state.vertexBuffer);break;case Ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=zn(this.gl,e,t,this._state.indexBuffer);break;case Ct.UNIFORM_BUFFER:this._state.uniformBuffer=zn(this.gl,e,t,this._state.uniformBuffer);break;case Ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=zn(this.gl,e,t,this._state.pixelPackBuffer);break;case Ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=zn(this.gl,e,t,this._state.pixelUnpackBuffer);break;case Ct.COPY_READ_BUFFER:this._state.copyReadBuffer=zn(this.gl,e,t,this._state.copyReadBuffer);break;case Ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=zn(this.gl,e,t,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[t];return T(s)&&(s={buffer:null,offset:0,size:0},r[t]=s),s}bindBufferBase(e,t,r){const s=this._getBufferBinding(e,t);T(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,t,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(e,t,r,s,n){const a=this._getBufferBinding(e,t);if(!T(a)&&!(a.buffer===r&&a.offset===s&&a.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,t,r.glName,s,n),a.buffer=r,a.offset=s,a.size=n}}bindUBO(e,t,r,s){T(t)?this.bindBufferBase(Ct.UNIFORM_BUFFER,e,null):(Ch()&&(s??t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Ct.UNIFORM_BUFFER,e,t.buffer,r,s):this.bindBufferBase(Ct.UNIFORM_BUFFER,e,t.buffer))}unbindUBO(e){for(let t=0,r=this._state.uniformBufferBindingPoints.length;t<r;t++){const s=this._state.uniformBufferBindingPoints[t];_(s)&&s.buffer===e.buffer&&this.bindBufferBase(Ct.UNIFORM_BUFFER,t,null)}}unbindBuffer(e){switch(e){case Ct.ARRAY_BUFFER:this._state.vertexBuffer=zn(this.gl,null,e,this._state.vertexBuffer);break;case Ct.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=zn(this.gl,null,e,this._state.indexBuffer);break;case Ct.UNIFORM_BUFFER:this._state.uniformBuffer=zn(this.gl,null,e,this._state.uniformBuffer);break;case Ct.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=zn(this.gl,null,e,this._state.pixelPackBuffer);break;case Ct.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=zn(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Ct.COPY_READ_BUFFER:this._state.copyReadBuffer=zn(this.gl,null,e,this._state.copyReadBuffer);break;case Ct.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=zn(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){T(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}async clientWaitAsync(e=tt(10)){const t=this.gl,r=t.fenceSync(Hz.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(eh.Sync,r),t.flush();do await kf(e),s=t.clientWaitSync(r,0,0);while(s===SP.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(eh.Sync,r),t.deleteSync(r),s===SP.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Eo.FRAMEBUFFER){return e===Eo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Ct.ARRAY_BUFFER),this.unbindBuffer(Ct.ELEMENT_ARRAY_BUFFER),this.type===wi.WEBGL2&&(this.unbindBuffer(Ct.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Ct.PIXEL_PACK_BUFFER),this.unbindBuffer(Ct.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Ct.COPY_READ_BUFFER),this.unbindBuffer(Ct.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(he.ONE,he.ZERO),this.setBlendEquation(wy.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Qu.BACK),this.setFrontFace(BF.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Ts.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Ts.ALWAYS,0,0),this.setStencilOp(Sf.KEEP,Sf.KEEP,Sf.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var n,a,o;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:t,gl2:r}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)t.disableVertexAttribArray(l);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(Ct.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,null),_(r)){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(Ct.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(_(c)){const{buffer:h,offset:u,size:m}=c;h!==null?u===0&&m===0?r.bindBufferBase(Ct.UNIFORM_BUFFER,l,h.glName):r.bindBufferRange(Ct.UNIFORM_BUFFER,l,h.glName,u,m):r.bindBufferBase(Ct.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(Ct.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(Ct.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(Ct.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(Ct.COPY_WRITE_BUFFER,null),r.bindFramebuffer(Eo.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(Eo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(qz.COLOR_ATTACHMENT0)),r.bindFramebuffer(Eo.DRAW_FRAMEBUFFER,((n=this._state.drawFramebuffer)==null?void 0:n.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Eo.FRAMEBUFFER,((a=this._state.drawFramebuffer)==null?void 0:a.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}t.useProgram(((o=this._state.program)==null?void 0:o.glName)??null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){t.activeTexture(fx+l),t.bindTexture(Qt.TEXTURE_2D,null),t.bindTexture(Qt.TEXTURE_CUBE_MAP,null),this.type===wi.WEBGL2&&(t.bindTexture(Qt.TEXTURE_3D,null),t.bindTexture(Qt.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];_(c)&&t.bindTexture(c.descriptor.target,c.glName)}t.activeTexture(fx+this._state.activeTexture);const s=this._state.viewport;t.viewport(s.x,s.y,s.width,s.height),this.resetInfo()}_loadExtensions(){this.type===wi.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(e){const t=this.capabilities.textureFilterAnisotropic,r=e.maxAnisotropy??1/0,s=this.type===wi.WEBGL2,n=this.gl,a={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:t?Math.min(this.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return ui.TEXTURE_UNIT_FOR_UPDATES=a.maxTextureImageUnits-1,a}};function zn(i,e,t,r){return e?r!==e&&i.bindBuffer(t,e.glName):i.bindBuffer(t,null),e}function h$(i,e){switch(i){case bt.POINTS:return 2*e;case bt.TRIANGLES:return e/3;case bt.TRIANGLE_STRIP:case bt.TRIANGLE_FAN:return e-2;default:return 0}}let yme=class extends _me{constructor(e,t,r){super(e,t),this.newCache=r,this._refCount=1}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}bindTechnique(e,t,r,s){return this.useProgram(e.program),e.bindPipelineState(this,r==null?void 0:r.slot,!!s),e.program.bindPass(t,r),e.program}get test(){return this.programCache.test}},sf=class extends ge{constructor(e,t,r){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Br,this._frameTask=e.view.resourceController.scheduler.registerTask(rr.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Ns.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return T(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(oA,new lA)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),Ze(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)}),e&&this.events.emit("changed",dr.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(T(t))return _t(t!==void 0),null;const r=t.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new vme(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&t.unload()})});return this._textures.set(e,s),s.ref(),_(t.glTexture)?(this._updateGLTexture(s,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=t.load(this._rctx,()=>this.textureTechnique),a=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),s),o=l=>(this._loadingCount--,s.loadingPromise=null,za(l)||pe.getLogger(this.declaredClass).error(l),null);return r0(n)?n.then(a,o):a(n)}),s.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",dr.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([p()],sf.prototype,"_loadingCount",void 0),d([p()],sf.prototype,"_frameTask",void 0),d([p()],sf.prototype,"updating",null),sf=d([k("esri.views.3d.webgl-engine.lib.TextureRepository")],sf);class vme{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(pe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}let U_=class extends ge{constructor(){super(...arguments),this._passParameters=new bme,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Le(this._passParameters.waveNormal),this._passParameters.wavePertubation=Le(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return a1.LOADING;if(_(this._passParameters.waveNormal)&&_(this._passParameters.wavePertubation))return a1.LOADED;const t={target:Qt.TEXTURE_2D,pixelFormat:Ke.RGBA,dataType:wt.UNSIGNED_BYTE,wrapMode:Dt.REPEAT,samplingMode:Rt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,gp(aE("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new ui(e,{...t,width:r.width,height:r.height},r)).catch(r=>pe.getLogger(this.declaredClass).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,gp(aE("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new ui(e,{...t,width:r.width,height:r.height},r)).catch(r=>pe.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),a1.LOADING}};d([p()],U_.prototype,"_loading",void 0),d([p({type:Boolean,readOnly:!0})],U_.prototype,"updating",null),U_=d([k("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],U_);let bme=class extends ur{};const d$=2048,wme=1.5,xme=8;function Tme(i,e){const{format:t,quality:r,rotation:s,disableDecorations:n}=i||{},a=BA(i,e.padding),o=Ome(i,{width:e.width-a.left-a.right,height:e.height-a.top-a.bottom}),{width:l,height:c}=Pme(i,o),h=Dme(t),u=Ume[h];return{format:h,quality:ie(r??u,0,100),area:o,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!i||!i.ignoreBackground),ignorePadding:!(!i||!i.ignorePadding)}}function Cme(i,e){const t=Tme(i,e),r=t.area,s=t.width/r.width,n=BA(t,e.padding),a=n.left+n.right,o=n.top+n.bottom,l=e.width-a,c=e.height-o,h=Math.floor(l*s+a),u=Math.floor(c*s+o),m=i&&i.layers?i.layers:[],f=t.ignoreBackground,y=t.ignorePadding;return{framebufferWidth:h,framebufferHeight:u,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:t.width,height:t.height},format:t.format,quality:t.quality,rotation:t.rotation,pixelRatio:s,layers:m,disableDecorations:t.disableDecorations,ignoreBackground:f,ignorePadding:y,objectAndLayerIdColor:!1}}function BC(i,e,t){const{ctx:r,canvas:s}=a8(i,t),n=r.getImageData(0,0,i.width,i.height),a=Sme(s,e);return o8(s),{dataUrl:a,data:n}}function zC(i,e){const{ctx:t,canvas:r}=a8(i,e),s=t.getImageData(0,0,i.width,i.height);return o8(r),s}function a8(i,e){const t=Eme();e.premultipliedAlpha&&$me(i),t.width=i.width,t.height=i.height;const r=t.getContext("2d",{willReadFrequently:!0});return r.putImageData(i,0,0),e.flipY&&Lme(r),{ctx:r,canvas:t}}function o8(i){i.width=0,i.height=0}function Eme(){return T(kC)&&(kC=document.createElement("canvas")),kC}let kC=null;function Sme(i,e){const t=Fme[e.format],r=e.quality/100;return i.toDataURL(t,r)}function Rme(i,e,t,r=0,s=0,n=i.width-r,a=i.height-s,o=!1){const{data:l}=i,{width:c,height:h,data:u}=e,m=n/c,f=a/h,y=Math.ceil(m/2),g=Math.ceil(f/2),v=i.width;for(let b=0;b<h;b++)for(let x=0;x<c;x++){const w=4*(x+(o?h-b-1:b)*c);let S=0,P=0,A=0,M=0,O=0,I=0;const N=(b+.5)*f;for(let F=Math.floor(b*f);F<(b+1)*f;F++){const V=Math.abs(N-(F+.5))/g,Q=(x+.5)*m,ae=V*V;for(let q=Math.floor(x*m);q<(x+1)*m;q++){const D=Math.abs(Q-(q+.5))/y,H=Math.sqrt(ae+D*D);if(H>=1)continue;let G=2*H*H*H-3*H*H+1;const B=4*(r+q+(s+F)*v);I+=G*l[B+3],P+=G,!t&&l[B+3]<255&&(G=G*l[B+3]/255),A+=G*l[B],M+=G*l[B+1],O+=G*l[B+2],S+=G}}u[w]=A/S,u[w+1]=M/S,u[w+2]=O/S,u[w+3]=I/P}return e}function Ame(i,e,t){if(!e)return i;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:a}=i,o=BA(i,t),l=o.left+o.right,c=o.top+o.bottom,h=r-l,u=s-c,m=Math.min(xme,Math.min((d$-l)/h,(d$-c)/u));return m<wme?i:{...i,framebufferWidth:Math.round(h*m)+l,framebufferHeight:Math.round(u*m)+c,pixelRatio:n*m,resample:{region:{x:Math.round((a.x-o.left)*m)+o.left,y:Math.round((a.y-o.top)*m)+o.top,width:Math.round(a.width*m),height:Math.round(a.height*m)},width:r,height:s}}}function Pme(i,e){if(!i)return e;const t=i.width,r=i.height;if(t!=null&&r!=null)return{width:Math.floor(t),height:Math.floor(r)};if(t==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(t),height:Math.floor(t/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function Ome(i,e){const t={x:0,y:0,width:e.width,height:e.height};if(i&&i.area){i.area.x!=null&&(t.x=Math.floor(i.area.x)),i.area.y!=null&&(t.y=Math.floor(i.area.y));const r=i.area.width!=null?Math.floor(i.area.width):null,s=i.area.height!=null?Math.floor(i.area.height):null;if(t.width=e.width-t.x,t.height=e.height-t.y,r!=null&&s!=null)t.width=Math.min(t.width,r),t.height=Math.min(t.height,s);else if(r==null&&s!=null){const n=Math.min(t.width,r);t.height=n/t.width*t.height,t.width=n}else if(r!=null&&s==null){const n=Math.min(t.height,s);t.width=n/t.height*t.width,t.height=n}}return Mme(Ime(t,i),e)}function Mme(i,e){const t=Math.floor(Math.max(i.x,0)),r=Math.floor(Math.max(i.y,0)),s={x:t,y:r,width:Math.floor(Math.min(i.width,e.width-t)),height:Math.floor(Math.min(i.height,e.height-r))},n=s.width/s.height,a=i.width/i.height;if(a===n)return s;if(a>n){const c=Math.floor(s.width/a),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const o=Math.floor(s.height*a),l=s.width-o;return{x:Math.floor(s.x+l/2),y:s.y,width:o,height:s.height}}function Ime(i,e){if(!e||e.width==null||e.height==null)return i;const t=e.width/e.height,r=i.width/i.height;if(r===t)return i;if(r<t){const n=Math.floor(i.height*t);return i.x-=(n-i.width)/2,i.width=n,i}const s=Math.floor(i.width/t);return i.y-=(s-i.height)/2,i.height=s,i}function BA(i,e){return!e||i&&i.ignorePadding?Vme:e}function Dme(i){switch(i){case"png":case"jpg":case"jpeg":return i;default:return Nme}}function Lme(i){i.save(),i.globalCompositeOperation="copy",i.scale(1,-1),i.translate(0,-i.canvas.height),i.drawImage(i.canvas,0,0),i.restore()}function $me(i){const e=i.data,t=e.length;for(let r=0;r<t;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r+0]=e[r+0]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const Fme={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},u$=98,Nme="png",Ume={png:100,jpg:u$,jpeg:u$},Vme={top:0,right:0,bottom:0,left:0};let Bme=class{constructor(e,t){this.viewCamera=e,this.frameHasDecorations=t}},zme=class{constructor(e,t,r,s){this._rctx=e,this._renderFunctions=t,this._forceCameraHook=r,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(dr.BACKGROUND);const t=hp();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e,t){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.viewCamera.pixelRatio},n=this._renderScreenshot(e,s,t);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,t,r){e.width=t.width,e.height=t.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,t.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),t=this._renderFunctions.renderOverlay(e,t),s.restore(),t}_readbackScreenshot(e,t){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},t):this._readbackScreenshotImmediate(e,t)}_readbackScreenshotResampled(e,t){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:a}=e,o=this._ensureScreenshotEncodeCanvas();let l=gx(r,s,o);this._rctx.gl.readPixels(0,0,r,s,Ke.RGBA,oa.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),t(),l=this._renderScreenshotOverlay(o,l,{...e,region:void 0});const c=gx(n.width,n.height,o);return Rme(l,c,!0,a.region.x,s-(a.region.y+a.region.height),a.region.width,a.region.height)}_readbackScreenshotImmediate(e,t){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),a=gx(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Ke.RGBA,oa.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),t(),this._renderScreenshotOverlay(n,a,e)}_renderScreenshot(e,t,r){let s=null,n=null;const a=e.viewCamera,{framebufferWidth:o,framebufferHeight:l}=t;let c=!1;const h=t.disableDecorations&&e.frameHasDecorations,u=o!==a.fullWidth||l!==a.fullHeight,m=t.ignorePadding&&a.pixelRatio!==t.pixelRatio,f=u||h||m||t.objectAndLayerIdColor;if(t.objectAndLayerIdColor&&(n=new Ur(this._rctx,{width:o,height:l,colorTarget:Wr.TEXTURE,depthStencilTarget:is.DEPTH_STENCIL_RENDER_BUFFER})),f){const b=a.clone();if(t.ignorePadding){const S=dw(b.padding);for(let P=0;P<4;P++)S[P]=Math.round(S[P]/b.pixelRatio*t.pixelRatio);b.padding=S}b.fullWidth=o,b.fullHeight=l,b.pixelRatio=t.pixelRatio;const x=a.fovX-b.fovX,w=a.fovY-b.fovY;x<0&&x<w?b.fovX=a.fovX:w<0&&w<x&&(b.fovY=a.fovY),this._forceCameraHook(b),c=!0,s=new Ur(this._rctx,{width:b.fullWidth,height:b.fullHeight,colorTarget:Wr.TEXTURE,depthStencilTarget:is.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(s,n,b,t.disableDecorations?Sy.OFF:Sy.ON,r),this._disposeOffscreenBuffers()}const y=()=>{this._rctx.bindFramebuffer(null),Le(s)},g=this._readbackScreenshot(t,y);y();let v=null;if(t.objectAndLayerIdColor){const b=()=>{this._rctx.bindFramebuffer(null),Le(n)};this._rctx.bindFramebuffer(n),v=this._readbackScreenshot(t,b),this._rctx.bindFramebuffer(null),b()}if(f&&!this._rctx.contextAttributes.alpha)for(let b=3;b<g.data.length;b+=4)g.data[b]=255;if(v&&!this._rctx.contextAttributes.alpha)for(let b=3;b<v.data.length;b+=4)v.data[b]=255;return c&&this._forceCameraHook(a),[g,v]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Kr=class extends ge{constructor(e){super({}),this.events=new Br,this.waterTextureRepository=new U_,this._magnifierHelper=new rf,this.objectAndLayerIdRenderHelper=Vt("enable-feature:objectAndLayerId-rendering")?new Vde:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),z(()=>{var r;return(r=this.waterTextureRepository)==null?void 0:r.updating},()=>this.requestRender(),Je),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new _5(this._rctx),this._shaderTechniqueRepository=new K9({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new sf(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",r=>this.requestRender(r)),this._materialRepository=new J9(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new _de(this._rctx,this._shaderTechniqueRepository),this.renderer=new Ea(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,r=>this.requestRender(r));const t={renderScene:(r,s,n,a,o)=>this.renderer.render(r,s,{camera:n,contentCamera:n,mode:bi.IDLE},a,o),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(r,s)=>e.options.screenshot.renderOverlay(r,s)};this._screenshotManager=new zme(this._rctx,t,r=>this.events.emit("force-camera-for-screenshot",r),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Us(this._frameTask),this._shaderTechniqueRepository=we(this._shaderTechniqueRepository)}get performanceInfo(){const e=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=dr.UPDATE){this._needsRender=!0,e===dr.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(t=>t[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,t,r,s,n,a=n){const o=s.constrainWindowSize(t,r,n*s.pixelRatio,a*s.pixelRatio),l=this._ensureDepthBuffer(o);this.renderer.readDepthPixels(s,o,l);let c=Number.MAX_VALUE;for(let h=0;h<o[2]*o[3];h++){const u=xde(4*h,l,s.nearFar);c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}if(_(e)){const h=e.pickDepth(t*s.pixelRatio,r*s.pixelRatio,s);_(h)&&c>h&&h!==s.nearFar[0]&&h!==s.nearFar[1]&&(c=h)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(T(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}async reloadShaders(){TU(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const t=e.view.state;let r=!1,s=dr.BACKGROUND,n=!1;const a={preRender:({time:o})=>{r=this.updating,s=this._needsUpdate?dr.UPDATE:dr.BACKGROUND,e.commitSyncLayers();const l=tt(o-this._lastAnimationUpdate);if(l>this.renderer.animationTimestep||_(t.forcedAnimationTime)||r||this._needsRender){const c=tt(l/this.renderer.animationTimeDilation),h=new NF(t.camera,c,t.forcedAnimationTime);this.renderer.updateAnimation(h)&&this.requestRender(dr.BACKGROUND),this._lastAnimationUpdate=o}},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,t,Sy.ON,o),n=!0,l&&this.renderer.hasWaterReflection&&(this.requestRender(dr.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{const l=new Bme(t.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,o)},finish:()=>{n&&(this.renderer.finish(t.mode===bi.IDLE?s:dr.UPDATE),n=!1)}};this._frameTask=Vf(a)}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:t.preserveDrawingBuffer??!1},s=Yk("3d",this._canvas,r);if(T(s)){const n=Vt("esri-force-webgl");pe.getLogger(this.declaredClass).error(n)}else this._rctx=this._newRenderingContext(s,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&pe.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Vt("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},s=(n,a)=>t.view.resourceController.memoryController.newCache(n,a);return new yme(e,r,s)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return _(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return T(this._componentObjectCollection)&&(this._componentObjectCollection=new ode(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};d([p({type:Boolean,readOnly:!0})],Kr.prototype,"updating",null),d([p({autoDestroy:!0})],Kr.prototype,"_rctx",void 0),d([p({autoDestroy:!0})],Kr.prototype,"_container",void 0),d([p({autoDestroy:!0})],Kr.prototype,"_canvas",void 0),d([p({autoDestroy:!0})],Kr.prototype,"_stippleTextureRepository",void 0),d([p({autoDestroy:!0})],Kr.prototype,"waterTextureRepository",void 0),d([p({autoDestroy:!0})],Kr.prototype,"_magnifierHelper",void 0),d([p({readOnly:!0})],Kr.prototype,"objectAndLayerIdRenderHelper",void 0),d([p({autoDestroy:!0})],Kr.prototype,"_textureRepository",void 0),d([p({autoDestroy:!0})],Kr.prototype,"_compositingHelper",void 0),d([p({autoDestroy:!0,readOnly:!0})],Kr.prototype,"renderer",void 0),d([p({autoDestroy:!0})],Kr.prototype,"_screenshotManager",void 0),d([p()],Kr.prototype,"componentObjectCollection",null),d([p({autoDestroy:!0})],Kr.prototype,"_componentObjectCollection",void 0),d([p()],Kr.prototype,"_needsUpdate",void 0),d([p()],Kr.prototype,"_needsWaterReflectionUpdate",void 0),Kr=d([k("esri.views.3d.webgl-engine.parts.RenderView")],Kr);let Wn=class extends ge{constructor(e){super(e),this._handles=new mi,this._model=new z1,this._layers=new Ht,this._asyncChangeSet=new vS,this._syncChangeSet=new vS,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Kr(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(rr.STAGE,this),this._handles.add(this._frameTask)}destroy(){this._handles.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),Bb(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){T(e)||(this.renderView.requestRender(),this._model.remove(e),Bb(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e,t){T(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(r=>T(r.glTexture)).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),t)))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===Ld.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?ta:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ta),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==Ld.ASYNC||(t.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===Ld.SYNC)&&(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ta),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,ta),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,ta))}addRenderPlugin(e,t,r){const s=this.renderer.renderPlugins.add(e,t,r),n=()=>{pD(t)&&this.view.sceneIntersectionHelper.addIntersectionHandler(t)};if(r0(s))return s.then(n);n()}removeRenderPlugin(e){pD(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(r=>r.type===t).length,model:e._model}}};Wn.DebugSettings={endFrameContentValidation:!1},d([p({constructOnly:!0})],Wn.prototype,"view",void 0),d([p({constructOnly:!0})],Wn.prototype,"options",void 0),d([p({readOnly:!0})],Wn.prototype,"viewingMode",null),d([p({constructOnly:!0})],Wn.prototype,"container",void 0),d([p({constructOnly:!0})],Wn.prototype,"_handles",void 0),d([p({readOnly:!0})],Wn.prototype,"updating",null),d([p({constructOnly:!0})],Wn.prototype,"_model",void 0),d([p({autoDestroy:!0})],Wn.prototype,"renderView",void 0),d([p({readOnly:!0})],Wn.prototype,"renderer",null),d([p({readOnly:!0})],Wn.prototype,"running",null),Wn=d([k("esri.views.3d.webgl-engine.Stage")],Wn);let m2e=class extends Pw{constructor(e,t,r,s){super(t,r),this.point=e,this.createGraphic=s}};function l8(i){return pl(i)&&i.intersector===Ri.PCL&&!!i.target}let g2e=class extends nN{constructor(e,t,r,s,n){super(e),this.layerUid=e,this.sublayerUid=t,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},y2e=class extends Pw{constructor(e,t,r){super(t,null),this.point=e,this.createVoxelGraphic=r}};function tx(i){return pl(i)&&i.intersector===Ri.I3S&&!!i.target}function c8(i){return pl(i)&&i.intersector===Ri.VOXEL&&!!i.target}function p$(i,e){var t,r;return Ow(i)||Mw(i)?Jy((t=i.target)==null?void 0:t.object.metadata,e):Hte(i)?(r=e.map)==null?void 0:r.ground:l8(i)||tx(i)||o6(i)||c8(i)?Jy(i.target,e):null}function b2e(i,e){const t=t2(i,e);return _(t)&&t.type==="graphic"?t.graphic:null}function t2(i,e){var t;if(T(i))return null;if(Ow(i)||Mw(i))return m$((t=i.target)==null?void 0:t.object.metadata,e);if(l8(i)){const r=i.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(c8(i)){const r=i.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return o6(i)||pA(i)?m$(i.target,e):tx(i)?kme(i.target,e):null}function m$(i,e){if(T(i)||T(i.graphicUid))return null;const t=Jy(i,e);if(T(t))return null;if(t===e.graphics)return T(e.graphicsView)||typeof i.graphicUid!="number"?null:e.graphicsView.getHit(i.graphicUid);const r=e.allLayerViews.find(s=>s.layer===t);return!r||r.suspended||T(i.graphicUid)?null:"getHit"in r?r.getHit(i.graphicUid):null}function kme(i,e){const t=Jy(i,e);if(T(t))return null;const r=e.allLayerViews.find(s=>s.layer===t);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?Hme(r.getGraphicFromIntersectorTarget(i)):null}function Gme(i,e){const t=Jy(i,e);if(T(t))return null;const r=e.allLayerViews.find(s=>s.layer===t);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(i):null}function Hme(i){return _(i)?{type:"graphic",graphic:i,layer:i.layer}:null}function Jy(i,e){return!i||T(i.layerUid)?null:_(e.graphicsView)&&i.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(i.layerUid)}function w2e(i,e){if(Ow(i)||Mw(i))return W$(i.target.object.boundingVolumeWorldSpace.bounds);if(pA(i)){UB(Jv,i.transformation);const t=Math.max(Jv[0],Jv[1],Jv[2]);return i.target.baseBoundingSphere.radius*t}return tx(i)?sa(Gme(i.target,e),t=>.5*c5(t)):null}function x2e(i){return!Ow(i)&&!Mw(i)&&(pA(i)?i.target.numLodLevels>1:!!tx(i))}const Jv=E();async function qme(i,e){if(i.type==="2d")return i.hitTest(e);const t=await i.hitTest(e);if(t.results.length===0)return t;const r=t.results[0],s=(Et(r.distance)??0)*(1+Wme),n=t.results.findIndex(a=>(a.distance??0)>s);return n!==-1&&(t.results=t.results.slice(0,n)),t}const Wme=.05;function jme(i){const e=ZG(i);if(!e.available)return new ue("webgl:required","WebGL is required but not supported.");if(i==="3d"&&e.majorPerformanceCaveat)return new ue("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new ue("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new ue("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===wi.WEBGL1){if(!e.supportsElementIndexUint)return new ue("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new ue("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new ue("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Xme(i){return i&&"nodeType"in i}function Yme(i){return i&&typeof i.render=="function"}const f$={component:"esri-component"};let Bu=class extends ge{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(f$.component),t&&t.classList.remove(f$.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||Xme(e)?(this._set("widget",null),c2(e)):(Yme(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([p({dependsOn:[]})],Bu.prototype,"id",null),d([p()],Bu.prototype,"node",null),d([ss("node")],Bu.prototype,"castNode",null),d([p({readOnly:!0})],Bu.prototype,"widget",void 0),Bu=d([k("esri.views.ui.Component")],Bu);const q1=Bu,Qme={left:0,top:0,bottom:0,right:0},h8={bottom:30,top:15,right:15,left:15},GC="manual",Vc="esri-ui",un={ui:Vc,corner:`${Vc}-corner`,innerContainer:`${Vc}-inner-container`,manualContainer:`${Vc}-manual-container`,cornerContainer:`${Vc}-corner-container`,topLeft:`${Vc}-top-left`,topRight:`${Vc}-top-right`,bottomLeft:`${Vc}-bottom-left`,bottomRight:`${Vc}-bottom-right`};function Zme(i){return i&&!i._started&&typeof i.postMixInProperties=="function"&&typeof i.buildRendering=="function"&&typeof i.postCreate=="function"&&typeof i.startup=="function"}function HC(i){const e=i,t=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(t===null||t===Object.prototype)&&("component"in e||"index"in e||"position"in e)?i:null}function qC(i,{top:e,bottom:t,left:r,right:s}){i.style.top=e,i.style.bottom=t,i.style.left=r,i.style.right=s}let Vl=class extends Br.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._locale=uF(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&qC(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&qC(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([z(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Je),z(()=>this.padding,this._applyUIPadding,Je),z(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},Je),I7(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(un.ui),Rq(e),this._attachContainers(e)),t&&(t.classList.remove(un.ui),qC(t,{top:"",bottom:"",left:"",right:""}),M$(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.top+t.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...h8,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.left+t.right;return Math.max(e-r,0)}add(e,t){let r,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,t));const n=HC(e);n&&({index:r,position:t,component:e,key:s}=n),t&&typeof t=="object"&&({index:r,key:s,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,s)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,t));const r=this._find(e);if(r){const s=this._componentToKey;if(s.has(e)&&s.get(e)!==t)return;const n=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(n,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,r)=>t.concat(r)):(e=e||GC)===GC?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(un.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(a=>this.move(a,t)),!e)return;let r;const s=HC(e)||HC(t);if(s&&(r=s.index,t=s.position,e=s.component||e),t&&!this._isValidPosition(t))return;const n=this.remove(e);n&&this.add(n,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,s){e instanceof q1||(e=new q1({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),s&&this._componentToKey.set(e,s)}_find(e){return e?e instanceof q1?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||Qme}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(un.innerContainer),e.classList.add(un.cornerContainer);const t=document.createElement("div");t.classList.add(un.innerContainer),t.classList.add(un.manualContainer);const r=document.createElement("div");r.classList.add(un.topLeft),r.classList.add(un.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(un.topRight),s.classList.add(un.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(un.bottomLeft),n.classList.add(un.corner),e.appendChild(n);const a=document.createElement("div");a.classList.add(un.bottomRight),a.classList.add(un.corner),e.appendChild(a),this._innerContainer=e,this._manualContainer=t;const o=Kl();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":a,"top-leading":o?s:r,"top-trailing":o?r:s,"bottom-leading":o?a:n,"bottom-trailing":o?n:a},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,r=e.position||GC,s=e.index,n=this._positionNameToContainerLookup[r],a=s!=null&&s>-1;if(Zme(t.widget)&&t.widget.startup(),!a)return void n.appendChild(t.node);const o=Array.prototype.slice.call(n.children);if(s===0)return void(n.firstChild?sP(t.node,n.firstChild):n.appendChild(t.node));s>=o.length?n.appendChild(t.node):sP(t.node,o[s])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,r=null;return this._components.some(s=>(t=s===e,t&&(r=s),t)),r}_findById(e){let t,r=null;return this._components.some(s=>(t=s.id===e,t&&(r=s),t)),r}_findByNode(e){let t,r=null;return this._components.some(s=>(t=s.node===e,t&&(r=s),t)),r}};d([p()],Vl.prototype,"_locale",void 0),d([p()],Vl.prototype,"container",null),d([p()],Vl.prototype,"height",null),d([p({value:h8})],Vl.prototype,"padding",null),d([ss("padding")],Vl.prototype,"castPadding",null),d([p()],Vl.prototype,"view",void 0),d([p()],Vl.prototype,"width",null),Vl=d([k("esri.views.ui.UI")],Vl);const Kme=Vl;function g$(i,e){return i&&"copyright"in i&&(!e||typeof i.originOf=="function"&&i.originOf("copyright")==="user")}function Jme(i,e){return i.length!==e.length||i.some((t,r)=>t.text!==e[r].text)}function e1(i,e,t){!t||!e||i.find(r=>r.layerView===e&&r.text===t)||i.push({text:t,layerView:e})}function efe(i){return i.type==="bing-maps"}const jh=[];let nf=class extends T2{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Oi,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(s=>z(()=>{var n;return[s.suspended,(n=s.layer)==null?void 0:n.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.handles.add([Nr(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),ha(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,t=e==null?void 0:e.allLayerViews;jh.length=0,e&&t?(t.forEach(r=>{var a;if(r.suspended||!((a=r.layer)!=null&&a.attributionVisible))return;const s=r.layer;if(g$(s,"user"))return void e1(jh,r,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(r)){const o=this._fetchedAttributionData.get(r);return void(o?e1(jh,r,this._getDynamicAttribution(o,e,s)):g$(s)&&e1(jh,r,s.copyright))}return void this._fetchAttributionData(r)}const n=s.get("portalItem.accessInformation");e1(jh,r,n||s.copyright)}),Jme(this.items,jh)&&(this.items.removeAll(),this.items.addMany(jh)),jh.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await yy(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,efe(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const a=r[n],o=a.coverageAreas;if(!o)return;for(const l of o){const c=l.bbox,h=l.zoomMin-(t&&l.zoomMin?1:0),u=l.zoomMax-(t&&l.zoomMax?1:0),m={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:ci.WGS84},f={extent:a2(m),attribution:a.attribution||"",score:l.score!=null?l.score:100,id:n};for(let y=h;y<=u;y++)s[y]=s[y]||[],s[y].push(f)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,t,r){var h;const{extent:s,scale:n}=t;let a=((h=r.tileInfo)==null?void 0:h.scaleToZoom(n))??0;if(a=Math.min(e.maxKey??0,Math.round(a)),!s||a==null||a<=-1)return"";const o=e[a],l=l2(s.center.clone().normalize(),t.spatialReference),c={};return o?o.filter(u=>{const m=u.id,f=!c[m]&&l&&u.extent&&q8(u.extent,l);return f&&(c[m]=!0),f}).sort((u,m)=>m.score-u.score||u.objectId-m.objectId).map(u=>u.attribution).join(", "):""}};d([p({readOnly:!0,type:Oi})],nf.prototype,"items",void 0),d([p({readOnly:!0})],nf.prototype,"state",null),d([p()],nf.prototype,"view",void 0),nf=d([k("esri.widgets.Attribution.AttributionViewModel")],nf);const d8=nf,Bm="esri-attribution",Xh={base:`${Bm} esri-widget`,poweredBy:`${Bm}__powered-by`,sources:`${Bm}__sources`,open:`${Bm}--open`,sourcesOpen:`${Bm}__sources--open`,link:`${Bm}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let bn=class extends rn{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=Xh.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new d8}initialize(){this.addHandles(Nr(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Xh.open]:this._isOpen};return U("div",{bind:this,class:this.classes(Xh.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return U("div",{class:Xh.poweredBy},"Powered by"," ",U("a",{class:Xh.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?"0":"",{attributionText:s}=this,n={[Xh.sourcesOpen]:e,[Xh.interactive]:t};return U("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Xh.sources,n),innerHTML:s,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,a=n>s,o=this._attributionTextOverflowed!==a;if(this._attributionTextOverflowed=a,o&&(t=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([p()],bn.prototype,"_isOpen",void 0),d([p()],bn.prototype,"_isInteractive",null),d([p()],bn.prototype,"_attributionTextOverflowed",void 0),d([p()],bn.prototype,"_prevSourceNodeHeight",void 0),d([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],bn.prototype,"attributionText",null),d([p()],bn.prototype,"iconClass",void 0),d([p()],bn.prototype,"itemDelimiter",void 0),d([p()],bn.prototype,"label",null),d([p(),Zs("esri/widgets/Attribution/t9n/Attribution")],bn.prototype,"messages",void 0),d([p()],bn.prototype,"view",null),d([p({type:d8})],bn.prototype,"viewModel",void 0),d([to()],bn.prototype,"_toggleState",null),bn=d([k("esri.widgets.Attribution")],bn);const tfe=bn,ife="esri.widgets.CompassViewModel";let zu=class extends c4(ge){constructor(e){super(e),this._handles=new mi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(z(()=>this.view,this._updateRotationWatcher,Je))}destroy(){Us(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var t;if(!this.get("view.ready"))return;const e={};((t=this.view)==null?void 0:t.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?z(()=>e==null?void 0:e.rotation,this._updateForRotation,Je):z(()=>e==null?void 0:e.camera,this._updateForCamera,Je))}};d([p({readOnly:!0})],zu.prototype,"canShowNorth",null),d([p()],zu.prototype,"orientation",void 0),d([p({readOnly:!0})],zu.prototype,"state",null),d([p()],zu.prototype,"view",void 0),zu=d([k(ife)],zu);const u8=zu,Yh={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Bl=class extends rn{constructor(e,t){super(e,t),this.iconClass=Yh.widgetIcon,this.messages=null,this.viewModel=new u8}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,r=t==="disabled",s=(t==="rotation"?"rotation":"compass")=="compass",n=r?-1:0,a={[Yh.disabled]:r,[Yh.interactive]:!r},o={[Yh.northIcon]:s,[Yh.rotationIcon]:!s},{messages:l}=this;return U("div",{bind:this,class:this.classes(Yh.base,a),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":l.reset,title:l.reset},U("span",{"aria-hidden":"true",class:this.classes(Yh.icon,o),styles:this._toRotationTransform(e)}),U("span",{class:Yh.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};d([p()],Bl.prototype,"goToOverride",null),d([p()],Bl.prototype,"iconClass",void 0),d([p()],Bl.prototype,"label",null),d([p(),Zs("esri/widgets/Compass/t9n/Compass")],Bl.prototype,"messages",void 0),d([p()],Bl.prototype,"view",null),d([p({type:u8})],Bl.prototype,"viewModel",void 0),d([to()],Bl.prototype,"_reset",null),Bl=d([k("esri.widgets.Compass")],Bl);const rfe=Bl,zm="esri-navigation-toggle",ja={base:`${zm} esri-widget`,button:`${zm}__button esri-widget--button`,activeButton:`${zm}__button--active`,panButton:`${zm}__button--pan`,rotateButton:`${zm}__button--rotate`,isLayoutHorizontal:`${zm}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let af=class extends ge{constructor(i){super(i),this.navigationMode="pan",this.view=null}initialize(){this.own(ha(()=>{var i;return(i=this.view)==null?void 0:i.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var i;return this.get("view.ready")&&((i=this.view)==null?void 0:i.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};d([p({readOnly:!0})],af.prototype,"state",null),d([p()],af.prototype,"navigationMode",void 0),d([p()],af.prototype,"view",void 0),af=d([k("esri.widgets.NavigationToggleViewModel")],af);const p8=af;let zl=class extends rn{constructor(e,t){super(e,t),this.iconClass=ja.widgetIcon,this.messages=null,this.viewModel=new p8}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",r={[ja.disabled]:e,[ja.isLayoutHorizontal]:this.layout==="horizontal"},s={[ja.activeButton]:t},n={[ja.activeButton]:!t},a=e?-1:0,o=this.messages.toggle;return U("div",{bind:this,class:this.classes(ja.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:a,"aria-label":o,title:o},U("div",{class:this.classes(ja.button,ja.panButton,s)},U("span",{class:ja.panIcon})),U("div",{class:this.classes(ja.button,ja.rotateButton,n)},U("span",{class:ja.rotationIcon})))}_toggle(){this.toggle()}};d([p()],zl.prototype,"iconClass",void 0),d([p()],zl.prototype,"label",null),d([p({value:"vertical"})],zl.prototype,"layout",null),d([p(),Zs("esri/widgets/NavigationToggle/t9n/NavigationToggle")],zl.prototype,"messages",void 0),d([p()],zl.prototype,"view",null),d([p({type:p8})],zl.prototype,"viewModel",void 0),d([to()],zl.prototype,"_toggle",null),zl=d([k("esri.widgets.NavigationToggle")],zl);const sfe=zl,s_={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let ld=class extends rn{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const i=this.enabled?0:-1,e={[s_.disabled]:!this.enabled,[s_.interactive]:this.enabled},t={[this.iconClass]:!!this.iconClass};return U("div",{bind:this,class:this.classes(s_.button,e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:i,title:this.title},U("span",{"aria-hidden":"true",role:"presentation",class:this.classes(s_.icon,t)}),U("span",{class:s_.iconText},this.title))}_triggerAction(){this.action.call(this)}};d([p()],ld.prototype,"action",void 0),d([p()],ld.prototype,"enabled",void 0),d([p()],ld.prototype,"iconClass",void 0),d([p()],ld.prototype,"title",void 0),d([to()],ld.prototype,"_triggerAction",null),ld=d([k("esri.widgets.IconButton")],ld);const _$=ld;let of=class extends ge{get canZoomIn(){if(!this.get("view.ready"))return!1;const i=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return e===0||i>e}get canZoomOut(){if(!this.get("view.ready"))return!1;const i=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");return e===0||i<e}};d([p({readOnly:!0})],of.prototype,"canZoomIn",null),d([p({readOnly:!0})],of.prototype,"canZoomOut",null),d([p()],of.prototype,"view",void 0),of=d([k("esri.widgets.Zoom.ZoomConditions2D")],of);const nfe=of;let lf=class extends ge{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([p({readOnly:!0})],lf.prototype,"canZoomIn",null),d([p({readOnly:!0})],lf.prototype,"canZoomOut",null),d([p()],lf.prototype,"view",void 0),lf=d([k("esri.widgets.Zoom.ZoomConditions3D")],lf);const afe=lf;let cd=class extends ge{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return _(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return _(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new nfe({view:e}):e.type==="3d"&&(this._zoomConditions=new afe({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():B_(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():B_(e.goTo({zoomFactor:.5}))}};d([p()],cd.prototype,"_zoomConditions",void 0),d([p()],cd.prototype,"canZoomIn",null),d([p()],cd.prototype,"canZoomOut",null),d([p({readOnly:!0})],cd.prototype,"state",null),d([p()],cd.prototype,"view",null),cd=d([k("esri.widgets.Zoom.ZoomViewModel")],cd);const m8=cd,n_={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let jc=class extends rn{constructor(i,e){super(i,e),this.iconClass=n_.widgetIcon,this.messages=null,this.viewModel=new m8}initialize(){this._zoomInButton=new _$({action:this.zoomIn.bind(this),iconClass:n_.zoomInIcon}),this._zoomOutButton=new _$({action:this.zoomOut.bind(this),iconClass:n_.zoomOutIcon})}destroy(){this._zoomInButton=we(this._zoomInButton),this._zoomOutButton=we(this._zoomOutButton)}get label(){var i;return((i=this.messages)==null?void 0:i.widgetLabel)??""}set label(i){this._overrideIfSome("label",i)}set layout(i){i!=="horizontal"&&(i="vertical"),this._set("layout",i)}set view(i){this.viewModel.view=i}get view(){return this.viewModel.view}render(){const i=this.viewModel,e={[n_.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:t,canZoomOut:r}=i;this._zoomInButton.enabled=t,this._zoomOutButton.enabled=r;const{zoomIn:s,zoomOut:n}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=n,U("div",{class:this.classes(n_.base,e)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};d([p()],jc.prototype,"iconClass",void 0),d([p()],jc.prototype,"label",null),d([p({value:"vertical"})],jc.prototype,"layout",null),d([p(),Zs("esri/widgets/Zoom/t9n/Zoom")],jc.prototype,"messages",void 0),d([p()],jc.prototype,"view",null),d([p({type:m8})],jc.prototype,"viewModel",void 0),jc=d([k("esri.widgets.Zoom")],jc);const ofe=jc;function lfe(i){return i&&i.view!==void 0}let W1=class extends Kme{constructor(i){super(i),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this.addHandles([z(()=>this.components,this._componentsWatcher.bind(this),Je),z(()=>this.view,this._updateViewAwareWidgets.bind(this),Je)])}_add(i,e,t,r){let s=i;if(typeof i=="string"&&this._defaultPositionLookup[i]){if(this._find(i))return;s=this._createComponent(i)}super._add(s,e,t,r)}_removeComponents(i){i.forEach(e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())})}_updateViewAwareWidgets(i){this.components.forEach(e=>{const t=this._find(e),r=t&&t.widget;lfe(r)&&(r.view=i)})}_componentsWatcher(i,e){this._removeComponents(e),this._addComponents(i),this._adjustPadding(i)}_adjustPadding(i){if(!i.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(i){this.constructed&&i.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(i){const e=this._createWidget(i);if(e)return new q1({id:i,node:e})}_createWidget(i){return i==="attribution"?this._createAttribution():i==="compass"?this._createCompass():i==="navigation-toggle"?this._createNavigationToggle():i==="zoom"?this._createZoom():void 0}_createAttribution(){return new tfe({view:this.view})}_createCompass(){return new rfe({view:this.view})}_createNavigationToggle(){return new sfe({view:this.view})}_createZoom(){return new ofe({view:this.view})}};d([p()],W1.prototype,"components",void 0),W1=d([k("esri.views.ui.DefaultUI")],W1);const cfe=W1;let j1=class extends cfe{constructor(i){super(i),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([p()],j1.prototype,"components",void 0),j1=d([k("esri.views.ui.3d.DefaultUI3D")],j1);const f8=j1;let Ie=class extends $H(tj(dj(Ij))){constructor(i){super(i),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._lostWebGLContextHandle=null,this._resolveWhenReady=[],this._propertiesPool=new ph({slicePlane:C5},this),this._resourceController=zae(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new fS({view:this}),this.labeler=new Nu({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Qf,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new Wu,this.environmentManager=new Lo,this.floors=new Oi,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Lj({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new oae,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new f8,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new OS,this.voxelWasm=null,this.voxelWasmPromise=null,sB(),i&&i.environment||(this._defaults.environment=new Qm,this.environment=this._defaults.environment);const e=(t=null)=>{_(t)&&t.type===tP.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([Nr(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",t=>e(t),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",t=>this._updateUpdatingMonitors(t)),z(()=>this.map,t=>{t&&"load"in t&&t.load&&t.load().catch(()=>{})})]),this.inputManager=new VJ({view:this}),this.stateManager=new _r({view:this})}initialize(){this.groundView=new hj({view:this}),this._updateUpdatingMonitors();const i=()=>this._updateDefaultToMapOptions();this.handles.add(Nr(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",i,{onListenerAdd:i,onListenerRemove:i})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Je),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Je),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>T8(e>0?1e3/Math.ceil(e):0),Je),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},i,er),this.updatingHandles.add(()=>{var e,t;return(t=(e=this.map)==null?void 0:e.ground)==null?void 0:t.opacity},()=>this._updateDefaultHitTestOptions(),er),this.handles.add(z(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),ii))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=we(this.sharedSymbolResources),this._set("labeler",we(this.labeler)),this._set("deconflictor",we(this.deconflictor)),this._resourceController=we(this._resourceController),this._set("stateManager",we(this.stateManager)),this._set("inputManager",we(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",we(this.environmentManager)),this.groundView=we(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var i;return(i=this.basemapTerrain)==null?void 0:i.spatialReference}get animation(){var i;return(i=this.state)==null?void 0:i.animation}get camera(){var i;return(i=this.stateManager)==null?void 0:i.camera}set camera(i){this.stateManager&&(this.stateManager.camera=i)}get contentCamera(){var i;return(i=this.stateManager)==null?void 0:i.contentCamera}set contentCamera(i){this.stateManager&&(this.stateManager.contentCamera=i)}installContentCameraReset(i={sticky:!1}){return this.stateManager.installContentCameraReset(i)}get center(){var i;return(i=this.stateManager)==null?void 0:i.center}set center(i){this.stateManager&&(this.stateManager.center=i)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let i=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!(this._userClippingArea||this.get("map.clippingEnabled"))||T(i)?(this._clippingArea=null,null):i instanceof ms?this.spatialReference&&(i=t1(i,this.spatialReference),T(i))?(pe.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(i=i.clone(),T(i.intersection(this._groundAndLayersExtent))&&(i.xmin=i.xmax,i.ymin=i.ymax),i.zmin=void 0,i.zmax=void 0,i.equals(this._clippingArea)||(this._clippingArea=i),this._clippingArea):(pe.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(i){this.ready&&this.viewingMode==="global"&&_(i)?pe.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=i}get renderDataExtent(){if(this.state.viewingMode===Se.Global)return null;const i=this.renderSpatialReference,e=this.dataExtent;return T(e)||T(i)||e.spatialReference.equals(i)?e:t1(e,i)}get dataExtent(){let i=this._groundAndLayersExtent;const e=this.spatialReference||ci.WGS84,t=t1(this.clippingArea,e);_(t)&&(i=_(i)?i.intersection(t):t);const r=this._get("dataExtent");return _(i)&&i.equals(r)?r:i}get _groundAndLayersExtent(){const i=this.spatialReference||ci.WGS84;let e;const t=n=>{const a=t1(n,i);T(a)||(_(e)?e.union(a):e=a.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;t(new ms({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=a=>{!_(a.fullExtent)||a.type==="graphics"&&a.internal||t(a.fullExtent)};this.map.allLayers.forEach(a=>n(a))}if(T(e))return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(i){i!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",i)}castEnvironment(i){return i?i instanceof Qm?i:i instanceof O4?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(i):Qm.fromWebsceneEnvironment(i):iw(Qm,i):new Qm}get extent(){var i;return(i=this.stateManager)==null?void 0:i.extent}set extent(i){this.stateManager&&(this.stateManager.extent=i)}get screenCenter(){var i;return(i=this.stateManager)==null?void 0:i.screenCenter}get frustum(){var i;return(i=this.stateManager)==null?void 0:i.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)&&this.activeTool.visible}get stationary(){return!this.animation&&!this.resizing&&(T(this.state)||this.state.stationary)}get navigating(){var i;return((i=this.state)==null?void 0:i.navigating)??!1}get padding(){var i;return(i=this.stateManager)==null?void 0:i.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}set qualityProfile(i){I1.isValidProfile(i)&&(I1.apply(i,this.qualitySettings),this._set("qualityProfile",i))}get qualityProfile(){return this._get("qualityProfile")||I1.getDefaultProfile()}set slicePlane(i){if(_(this._stage)&&this._stage.renderer.setParameters({slicePlane:i}),T(i))return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");Fp(i,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?XB(this.scale,this.spatialReference):0}get scale(){var i;return(i=this.stateManager)==null?void 0:i.scale}set scale(i){this.stateManager&&(this.stateManager.scale=i)}get heightModelInfo(){const i=this.getDefaultHeightModelInfo();return i!=null?s0.deriveUnitFromSR(i,this.spatialReference):null}get updating(){var s,n,a;if(this.destroyed)return!1;let i=0,e=this.layerViewManager.updating,t=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(e=!0,o.suspended||jy(o))return;++t,i+=o.updatingProgress}}else++t});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(o)&&o.updating&&(t+=.1,i+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])_(o)&&o.updating&&(++t,i+=o.updatingProgress);const r=this.stateManager.test.updatingIgnoreRenderState?bi.IDLE:this.state.mode;if(e=!!(e||t>0||this.updatingHandles.updating||!this.ready||!this.stationary||r!==bi.IDLE||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.hasPendingInputs||(a=(n=this.map)==null?void 0:n.allLayers)!=null&&a.some(o=>!o.isFulfilled())),e?(this._numUpdating=Math.max(t,this._numUpdating),i+=this._numUpdating-t):this._numUpdating=0,this._numUpdating>0?i/=this._numUpdating:i=e?0:1,this._get("updatingProgress")!==i){const o=performance.now();if(i<1){const l=Math.min((o-this._lastUpdateTime)/2e3,1);i=this.updatingProgress*(1-l)+i*l}this._set("updatingProgress",i),this._lastUpdateTime=e&&i<1?o:0}return e}get viewingMode(){var t;const i=this._predeterminedViewingMode;if(_(i))return px(i);const e=this.spatialReference;return e?_((t=this.defaultsFromMap)==null?void 0:t.viewingMode)&&e.equals(this.defaultsFromMap.spatialReference)?px(this.defaultsFromMap.viewingMode):Ib(e,Se.Global)?"global":"local":"global"}set viewingMode(i){this.ready?pe.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",i)}get viewpoint(){var i;return(i=this.stateManager)==null?void 0:i.viewpoint}set viewpoint(i){this.stateManager&&(this.stateManager.viewpoint=i)}get zoom(){return this.stateManager.zoom}set zoom(i){this.stateManager&&(this.stateManager.zoom=i)}get resourceController(){return this._resourceController}get performanceInfo(){return new poe(this)}on(i,e,t,r){return this.viewEvents.on(i,e,t,r)||super.on(i,e)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}toMap(i,e){if(!this.ready)return pe.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const t=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=_(t.graphics)&&(_(t.graphics.include)||_(t.graphics.exclude)),s=kO(i)?zO(this,i):i,n=Xl(s);t.enableDraped=t.include&&!t.include.has(vd)||t.exclude&&t.exclude.has(vd);const a=this.sceneIntersectionHelper,o=wo(this.state.viewingMode);if(o.options.selectionMode=!0,o.options.store=r?rs.ALL:rs.MIN,a.intersectIntersectorScreen(n,o,t),r){for(const l of o.results.all){const c=t2(l,this);if(T(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(t.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(o.results.min)}toScreen(i){if(!this.ready)return pe.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=Ze(i.z==null?tc(this.elevationProvider,i):null,0);return xs(i,km,this.renderSpatialReference,e),this.state.camera.projectToScreen(km,WC),_o(WC[0],WC[1])}pixelSizeAt(i){return this.ready?i?(xs(i,km,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(km)):0:(pe.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(i){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(i):1}hitTest(i,e){if(!this.ready)return pe.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const t=kO(i)?zO(this,i):i,r=Fi(t.x,t.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=wo(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=rs.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const a=this._intersectResultsToHits(n.results.all,s.graphics),o=n.results.ground,l=p$(o,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:t,results:a,ground:{mapPoint:this._intersectResultToMapPoint(o),distance:pl(o)?o.distanceInRenderSpace:0,layer:c}};return zt.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(i){const{results:e,ground:t}=await qme(this,i);let r=null;return!(e.length===0||Math.abs(Ze(e[0].distance,0)-t.distance)<1e-5)||t.layer&&t.layer.type==="integrated-mesh"||(r=t.mapPoint),{results:e,screenPoint:i,mapPoint:r}}goTo(i,e){return this.updatingHandles.addPromise(this.stateManager.goTo(i,e))}async whenAnalysisView(i){if(T(i.parent))throw new ue("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:i});switch(i.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(i.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(i)}}whenLayerView(i){return super.whenLayerView(i)}async takeScreenshot(i){const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshot(e);return BC(t,e,this._pixelFormat())}async _takeScreenshot(i){const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshot(e);return zC(t,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(i){const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshotWithOID(e);return[zC(t[0],this._pixelFormat()),zC(t[1],this._pixelFormat())]}_completeSettings(i){const e=Cme(i,this);return e.pixelRatio/=this.state.pixelRatio,Ame(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:i=>this._takeScreenshot(i),takeScreenshotWithObjectAndLayerId:i=>this._takeScreenshotWithObjectAndLayerId(i)}}async takeScreenshotWithObjectAndLayerId(i){if(!Vt("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshotWithOID(e),r=BC(t[0],e,this._pixelFormat()),s=this._completeSettings(i);return s.format="png",[r,BC(t[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(T(this._stage.renderView.objectAndLayerIdRenderHelper))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(i){return this.updatingHandles.addPromise(i)}importLayerView(i){return YO.importLayerView(i)}hasLayerViewModule(i){return YO.hasLayerViewModule(i)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var i,e,t,r;return this.map&&"initialViewProperties"in this.map&&((e=(i=this.map)==null?void 0:i.initialViewProperties)==null?void 0:e.spatialReference)||((t=this.defaultsFromMap)==null?void 0:t.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let i=jme(this.type);const e=Vt("safari");if(e&&e<9&&(i=new ue("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),_(i))throw pe.getLogger(this.declaredClass).warn("#validate()",i.message),i}get _predeterminedViewingMode(){var e;const i=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return _(i)?yP(i):null}getSpatialReferenceSupport({spatialReference:i,layer:e}){const t=this._predeterminedViewingMode;if(_(t))return this._validateSpatialReferenceForViewingMode(i,e,t)?{constraints:this._makeSpatialReferenceConstraints(i,e,t)}:null;const r=this._validateSpatialReferenceForViewingMode(i,e,Se.Local),s=this._validateSpatialReferenceForViewingMode(i,e,Se.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(i,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(i,e,Se.Local)}:{constraints:this._makeSpatialReferenceConstraints(i,e,Se.Global)}:null}_validateSpatialReferenceForViewingMode(i,e,t){return!!Ib(i,t)&&(!!T(e)||!!uP(e)||(!k_(e)||!T(jw(e,i,t)))&&(!pP(e)||t!==Se.Global))}_makeSpatialReferenceConstraints(i,e,t){if(T(e))return[{spatialReference:i,viewingMode:t}];const r=i.isWebMercator,s=i.isWGS84;return uP(e)&&(r||s)?!s||t===Se.Local||TA(e.tileInfo,e.fullExtent,i,Se.Global)===null?[{spatialReference:i,viewingMode:t},{spatialReference:ci.WebMercator,viewingMode:t}]:[{spatialReference:r?ci.WGS84:ci.WebMercator,viewingMode:t}]:k_(e)||pP(e)||!r&&!s?k_(e)&&r&&t!==Se.Global?[{spatialReference:i,viewingMode:t},{spatialReference:ci.WGS84,viewingMode:Se.Local}]:[{spatialReference:i,viewingMode:t}]:[{spatialReference:i,viewingMode:t},{spatialReference:r?ci.WGS84:ci.WebMercator,viewingMode:t}]}_validateSpatialReference(i){const e=_(this.getSpatialReferenceSupport({spatialReference:i})),t=this._predeterminedViewingMode;return e||(_(t)?pe.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${px(t)} viewing mode.`):i.isGeographic&&pe.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(i=>{this.ready?i(this):this._resolveWhenReady.push(i)})}computeMapPointFromVec3d(i,e){let t=this.spatialReference||ci.WGS84;return vs(i,this.renderSpatialReference,i,t)||(t=ci.WGS84,vs(i,this.renderSpatialReference,i,t)),e?(e.x=i[0],e.y=i[1],e.z=i[2],e.spatialReference=t):e=new kt(i,t),e}trackGraphicState(i){if(!i.graphic)return pe.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(i.graphic);let t=null,r=!1;const s=n=>{var a;!r&&_(n)&&"processor"in n&&((a=n.processor)==null?void 0:a.type)==="graphics-3d"&&n.processor.graphicsCore&&(t=n.processor.graphicsCore.trackGraphicState(i))};return _(e)?s(e):this.whenViewForGraphic(i.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(t)&&(t.remove(),t=null)}}}highlight(i){if(Array.isArray(i))return ZA(i.map(t=>this.highlight(t)));if(Oi.isCollection(i))return ZA(i.toArray().map(t=>this.highlight(t)));const e=this.getViewForGraphic(i);return e&&"highlight"in e?e.highlight(i):hy()}maskOccludee(i){if(!i)return pe.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(i);let t=null,r=!1;const s=n=>{!r&&_(n)&&jW(n)&&(t=n.maskOccludee(i))};return _(e)?s(e):this.whenViewForGraphic(i,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(t)&&(t.remove(),t=null)}}}getViewForGraphic(i){return i.layer===this.graphics?this.graphicsView:i.layer?this.allLayerViews.find(e=>e.layer===i.layer):null}graphicChanged(i){_(this.graphicsView)&&this.graphicsView.graphicChanged(i)}async whenViewForGraphic(i,e){if(i.layer===this)return await py(()=>this.graphicsView),this.graphicsView;if(!i.layer||!this.map)throw new ue("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(i.layer)?new Promise((t,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(i.layer)&&(s.remove(),this.whenLayerView(i.layer).then(t,r))})}):this.whenLayerView(i.layer)}externalToInternalIntersectOptions(i){const e=this._externalToInternalRenderItems(i.include,cy.INCLUDE),t=this._externalToInternalRenderItems(i.exclude,cy.EXCLUDE);return{include:e.layerUids,exclude:t.layerUids,graphics:{include:e.graphicUids,exclude:t.graphicUids}}}_intersectResultToMapPoint(i,e){return i.getIntersectionPoint(km)?(e=this.computeMapPointFromVec3d(km,e),i.intersector===Ri.TERRAIN&&this.basemapTerrain&&(e.z=Ze(tc(this.basemapTerrain,e),0)),e):null}_intersectResultsToHits(i,e){const t=new Array;let r=null;for(let s=0;s<i.length;s++){const n=i[s],a=p$(n,this);if(_(a)&&(a===this.map.ground||"type"in a&&a.type==="integrated-mesh"))break;const o=t2(n,this);if(T(o))continue;if(o.type==="graphic"){if(T(r)&&s!==i.length-1&&(r=new Set),_(r)){const h=this._getGraphicFilterUid(o.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(e,o.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;t.push({...o,mapPoint:l,distance:c})}return t}_getGraphicFilterUid(i){var s;const e=i.sourceLayer,t=i.layer,r=e&&"objectIdField"in e?e:t&&"objectIdField"in t?t:e;if(r){const n=r.objectIdField??V5,a=(s=i.attributes)==null?void 0:s[n];if(a)return`o-${r.id}-${a}`}return`u-${i.uid}`}_testGraphicUidFilter(i,e){const t=this._getGraphicFilterUid(e);return T(i)||(T(i.include)||i.include.has(t))&&(T(i.exclude)||!i.exclude.has(t))}_externalToInternalRenderItems(i,e,t={layerUids:void 0,graphicUids:void 0}){if(!i)return t;if(i instanceof mc)hfe(t,this._getGraphicFilterUid(i)),e===cy.INCLUDE&&(_(this.graphicsView)&&i.layer===this?a_(t,this.graphicsView.processor.layer.id):i.layer&&a_(t,i.layer.uid));else if(C8(i))for(const r of i)r===this.graphics&&_(this.graphicsView)?a_(t,this.graphicsView.processor.layer.id):r===this.map.ground?a_(t,vd):this._externalToInternalRenderItems(r,e,t);else"uid"in i&&a_(t,i.uid);return t}_initBasemapTerrain(){this._set("basemapTerrain",new _he({view:this})),this._set("elevationProvider",new O_({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new wn({view:this})),this._set("featureTiles",new Jr({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const i=()=>{var t;const e=(t=this.basemapTerrain)==null?void 0:t.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=_(this.basemapTerrain.extent)&&_(this.basemapTerrain.spatialReference)?rw(V$(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>zt.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(Y(()=>import("./FeatureTileTree3DDebugger-443b8e06.js"),["./FeatureTileTree3DDebugger-443b8e06.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./reactiveUtils-53e5756b.js","./HandleOwner-6217a02e.js","./TileTreeDebugger-66028ce4.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./Graphic-5dcfa25e.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:t})=>{!this._featureTreeDebugger&&zt.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new t({view:this}))}):e||!this._featureTreeDebugger||zt.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},er),this.updatingHandles.add(()=>this.clippingArea,i,er),this.updatingHandles.add(()=>this.basemapTerrain.extent,i,er)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const i=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(i)||this._set("mapCoordsHelper",new Tae(this.map,i));const e=this.state.isGlobal,t=U5(e,i);t!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Rae.create(this.state.viewingMode,t)),e||this.handles.add(z(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;_(r)&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&sw(r,this.basemapTerrain.spatialReference,y$,s)&&(this.renderCoordsHelper.extent=y$)},ii),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Kf/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(i=null){_(i)&&i.type===tP.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.handles.add(z(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),ii),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(i,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const t=i.getContext("2d");return t.putImageData(e,0,0),this.overlay.renderCanvas(i),t.getImageData(0,0,e.width,e.height)}_initStage(){const i={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(s,n)=>this._renderScreenshotOverlay(s,n)}},e=new lae(this.state.viewingMode,s=>this._stage.layers.forAll(s),this);this._set("sceneIntersectionHelper",e);const t=c2(this.surface);this._stage=new Wn({view:this,options:i,container:t}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=rB(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new ue("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Je),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,s=>this._stage.renderer.setParameters({highQualityTransparency:s}),Je),z(()=>this.magnifier,s=>this._stage.renderView.magnifier=s,er),this.on("pointer-move",()=>{var s;return(s=this._stage)==null?void 0:s.renderer.resetAnimation()})],"stage");const r=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:OS.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],r),"stage"),r(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Kf/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=we(this._stage),this._lostWebGLContextHandle=Us(this._lostWebGLContextHandle),this.handles.remove("stage"),this._set("canvas",null)}_initSurface(i){this._exitSurface(),this.state.init(i,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new goe({view:this,viewingMode:i,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const i=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(i,i),this._updatingChanged()}async _createGraphicsViewAsync(i){const e=(await Y(()=>import("./GraphicsView3D-0b9515e3.js"),["./GraphicsView3D-0b9515e3.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Identifiable-e4f9b04c.js","./GraphicsProcessor-b6945ef7.js","./Graphic-5dcfa25e.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./HandleOwner-6217a02e.js","./reactiveUtils-53e5756b.js","./diffUtils-1bae97a1.js","./Layer-524734fa.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./Graphics3DObjectStates-93b8548c.js","./UniqueValueRenderer-80c8e628.js","./ColorStop-29c89bbb.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./compilerUtils-7bf6df9e.js","./lengthUtils-3c9047c4.js","./jsonUtils-27937179.js","./layerUtils-eef15b39.js","./styleUtils-689841ac.js","./jsonUtils-9b4d797d.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./MemCache-b4d68123.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./vec4f64-6d0e93be.js","./projection-4ac247db.js","./mat4-f0dc8788.js","./assets-94d592bf.js","./zscale-baa108ea.js","./dehydratedFeatures-efdbcd90.js","./byteSizeEstimations-f0cab514.js","./quantizationUtils-16db4e0b.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OptimizedFeature-3e582950.js","./optimizedFeatureQueryEngineAdapter-9ce8e144.js","./centroid-0766e68a.js","./asyncUtils-24bd37b2.js","./PooledRBush-2aadabe0.js","./quickselect-56c5966e.js","./ElevationInfo-005ddd87.js","./Scheduler-61737382.js","./basicInterfaces-7449a8bf.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./BlendLayer-793ff14a.js","./mat4f32-60a2394b.js","./ScaleRangeLayer-d1b04b80.js","./HeightModelInfo-73f516f9.js","./sphere-a48b65b1.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./lineSegment-4eb8b6fa.js","./plane-01584357.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./ViewingMode-5d7d590b.js","./vec2-848c6cf0.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./View.glsl-879c1eaf.js","./ShaderBuilder-be7ca791.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DPassUniform-268e8d2d.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./ReadLinearDepth.glsl-0e6f5c47.js","./WaterSurface.glsl-e13d44e2.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./Matrix3PassUniform-df6e2166.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./OutputHighlight.glsl-ca02d1ee.js","./MultipassTerrainTest.glsl-8b279fcd.js","./NormalUtils.glsl-84d184a7.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./EvaluateSceneLighting.glsl-14c608ff.js","./VisualVariablePassParameters-f892560d.js","./enums-fc527c7c.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Util-513876a8.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./SSAO.glsl-2c6533cd.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./mat3-4fd89d48.js","./HUD.glsl-73b068b4.js","./VerticalOffset.glsl-109e8746.js","./Octree-813f29c9.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./BufferView-b402c7a7.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./Version-621cc6b7.js","./quat-77a0169c.js","./resourceUtils-527631ac.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./MixExternalColor.glsl-f5c601ed.js","./symbolColorUtils-1c63720c.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./VertexColor.glsl-2f905a78.js","./Normals.glsl-6a1bc6fb.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url)).default;Ti(i),await py(()=>{var t;return(t=this.basemapTerrain)==null?void 0:t.ready},i),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const i=yP(this.viewingMode);if(i===Se.Global&&(this._clippingArea=null),this._initSurface(i),this._set("ready",!0),this.handles.add(Nr(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const t=this.get("map.initialViewProperties.environment");t&&(this.environment=t)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(t=>t(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(vd);for(const i of this.map.allLayers.items)i.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(i.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(vd);for(const i of this.map.allLayers.items)i.type==="integrated-mesh"&&i.opacity<1&&this._defaultHitTestOptions.exclude.add(i.uid)}}addVoxelLayerViewToWasm(i){return T(this.voxelWasm)?(T(this.voxelWasmPromise)&&(this.voxelWasmPromise=Y(()=>import("./VoxelWasmPerSceneView-4b24ad3c.js"),["./VoxelWasmPerSceneView-4b24ad3c.js","./Graphic-5dcfa25e.js","./jsonMap-ffa742d3.js","./typedArrayUtil-bf9f210a.js","./string-53224faa.js","./Error-5cdd6e0a.js","./ArrayPool-b51874dd.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./geometry-7d866d3f.js","./Extent-22afa84a.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./PopupTemplate-81dc9b83.js","./Clonable-7fa7ad97.js","./Collection-74ae958a.js","./Evented-686173eb.js","./SimpleObservable-bd2c3ae8.js","./fieldUtils-d430f46c.js","./preload-helper-41c905a7.js","./arcadeOnDemand-dd48afd7.js","./enumeration-925aa0f6.js","./number-036ac4ef.js","./locale-fe7cc1d0.js","./Identifiable-e4f9b04c.js","./symbols-5f42cb0e.js","./CIMSymbol-8f55d4ab.js","./Color-7b46c33a.js","./colorUtils-639f4d25.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./screenUtils-410d12c0.js","./opacityUtils-d4a4b602.js","./symbolLayerUtils3D-5cf2dcce.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./request-09e7d9b2.js","./persistableUrlUtils-3635dccc.js","./Symbol3DAnchorPosition2D-e9d8a8f4.js","./collectionUtils-423a192d.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./jsonUtils-36bf3d33.js","./reactiveUtils-53e5756b.js","./Octree-813f29c9.js","./sphere-a48b65b1.js","./mat4-f0dc8788.js","./vec4f64-6d0e93be.js","./byteSizeEstimations-f0cab514.js","./mat3f64-50f3b9f6.js","./mat4f64-abdda1bb.js","./quatf64-f8f1c132.js","./vec2f64-70cfd09e.js","./plane-01584357.js","./Util-513876a8.js","./assets-94d592bf.js","./ViewingMode-5d7d590b.js","./Matrix3PassUniform-df6e2166.js","./ShaderBuilder-be7ca791.js","./objectResourceUtils-3685cb27.js","./devEnvironmentUtils-5002a058.js","./mat3-4fd89d48.js","./BufferView-b402c7a7.js","./vec2-848c6cf0.js","./vec33-ca555933.js","./DefaultMaterial_COLOR_GAMMA-8ec4380b.js","./types-e1c0a5bf.js","./asyncUtils-24bd37b2.js","./enums-fc527c7c.js","./Version-621cc6b7.js","./quat-77a0169c.js","./compilerUtils-7bf6df9e.js","./resourceUtils-527631ac.js","./basicInterfaces-7449a8bf.js","./Indices-f9b34f39.js","./DefaultMaterial.glsl-58ca0075.js","./ForwardLinearDepth.glsl-52bf5bdc.js","./vec3f32-01c06d8d.js","./VertexAttribute-15d1866a.js","./View.glsl-879c1eaf.js","./mat4f32-60a2394b.js","./Texture2DPassUniform-268e8d2d.js","./MixExternalColor.glsl-f5c601ed.js","./ShaderTechniqueConfiguration-0fa0f78c.js","./symbolColorUtils-1c63720c.js","./PhysicallyBasedRendering.glsl-edd81ba9.js","./FloatPassUniform-0426669b.js","./Float4PassUniform-9354414b.js","./RgbaFloatEncoding.glsl-67199794.js","./Texture2DDrawUniform-e4341b84.js","./PiUtils.glsl-49462ceb.js","./VisualVariablePassParameters-f892560d.js","./VertexElementDescriptor-2925c6af.js","./Texture-d2fa6cd8.js","./context-util-34d303b7.js","./Slice.glsl-cd30f0ea.js","./Transform.glsl-052069d0.js","./ObjectAndLayerIdColor.glsl-66083f64.js","./OutputDepth.glsl-17bf0574.js","./OutputHighlight.glsl-ca02d1ee.js","./VisualVariables.glsl-bb97d5ba.js","./DiscardOrAdjustAlphaBlend.glsl-27f02ebd.js","./AlphaCutoff-96178e0d.js","./TransparencyPassType-c3841b0a.js","./VertexColor.glsl-2f905a78.js","./VerticalOffset.glsl-109e8746.js","./Normals.glsl-6a1bc6fb.js","./EvaluateSceneLighting.glsl-14c608ff.js","./SSAOBlur.glsl-c56632c0.js","./ScreenSpacePass.glsl-44cc0c5e.js","./ReadLinearDepth.glsl-0e6f5c47.js","./SSAO.glsl-2c6533cd.js","./MultipassTerrainTest.glsl-8b279fcd.js","./vec2f32-eaf29605.js","./Texture-ae652f15.js","./TextureOnly.glsl-469cc321.js","./Attribute-f72d3f37.js","./lineSegment-4eb8b6fa.js","./InterleavedLayout-07cc6753.js","./DefaultTechniqueConfiguration-b54ae0b1.js","./RealisticTree.glsl-29f7cbd7.js","./Cyclical-47bda305.js","./widget-01c21b51.js","./intl-87d72dbe.js","./messages-1516d146.js","./uuid-73213768.js","./workers-c8fc8d43.js","./Connection-3d9fb42e.js","./GraphicsLayer-cbd6e467.js","./HandleOwner-6217a02e.js","./Layer-524734fa.js","./BlendLayer-793ff14a.js","./ScaleRangeLayer-d1b04b80.js","./ElevationInfo-005ddd87.js","./lengthUtils-3c9047c4.js","./HeightModelInfo-73f516f9.js","./projection-4ac247db.js","./zscale-baa108ea.js","./spatialReferenceEllipsoidUtils-88aa82c4.js","./scaleUtils-a3b834c2.js","./layerUtils-eef15b39.js","./AttachmentInfo-23249301.js","./AttachmentQuery-f1085685.js","./ColorStop-29c89bbb.js","./utils-6a5cc1bf.js","./ItemCache-e927309e.js","./MemCache-b4d68123.js","./jsonUtils-9b4d797d.js","./UniqueValueRenderer-80c8e628.js","./diffUtils-1bae97a1.js","./colorRamps-18bbdf60.js","./sizeVariableUtils-d4870b0d.js","./visualVariableUtils-61985981.js","./jsonUtils-27937179.js","./styleUtils-689841ac.js","./DictionaryLoader-1c3435ac.js","./LRUCache-86d9ad15.js","./deprecate-ba25fc78.js","./heatmapUtils-8ee685fd.js","./Query-b0193ce7.js","./TimeExtent-64e16588.js","./Field-945b2973.js","./fieldType-24ac97df.js","./executeQueryJSON-044ac84b.js","./normalizeUtils-353ec0fc.js","./normalizeUtilsCommon-d8ea404e.js","./query-b4dff312.js","./pbfQueryUtils-481b10bc.js","./pbf-845dcafd.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./queryZScale-f6e44ca7.js","./FeatureSet-b4fbf079.js","./featureConversionUtils-aead6959.js","./RelationshipQuery-765b2184.js","./TopFeaturesQuery-d2b31d08.js","./FeatureLayer-e767d294.js","./MultiOriginJSONSupport-06f8f24a.js","./serviceCapabilitiesUtils-22f436bd.js","./arcgisLayerUrl-1b8d6c52.js","./FeatureLayerBase-633118ca.js","./OperationalLayer-db187f46.js","./TimeReference-adaa7961.js","./datetime-eed49b9b.js","./editsZScale-9d0832b8.js","./APIKeyMixin-ef4ccb38.js","./ArcGISService-24587a68.js","./CustomParametersMixin-2798ec18.js","./EditBusLayer-b1010019.js","./FeatureReductionLayer-5ef01ce2.js","./labelingInfo-e65ecbf4.js","./labelUtils-b68da70f.js","./defaultsJSON-59981e75.js","./OrderedLayer-045186a6.js","./PortalLayer-d69e402d.js","./PortalItem-4d7e1038.js","./portalItemUtils-0655aa33.js","./RefreshableLayer-12bc7ba2.js","./TemporalLayer-f231f22a.js","./FeatureTemplate-5a472038.js","./FeatureType-017f886c.js","./fieldProperties-7a0757a8.js","./FieldsIndex-113320d3.js","./versionUtils-9a1e7983.js","./styleUtils-5c617777.js","./popupUtils-b8625101.js","./callExpressionWithFeature-eb5719d8.js","./quantizationUtils-16db4e0b.js","./Scheduler-61737382.js","./ElevationSamplerData-3fc2a90f.js","./TileInfo-9973cd47.js","./Basemap-5a7c72ee.js","./loadAll-8ca49458.js","./writeUtils-b7104d82.js","./CollectionFlattener-80d223f1.js","./TablesMixin-8f62a14c.js","./WaterSurface.glsl-e13d44e2.js","./NormalUtils.glsl-84d184a7.js","./HUD.glsl-73b068b4.js","./edgeProcessing-ac701714.js","./deduplicate-a70aec6f.js","./MeshComponent-777de3ff.js","./earcut-61f7b102.js","./projection-03824933.js","./HUDMaterial.glsl-82200888.js","./sdfPrimitives-3ceeab79.js","./floatRGBA-1f66d0a4.js","./dehydratedFeatures-efdbcd90.js","./labelFormatUtils-f90ee62f.js","./orientedBoundingBox-6188c4d9.js","./quatf32-51a323b8.js","./LineCallout.glsl-76cd336e.js","./SnappingCandidate-970faec6.js","./MarkerSizing.glsl-950a18f6.js","./RibbonLine.glsl-8fe4662b.js","./LineStipple.glsl-4eef2aea.js","./LineMarker.glsl-2c017de2.js","./NativeLine.glsl-9893bc56.js","./Path.glsl-2eb74a31.js","./ColorMaterial.glsl-1d45c81e.js","./Pattern.glsl-698f2083.js","./LercDecoder-f1486af7.js","./enums-fb086c25.js","./config-f7904f35.js","./TileKey-4d1284e4.js","./workerHelper-2d7b0d57.js","./capabilities-caaa1278.js"],import.meta.url).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(i))):this.voxelWasm.addVoxelLayer(i)}removeVoxelLayerViewFromWasm(i){_(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(i)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function a_(i,e){i.layerUids||(i.layerUids=new Set),i.layerUids.add(e)}function hfe(i,e){i.graphicUids||(i.graphicUids=new Set),i.graphicUids.add(e)}function t1(i,e){return _(i)&&u2(i.spatialReference,e)?rw(i,e):null}var cy;Ie.type="3d",d([p()],Ie.prototype,"_userClippingArea",void 0),d([p()],Ie.prototype,"_resourceController",void 0),d([p()],Ie.prototype,"_stage",void 0),d([p({readOnly:!0})],Ie.prototype,"deconflictor",void 0),d([p({readOnly:!0})],Ie.prototype,"labeler",void 0),d([p(JC(Qf,"analyses"))],Ie.prototype,"analyses",void 0),d([p({type:Zf,readOnly:!0})],Ie.prototype,"animation",null),d([p({readOnly:!0})],Ie.prototype,"basemapTerrain",void 0),d([p({readOnly:!0})],Ie.prototype,"elevationProvider",void 0),d([p()],Ie.prototype,"camera",null),d([p({type:bo})],Ie.prototype,"contentCamera",null),d([p({readOnly:!0})],Ie.prototype,"canvas",void 0),d([p({type:kt})],Ie.prototype,"center",null),d([p({type:ms})],Ie.prototype,"clippingArea",null),d([p({type:Wu})],Ie.prototype,"constraints",void 0),d([p({type:ms,readOnly:!0})],Ie.prototype,"renderDataExtent",null),d([p({type:ms,readOnly:!0})],Ie.prototype,"dataExtent",null),d([p({type:ms,readOnly:!0})],Ie.prototype,"_groundAndLayersExtent",null),d([p({value:null,type:Qm})],Ie.prototype,"environment",null),d([ss("environment")],Ie.prototype,"castEnvironment",null),d([p({readOnly:!0})],Ie.prototype,"environmentManager",void 0),d([p({type:ms})],Ie.prototype,"extent",null),d([p()],Ie.prototype,"floors",void 0),d([p()],Ie.prototype,"screenCenter",null),d([p()],Ie.prototype,"frustum",null),d([p({type:Number,readOnly:!0})],Ie.prototype,"fullOpacity",void 0),d([p({readOnly:!0})],Ie.prototype,"graphicsView",void 0),d([p({readOnly:!0})],Ie.prototype,"analysisViewManager",void 0),d([p()],Ie.prototype,"groundView",void 0),d([p({type:Boolean})],Ie.prototype,"initialExtentRequired",null),d([p()],Ie.prototype,"_defaultsFromMapSettings",null),d([p()],Ie.prototype,"interacting",null),d([p()],Ie.prototype,"stationary",null),d([p()],Ie.prototype,"navigating",null),d([p()],Ie.prototype,"map",void 0),d([p({readOnly:!0})],Ie.prototype,"mapCoordsHelper",void 0),d([p()],Ie.prototype,"padding",null),d([p({type:wn,readOnly:!0})],Ie.prototype,"pointsOfInterest",void 0),d([p({type:Jr,readOnly:!0})],Ie.prototype,"featureTiles",void 0),d([p()],Ie.prototype,"_featureTreeDebugger",void 0),d([p({type:Boolean})],Ie.prototype,"screenSizePerspectiveEnabled",void 0),d([p({constructOnly:!0})],Ie.prototype,"deactivatedWebGLExtensions",void 0),d([p({constructOnly:!0})],Ie.prototype,"debugWebGLExtensions",void 0),d([p({constructOnly:!0})],Ie.prototype,"renderCanvas",void 0),d([p({constructOnly:!0})],Ie.prototype,"state",void 0),d([p({readOnly:!0})],Ie.prototype,"inputManager",void 0),d([p({readOnly:!0})],Ie.prototype,"stateManager",void 0),d([p({type:["low","medium","high"]})],Ie.prototype,"qualityProfile",null),d([p({type:wD,get(){let i=this._get("qualitySettings");return i||(i=new wD,I1.apply(this.qualityProfile,i)),i}})],Ie.prototype,"qualitySettings",void 0),d([p()],Ie.prototype,"slicePlane",null),d([p({readOnly:!0})],Ie.prototype,"typeSpecificPreconditionsReady",null),d([p({readOnly:!0})],Ie.prototype,"renderCoordsHelper",void 0),d([p({readOnly:!0})],Ie.prototype,"sceneIntersectionHelper",void 0),d([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ie.prototype,"resolution",null),d([p({type:Number})],Ie.prototype,"scale",null),d([p()],Ie.prototype,"heightModelInfo",null),d([p()],Ie.prototype,"spatialReference",void 0),d([p({type:Boolean,constructOnly:!0})],Ie.prototype,"alphaCompositingEnabled",void 0),d([p({constructOnly:!0})],Ie.prototype,"preserveDrawingBufferEnabled",void 0),d([p({type:Boolean})],Ie.prototype,"supersampleScreenshotsEnabled",void 0),d([p({readOnly:!0})],Ie.prototype,"type",void 0),d([p({type:f8})],Ie.prototype,"ui",void 0),d([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating","state.mode"]})],Ie.prototype,"updating",null),d([p({type:Number,readOnly:!0,dependsOn:["updating"]})],Ie.prototype,"updatingProgress",void 0),d([p({type:["global","local"]})],Ie.prototype,"viewingMode",null),d([p({type:hl})],Ie.prototype,"viewpoint",null),d([p({type:Number})],Ie.prototype,"zoom",null),d([p({type:OS})],Ie.prototype,"highlightOptions",void 0),Ie=d([k("esri.views.SceneView")],Ie),function(i){i[i.INCLUDE=0]="INCLUDE",i[i.EXCLUDE=1]="EXCLUDE"}(cy||(cy={}));const km=E(),WC=Fi(),y$=Ot(),M2e=Ie;export{Di as $,Ma as A,Xee as B,Ld as C,lte as D,es as E,Rne as F,XR as G,Cr as H,cU as I,b0e as J,Ri as K,sH as L,Rae as M,jne as N,U5 as O,wd as P,Qi as Q,y2e as R,Pj as S,k0e as T,SR as U,Hoe as V,gCe as W,TA as X,bve as Y,ir as Z,zt as _,Vbe as a,vve as a$,Li as a0,rg as a1,w0e as a2,wae as a3,nA as a4,Qte as a5,g2e as a6,Mv as a7,qhe as a8,V5 as a9,dl as aA,ooe as aB,loe as aC,Nye as aD,Lye as aE,$ye as aF,tc as aG,Kwe as aH,bh as aI,vf as aJ,jwe as aK,ES as aL,xw as aM,zye as aN,kye as aO,Gye as aP,Hye as aQ,Fye as aR,aH as aS,See as aT,BO as aU,xve as aV,VO as aW,uae as aX,Id as aY,Vb as aZ,P9 as a_,Uf as aa,fbe as ab,VEe as ac,ml as ad,_be as ae,Mee as af,Zl as ag,x0e as ah,Pae as ai,MCe as aj,Jn as ak,Sa as al,cA as am,Ir as an,C9 as ao,pg as ap,_0 as aq,yS as ar,m2e as as,dTe as at,$le as au,aCe as av,nCe as aw,lCe as ax,rCe as ay,fC as az,Tee as b,NV as b$,L0e as b0,hre as b1,ze as b2,ube as b3,_N as b4,E3 as b5,j3 as b6,Oy as b7,tg as b8,XE as b9,bX as bA,H4 as bB,xR as bC,EX as bD,qX as bE,cY as bF,Ep as bG,Ace as bH,Jhe as bI,NA as bJ,vV as bK,cde as bL,xV as bM,dde as bN,EV as bO,pde as bP,AV as bQ,fde as bR,V4 as bS,dX as bT,Tle as bU,xle as bV,Yw as bW,Cle as bX,Yde as bY,LV as bZ,Kde as b_,tx as ba,Hte as bb,b2e as bc,x2e as bd,w2e as be,UO as bf,Il as bg,K2 as bh,DZ as bi,J2 as bj,vh as bk,_H as bl,uh as bm,bw as bn,aM as bo,wve as bp,Fp as bq,FU as br,ece as bs,j_ as bt,Zj as bu,tX as bv,F4 as bw,$4 as bx,lX as by,vR as bz,m_ as c,eue as c0,BV as c1,ex as c2,mue as c3,Tue as c4,Lue as c5,Fue as c6,Uue as c7,zV as c8,_ue as c9,tpe as ca,S5 as cb,pH as cc,Ms as cd,ope as ce,SM as d,ty as e,zwe as f,hte as g,rs as h,Rbe as i,ra as j,mbe as k,sd as l,Sbe as m,hR as n,ph as o,Sne as p,_Te as q,rA as r,Bbe as s,to as t,bp as u,vbe as v,ybe as w,wo as x,M2e as y,e6 as z};
