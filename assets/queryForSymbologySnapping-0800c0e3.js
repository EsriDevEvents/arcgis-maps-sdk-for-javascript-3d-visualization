import"./geometry-7d866d3f.js";import{t as I,r as $}from"./typedArrayUtil-bf9f210a.js";import{f as j}from"./promiseUtils-5940888c.js";import{M as q}from"./dehydratedFeatures-efdbcd90.js";import{a as C}from"./elevationInfoUtils-d3b9d588.js";import{v as z,w as F,ap as G,ad as O,aq as E}from"./SceneView-7ac05f56.js";import{f as P}from"./Extent-22afa84a.js";import{i as A}from"./arcadeOnDemand-dd48afd7.js";async function L(r,p,d,f,s){const{elevationProvider:h,renderCoordsHelper:i,spatialReference:b}=r,{elevationInfo:g}=p,y=z(g,!0),w=await F(y,b,s);j(s);const c=[],u=new Set,l=new Set;for(const{objectId:e,points:n}of f){const t=d(e);if(I(t)){for(const a of n)c.push(a[2]);u.add(e);continue}t.isDraped&&l.add(e);const o=t.graphic.geometry;v.setFromElevationInfo(C(o,g)),v.updateFeatureExpressionInfoContext(w,t.graphic,p),m.spatialReference=r.spatialReference;for(const{x:a,y:x,z:D}of n)m.x=a,m.y=x,m.z=D??0,G(m,h,v,i,S),c.push(S.z)}return{elevations:c,drapedObjectIds:l,failedObjectIds:u}}const v=new O,m=q(0,0,0,P.WGS84),S=new E;async function N(r,p,d){if(I(r)||p.candidates.length===0)return R;const f=r.graphics3DGraphicsByObjectID??r.graphics3DGraphics,s=[],h=[],{renderer:i}=r,b=$(i)&&"arcadeRequired"in i&&i.arcadeRequired?A():null,g=async(e,{graphic:n,graphics3DSymbol:t})=>{const o=await b,a=await r.getRenderingInfoAsync(n,i,o,{signal:d});return I(a)?[]:t.queryForSnapping(e,w,a,d)},{candidates:y,spatialReference:w}=p;for(let e=0;e<y.length;++e){const n=y[e],{objectId:t}=n,o=typeof t=="number"?f==null?void 0:f.get(t):void 0;if(I(o))continue;const{graphics3DSymbol:a}=o;a.symbologySnappingSupported&&(s.push(g(n,o)),h.push(e))}if(s.length===0)return R;const c=await Promise.all(s);j(d);const u=[],l=[];for(let e=0;e<c.length;++e){const n=c[e],t=h[e];for(const o of n)u.push(o),l.push(t)}return{candidates:u,sourceCandidateIndices:l}}const R={candidates:[],sourceCandidateIndices:[]};export{N as a,L as m};
