import{_ as A}from"./preload-helper-41c905a7.js";import"./geometry-7d866d3f.js";import{s as D,a as T}from"./Error-5cdd6e0a.js";import{r as O}from"./typedArrayUtil-bf9f210a.js";import{f as j}from"./Extent-22afa84a.js";const E=D.getLogger("esri.support.arcadeOnDemand");let y;function L(){return y||(y=(async()=>{const a=await A(()=>import("./arcadeUtils-1329e1ca.js").then(e=>e.ax),["./arcadeUtils-1329e1ca.js","./geometry-7d866d3f.js","./ArrayPool-b51874dd.js","./string-53224faa.js","./typedArrayUtil-bf9f210a.js","./Error-5cdd6e0a.js","./Extent-22afa84a.js","./jsonMap-ffa742d3.js","./nextTick-3ee5a785.js","./promiseUtils-5940888c.js","./Ellipsoid-89682c5e.js","./Polyline-82cb63bc.js","./typeUtils-1714017f.js","./preload-helper-41c905a7.js","./ArcadeDate-9f8ea201.js","./executionError-fb3f283a.js","./datetime-eed49b9b.js","./number-08a18d0d.js","./locale-fe7cc1d0.js","./Field-945b2973.js","./enumeration-925aa0f6.js","./fieldType-24ac97df.js","./jsonUtils-36bf3d33.js","./featureConversionUtils-aead6959.js","./aaBoundingBox-fb003858.js","./aaBoundingRect-2fb32e32.js","./mathUtils-ae09f98b.js","./vec3-8818fe1c.js","./common-d0b63c2d.js","./vec4-c7a19f0d.js","./OptimizedFeature-3e582950.js","./OptimizedFeatureSet-1d1ac4b9.js","./request-09e7d9b2.js","./hash-0ddfbf4b.js","./Portal-8dfa7a94.js","./Loadable-40ecd3b9.js","./Promise-755e47e5.js","./PortalGroup-00fb77a4.js","./PortalUser-9579f611.js","./sizeVariableUtils-d4870b0d.js"],import.meta.url);return{arcade:a.arcade,arcadeUtils:a,Dictionary:a.Dictionary,Feature:a.arcadeFeature}})()),y}const J=(a,e,s)=>o.create(a,e,s,null,["$feature"]),N=(a,e,s)=>o.create(a,e,s,null,["$feature","$view"]),V=(a,e,s,c)=>o.create(a,e,s,c,["$feature","$view"]);class o{constructor(e,s,c,l,m,n,r){this.script=e,this.evaluate=l;const f=Array.isArray(n)?n:n.fields;this.fields=f,this._syntaxTree=c,this._arcade=s,this._arcadeFeature=m,this._spatialReference=r,this._referencesGeometry=s.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,s,c,l,m,n){const{arcade:r,Feature:f,Dictionary:h}=await L(),d=j.fromJSON(s);let i;try{i=r.parseScript(e,n)}catch(t){return E.error(new T("arcade-bad-expression","Failed to parse arcade script",{script:e,error:t})),null}const _=m.reduce((t,x)=>({...t,[x]:null}),{});let u=null;O(l)&&(u=new h(l),u.immutable=!0,_.$config=null);const w=r.scriptUsesGeometryEngine(i),F=w&&r.enableGeometrySupport(),S=r.scriptUsesFeatureSet(i)&&r.enableFeatureSetSupport(),$=r.scriptIsAsync(i),v=$&&r.enableAsyncSupport(),b={vars:_,spatialReference:d,useAsync:!!v};await Promise.all([F,S,v]);const g=new Set;await r.loadDependentModules(g,i,null,$,w);const p=new h;p.immutable=!1,p.setField("scale",0);const G=r.compileScript(i,b),R=t=>("$view"in t&&t.$view&&(p.setField("scale",typeof t.$view=="object"?t.$view.scale:void 0),t.$view=p),u&&(t.$config=u),G({vars:t,spatialReference:d}));return new o(e,r,i,R,new f,c,d)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}}export{L as i,J as n,N as o,V as p,o as u};
